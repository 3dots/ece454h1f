cscope 15 /nfs/ug/homes-5/r/riabtse1/sysProg/hw1/orig/SRC -q 0000002925 0000734562
	@CheckArch.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"O±i⁄Tokís.h
"

6 
	~"RódO±i⁄s.h
"

7 
	~"xml_¨ch.h
"

8 
	~"SëupVPR.h
"

11 
CheckSwôches
(
IN
 
t_¨ch
 
Arch
,

12 
IN
 
boﬁón
 
TimögE«bÀd
);

14 
CheckSegmíts
(
IN
 
t_¨ch
 
Arch
);

19 
	$CheckArch
(
IN
 
t_¨ch
 
Arch
,

20 
IN
 
boﬁón
 
TimögE«bÀd
)

22 
	`CheckSwôches
(
Arch
, 
TimögE«bÀd
);

23 
	`CheckSegmíts
(
Arch
);

24 
	}
}

27 
	$CheckSwôches
(
IN
 
t_¨ch
 
Arch
,

28 
IN
 
boﬁón
 
TimögE«bÀd
)

30 
s_swôch_öf
 *
CurSwôch
;

31 
i
;

34 
CurSwôch
 = 
Arch
.
Swôches
;

35 
i
 = 0; i < 
Arch
.
num_swôches
; i++)

38 if(
CurSwôch
->
buf„ªd
 && 
Arch
.
Segmíts
[0].
dúe˘i⁄Æôy
 =
BI_DIRECTIONAL
)

44 if(
CurSwôch
->
R
 > 2 * 
Arch
.
R_möW_nmos
)

46 
	`¥ötf
(
ERRTAG


48 "2 * R_möW_nmo†(%g).\n", 
CurSwôch
->
«me
,

49 
CurSwôch
->
R
, (2 * 
Arch
.
R_möW_nmos
));

50 
	`exô
(1);

55 if(
CurSwôch
->
R
 > 
Arch
.
R_möW_nmos
)

57 
	`¥ötf
(
ERRTAG


59 "R_möW_nmo†(%g).\n", 
CurSwôch
->
«me
,

60 
CurSwôch
->
R
, 
Arch
.
R_möW_nmos
);

61 
	`exô
(1);

65 
	}
}

67 
	$CheckSegmíts
(
IN
 
t_¨ch
 
Arch
) {

68 
t_£gmít_öf
 *
CurSeg
;

69 
i
;

71 
CurSeg
 = 
Arch
.
Segmíts
;

72 
i
 = 0; i < 
Arch
.
num_£gmíts
; i++)

74 if(
CurSeg
[
i
].
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
 && CurSeg[i].
l⁄glöe
 =
TRUE
) {

75 
	`¥ötf
("LongÜinesÇot supported for unidirectionalárchitectures\n");

76 
	`exô
(1);

79 
	}
}

	@CheckOptions.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"O±i⁄Tokís.h
"

6 
	~"RódO±i⁄s.h
"

7 
	~"xml_¨ch.h
"

8 
	~"SëupVPR.h
"

13 
	$CheckO±i⁄s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

14 
IN
 
boﬁón
 
TimögE«bÀd
)

16 
i
;

17 
boﬁón
 
Pœ˚r
;

18 
boﬁón
 
TimögPœ˚r
;

19 
boﬁón
 
Rouãr
;

20 
boﬁón
 
TimögRouãr
;

21 c⁄° 
s_TokíPaú
 *
Cur
;

22 
e_O±i⁄Ba£Tokí
 
Yes
;

25 if((
NULL
 =
O±i⁄s
.
NëFûe
) ||

26 (
NULL
 =
O±i⁄s
.
ArchFûe
) ||

27 (
NULL
 =
O±i⁄s
.
Pœ˚Fûe
Ë|| (NULL =O±i⁄s.
RouãFûe
))

29 
	`¥ötf
(
ERRTAG
 "NotÉnoughárgs. NeedátÜeast 'vpr "

31 
	`exô
(1);

35 
Cur
 = 
O±i⁄Ba£TokíLi°
;

36 
Cur
->
Så
)

38 if(
O±i⁄s
.
Cou¡
[
Cur
->
Enum
] > 1)

40 
	`¥ötf
(
ERRTAG
 "Parameter '%s' was specified moreÅhan "

41 "⁄˚ o¿comm™dÜöe.\n", 
Cur
->
Så
);

42 
	`exô
(1);

44 ++
Cur
;

49 
i
 = 0;

50 
Pœ˚r
 = 
TRUE
;

51 
Rouãr
 = 
TRUE
;

52 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_ONLY
])

54 ++
i
;

55 
Pœ˚r
 = 
FALSE
;

57 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_ONLY
])

59 ++
i
;

60 
Rouãr
 = 
FALSE
;

62 if(
O±i⁄s
.
Cou¡
[
OT_TIMING_ANALYZE_ONLY_WITH_NET_DELAY
])

64 ++
i
;

65 
Pœ˚r
 = 
FALSE
;

66 
Rouãr
 = 
FALSE
;

68 if(
i
 > 1)

70 
	`¥ötf
(
ERRTAG
 "'route_only', 'place_only',ánd "

73 
	`exô
(1);

77 
TimögPœ˚r
 = (
Pœ˚r
 && 
TimögE«bÀd
);

78 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_ALGORITHM
] > 0)

80 if((
PATH_TIMING_DRIVEN_PLACE
 !
O±i⁄s
.
Pœ˚Alg‹ôhm
) &&

81 (
NET_TIMING_DRIVEN_PLACE
 !
O±i⁄s
.
Pœ˚Alg‹ôhm
))

84 
TimögPœ˚r
 = 
FALSE
;

89 
TimögRouãr
 = (
Rouãr
 && 
TimögE«bÀd
);

90 if(
O±i⁄s
.
Cou¡
[
OT_ROUTER_ALGORITHM
] > 0)

92 if(
TIMING_DRIVEN
 !
O±i⁄s
.
RouãrAlg‹ôhm
)

95 
TimögRouãr
 = 
FALSE
;

99 
Yes
 = 
OT_BASE_UNKNOWN
;

100 if(
O±i⁄s
.
Cou¡
[
OT_SEED
] > 0)

102 
Yes
 = 
OT_SEED
;

104 if(
O±i⁄s
.
Cou¡
[
OT_INNER_NUM
] > 0)

106 
Yes
 = 
OT_INNER_NUM
;

108 if(
O±i⁄s
.
Cou¡
[
OT_INIT_T
] > 0)

110 
Yes
 = 
OT_INIT_T
;

112 if(
O±i⁄s
.
Cou¡
[
OT_ALPHA_T
] > 0)

114 
Yes
 = 
OT_ALPHA_T
;

116 if(
O±i⁄s
.
Cou¡
[
OT_EXIT_T
] > 0)

118 
Yes
 = 
OT_EXIT_T
;

120 if(
O±i⁄s
.
Cou¡
[
OT_FIX_PINS
] > 0)

122 
Yes
 = 
OT_FIX_PINS
;

124 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_ALGORITHM
] > 0)

126 
Yes
 = 
OT_PLACE_ALGORITHM
;

128 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_COST_TYPE
] > 0)

130 
Yes
 = 
OT_PLACE_COST_TYPE
;

132 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_COST_EXP
] > 0)

134 
Yes
 = 
OT_PLACE_COST_EXP
;

136 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_CHAN_WIDTH
] > 0)

138 
Yes
 = 
OT_PLACE_CHAN_WIDTH
;

140 if(
O±i⁄s
.
Cou¡
[
OT_NUM_REGIONS
] > 0)

142 
Yes
 = 
OT_NUM_REGIONS
;

144 if(
O±i⁄s
.
Cou¡
[
OT_ENABLE_TIMING_COMPUTATIONS
] > 0)

146 
Yes
 = 
OT_ENABLE_TIMING_COMPUTATIONS
;

148 if(
O±i⁄s
.
Cou¡
[
OT_BLOCK_DIST
] > 0)

150 
Yes
 = 
OT_BLOCK_DIST
;

153 if((
FALSE
 =
Pœ˚r
Ë&& (
Yes
 < 
OT_BASE_UNKNOWN
))

155 
Cur
 = 
O±i⁄Ba£TokíLi°
;

156 
Cur
->
Så
)

158 if(
Yes
 =
Cur
->
Enum
)

160 
	`¥ötf
(
ERRTAG


162 "nŸÑun.\n", 
Cur
->
Så
);

163 
	`exô
(1);

165 ++
Cur
;

169 
Yes
 = 
OT_BASE_UNKNOWN
;

170 if(
O±i⁄s
.
Cou¡
[
OT_TIMING_TRADEOFF
] > 0)

172 
Yes
 = 
OT_TIMING_TRADEOFF
;

174 if(
O±i⁄s
.
Cou¡
[
OT_RECOMPUTE_CRIT_ITER
] > 0)

176 
Yes
 = 
OT_RECOMPUTE_CRIT_ITER
;

178 if(
O±i⁄s
.
Cou¡
[
OT_INNER_LOOP_RECOMPUTE_DIVIDER
] > 0)

180 
Yes
 = 
OT_INNER_LOOP_RECOMPUTE_DIVIDER
;

182 if(
O±i⁄s
.
Cou¡
[
OT_TD_PLACE_EXP_FIRST
] > 0)

184 
Yes
 = 
OT_TD_PLACE_EXP_FIRST
;

186 if(
O±i⁄s
.
Cou¡
[
OT_TD_PLACE_EXP_LAST
] > 0)

188 
Yes
 = 
OT_TD_PLACE_EXP_LAST
;

191 if((
FALSE
 =
TimögPœ˚r
Ë&& (
Yes
 < 
OT_BASE_UNKNOWN
))

193 
Cur
 = 
O±i⁄Ba£TokíLi°
;

194 
Cur
->
Så
)

196 if(
Yes
 =
Cur
->
Enum
)

198 
	`¥ötf
(
ERRTAG


200 "nŸ u£d.\n", 
Cur
->
Så
);

201 
	`exô
(1);

203 ++
Cur
;

207 
Yes
 = 
OT_BASE_UNKNOWN
;

208 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_TYPE
] > 0)

210 
Yes
 = 
OT_ROUTE_TYPE
;

212 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_CHAN_WIDTH
] > 0)

214 
Yes
 = 
OT_ROUTE_CHAN_WIDTH
;

216 if(
O±i⁄s
.
Cou¡
[
OT_ROUTER_ALGORITHM
] > 0)

218 
Yes
 = 
OT_ROUTER_ALGORITHM
;

220 if(
O±i⁄s
.
Cou¡
[
OT_MAX_ROUTER_ITERATIONS
] > 0)

222 
Yes
 = 
OT_MAX_ROUTER_ITERATIONS
;

224 if(
O±i⁄s
.
Cou¡
[
OT_INITIAL_PRES_FAC
] > 0)

226 
Yes
 = 
OT_INITIAL_PRES_FAC
;

228 if(
O±i⁄s
.
Cou¡
[
OT_FIRST_ITER_PRES_FAC
] > 0)

230 
Yes
 = 
OT_FIRST_ITER_PRES_FAC
;

232 if(
O±i⁄s
.
Cou¡
[
OT_PRES_FAC_MULT
] > 0)

234 
Yes
 = 
OT_PRES_FAC_MULT
;

236 if(
O±i⁄s
.
Cou¡
[
OT_ACC_FAC
] > 0)

238 
Yes
 = 
OT_ACC_FAC
;

240 if(
O±i⁄s
.
Cou¡
[
OT_BB_FACTOR
] > 0)

242 
Yes
 = 
OT_BB_FACTOR
;

244 if(
O±i⁄s
.
Cou¡
[
OT_BASE_COST_TYPE
] > 0)

246 
Yes
 = 
OT_BASE_COST_TYPE
;

248 if(
O±i⁄s
.
Cou¡
[
OT_BEND_COST
] > 0)

250 
Yes
 = 
OT_BEND_COST
;

252 if(
O±i⁄s
.
Cou¡
[
OT_BASE_COST_TYPE
] > 0)

254 
Yes
 = 
OT_BASE_COST_TYPE
;

256 if(
O±i⁄s
.
Cou¡
[
OT_ASTAR_FAC
] > 0)

258 
Yes
 = 
OT_ASTAR_FAC
;

261 if((
FALSE
 =
Rouãr
Ë&& (
Yes
 < 
OT_BASE_UNKNOWN
))

263 
Cur
 = 
O±i⁄Ba£TokíLi°
;

264 
Cur
->
Så
)

266 if(
Yes
 =
Cur
->
Enum
)

268 
	`¥ötf
(
ERRTAG


270 "nŸ u£d.\n", 
Cur
->
Så
);

271 
	`exô
(1);

273 ++
Cur
;

277 
Yes
 = 
OT_BASE_UNKNOWN
;

278 if(
O±i⁄s
.
Cou¡
[
OT_MAX_CRITICALITY
] > 0)

280 
Yes
 = 
OT_MAX_CRITICALITY
;

282 if(
O±i⁄s
.
Cou¡
[
OT_CRITICALITY_EXP
] > 0)

284 
Yes
 = 
OT_CRITICALITY_EXP
;

287 if((
FALSE
 =
TimögRouãr
Ë&& (
Yes
 < 
OT_BASE_UNKNOWN
))

289 
Cur
 = 
O±i⁄Ba£TokíLi°
;

290 
Cur
->
Så
)

292 if(
Yes
 =
Cur
->
Enum
)

294 
	`¥ötf
(
ERRTAG


296 "nŸ u£d.\n", 
Cur
->
Så
);

297 
	`exô
(1);

299 ++
Cur
;

302 
	}
}

	@CheckSetup.c

1 
	~"utû.h
"

2 
	~"v¥_ty≥s.h
"

3 
	~"globÆs.h
"

4 
	~"O±i⁄Tokís.h
"

5 
	~"RódO±i⁄s.h
"

6 
	~"xml_¨ch.h
"

7 
	~"SëupVPR.h
"

11 
	$CheckSëup
(
IN
 
e_›î©i⁄
 
O≥øti⁄
,

12 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

13 
IN
 
s_™√Æög_sched
 
A¬ólSched
,

14 
IN
 
s_rouãr_›ts
 
RouãrO±s
,

15 
IN
 
s_dë_routög_¨ch
 
RoutögArch
,

16 
IN
 
t_£gmít_öf
 * 
Segmíts
,

17 
IN
 
t_timög_öf
 
Timög
,

18 
IN
 
t_subblock_d©a
 
Subblocks
,

19 
IN
 
t_ch™_width_di°
 
Ch™s
)

21 
i
;

22 
Tmp
;

24 if((
NONLINEAR_CONG
 =
Pœ˚rO±s
.
∂a˚_co°_ty≥
) &&

25 (
O≥øti⁄
 !
PLACE_AND_ROUTE
) &&

26 (
PLACE_ALWAYS
 =
Pœ˚rO±s
.
∂a˚_‰eq
))

28 
	`¥ötf
(
ERRTAG
 "Replacing usingÅheÇonlinear congestion option "

31 
	`exô
(1);

34 if((
NONLINEAR_CONG
 =
Pœ˚rO±s
.
∂a˚_co°_ty≥
) &&

35 (
BOUNDING_BOX_PLACE
 !
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
))

39 
	`¥ötf
(
ERRTAG


42 
	`exô
(1);

45 if((
GLOBAL
 =
RouãrO±s
.
rouã_ty≥
) &&

46 (
TIMING_DRIVEN
 =
RouãrO±s
.
rouãr_Æg‹ôhm
))

49 
	`¥ötf
(
ERRTAG
 "The globalÑouter doesÇot supportÅiming-drvien "

51 
	`exô
(1);

54 if((
GLOBAL
 =
RouãrO±s
.
rouã_ty≥
) &&

55 (
BOUNDING_BOX_PLACE
 !
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
))

60 
	`¥ötf
(
WARNTAG


65 if((
FALSE
 =
Timög
.
timög_™Æysis_íabÀd
) &&

66 ((
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
) ||

67 (
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)))

71 
	`¥ötf
(
ERRTAG


73 
	`exô
(1);

76 if((
ROUTE_ONLY
 =
O≥øti⁄
Ë&& (
USER
 =
Pœ˚rO±s
.
∑d_loc_ty≥
))

78 
	`¥ötf
(
ERRTAG
 "You cannot specify bothá fullÖlacement fileánd "

80 
	`exô
(1);

83 if((
ROUTE_ONLY
 =
O≥øti⁄
Ë|| (
PLACE_AND_ROUTE
 == Operation))

85 if((
TIMING_DRIVEN
 =
RouãrO±s
.
rouãr_Æg‹ôhm
) &&

86 (
FALSE
 =
Timög
.
timög_™Æysis_íabÀd
))

88 
	`¥ötf
(
ERRTAG


91 
	`exô
(1);

94 if((
FALSE
 =
Timög
.
timög_™Æysis_íabÀd
) &&

95 (
DEMAND_ONLY
 !
RouãrO±s
.
ba£_co°_ty≥
))

97 
	`¥ötf
(
ERRTAG


100 
	`exô
(1);

104 if((
TIMING_ANALYSIS_ONLY
 =
O≥øti⁄
) &&

105 (
FALSE
 =
Timög
.
timög_™Æysis_íabÀd
))

107 
	`¥ötf
(
ERRTAG


110 
	`exô
(1);

113 if((
NONLINEAR_CONG
 =
Pœ˚rO±s
.
∂a˚_co°_ty≥
) &&

114 ((
Pœ˚rO±s
.
num_ªgi⁄s
 > 
nx
Ë|| (Pœ˚rO±s.num_ªgi⁄†> 
ny
)))

116 
	`¥ötf
(
ERRTAG
 "Cannot use moreÑegionsÅhan clbs in "

118 
	`exô
(1);

121 if(
DETAILED
 =
RouãrO±s
.
rouã_ty≥
)

123 if((
Ch™s
.
ch™_x_di°
.
ty≥
 !
UNIFORM
) ||

124 (
Ch™s
.
ch™_y_di°
.
ty≥
 !
UNIFORM
) ||

125 (
Ch™s
.
ch™_x_di°
.
≥ak
 !Ch™s.
ch™_y_di°
.peak) ||

126 (
Ch™s
.
ch™_x_di°
.
≥ak
 !Ch™s.
ch™_width_io
))

128 
	`¥ötf
(
ERRTAG
 "DetailedÑouting currently only supported "

130 
	`exô
(1);

134 
i
 = 0; i < 
RoutögArch
.
num_£gmít
; ++i)

136 
Tmp
 = 
Segmíts
[
i
].
›ö_swôch
;

137 if(
FALSE
 =
swôch_öf
[
Tmp
].
buf„ªd
)

139 
	`¥ötf
(
ERRTAG
 "opin_switch (#%d) of segmentÅype #%d "

140 "i†nŸ buf„ªd.\n", 
Tmp
, 
i
);

141 
	`exô
(1);

145 if(
UNI_DIRECTIONAL
 =
RoutögArch
.
dúe˘i⁄Æôy
)

147 if((
RouãrO±s
.
fixed_ch™√l_width
 !
NO_FIXED_CHANNEL_WIDTH
) &&

148 (
RouãrO±s
.
fixed_ch™√l_width
 % 2 > 0))

150 
	`¥ötf
(
ERRTAG


152 
	`exô
(1);

154 if((
Pœ˚rO±s
.
∂a˚_ch™_width
 !
NO_FIXED_CHANNEL_WIDTH
) &&

155 (
Pœ˚rO±s
.
∂a˚_ch™_width
 % 2 > 0))

157 
	`¥ötf
(
ERRTAG


159 
	`exô
(1);

162 
	}
}

	@OptionTokens.c

1 
	~"utû.h
"

2 
	~"v¥_ty≥s.h
"

3 
	~"O±i⁄Tokís.h
"

7 c⁄° 
s_TokíPaú
 
	gO±i⁄Ba£TokíLi°
[] = {

8 {"nodi•", 
OT_NODISP
},

9 {"auto", 
OT_AUTO
},

10 {"ªcompuã_¸ô_ôî", 
OT_RECOMPUTE_CRIT_ITER
},

11 {"ö√r_lo›_ªcompuã_dividî", 
OT_INNER_LOOP_RECOMPUTE_DIVIDER
},

12 {"fix_pös", 
OT_FIX_PINS
},

13 {"fuŒ_°©s", 
OT_FULL_STATS
},

14 {"Á°", 
OT_FAST
},

15 {"timög_™Æysis", 
OT_TIMING_ANALYSIS
},

17 
OT_TIMING_ANALYZE_ONLY_WITH_NET_DELAY
},

18 {"öô_t", 
OT_INIT_T
},

19 {"Æpha_t", 
OT_ALPHA_T
},

20 {"exô_t", 
OT_EXIT_T
},

21 {"ö√r_num", 
OT_INNER_NUM
},

22 {"£ed", 
OT_SEED
},

23 {"∂a˚_co°_exp", 
OT_PLACE_COST_EXP
},

24 {"td_∂a˚_exp_fú°", 
OT_TD_PLACE_EXP_FIRST
},

25 {"td_∂a˚_exp_œ°", 
OT_TD_PLACE_EXP_LAST
},

26 {"∂a˚_Æg‹ôhm", 
OT_PLACE_ALGORITHM
},

27 {"timög_åadeoff", 
OT_TIMING_TRADEOFF
},

28 {"íabÀ_timög_compuèti⁄s", 
OT_ENABLE_TIMING_COMPUTATIONS
},

29 {"block_di°", 
OT_BLOCK_DIST
},

30 {"∂a˚_co°_ty≥", 
OT_PLACE_COST_TYPE
},

31 {"num_ªgi⁄s", 
OT_NUM_REGIONS
},

32 {"∂a˚_ch™_width", 
OT_PLACE_CHAN_WIDTH
},

33 {"max_rouãr_ôî©i⁄s", 
OT_MAX_ROUTER_ITERATIONS
},

34 {"bb_Á˘‹", 
OT_BB_FACTOR
},

35 {"rouãr_Æg‹ôhm", 
OT_ROUTER_ALGORITHM
},

36 {"fú°_ôî_¥es_Ác", 
OT_FIRST_ITER_PRES_FAC
},

37 {"öôül_¥es_Ác", 
OT_INITIAL_PRES_FAC
},

38 {"¥es_Ác_mu…", 
OT_PRES_FAC_MULT
},

39 {"acc_Ác", 
OT_ACC_FAC
},

40 {"a°¨_Ác", 
OT_ASTAR_FAC
},

41 {"max_¸ôiˇlôy", 
OT_MAX_CRITICALITY
},

42 {"¸ôiˇlôy_exp", 
OT_CRITICALITY_EXP
},

43 {"ba£_co°_ty≥", 
OT_BASE_COST_TYPE
},

44 {"bíd_co°", 
OT_BEND_COST
},

45 {"rouã_ty≥", 
OT_ROUTE_TYPE
},

46 {"rouã_ch™_width", 
OT_ROUTE_CHAN_WIDTH
},

47 {"rouã_⁄ly", 
OT_ROUTE_ONLY
},

48 {"∂a˚_⁄ly", 
OT_PLACE_ONLY
},

49 {"vîify_bö¨y_£¨ch", 
OT_VERIFY_BINARY_SEARCH
},

50 {"outfûe_¥efix", 
OT_OUTFILE_PREFIX
},

51 {
NULL
, 
OT_BASE_UNKNOWN
}

55 c⁄° 
s_TokíPaú
 
	gO±i⁄ArgTokíLi°
[] = {

56 {"⁄", 
OT_ON
},

57 {"off", 
OT_OFF
},

58 {"øndom", 
OT_RANDOM
},

59 {"boundög_box", 
OT_BOUNDING_BOX
},

60 {"√t_timög_driví", 
OT_NET_TIMING_DRIVEN
},

61 {"∑th_timög_driví", 
OT_PATH_TIMING_DRIVEN
},

62 {"löór", 
OT_LINEAR
},

63 {"n⁄löór", 
OT_NONLINEAR
},

64 {"bªadth_fú°", 
OT_BREADTH_FIRST
},

65 {"timög_driví", 
OT_TIMING_DRIVEN
},

66 {"dúe˘ed_£¨ch", 
OT_DIRECTED_SEARCH
},

67 {"öåösic_dñay", 
OT_INTRINSIC_DELAY
},

68 {"dñay_n‹mÆized", 
OT_DELAY_NORMALIZED
},

69 {"dem™d_⁄ly", 
OT_DEMAND_ONLY
},

70 {"globÆ", 
OT_GLOBAL
},

71 {"dëaûed", 
OT_DETAILED
},

72 {
NULL
, 
OT_BASE_UNKNOWN
}

	@OptionTokens.h

3 
	ee_O±i⁄Ba£Tokí


5 
	mOT_NODISP
,

6 
	mOT_AUTO
,

7 
	mOT_RECOMPUTE_CRIT_ITER
,

8 
	mOT_INNER_LOOP_RECOMPUTE_DIVIDER
,

9 
	mOT_FIX_PINS
,

10 
	mOT_FULL_STATS
,

11 
	mOT_READ_PLACE_ONLY
,

12 
	mOT_FAST
,

13 
	mOT_TIMING_ANALYSIS
,

14 
	mOT_TIMING_ANALYZE_ONLY_WITH_NET_DELAY
,

15 
	mOT_INIT_T
,

16 
	mOT_ALPHA_T
,

17 
	mOT_EXIT_T
,

18 
	mOT_INNER_NUM
,

19 
	mOT_SEED
,

20 
	mOT_PLACE_COST_EXP
,

21 
	mOT_TD_PLACE_EXP_FIRST
,

22 
	mOT_TD_PLACE_EXP_LAST
,

23 
	mOT_PLACE_ALGORITHM
,

24 
	mOT_TIMING_TRADEOFF
,

25 
	mOT_ENABLE_TIMING_COMPUTATIONS
,

26 
	mOT_BLOCK_DIST
,

27 
	mOT_PLACE_COST_TYPE
,

28 
	mOT_NUM_REGIONS
,

29 
	mOT_PLACE_CHAN_WIDTH
,

30 
	mOT_MAX_ROUTER_ITERATIONS
,

31 
	mOT_BB_FACTOR
,

32 
	mOT_ROUTER_ALGORITHM
,

33 
	mOT_FIRST_ITER_PRES_FAC
,

34 
	mOT_INITIAL_PRES_FAC
,

35 
	mOT_PRES_FAC_MULT
,

36 
	mOT_ACC_FAC
,

37 
	mOT_ASTAR_FAC
,

38 
	mOT_MAX_CRITICALITY
,

39 
	mOT_CRITICALITY_EXP
,

40 
	mOT_BASE_COST_TYPE
,

41 
	mOT_BEND_COST
,

42 
	mOT_ROUTE_TYPE
,

43 
	mOT_ROUTE_CHAN_WIDTH
,

44 
	mOT_ROUTE_ONLY
,

45 
	mOT_PLACE_ONLY
,

46 
	mOT_VERIFY_BINARY_SEARCH
,

47 
	mOT_OUTFILE_PREFIX
,

48 
	mOT_BASE_UNKNOWN


52 
	ee_O±i⁄ArgTokí


54 
	mOT_ON
,

55 
	mOT_OFF
,

56 
	mOT_RANDOM
,

57 
	mOT_BOUNDING_BOX
,

58 
	mOT_NET_TIMING_DRIVEN
,

59 
	mOT_PATH_TIMING_DRIVEN
,

60 
	mOT_LINEAR
,

61 
	mOT_NONLINEAR
,

62 
	mOT_BREADTH_FIRST
,

63 
	mOT_TIMING_DRIVEN
,

64 
	mOT_DIRECTED_SEARCH
,

65 
	mOT_INTRINSIC_DELAY
,

66 
	mOT_DELAY_NORMALIZED
,

67 
	mOT_DEMAND_ONLY
,

68 
	mOT_GLOBAL
,

69 
	mOT_DETAILED
,

70 
	mOT_ARG_UNKNOWN


74 c⁄° 
s_TokíPaú
 
O±i⁄Ba£TokíLi°
[];

75 c⁄° 
s_TokíPaú
 
O±i⁄ArgTokíLi°
[];

	@ReadLine.c

1 
	~<°dio.h
>

2 
	~<°rög.h
>

3 
	~<°dlib.h
>

4 
	~<as£π.h
>

5 
	~"utû.h
"

6 
	~"RódLöe.h
"

11 
	$FªeTokís
(
INOUT
 ***
TokísPå
)

13 
	`as£π
(*
TokísPå
);

14 
	`as£π
(**
TokísPå
);

16 
	`‰ì
(**
TokísPå
);

17 
	`‰ì
(*
TokísPå
);

18 *
TokísPå
 = 
NULL
;

19 
	}
}

24 
	$Cou¡Tokís
(
IN
 **
Tokís
)

26 
cou¡
 = 0;

28 if(
NULL
 =
Tokís
)

32 
Tokís
[
cou¡
])

34 ++
cou¡
;

36  
cou¡
;

37 
	}
}

48 
	$RódLöeTokís
(
INOUT
 
FILE
 * 
InFûe
,

49 
INOUT
 *
LöeNum
)

53 { 
BUFFSIZE
 = 65536 };

54 
Buf„r
[
BUFFSIZE
];

55 *
Res
;

56 *
La°
;

57 *
Cur
;

58 *
D°
;

59 **
Tokís
;

60 
TokíCou¡
;

61 
Lí
;

62 
CurTokí
;

63 
boﬁón
 
InTokí
;

68 
Res
 = 
	`fgës
(
Buf„r
, 
BUFFSIZE
, 
InFûe
);

69 if(
NULL
 =
Res
)

71 if(
	`„of
(
InFûe
))

73  
NULL
;

77 
	`¥ötf
(
ERRTAG
 "UnexpectedÉrrorÑeading file\n");

78 
	`exô
(1);

81 ++(*
LöeNum
);

84 
La°
 = 
Buf„r
 + 
	`°æí
(Buffer);

85 if((
La°
 > 
Buf„r
) && ('\n' == Last[-1]))

87 --
La°
;

89 if((
La°
 > 
Buf„r
) && ('\r' == Last[-1]))

91 --
La°
;

95 (
La°
 > 
Buf„r
) && ('\\' == Last[-1]))

98 --
La°
;

101 
Res
 = 
	`fgës
(
La°
, (
BUFFSIZE
 - (La° - 
Buf„r
)), 
InFûe
);

102 if(
NULL
 =
Res
)

104 if(
	`„of
(
InFûe
))

106  
NULL
;

110 
	`¥ötf
(
ERRTAG


112 
	`exô
(1);

115 ++(*
LöeNum
);

118 
La°
 = 
Buf„r
 + 
	`°æí
(Buffer);

119 if((
La°
 > 
Buf„r
) && ('\n' == Last[-1]))

121 --
La°
;

123 if((
La°
 > 
Buf„r
) && ('\r' == Last[-1]))

125 --
La°
;

130 
Cur
 = 
Buf„r
;

131 
Cur
 < 
La°
)

133 if('#' =*
Cur
)

135 
La°
 = 
Cur
;

138 ++
Cur
;

142 
	`as£π
(
La°
 < (
Buf„r
 + 
BUFFSIZE
));

143 
Lí
 = 0;

144 
TokíCou¡
 = 0;

145 
Cur
 = 
Buf„r
;

146 
InTokí
 = 
FALSE
;

147 
Cur
 < 
La°
)

149 if(
InTokí
)

151 if((' ' =*
Cur
) || ('\t' == *Cur))

153 
InTokí
 = 
FALSE
;

157 ++
Lí
;

162 if((' ' !*
Cur
) && ('\t' != *Cur))

164 ++
TokíCou¡
;

165 ++
Lí
;

166 
InTokí
 = 
TRUE
;

169 ++
Cur
;

172 0 =
TokíCou¡
);

176 
Lí
 = (() * Len) +

177 ((Ë* 
TokíCou¡
);

181 
Tokís
 = (**)
	`my_mÆloc
((*Ë* (
TokíCou¡
 + 1));

182 *
Tokís
 = (*)
	`my_mÆloc
((Ë* 
Lí
);

185 
Cur
 = 
Buf„r
;

186 
D°
 = *
Tokís
;

187 
InTokí
 = 
FALSE
;

188 
CurTokí
 = 0;

189 
Cur
 < 
La°
)

191 if(
InTokí
)

193 if((' ' =*
Cur
) || ('\t' == *Cur))

195 
InTokí
 = 
FALSE
;

196 *
D°
 = '\0';

197 ++
D°
;

198 ++
CurTokí
;

202 *
D°
 = *
Cur
;

203 ++
D°
;

208 if((' ' !*
Cur
) && ('\t' != *Cur))

210 
Tokís
[
CurTokí
] = 
D°
;

211 *
D°
 = *
Cur
;

212 ++
D°
;

213 
InTokí
 = 
TRUE
;

216 ++
Cur
;

218 if(
InTokí
)

220 *
D°
 = '\0';

221 ++
D°
;

222 ++
CurTokí
;

224 
	`as£π
(
CurTokí
 =
TokíCou¡
);

227 
Tokís
[
CurTokí
] = 
NULL
;

230  
Tokís
;

231 
	}
}

	@ReadLine.h

1 **
RódLöeTokís
(
INOUT
 
FILE
 * 
InFûe
,

2 
INOUT
 *
LöeNum
);

3 
Cou¡Tokís
(
IN
 **
Tokís
);

4 
FªeTokís
(
INOUT
 ***
TokísPå
);

	@ReadOptions.c

1 
	~<°dio.h
>

2 
	~<°rög.h
>

3 
	~<as£π.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"O±i⁄Tokís.h
"

7 
	~"RódO±i⁄s.h
"

11 c⁄° *c⁄° *
RódBa£Tokí
(
IN
 c⁄° *c⁄° *
Args
,

12 
OUT
 
e_O±i⁄Ba£Tokí
 *
Tokí
);

13 
Eº‹
(
IN
 c⁄° *
Tokí
);

14 
Eº‹O±i⁄
(
IN
 c⁄° *
O±i⁄
);

15 c⁄° *c⁄° *
Pro˚ssO±i⁄
(
IN
 c⁄° *c⁄° *
Args
,

16 
INOUT
 
t_›ti⁄s
 * 
O±i⁄s
);

17 c⁄° *c⁄° *
RódFlﬂt
(
IN
 c⁄° *c⁄° *
Args
,

18 
OUT
 *
VÆ
);

19 c⁄° *c⁄° *
RódI¡
(
IN
 c⁄° *c⁄° *
Args
,

20 
OUT
 *
VÆ
);

21 c⁄° *c⁄° *
RódOnOff
(
IN
 c⁄° *c⁄° *
Args
,

22 
OUT
 
boﬁón
 * 
VÆ
);

23 c⁄° *c⁄° *
RódFixPös
(
IN
 c⁄° *c⁄° *
Args
,

24 
OUT
 **
PöFûe
);

25 c⁄° *c⁄° *
RódPœ˚Alg‹ôhm
(
IN
 c⁄° *c⁄° *
Args
,

26 
OUT
 
e_∂a˚_Æg‹ôhm


27 *
Algo
);

28 c⁄° *c⁄° *
RódPœ˚Co°Ty≥
(
IN
 c⁄° *c⁄° *
Args
,

29 
OUT
 
∂a˚_c_ty≥s
 *
Ty≥
);

30 c⁄° *c⁄° *
RódRouãrAlg‹ôhm
(
IN
 c⁄° *c⁄° *
Args
,

31 
OUT
 
e_rouãr_Æg‹ôhm


32 *
Algo
);

33 c⁄° *c⁄° *
RódBa£Co°Ty≥
(
IN
 c⁄° *c⁄° *
Args
,

34 
OUT
 
e_ba£_co°_ty≥
 *
Ba£Co°Ty≥
);

35 c⁄° *c⁄° *
RódRouãTy≥
(
IN
 c⁄° *c⁄° *
Args
,

36 
OUT
 
e_rouã_ty≥
 *
Ty≥
);

37 c⁄° *c⁄° *
RódSåög
(
IN
 c⁄° *c⁄° *
Args
,

38 
OUT
 **
VÆ
);

44 
	$RódO±i⁄s
(
IN
 
¨gc
,

45 
IN
 **
¨gv
,

46 
OUT
 
t_›ti⁄s
 * 
O±i⁄s
)

48 **
Args
, **
hód
;

51 
	`mem£t
(
O±i⁄s
, 0, (
t_›ti⁄s
));

56 --
¨gc
;

57 ++
¨gv
;

58 
hód
 = 
Args
 = (**)
	`my_mÆloc
((*Ë* (
¨gc
 + 1));

59 
	`mem˝y
(
Args
, 
¨gv
, ((*Ë* 
¨gc
));

60 
Args
[
¨gc
] = 
NULL
;

65 *
Args
)

67 if(
	`°∫cmp
("--", *
Args
, 2) == 0)

69 *
Args
 += 2;

70 
Args
 =

71 (**)
	`Pro˚ssO±i⁄
((c⁄° *c⁄° *)
Args
,

72 
O±i⁄s
);

74 if(
	`°∫cmp
("-", *
Args
, 1) == 0)

76 *
Args
 += 1;

77 
Args
 =

78 (**)
	`Pro˚ssO±i⁄
((c⁄° *c⁄° *)
Args
,

79 
O±i⁄s
);

81 if(
NULL
 =
O±i⁄s
->
NëFûe
)

83 
O±i⁄s
->
NëFûe
 = 
	`my_°rdup
(*
Args
);

84 ++
Args
;

86 if(
NULL
 =
O±i⁄s
->
ArchFûe
)

88 
O±i⁄s
->
ArchFûe
 = 
	`my_°rdup
(*
Args
);

89 ++
Args
;

91 if(
NULL
 =
O±i⁄s
->
Pœ˚Fûe
)

93 
O±i⁄s
->
Pœ˚Fûe
 = 
	`my_°rdup
(*
Args
);

94 ++
Args
;

96 if(
NULL
 =
O±i⁄s
->
RouãFûe
)

98 
O±i⁄s
->
RouãFûe
 = 
	`my_°rdup
(*
Args
);

99 ++
Args
;

104 
	`Eº‹
(*
Args
);

107 
	`‰ì
(
hód
);

108 
	}
}

112 
	$Pro˚ssO±i⁄
(
IN
 c⁄° *c⁄° *
Args
,

113 
INOUT
 
t_›ti⁄s
 * 
O±i⁄s
)

115 
e_O±i⁄Ba£Tokí
 
Tokí
;

116 c⁄° *c⁄° *
PªvArgs
;

118 
PªvArgs
 = 
Args
;

119 
Args
 = 
	`RódBa£Tokí
(Args, &
Tokí
);

121 if(
Tokí
 < 
OT_BASE_UNKNOWN
)

123 ++
O±i⁄s
->
Cou¡
[
Tokí
];

126 
Tokí
)

129 
OT_NODISP
:

130  
Args
;

131 
OT_AUTO
:

132  
	`RódI¡
(
Args
, &
O±i⁄s
->
GøphPau£
);

133 
OT_ROUTE_ONLY
:

134 
OT_PLACE_ONLY
:

135  
Args
;

136 
OT_TIMING_ANALYZE_ONLY_WITH_NET_DELAY
:

137  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
c⁄°™t_√t_dñay
);

138 
OT_FAST
:

139 
OT_FULL_STATS
:

140  
Args
;

141 
OT_TIMING_ANALYSIS
:

142  
	`RódOnOff
(
Args
, &
O±i⁄s
->
TimögA«lysis
);

143 
OT_OUTFILE_PREFIX
:

144  
	`RódSåög
(
Args
, &
O±i⁄s
->
OutFûePªfix
);

147 
OT_PLACE_ALGORITHM
:

148  
	`RódPœ˚Alg‹ôhm
(
Args
, &
O±i⁄s
->
Pœ˚Alg‹ôhm
);

149 
OT_INIT_T
:

150  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
Pœ˚InôT
);

151 
OT_EXIT_T
:

152  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
Pœ˚ExôT
);

153 
OT_ALPHA_T
:

154  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
Pœ˚AÕhaT
);

155 
OT_INNER_NUM
:

156  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
Pœ˚I¬îNum
);

157 
OT_SEED
:

158  
	`RódI¡
(
Args
, &
O±i⁄s
->
Sìd
);

159 
OT_PLACE_COST_EXP
:

160  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
∂a˚_co°_exp
);

161 
OT_PLACE_COST_TYPE
:

162  
	`RódPœ˚Co°Ty≥
(
Args
, &
O±i⁄s
->
Pœ˚Co°Ty≥
);

163 
OT_PLACE_CHAN_WIDTH
:

164  
	`RódI¡
(
Args
, &
O±i⁄s
->
Pœ˚Ch™Width
);

165 
OT_NUM_REGIONS
:

166  
	`RódI¡
(
Args
, &
O±i⁄s
->
Pœ˚N⁄löórRegi⁄s
);

167 
OT_FIX_PINS
:

168  
	`RódFixPös
(
Args
, &
O±i⁄s
->
PöFûe
);

169 
OT_ENABLE_TIMING_COMPUTATIONS
:

170  
	`RódOnOff
(
Args
, &
O±i⁄s
->
ShowPœ˚Timög
);

171 
OT_BLOCK_DIST
:

172  
	`RódI¡
(
Args
, &
O±i⁄s
->
block_di°
);

175 
OT_TIMING_TRADEOFF
:

176  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
Pœ˚TimögTødeoff
);

177 
OT_RECOMPUTE_CRIT_ITER
:

178  
	`RódI¡
(
Args
, &
O±i⁄s
->
RecompuãCrôIãr
);

179 
OT_INNER_LOOP_RECOMPUTE_DIVIDER
:

180  
	`RódI¡
(
Args
, &
O±i⁄s
->
ö√r_lo›_ªcompuã_dividî
);

181 
OT_TD_PLACE_EXP_FIRST
:

182  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
∂a˚_exp_fú°
);

183 
OT_TD_PLACE_EXP_LAST
:

184  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
∂a˚_exp_œ°
);

187 
OT_MAX_ROUTER_ITERATIONS
:

188  
	`RódI¡
(
Args
, &
O±i⁄s
->
max_rouãr_ôî©i⁄s
);

189 
OT_BB_FACTOR
:

190  
	`RódI¡
(
Args
, &
O±i⁄s
->
bb_Á˘‹
);

191 
OT_INITIAL_PRES_FAC
:

192  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
öôül_¥es_Ác
);

193 
OT_PRES_FAC_MULT
:

194  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
¥es_Ác_mu…
);

195 
OT_ACC_FAC
:

196  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
acc_Ác
);

197 
OT_FIRST_ITER_PRES_FAC
:

198  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
fú°_ôî_¥es_Ác
);

199 
OT_BEND_COST
:

200  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
bíd_co°
);

201 
OT_ROUTE_TYPE
:

202  
	`RódRouãTy≥
(
Args
, &
O±i⁄s
->
RouãTy≥
);

203 
OT_VERIFY_BINARY_SEARCH
:

204  
Args
;

205 
OT_ROUTE_CHAN_WIDTH
:

206  
	`RódI¡
(
Args
, &
O±i⁄s
->
RouãCh™Width
);

207 
OT_ROUTER_ALGORITHM
:

208  
	`RódRouãrAlg‹ôhm
(
Args
, &
O±i⁄s
->
RouãrAlg‹ôhm
);

209 
OT_BASE_COST_TYPE
:

210  
	`RódBa£Co°Ty≥
(
Args
, &
O±i⁄s
->
ba£_co°_ty≥
);

213 
OT_ASTAR_FAC
:

214  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
a°¨_Ác
);

215 
OT_MAX_CRITICALITY
:

216  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
max_¸ôiˇlôy
);

217 
OT_CRITICALITY_EXP
:

218  
	`RódFlﬂt
(
Args
, &
O±i⁄s
->
¸ôiˇlôy_exp
);

220 
	`Eº‹O±i⁄
(*
PªvArgs
);

222  
NULL
;

223 
	}
}

227 
	$RódBa£Tokí
(
IN
 c⁄° *c⁄° *
Args
,

228 
OUT
 
e_O±i⁄Ba£Tokí
 *
Tokí
)

230 c⁄° 
s_TokíPaú
 *
Cur
;

233 if(
NULL
 =*
Args
)

234 
	`Eº‹
(*
Args
);

237 
Cur
 = 
O±i⁄Ba£TokíLi°
;

238 
Cur
->
Så
)

240 if(
	`°rcmp
(*
Args
, 
Cur
->
Så
) == 0)

242 *
Tokí
 = 
Cur
->
Enum
;

243  ++
Args
;

245 ++
Cur
;

248 *
Tokí
 = 
OT_BASE_UNKNOWN
;

249  ++
Args
;

250 
	}
}

254 
	$RódTokí
(
IN
 c⁄° *c⁄° *
Args
,

255 
OUT
 
e_O±i⁄ArgTokí
 *
Tokí
)

257 c⁄° 
s_TokíPaú
 *
Cur
;

260 if(
NULL
 =*
Args
)

261 
	`Eº‹
(*
Args
);

264 
Cur
 = 
O±i⁄ArgTokíLi°
;

265 
Cur
->
Så
)

267 if(
	`°rcmp
(*
Args
, 
Cur
->
Så
) == 0)

269 *
Tokí
 = 
Cur
->
Enum
;

270  ++
Args
;

272 ++
Cur
;

275 *
Tokí
 = 
OT_ARG_UNKNOWN
;

276  ++
Args
;

277 
	}
}

282 
	$Eº‹
(
IN
 c⁄° *
Tokí
)

284 if(
Tokí
)

286 
	`¥ötf
(
ERRTAG
 "U√x≥˘edÅokí '%s' o¿comm™dÜöe\n", 
Tokí
);

290 
	`¥ötf
(
ERRTAG
 "MissingÅokenátÉnd of commandÜine\n");

292 
	`exô
(1);

293 
	}
}

297 
	$Eº‹O±i⁄
(
IN
 c⁄° *
O±i⁄
)

299 
	`¥ötf
(
ERRTAG
 "U√x≥˘ed o±i⁄ '%s' o¿comm™dÜöe\n", 
O±i⁄
);

300 
	`exô
(1);

301 
	}
}

305 
	$RódRouãrAlg‹ôhm
(
IN
 c⁄° *c⁄° *
Args
,

306 
OUT
 
e_rouãr_Æg‹ôhm
 *
Algo
)

308 
e_O±i⁄ArgTokí
 
Tokí
;

309 c⁄° *c⁄° *
PªvArgs
;

311 
PªvArgs
 = 
Args
;

312 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

313 
Tokí
)

315 
OT_BREADTH_FIRST
:

316 *
Algo
 = 
BREADTH_FIRST
;

318 
OT_DIRECTED_SEARCH
:

319 *
Algo
 = 
DIRECTED_SEARCH
;

321 
OT_TIMING_DRIVEN
:

322 *
Algo
 = 
TIMING_DRIVEN
;

325 
	`Eº‹
(*
PªvArgs
);

328  
Args
;

329 
	}
}

332 
	$RódBa£Co°Ty≥
(
IN
 c⁄° *c⁄° *
Args
,

333 
OUT
 
e_ba£_co°_ty≥
 *
Ba£Co°Ty≥
)

335 
e_O±i⁄ArgTokí
 
Tokí
;

336 c⁄° *c⁄° *
PªvArgs
;

338 
PªvArgs
 = 
Args
;

339 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

340 
Tokí
)

342 
OT_INTRINSIC_DELAY
:

343 *
Ba£Co°Ty≥
 = 
INTRINSIC_DELAY
;

345 
OT_DELAY_NORMALIZED
:

346 *
Ba£Co°Ty≥
 = 
DELAY_NORMALIZED
;

348 
OT_DEMAND_ONLY
:

349 *
Ba£Co°Ty≥
 = 
DEMAND_ONLY
;

352 
	`Eº‹
(*
PªvArgs
);

355  
Args
;

356 
	}
}

360 
	$RódRouãTy≥
(
IN
 c⁄° *c⁄° *
Args
,

361 
OUT
 
e_rouã_ty≥
 *
Ty≥
)

363 
e_O±i⁄ArgTokí
 
Tokí
;

364 c⁄° *c⁄° *
PªvArgs
;

366 
PªvArgs
 = 
Args
;

367 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

368 
Tokí
)

370 
OT_GLOBAL
:

371 *
Ty≥
 = 
GLOBAL
;

373 
OT_DETAILED
:

374 *
Ty≥
 = 
DETAILED
;

377 
	`Eº‹
(*
PªvArgs
);

380  
Args
;

381 
	}
}

385 
	$RódPœ˚Co°Ty≥
(
IN
 c⁄° *c⁄° *
Args
,

386 
OUT
 
∂a˚_c_ty≥s
 *
Ty≥
)

388 
e_O±i⁄ArgTokí
 
Tokí
;

389 c⁄° *c⁄° *
PªvArgs
;

391 
PªvArgs
 = 
Args
;

392 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

393 
Tokí
)

395 
OT_LINEAR
:

396 *
Ty≥
 = 
LINEAR_CONG
;

398 
OT_NONLINEAR
:

399 *
Ty≥
 = 
NONLINEAR_CONG
;

402 
	`Eº‹
(*
PªvArgs
);

405  
Args
;

406 
	}
}

410 
	$RódPœ˚Alg‹ôhm
(
IN
 c⁄° *c⁄° *
Args
,

411 
OUT
 
e_∂a˚_Æg‹ôhm
 *
Algo
)

413 
e_O±i⁄ArgTokí
 
Tokí
;

414 c⁄° *c⁄° *
PªvArgs
;

416 
PªvArgs
 = 
Args
;

417 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

418 
Tokí
)

420 
OT_BOUNDING_BOX
:

421 *
Algo
 = 
BOUNDING_BOX_PLACE
;

423 
OT_NET_TIMING_DRIVEN
:

424 *
Algo
 = 
NET_TIMING_DRIVEN_PLACE
;

426 
OT_PATH_TIMING_DRIVEN
:

427 *
Algo
 = 
PATH_TIMING_DRIVEN_PLACE
;

430 
	`Eº‹
(*
PªvArgs
);

433  
Args
;

434 
	}
}

437 
	$RódFixPös
(
IN
 c⁄° *c⁄° *
Args
,

438 
OUT
 **
PöFûe
)

440 
e_O±i⁄ArgTokí
 
Tokí
;

441 
Lí
;

442 c⁄° *c⁄° *
PªvArgs
 = 
Args
;

444 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

445 if(
OT_RANDOM
 !
Tokí
)

447 
Lí
 = 1 + 
	`°æí
(*
PªvArgs
);

448 *
PöFûe
 = (*)
	`my_mÆloc
(
Lí
 * ());

449 
	`mem˝y
(*
PöFûe
, *
PªvArgs
, 
Lí
);

451  
Args
;

452 
	}
}

456 
	$RódOnOff
(
IN
 c⁄° *c⁄° *
Args
,

457 
OUT
 
boﬁón
 * 
VÆ
)

459 
e_O±i⁄ArgTokí
 
Tokí
;

460 c⁄° *c⁄° *
PªvArgs
;

462 
PªvArgs
 = 
Args
;

463 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

464 
Tokí
)

466 
OT_ON
:

467 *
VÆ
 = 
TRUE
;

469 
OT_OFF
:

470 *
VÆ
 = 
FALSE
;

473 
	`Eº‹
(*
PªvArgs
);

475  
Args
;

476 
	}
}

480 
	$RódI¡
(
IN
 c⁄° *c⁄° *
Args
,

481 
OUT
 *
VÆ
)

483 if(
NULL
 =*
Args
)

484 
	`Eº‹
(*
Args
);

485 if((**
Args
 > '9') || (**Args < '0'))

486 
	`Eº‹
(*
Args
);

488 *
VÆ
 = 
	`©oi
(*
Args
);

490  ++
Args
;

491 
	}
}

495 
	$RódFlﬂt
(
IN
 c⁄° *c⁄° *
Args
,

496 
OUT
 *
VÆ
)

498 if(
NULL
 =*
Args
)

500 
	`Eº‹
(*
Args
);

503 if((**
Args
 != '-') &&

504 (**
Args
 != '.') && ((**Args > '9') || (**Args < '0')))

506 
	`Eº‹
(*
Args
);

509 *
VÆ
 = 
	`©of
(*
Args
);

511  ++
Args
;

512 
	}
}

516 
	$RódSåög
(
IN
 c⁄° *c⁄° *
Args
,

517 
OUT
 **
VÆ
)

519 if(
NULL
 =*
Args
)

521 
	`Eº‹
(*
Args
);

524 *
VÆ
 = 
	`my_°rdup
(*
Args
);

526  ++
Args
;

527 
	}
}

	@ReadOptions.h

1 
s_›ti⁄s
 
	tt_›ti⁄s
;

2 
	ss_›ti⁄s


4 *
	mArchFûe
;

5 *
	mNëFûe
;

6 *
	mPœ˚Fûe
;

7 *
	mRouãFûe
;

10 
	mGøphPau£
;

11 
	mc⁄°™t_√t_dñay
;

12 
boﬁón
 
	mTimögA«lysis
;

13 *
	mOutFûePªfix
;

16 
e_∂a˚_Æg‹ôhm
 
	mPœ˚Alg‹ôhm
;

17 
	mPœ˚InôT
;

18 
	mPœ˚ExôT
;

19 
	mPœ˚AÕhaT
;

20 
	mPœ˚I¬îNum
;

21 
	mSìd
;

22 
	m∂a˚_co°_exp
;

23 
∂a˚_c_ty≥s
 
	mPœ˚Co°Ty≥
;

24 
	mPœ˚Ch™Width
;

25 
	mPœ˚N⁄löórRegi⁄s
;

26 *
	mPöFûe
;

27 
boﬁón
 
	mShowPœ˚Timög
;

28 
	mblock_di°
;

31 
	mPœ˚TimögTødeoff
;

32 
	mRecompuãCrôIãr
;

33 
	mö√r_lo›_ªcompuã_dividî
;

34 
	m∂a˚_exp_fú°
;

35 
	m∂a˚_exp_œ°
;

38 
	mmax_rouãr_ôî©i⁄s
;

39 
	mbb_Á˘‹
;

40 
	möôül_¥es_Ác
;

41 
	m¥es_Ác_mu…
;

42 
	macc_Ác
;

43 
	mfú°_ôî_¥es_Ác
;

44 
	mbíd_co°
;

45 
e_rouã_ty≥
 
	mRouãTy≥
;

46 
	mRouãCh™Width
;

47 
e_rouãr_Æg‹ôhm
 
	mRouãrAlg‹ôhm
;

48 
e_ba£_co°_ty≥
 
	mba£_co°_ty≥
;

51 
	ma°¨_Ác
;

52 
	m¸ôiˇlôy_exp
;

53 
	mmax_¸ôiˇlôy
;

55 
	mCou¡
[
OT_BASE_UNKNOWN
];

58 
RódO±i⁄s
(
IN
 
¨gc
,

59 
IN
 **
¨gv
,

60 
OUT
 
t_›ti⁄s
 * 
O±i⁄s
);

	@SetupVPR.c

1 
	~<as£π.h
>

2 
	~<°rög.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"check_√éi°.h
"

6 
	~"O±i⁄Tokís.h
"

7 
	~"RódO±i⁄s.h
"

8 
	~"ªad_√éi°.h
"

9 
	~"globÆs.h
"

10 
	~"xml_¨ch.h
"

11 
	~"SëupVPR.h
"

13 
SëupO≥øti⁄
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

14 
OUT
 
e_›î©i⁄
 *
O≥øti⁄
);

15 
SëupPœ˚rO±s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

16 
IN
 
boﬁón
 
TimögE«bÀd
,

17 
OUT
 
s_∂a˚r_›ts
 *
Pœ˚rO±s
);

18 
SëupA¬ólSched
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

19 
OUT
 
s_™√Æög_sched
 *
A¬ólSched
);

20 
SëupRouãrO±s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

21 
IN
 
boﬁón
 
TimögE«bÀd
,

22 
OUT
 
s_rouãr_›ts
 *
RouãrO±s
);

23 
SëupGlobÆRoutögArch
(
OUT
 
s_dë_routög_¨ch
 *
RoutögArch
,

24 
OUT
 
t_£gmít_öf
 ** 
Segmíts
);

25 
SëupRoutögArch
(
IN
 
t_¨ch
 
Arch
,

26 
OUT
 
s_dë_routög_¨ch
 *
RoutögArch
);

27 
SëupTimög
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

28 
IN
 
t_¨ch
 
Arch
,

29 
IN
 
boﬁón
 
TimögE«bÀd
,

30 
IN
 
e_›î©i⁄
 
O≥øti⁄
,

31 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

32 
IN
 
s_rouãr_›ts
 
RouãrO±s
,

33 
OUT
 
t_timög_öf
 * 
Timög
);

34 
lﬂd_subblock_öfo_to_ty≥
(
INOUT
 
t_subblock_d©a
 * 
subblocks
,

35 
INOUT
 
t_ty≥_±r
 
ty≥
);

36 
InôArch
(
IN
 
t_¨ch
 
Arch
);

37 
Æloc_™d_lﬂd_grid
(
INOUT
 *
num_ö°™˚s_ty≥
);

38 
‰ìGrid
();

39 
CheckGrid
();

40 
t_ty≥_±r
 
föd_ty≥_cﬁ
(
IN
 
x
);

41 
SëupSwôches
(
IN
 
t_¨ch
 
Arch
,

42 
INOUT
 
s_dë_routög_¨ch
 *
RoutögArch
,

43 
IN
 
s_swôch_öf
 *
ArchSwôches
,

44 
IN
 
NumArchSwôches
);

49 
	$SëupVPR
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

50 
IN
 
boﬁón
 
TimögE«bÀd
,

51 
OUT
 
t_¨ch
 * 
Arch
,

52 
OUT
 
e_›î©i⁄
 *
O≥øti⁄
,

53 
OUT
 
s_∂a˚r_›ts
 *
Pœ˚rO±s
,

54 
OUT
 
s_™√Æög_sched
 *
A¬ólSched
,

55 
OUT
 
s_rouãr_›ts
 *
RouãrO±s
,

56 
OUT
 
s_dë_routög_¨ch
 *
RoutögArch
,

57 
OUT
 
t_£gmít_öf
 ** 
Segmíts
,

58 
OUT
 
t_timög_öf
 * 
Timög
,

59 
OUT
 
t_subblock_d©a
 * 
Subblocks
,

60 
OUT
 
boﬁón
 * 
ShowGøphics
,

61 
OUT
 *
GøphPau£
)

64 
	`SëupO≥øti⁄
(
O±i⁄s
, 
O≥øti⁄
);

65 
	`SëupPœ˚rO±s
(
O±i⁄s
, 
TimögE«bÀd
, 
Pœ˚rO±s
);

66 
	`SëupA¬ólSched
(
O±i⁄s
, 
A¬ólSched
);

67 
	`SëupRouãrO±s
(
O±i⁄s
, 
TimögE«bÀd
, 
RouãrO±s
);

69 
	`XmlRódArch
(
O±i⁄s
.
ArchFûe
, 
TimögE«bÀd
, 
Arch
,

70 &
ty≥_des¸ùt‹s
, &
num_ty≥s
);

72 *
Segmíts
 = 
Arch
->Segments;

73 
RoutögArch
->
num_£gmít
 = 
Arch
->
num_£gmíts
;

75 
	`SëupSwôches
(*
Arch
, 
RoutögArch
, Arch->
Swôches
, Arch->
num_swôches
);

76 
	`SëupRoutögArch
(*
Arch
, 
RoutögArch
);

77 
	`SëupTimög
(
O±i⁄s
, *
Arch
, 
TimögE«bÀd
, *
O≥øti⁄
,

78 *
Pœ˚rO±s
, *
RouãrO±s
, 
Timög
);

81 
OutFûePªfix
 = 
O±i⁄s
.OutFilePrefix;

82 
grid_logic_tûe_¨ó
 = 
Arch
->grid_logic_tile_area;

83 
ùö_mux_å™s_size
 = 
Arch
->ipin_mux_trans_size;

86 
Pœ˚rO±s
->
£ed
 = 1;

87 if(
O±i⁄s
.
Cou¡
[
OT_SEED
])

89 
Pœ˚rO±s
->
£ed
 = 
O±i⁄s
.
Sìd
;

91 
	`my_§™dom
(
Pœ˚rO±s
->
£ed
);

93 *
GøphPau£
 = 1;

94 if(
O±i⁄s
.
Cou¡
[
OT_AUTO
])

96 *
GøphPau£
 = 
O±i⁄s
.GraphPause;

98 #ifde‡
NO_GRAPHICS


99 *
ShowGøphics
 = 
FALSE
;

101 *
ShowGøphics
 = 
TRUE
;

102 if(
O±i⁄s
.
Cou¡
[
OT_NODISP
])

104 *
ShowGøphics
 = 
FALSE
;

108 #ifde‡
CREATE_ECHO_FILES


109 
	`EchoArch
("¨ch.echo", 
ty≥_des¸ùt‹s
, 
num_ty≥s
);

112 if(
O±i⁄s
.
NëFûe
)

114 
	`ªad_√éi°
(
O±i⁄s
.
NëFûe
, 
num_ty≥s
, 
ty≥_des¸ùt‹s
,

115 
IO_TYPE
, 0, 1, 
Subblocks
, &
num_blocks
, &
block
,

116 &
num_√ts
, &
√t
);

118 
	`lﬂd_subblock_öfo_to_ty≥
(
Subblocks
, 
IO_TYPE
);

119 
	`check_√éi°
(
Subblocks
);

122 
	`InôArch
(*
Arch
);

123 
	}
}

130 
	$InôArch
(
IN
 
t_¨ch
 
Arch
)

132 *
num_ö°™˚s_ty≥
, *
num_blocks_ty≥
;

133 
i
;

134 
cuºít
, 
high
, 
low
;

135 
boﬁón
 
fô
;

137 
cuºít
 = 
	`nöt
(
	`sqπ
(
num_blocks
));

138 
low
 = 1;

139 
high
 = -1;

141 
num_ö°™˚s_ty≥
 = 
	`my_ˇŒoc
(
num_ty≥s
, ());

142 
num_blocks_ty≥
 = 
	`my_ˇŒoc
(
num_ty≥s
, ());

144 
i
 = 0; i < 
num_blocks
; i++)

146 
num_blocks_ty≥
[
block
[
i
].
ty≥
->
ödex
]++;

149 if(
Arch
.
˛b_grid
.
IsAuto
)

152 
high
 =-1 || 
low
 < high)

155 if(
Arch
.
˛b_grid
.
A•e˘
 >= 1.0)

157 
ny
 = 
cuºít
;

158 
nx
 = 
	`nöt
(
cuºít
 * 
Arch
.
˛b_grid
.
A•e˘
);

162 
nx
 = 
cuºít
;

163 
ny
 = 
	`nöt
(
cuºít
 / 
Arch
.
˛b_grid
.
A•e˘
);

165 #i‡
DEBUG


166 
	`¥ötf
("Auto-sizög FPGA,Åry x = %d y = %d\n", 
nx
, 
ny
);

168 
	`Æloc_™d_lﬂd_grid
(
num_ö°™˚s_ty≥
);

169 
	`‰ìGrid
();

172 
fô
 = 
TRUE
;

173 
i
 = 0; i < 
num_ty≥s
; i++)

175 if(
num_blocks_ty≥
[
i
] > 
num_ö°™˚s_ty≥
[i])

177 
fô
 = 
FALSE
;

183 if(!
fô
)

186 if(
high
 == -1)

188 
cuºít
 = current * 2;

189 if(
cuºít
 > 
MAX_SHORT
)

191 
	`¥ötf
(
ERRTAG


193 
	`exô
(1);

198 if(
low
 =
cuºít
)

199 
cuºít
++;

200 
low
 = 
cuºít
;

201 
cuºít
 = 
low
 + ((
high
 -Üow) / 2);

206 
high
 = 
cuºít
;

207 
cuºít
 = 
low
 + ((
high
 -Üow) / 2);

211 if(
Arch
.
˛b_grid
.
A•e˘
 >= 1.0)

213 
ny
 = 
cuºít
;

214 
nx
 = 
	`nöt
(
cuºít
 * 
Arch
.
˛b_grid
.
A•e˘
);

218 
nx
 = 
cuºít
;

219 
ny
 = 
	`nöt
(
cuºít
 / 
Arch
.
˛b_grid
.
A•e˘
);

221 
	`Æloc_™d_lﬂd_grid
(
num_ö°™˚s_ty≥
);

222 
	`¥ötf
("FPGAáuto-sizedÅo, x = %d y = %d\n", 
nx
, 
ny
);

226 
nx
 = 
Arch
.
˛b_grid
.
W
;

227 
ny
 = 
Arch
.
˛b_grid
.
H
;

228 
	`Æloc_™d_lﬂd_grid
(
num_ö°™˚s_ty≥
);

232 
fô
 = 
TRUE
;

233 
i
 = 0; i < 
num_ty≥s
; i++)

235 if(
num_blocks_ty≥
[
i
] > 
num_ö°™˚s_ty≥
[i])

237 
fô
 = 
FALSE
;

241 if(!
fô
)

243 
	`¥ötf
(
ERRTAG
 "NotÉnoughÖhysicalÜocations forÅype %s, "

245 
num_blocks_ty≥
[
i
], 
num_ö°™˚s_ty≥
[i]);

246 
	`exô
(1);

249 
	`¥ötf
("\nResource Usage:\n");

250 
i
 = 0; i < 
num_ty≥s
; i++)

252 
	`¥ötf
("Netlist %d\tblocks ofÅype %s\n",

253 
num_blocks_ty≥
[
i
], 
ty≥_des¸ùt‹s
[i].
«me
);

254 
	`¥ötf
("Architecture %d\tblocks ofÅype %s\n",

255 
num_ö°™˚s_ty≥
[
i
], 
ty≥_des¸ùt‹s
[i].
«me
);

257 
	`¥ötf
("\n");

258 
ch™_width_x
 = (*)
	`my_mÆloc
((
ny
 + 1) * ());

259 
ch™_width_y
 = (*)
	`my_mÆloc
((
nx
 + 1) * ());

261 
	`‰ì
(
num_blocks_ty≥
);

262 
	`‰ì
(
num_ö°™˚s_ty≥
);

263 
	}
}

268 
	$Æloc_™d_lﬂd_grid
(
INOUT
 *
num_ö°™˚s_ty≥
)

271 
i
, 
j
;

272 
t_ty≥_±r
 
ty≥
;

274 #ifde‡
SHOW_ARCH


275 
FILE
 *
dump
;

284 if((
nx
 =1Ë&& (
ny
 =1Ë&& (
num_blocks
 > 0))

286 
	`¥ötf
("Error:\n");

287 
¥ötf


289 
	`¥ötf
("foráÜogic block (clb).\n");

290 
	`¥ötf
("Try me withá moreÑealistic circuit!\n");

291 
	`exô
(1);

296 if((
nx
 > 32766Ë|| (
ny
 > 32766))

298 
	`¥ötf
("Error:ÇxándÇy must beÜessÅhan 32767, sinceÅhe \n");

299 
	`¥ötf
("router uses shorts (16-bit)Åo store coordinates.\n");

300 
	`¥ötf
("nx: %d.Çy: %d.\n", 
nx
, 
ny
);

301 
	`exô
(1);

304 
	`as£π
(
nx
 >1 && 
ny
 >= 1);

306 
grid
 = (
s_grid_tûe
 **)
	`Æloc_m©rix
(0, (
nx
 + 1),

307 0, (
ny
 + 1),

308 (
s_grid_tûe
));

311 
i
 = 0; i <(
nx
 + 1); ++i)

313 
j
 = 0; j <(
ny
 + 1); ++j)

315 
	`mem£t
(&
grid
[
i
][
j
], 0, ((
s_grid_tûe
)));

319 
i
 = 0; i < 
num_ty≥s
; i++)

321 
num_ö°™˚s_ty≥
[
i
] = 0;

325 
grid
[0][0].
ty≥
 = grid[
nx
 + 1][0].ty≥ = 
EMPTY_TYPE
;

326 
grid
[0][
ny
 + 1].
ty≥
 = grid[
nx
 + 1][ny + 1].ty≥ = 
EMPTY_TYPE
;

327 
num_ö°™˚s_ty≥
[
EMPTY_TYPE
->
ödex
] = 4;

329 
i
 = 1; i <
nx
; i++)

331 
grid
[
i
][0].
blocks
 =

332 (*)
	`my_mÆloc
((Ë* 
IO_TYPE
->
ˇ∑côy
);

333 
grid
[
i
][0].
ty≥
 = 
IO_TYPE
;

335 
grid
[
i
][
ny
 + 1].
blocks
 =

336 (*)
	`my_mÆloc
((Ë* 
IO_TYPE
->
ˇ∑côy
);

337 
grid
[
i
][
ny
 + 1].
ty≥
 = 
IO_TYPE
;

339 
j
 = 0; j < 
IO_TYPE
->
ˇ∑côy
; j++)

341 
grid
[
i
][0].
blocks
[
j
] = 
EMPTY
;

342 
grid
[
i
][
ny
 + 1].
blocks
[
j
] = 
EMPTY
;

346 
i
 = 1; i <
ny
; i++)

348 
grid
[0][
i
].
blocks
 =

349 (*)
	`my_mÆloc
((Ë* 
IO_TYPE
->
ˇ∑côy
);

350 
grid
[0][
i
].
ty≥
 = 
IO_TYPE
;

352 
grid
[
nx
 + 1][
i
].
blocks
 =

353 (*)
	`my_mÆloc
((Ë* 
IO_TYPE
->
ˇ∑côy
);

354 
grid
[
nx
 + 1][
i
].
ty≥
 = 
IO_TYPE
;

355 
j
 = 0; j < 
IO_TYPE
->
ˇ∑côy
; j++)

357 
grid
[0][
i
].
blocks
[
j
] = 
EMPTY
;

358 
grid
[
nx
 + 1][
i
].
blocks
[
j
] = 
EMPTY
;

362 
num_ö°™˚s_ty≥
[
IO_TYPE
->
ödex
] = 2 * IO_TYPE->
ˇ∑côy
 * (
nx
 + 
ny
);

364 
i
 = 1; i <
nx
; i++)

366 
ty≥
 = 
	`föd_ty≥_cﬁ
(
i
);

367 
j
 = 1; j <
ny
; j++)

369 
grid
[
i
][
j
].
ty≥
 =Åype;

370 
grid
[
i
][
j
].
off£t
 = (j - 1Ë% 
ty≥
->
height
;

371 if(
j
 + 
grid
[
i
][j].
ty≥
->
height
 - 1 - grid[i][j].
off£t
 >

372 
ny
)

374 
grid
[
i
][
j
].
ty≥
 = 
EMPTY_TYPE
;

375 
grid
[
i
][
j
].
off£t
 = 0;

378 if(
ty≥
->
ˇ∑côy
 > 1)

380 
	`¥ötf
(
ERRTAG


383 
i
, 
j
, 
grid
[i][j].
ty≥
->
«me
,

384 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
);

385 
	`exô
(1);

388 
grid
[
i
][
j
].
blocks
 = (*)
	`my_mÆloc
(());

389 
grid
[
i
][
j
].
blocks
[0] = 
EMPTY
;

390 if(
grid
[
i
][
j
].
off£t
 == 0)

392 
num_ö°™˚s_ty≥
[
grid
[
i
][
j
].
ty≥
->
ödex
]++;

397 
	`CheckGrid
();

399 #ifde‡
SHOW_ARCH


401 
dump
 = 
	`my_f›í
("grid_type_dump.txt", "w");

402 
j
 = (
ny
 + 1); j >= 0; --j)

404 
i
 = 0; i <(
nx
 + 1); ++i)

406 
	`Ârötf
(
dump
, "%c", 
grid
[
i
][
j
].
ty≥
->
«me
[1]);

408 
	`Ârötf
(
dump
, "\n");

410 
	`f˛o£
(
dump
);

412 
	}
}

415 
	$‰ìGrid
()

417 
i
, 
j
;

419 
i
 = 0; i <(
nx
 + 1); ++i)

421 
j
 = 0; j <(
ny
 + 1); ++j)

423 
	`‰ì
(
grid
[
i
][
j
].
blocks
);

426 
	`‰ì_m©rix
(
grid
, 0, 
nx
 + 1, 0, (
s_grid_tûe
));

427 
	}
}

431 
	$CheckGrid
()

433 
i
, 
j
;

436 
i
 = 0; i <(
nx
 + 1); ++i)

438 
j
 = 0; j <(
ny
 + 1); ++j)

440 if(
NULL
 =
grid
[
i
][
j
].
ty≥
)

442 
	`¥ötf
(
ERRTAG
 "grid[%d][%d] ha†nÿty≥.\n", 
i
,

443 
j
);

444 
	`exô
(1);

447 if(
grid
[
i
][
j
].
ußge
 != 0)

449 
	`¥ötf
(
ERRTAG


451 "bef‹ê√éi°Üﬂd.\n", 
i
, 
j
,

452 
grid
[
i
][
j
].
ußge
);

453 
	`exô
(1);

456 if((
grid
[
i
][
j
].
off£t
 < 0) ||

457 (
grid
[
i
][
j
].
off£t
 >grid[i][j].
ty≥
->
height
))

459 
	`¥ötf
(
ERRTAG


461 
i
, 
j
, 
grid
[i][j].
off£t
);

462 
	`exô
(1);

465 if((
NULL
 =
grid
[
i
][
j
].
blocks
) &&

466 (
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
 > 0))

468 
	`¥ötf
(
ERRTAG


470 
i
, 
j
);

471 
	`exô
(1);

475 
	}
}

477 
t_ty≥_±r


478 
	$föd_ty≥_cﬁ
(
IN
 
x
)

480 
i
, 
j
;

481 
°¨t
, 
ª≥©
;

482 
ªl
;

483 
boﬁón
 
m©ch
;

484 
¥i‹ôy
, 
num_loc
;

485 
t_ty≥_±r
 
cﬁumn_ty≥
;

487 
¥i‹ôy
 = 
FILL_TYPE
->
grid_loc_def
[0].priority;

488 
cﬁumn_ty≥
 = 
FILL_TYPE
;

490 
i
 = 0; i < 
num_ty≥s
; i++)

492 if(&
ty≥_des¸ùt‹s
[
i
] =
IO_TYPE
 ||

493 &
ty≥_des¸ùt‹s
[
i
] =
EMPTY_TYPE
 ||

494 &
ty≥_des¸ùt‹s
[
i
] =
FILL_TYPE
)

496 
num_loc
 = 
ty≥_des¸ùt‹s
[
i
].
num_grid_loc_def
;

497 
j
 = 0; j < 
num_loc
; j++)

499 if(
¥i‹ôy
 <

500 
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].
¥i‹ôy
)

502 
m©ch
 = 
FALSE
;

503 if(
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].

504 
grid_loc_ty≥
 =
COL_REPEAT
)

506 
°¨t
 =

507 
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].

508 
°¨t_cﬁ
;

509 
ª≥©
 =

510 
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].

511 
ª≥©
;

512 if(
°¨t
 < 0)

514 
°¨t
 +(
nx
 + 1);

516 if(
x
 =
°¨t
)

518 
m©ch
 = 
TRUE
;

520 if(
ª≥©
 > 0 && 
x
 > 
°¨t


521 && 
°¨t
 > 0)

523 if((
x
 - 
°¨t
Ë% 
ª≥©
 == 0)

525 
m©ch
 = 
TRUE
;

529 if(
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].

530 
grid_loc_ty≥
 =
COL_REL
)

532 
ªl
 =

533 
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].

534 
cﬁ_ªl
;

535 if(
	`nöt
(
ªl
 * 
nx
Ë=
x
)

537 
m©ch
 = 
TRUE
;

540 if(
m©ch
)

542 
¥i‹ôy
 =

543 
ty≥_des¸ùt‹s
[
i
].
grid_loc_def
[
j
].

544 
¥i‹ôy
;

545 
cﬁumn_ty≥
 = &
ty≥_des¸ùt‹s
[
i
];

550  
cﬁumn_ty≥
;

551 
	}
}

555 
	$SëupTimög
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

556 
IN
 
t_¨ch
 
Arch
,

557 
IN
 
boﬁón
 
TimögE«bÀd
,

558 
IN
 
e_›î©i⁄
 
O≥øti⁄
,

559 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

560 
IN
 
s_rouãr_›ts
 
RouãrO±s
,

561 
OUT
 
t_timög_öf
 * 
Timög
)

565 if(
FALSE
 =
TimögE«bÀd
)

567 
	`mem£t
(
Timög
, 0, (
t_timög_öf
));

568 
Timög
->
timög_™Æysis_íabÀd
 = 
FALSE
;

572 
Timög
->
C_ùö_cblock
 = 
Arch
.C_ipin_cblock;

573 
Timög
->
T_ùö_cblock
 = 
Arch
.T_ipin_cblock;

574 
Timög
->
timög_™Æysis_íabÀd
 = 
TimögE«bÀd
;

575 
	}
}

581 
	$SëupSwôches
(
IN
 
t_¨ch
 
Arch
,

582 
INOUT
 
s_dë_routög_¨ch
 *
RoutögArch
,

583 
IN
 
s_swôch_öf
 *
ArchSwôches
,

584 
IN
 
NumArchSwôches
)

587 
RoutögArch
->
num_swôch
 = 
NumArchSwôches
;

590 
RoutögArch
->
wúe_to_ùö_swôch
 = RoutögArch->
num_swôch
;

591 ++
RoutögArch
->
num_swôch
;

594 
RoutögArch
->
dñayÀss_swôch
 = RoutögArch->
num_swôch
;

595 
RoutögArch
->
globÆ_rouã_swôch
 = RoutögArch->
dñayÀss_swôch
;

596 ++
RoutögArch
->
num_swôch
;

599 
swôch_öf
 =

600 (
s_swôch_öf
 *)
	`my_mÆloc
((s_switch_inf) *

601 
RoutögArch
->
num_swôch
);

604 
	`mem˝y
(
swôch_öf
, 
ArchSwôches
,

605 (
s_swôch_öf
Ë* 
NumArchSwôches
);

608 
swôch_öf
[
RoutögArch
->
dñayÀss_swôch
].
buf„ªd
 = 
TRUE
;

609 
swôch_öf
[
RoutögArch
->
dñayÀss_swôch
].
R
 = 0.;

610 
swôch_öf
[
RoutögArch
->
dñayÀss_swôch
].
Cö
 = 0.;

611 
swôch_öf
[
RoutögArch
->
dñayÀss_swôch
].
Cout
 = 0.;

612 
swôch_öf
[
RoutögArch
->
dñayÀss_swôch
].
Tdñ
 = 0.;

617 
swôch_öf
[
RoutögArch
->
wúe_to_ùö_swôch
].
buf„ªd
 = 
TRUE
;

618 
swôch_öf
[
RoutögArch
->
wúe_to_ùö_swôch
].
R
 = 0.;

619 
swôch_öf
[
RoutögArch
->
wúe_to_ùö_swôch
].
Cö
 = 
Arch
.
C_ùö_cblock
;

620 
swôch_öf
[
RoutögArch
->
wúe_to_ùö_swôch
].
Cout
 = 0.;

621 
swôch_öf
[
RoutögArch
->
wúe_to_ùö_swôch
].
Tdñ
 = 
Arch
.
T_ùö_cblock
;

622 
	}
}

628 
	$SëupRoutögArch
(
IN
 
t_¨ch
 
Arch
,

629 
OUT
 
s_dë_routög_¨ch
 *
RoutögArch
)

632 
RoutögArch
->
swôch_block_ty≥
 = 
Arch
.
SBTy≥
;

633 
RoutögArch
->
R_möW_nmos
 = 
Arch
.R_minW_nmos;

634 
RoutögArch
->
R_möW_pmos
 = 
Arch
.R_minW_pmos;

635 
RoutögArch
->
Fs
 = 
Arch
.Fs;

636 
RoutögArch
->
dúe˘i⁄Æôy
 = 
BI_DIRECTIONAL
;

637 if(
Arch
.
Segmíts
)

638 
RoutögArch
->
dúe˘i⁄Æôy
 = 
Arch
.
Segmíts
[0].directionality;

639 
	}
}

643 
	$SëupRouãrO±s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

644 
IN
 
boﬁón
 
TimögE«bÀd
,

645 
OUT
 
s_rouãr_›ts
 *
RouãrO±s
)

647 
RouãrO±s
->
a°¨_Ác
 = 1.2;

648 if(
O±i⁄s
.
Cou¡
[
OT_ASTAR_FAC
])

650 
RouãrO±s
->
a°¨_Ác
 = 
O±i⁄s
.astar_fac;

653 
RouãrO±s
->
bb_Á˘‹
 = 3;

654 if(
O±i⁄s
.
Cou¡
[
OT_FAST
])

656 
RouãrO±s
->
bb_Á˘‹
 = 0;

658 if(
O±i⁄s
.
Cou¡
[
OT_BB_FACTOR
])

660 
RouãrO±s
->
bb_Á˘‹
 = 
O±i⁄s
.bb_factor;

663 
RouãrO±s
->
¸ôiˇlôy_exp
 = 1.0;

664 if(
O±i⁄s
.
Cou¡
[
OT_CRITICALITY_EXP
])

666 
RouãrO±s
->
¸ôiˇlôy_exp
 = 
O±i⁄s
.criticality_exp;

669 
RouãrO±s
->
max_¸ôiˇlôy
 = 0.99;

670 if(
O±i⁄s
.
Cou¡
[
OT_MAX_CRITICALITY
])

672 
RouãrO±s
->
max_¸ôiˇlôy
 = 
O±i⁄s
.max_criticality;

675 
RouãrO±s
->
max_rouãr_ôî©i⁄s
 = 50;

676 if(
O±i⁄s
.
Cou¡
[
OT_FAST
])

678 
RouãrO±s
->
max_rouãr_ôî©i⁄s
 = 10;

680 if(
O±i⁄s
.
Cou¡
[
OT_MAX_ROUTER_ITERATIONS
])

682 
RouãrO±s
->
max_rouãr_ôî©i⁄s
 = 
O±i⁄s
.max_router_iterations;

685 
RouãrO±s
->
¥es_Ác_mu…
 = 1.3;

686 if(
O±i⁄s
.
Cou¡
[
OT_PRES_FAC_MULT
])

688 
RouãrO±s
->
¥es_Ác_mu…
 = 
O±i⁄s
.pres_fac_mult;

692 
RouãrO±s
->
rouã_ty≥
 = 
DETAILED
;

693 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_TYPE
])

695 
RouãrO±s
->
rouã_ty≥
 = 
O±i⁄s
.
RouãTy≥
;

698 
RouãrO±s
->
fuŒ_°©s
 = 
FALSE
;

699 if(
O±i⁄s
.
Cou¡
[
OT_FULL_STATS
])

701 
RouãrO±s
->
fuŒ_°©s
 = 
TRUE
;

704 
RouãrO±s
->
vîify_bö¨y_£¨ch
 = 
FALSE
;

705 if(
O±i⁄s
.
Cou¡
[
OT_VERIFY_BINARY_SEARCH
])

707 
RouãrO±s
->
vîify_bö¨y_£¨ch
 = 
TRUE
;

711 
RouãrO±s
->
rouãr_Æg‹ôhm
 = 
DIRECTED_SEARCH
;

712 if(
TimögE«bÀd
)

714 
RouãrO±s
->
rouãr_Æg‹ôhm
 = 
TIMING_DRIVEN
;

716 if(
GLOBAL
 =
RouãrO±s
->
rouã_ty≥
)

718 
RouãrO±s
->
rouãr_Æg‹ôhm
 = 
DIRECTED_SEARCH
;

720 if(
O±i⁄s
.
Cou¡
[
OT_ROUTER_ALGORITHM
])

722 
RouãrO±s
->
rouãr_Æg‹ôhm
 = 
O±i⁄s
.
RouãrAlg‹ôhm
;

725 
RouãrO±s
->
fixed_ch™√l_width
 = 
NO_FIXED_CHANNEL_WIDTH
;

726 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_CHAN_WIDTH
])

728 
RouãrO±s
->
fixed_ch™√l_width
 = 
O±i⁄s
.
RouãCh™Width
;

732 
RouãrO±s
->
öôül_¥es_Ác
 = 0.5;

733 if(
DIRECTED_SEARCH
 =
RouãrO±s
->
rouãr_Æg‹ôhm
 ||

734 
O±i⁄s
.
Cou¡
[
OT_FAST
])

736 
RouãrO±s
->
öôül_¥es_Ác
 = 10000.0;

738 if(
O±i⁄s
.
Cou¡
[
OT_INITIAL_PRES_FAC
])

740 
RouãrO±s
->
öôül_¥es_Ác
 = 
O±i⁄s
.initial_pres_fac;

744 
RouãrO±s
->
ba£_co°_ty≥
 = 
DELAY_NORMALIZED
;

745 if(
BREADTH_FIRST
 =
RouãrO±s
->
rouãr_Æg‹ôhm
)

747 
RouãrO±s
->
ba£_co°_ty≥
 = 
DEMAND_ONLY
;

749 if(
DIRECTED_SEARCH
 =
RouãrO±s
->
rouãr_Æg‹ôhm
)

751 
RouãrO±s
->
ba£_co°_ty≥
 = 
DEMAND_ONLY
;

753 if(
O±i⁄s
.
Cou¡
[
OT_BASE_COST_TYPE
])

755 
RouãrO±s
->
ba£_co°_ty≥
 = 
O±i⁄s
.base_cost_type;

759 
RouãrO±s
->
fú°_ôî_¥es_Ác
 = 0.5;

760 if(
BREADTH_FIRST
 =
RouãrO±s
->
rouãr_Æg‹ôhm
)

762 
RouãrO±s
->
fú°_ôî_¥es_Ác
 = 0.0;

764 if(
DIRECTED_SEARCH
 =
RouãrO±s
->
rouãr_Æg‹ôhm
 ||

765 
O±i⁄s
.
Cou¡
[
OT_FAST
])

767 
RouãrO±s
->
fú°_ôî_¥es_Ác
 = 10000.0;

769 if(
O±i⁄s
.
Cou¡
[
OT_FIRST_ITER_PRES_FAC
])

771 
RouãrO±s
->
fú°_ôî_¥es_Ác
 = 
O±i⁄s
.first_iter_pres_fac;

775 
RouãrO±s
->
acc_Ác
 = 1.0;

776 if(
BREADTH_FIRST
 =
RouãrO±s
->
rouãr_Æg‹ôhm
)

778 
RouãrO±s
->
acc_Ác
 = 0.2;

780 if(
O±i⁄s
.
Cou¡
[
OT_ACC_FAC
])

782 
RouãrO±s
->
acc_Ác
 = 
O±i⁄s
.acc_fac;

786 
RouãrO±s
->
bíd_co°
 = 0.0;

787 if(
GLOBAL
 =
RouãrO±s
->
rouã_ty≥
)

789 
RouãrO±s
->
bíd_co°
 = 1.0;

791 if(
O±i⁄s
.
Cou¡
[
OT_BEND_COST
])

793 
RouãrO±s
->
bíd_co°
 = 
O±i⁄s
.bend_cost;

795 
	}
}

799 
	$SëupA¬ólSched
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

800 
OUT
 
s_™√Æög_sched
 *
A¬ólSched
)

802 
A¬ólSched
->
Æpha_t
 = 0.8;

803 if(
O±i⁄s
.
Cou¡
[
OT_ALPHA_T
])

805 
A¬ólSched
->
Æpha_t
 = 
O±i⁄s
.
Pœ˚AÕhaT
;

807 if(
A¬ólSched
->
Æpha_t
 >= 1 || AnnealSched->alpha_t <= 0)

809 
	`¥ötf
(
ERRTAG
 "alpha_t must be between 0ánd 1Éxclusive\n");

810 
	`exô
(1);

812 
A¬ólSched
->
exô_t
 = 0.01;

813 if(
O±i⁄s
.
Cou¡
[
OT_EXIT_T
])

815 
A¬ólSched
->
exô_t
 = 
O±i⁄s
.
Pœ˚ExôT
;

817 if(
A¬ólSched
->
exô_t
 <= 0)

819 
	`¥ötf
(
ERRTAG
 "exit_t must be greaterÅhan 0\n");

820 
	`exô
(1);

822 
A¬ólSched
->
öô_t
 = 100.0;

823 if(
O±i⁄s
.
Cou¡
[
OT_INIT_T
])

825 
A¬ólSched
->
öô_t
 = 
O±i⁄s
.
Pœ˚InôT
;

827 if(
A¬ólSched
->
öô_t
 <= 0)

829 
	`¥ötf
(
ERRTAG
 "init_t must be greaterÅhan 0\n");

830 
	`exô
(1);

832 if(
A¬ólSched
->
öô_t
 < A¬ólSched->
exô_t
)

834 
	`¥ötf
(
ERRTAG
 "init_t must be greater orÉqualÅoÅhanÉxit_t\n");

835 
	`exô
(1);

837 
A¬ólSched
->
ö√r_num
 = 10.0;

838 if(
O±i⁄s
.
Cou¡
[
OT_FAST
]) {

839 
A¬ólSched
->
ö√r_num
 = 1.0;

841 if(
O±i⁄s
.
Cou¡
[
OT_INNER_NUM
])

843 
A¬ólSched
->
ö√r_num
 = 
O±i⁄s
.
Pœ˚I¬îNum
;

845 if(
A¬ólSched
->
ö√r_num
 <= 0)

847 
	`¥ötf
(
ERRTAG
 "init_t must be greaterÅhan 0\n");

848 
	`exô
(1);

850 
A¬ólSched
->
ty≥
 = 
AUTO_SCHED
;

851 if((
O±i⁄s
.
Cou¡
[
OT_ALPHA_T
]) ||

852 (
O±i⁄s
.
Cou¡
[
OT_EXIT_T
]Ë|| (O±i⁄s.Cou¡[
OT_INIT_T
]))

854 
A¬ólSched
->
ty≥
 = 
USER_SCHED
;

856 
	}
}

862 
	$SëupPœ˚rO±s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

863 
IN
 
boﬁón
 
TimögE«bÀd
,

864 
OUT
 
s_∂a˚r_›ts
 *
Pœ˚rO±s
)

866 
Pœ˚rO±s
->
block_di°
 = 1;

867 if(
O±i⁄s
.
Cou¡
[
OT_BLOCK_DIST
])

869 
Pœ˚rO±s
->
block_di°
 = 
O±i⁄s
.block_dist;

872 
Pœ˚rO±s
->
ö√r_lo›_ªcompuã_dividî
 = 0;

873 if(
O±i⁄s
.
Cou¡
[
OT_INNER_LOOP_RECOMPUTE_DIVIDER
])

875 
Pœ˚rO±s
->
ö√r_lo›_ªcompuã_dividî
 = 
O±i⁄s
.inner_loop_recompute_divider;

878 
Pœ˚rO±s
->
∂a˚_co°_exp
 = 1.0;

879 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_COST_EXP
])

881 
Pœ˚rO±s
->
∂a˚_co°_exp
 = 
O±i⁄s
.place_cost_exp;

884 
Pœ˚rO±s
->
td_∂a˚_exp_fú°
 = 1;

885 if(
O±i⁄s
.
Cou¡
[
OT_TD_PLACE_EXP_FIRST
])

887 
Pœ˚rO±s
->
td_∂a˚_exp_fú°
 = 
O±i⁄s
.
∂a˚_exp_fú°
;

890 
Pœ˚rO±s
->
td_∂a˚_exp_œ°
 = 8;

891 if(
O±i⁄s
.
Cou¡
[
OT_TD_PLACE_EXP_LAST
])

893 
Pœ˚rO±s
->
td_∂a˚_exp_œ°
 = 
O±i⁄s
.
∂a˚_exp_œ°
;

896 
Pœ˚rO±s
->
∂a˚_co°_ty≥
 = 
LINEAR_CONG
;

897 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_COST_TYPE
])

899 
Pœ˚rO±s
->
∂a˚_co°_ty≥
 = 
O±i⁄s
.
Pœ˚Co°Ty≥
;

903 
Pœ˚rO±s
->
∂a˚_Æg‹ôhm
 = 
BOUNDING_BOX_PLACE
;

904 if(
TimögE«bÀd
)

906 
Pœ˚rO±s
->
∂a˚_Æg‹ôhm
 = 
PATH_TIMING_DRIVEN_PLACE
;

908 if(
NONLINEAR_CONG
 =
Pœ˚rO±s
->
∂a˚_co°_ty≥
)

910 
Pœ˚rO±s
->
∂a˚_Æg‹ôhm
 = 
BOUNDING_BOX_PLACE
;

912 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_ALGORITHM
])

914 
Pœ˚rO±s
->
∂a˚_Æg‹ôhm
 = 
O±i⁄s
.
Pœ˚Alg‹ôhm
;

917 
Pœ˚rO±s
->
num_ªgi⁄s
 = 4;

918 if(
O±i⁄s
.
Cou¡
[
OT_NUM_REGIONS
])

920 
Pœ˚rO±s
->
num_ªgi⁄s
 = 
O±i⁄s
.
Pœ˚N⁄löórRegi⁄s
;

923 
Pœ˚rO±s
->
∑d_loc_fûe
 = 
NULL
;

924 if(
O±i⁄s
.
Cou¡
[
OT_FIX_PINS
])

926 if(
O±i⁄s
.
PöFûe
)

928 
Pœ˚rO±s
->
∑d_loc_fûe
 = 
	`my_°rdup
(
O±i⁄s
.
PöFûe
);

932 
Pœ˚rO±s
->
∑d_loc_ty≥
 = 
FREE
;

933 if(
O±i⁄s
.
Cou¡
[
OT_FIX_PINS
])

935 
Pœ˚rO±s
->
∑d_loc_ty≥
 = (
O±i⁄s
.
PöFûe
 ? 
USER
 : 
RANDOM
);

939 
Pœ˚rO±s
->
∂a˚_ch™_width
 = 100;

940 if((
NONLINEAR_CONG
 =
Pœ˚rO±s
->
∂a˚_co°_ty≥
) &&

941 (
O±i⁄s
.
Cou¡
[
OT_ROUTE_CHAN_WIDTH
]))

943 
Pœ˚rO±s
->
∂a˚_ch™_width
 = 
O±i⁄s
.
RouãCh™Width
;

945 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_CHAN_WIDTH
])

947 
Pœ˚rO±s
->
∂a˚_ch™_width
 = 
O±i⁄s
.
Pœ˚Ch™Width
;

950 
Pœ˚rO±s
->
ªcompuã_¸ô_ôî
 = 1;

951 if(
O±i⁄s
.
Cou¡
[
OT_RECOMPUTE_CRIT_ITER
])

953 
Pœ˚rO±s
->
ªcompuã_¸ô_ôî
 = 
O±i⁄s
.
RecompuãCrôIãr
;

956 
Pœ˚rO±s
->
timög_åadeoff
 = 0.5;

957 if(
O±i⁄s
.
Cou¡
[
OT_TIMING_TRADEOFF
])

959 
Pœ˚rO±s
->
timög_åadeoff
 = 
O±i⁄s
.
Pœ˚TimögTødeoff
;

963 
Pœ˚rO±s
->
íabÀ_timög_compuèti⁄s
 = 
FALSE
;

964 if((
Pœ˚rO±s
->
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
) ||

965 (
Pœ˚rO±s
->
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
))

967 
Pœ˚rO±s
->
íabÀ_timög_compuèti⁄s
 = 
TRUE
;

969 if(
O±i⁄s
.
Cou¡
[
OT_ENABLE_TIMING_COMPUTATIONS
])

971 
Pœ˚rO±s
->
íabÀ_timög_compuèti⁄s
 = 
O±i⁄s
.
ShowPœ˚Timög
;

975 
Pœ˚rO±s
->
∂a˚_‰eq
 = 
PLACE_ONCE
;

976 if(
NONLINEAR_CONG
 =
Pœ˚rO±s
->
∂a˚_co°_ty≥
)

978 
Pœ˚rO±s
->
∂a˚_‰eq
 = 
PLACE_ALWAYS
;

980 if((
O±i⁄s
.
Cou¡
[
OT_ROUTE_CHAN_WIDTH
]) ||

981 (
O±i⁄s
.
Cou¡
[
OT_PLACE_CHAN_WIDTH
]))

983 
Pœ˚rO±s
->
∂a˚_‰eq
 = 
PLACE_ONCE
;

985 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_ONLY
])

987 
Pœ˚rO±s
->
∂a˚_‰eq
 = 
PLACE_NEVER
;

989 
	}
}

993 
	$SëupO≥øti⁄
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

994 
OUT
 
e_›î©i⁄
 *
O≥øti⁄
)

996 *
O≥øti⁄
 = 
PLACE_AND_ROUTE
;

997 if(
O±i⁄s
.
Cou¡
[
OT_ROUTE_ONLY
])

999 *
O≥øti⁄
 = 
ROUTE_ONLY
;

1001 if(
O±i⁄s
.
Cou¡
[
OT_PLACE_ONLY
])

1003 *
O≥øti⁄
 = 
PLACE_ONLY
;

1005 if(
O±i⁄s
.
Cou¡
[
OT_TIMING_ANALYZE_ONLY_WITH_NET_DELAY
])

1007 *
O≥øti⁄
 = 
TIMING_ANALYSIS_ONLY
;

1009 
	}
}

1015 
boﬁón


1016 
	$IsTimögE«bÀd
(
IN
 
t_›ti⁄s
 
O±i⁄s
)

1019 if(
O±i⁄s
.
Cou¡
[
OT_TIMING_ANALYSIS
])

1021  
O±i⁄s
.
TimögA«lysis
;

1023  
TRUE
;

1024 
	}
}

1029 
	$lﬂd_subblock_öfo_to_ty≥
(
INOUT
 
t_subblock_d©a
 * 
subblocks
,

1030 
INOUT
 
t_ty≥_±r
 
ty≥
)

1032 
iblk
, 
i
;

1033 *
num_subblocks_≥r_block
;

1034 
t_subblock
 **
subblock_öf
;

1036 
num_subblocks_≥r_block
 = 
subblocks
->num_subblocks_per_block;

1037 
subblock_öf
 = 
subblocks
->subblock_inf;

1040 if(
ty≥
 !
IO_TYPE
)

1042 
ty≥_des¸ùt‹s
[
ty≥
->
ödex
].
max_subblock_öputs
 =

1043 
ty≥
->
num_ª˚ivîs
;

1044 
ty≥_des¸ùt‹s
[
ty≥
->
ödex
].
max_subblock_ouçuts
 =

1045 
ty≥
->
num_drivîs
;

1046 
ty≥_des¸ùt‹s
[
ty≥
->
ödex
].
max_subblocks
 = 1;

1049 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

1051 if(
block
[
iblk
].
ty≥
 ==Åype)

1053 
subblock_öf
[
iblk
] =

1054 (
t_subblock
 *Ë
	`my_mÆloc
((t_subblock));

1055 
num_subblocks_≥r_block
[
iblk
] = 1;

1056 
subblock_öf
[
iblk
][0].
«me
 = 
block
[iblk].name;

1057 
subblock_öf
[
iblk
][0].
öputs
 =

1058 (*)
	`my_mÆloc
(
ty≥
->
max_subblock_öputs
 *

1060 
subblock_öf
[
iblk
][0].
ouçuts
 =

1061 (*)
	`my_mÆloc
(
ty≥
->
max_subblock_ouçuts
 *

1063 
i
 = 0; i < 
ty≥
->
num_pös
; i++)

1065 if(
i
 < 
ty≥
->
max_subblock_öputs
)

1067 
subblock_öf
[
iblk
][0].
öputs
[
i
] =

1068 (
block
[
iblk
].
√ts
[
i
] ==

1069 
OPEN
Ë? OPEN : 
i
;

1071 if(
i
 <

1072 
ty≥
->
max_subblock_öputs
 +

1073 
ty≥
->
max_subblock_ouçuts
)

1075 
subblock_öf
[
iblk
][0].
ouçuts
[
i
 -

1076 
ty≥
->

1077 
max_subblock_öputs
]

1079 (
block
[
iblk
].
√ts
[
i
] ==

1080 
OPEN
Ë? OPEN : 
i
;

1084 
subblock_öf
[
iblk
][0].
˛ock
 =

1085 (
block
[
iblk
].
√ts
[
i
] ==

1086 
OPEN
Ë? OPEN : 
i
;

1091 
	}
}

	@SetupVPR.h

1 
boﬁón
 
IsTimögE«bÀd
(
IN
 
t_›ti⁄s
 
O±i⁄s
);

3 
SëupVPR
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

4 
IN
 
boﬁón
 
TimögE«bÀd
,

5 
OUT
 
t_¨ch
 * 
Arch
,

6 
OUT
 
e_›î©i⁄
 *
O≥øti⁄
,

7 
OUT
 
s_∂a˚r_›ts
 *
Pœ˚rO±s
,

8 
OUT
 
s_™√Æög_sched
 *
A¬ólSched
,

9 
OUT
 
s_rouãr_›ts
 *
RouãrO±s
,

10 
OUT
 
s_dë_routög_¨ch
 *
RoutögArch
,

11 
OUT
 
t_£gmít_öf
 ** 
Segmíts
,

12 
OUT
 
t_timög_öf
 * 
Timög
,

13 
OUT
 
t_subblock_d©a
 * 
Subblocks
,

14 
OUT
 
boﬁón
 * 
ShowGøphics
,

15 
OUT
 *
GøphPau£
);

17 
CheckSëup
(
IN
 
e_›î©i⁄
 
O≥øti⁄
,

18 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

19 
IN
 
s_™√Æög_sched
 
A¬ólSched
,

20 
IN
 
s_rouãr_›ts
 
RouãrO±s
,

21 
IN
 
s_dë_routög_¨ch
 
RoutögArch
,

22 
IN
 
t_£gmít_öf
 * 
Segmíts
,

23 
IN
 
t_timög_öf
 
Timög
,

24 
IN
 
t_subblock_d©a
 
Subblocks
,

25 
IN
 
t_ch™_width_di°
 
Ch™s
);

27 
CheckArch
(
IN
 
t_¨ch
 
Arch
,

28 
IN
 
boﬁón
 
TimögE«bÀd
);

30 
CheckO±i⁄s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

31 
IN
 
boﬁón
 
TimögE«bÀd
);

33 
ShowSëup
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

34 
IN
 
t_¨ch
 
Arch
,

35 
IN
 
boﬁón
 
TimögE«bÀd
,

36 
IN
 
e_›î©i⁄
 
O≥øti⁄
,

37 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

38 
IN
 
s_™√Æög_sched
 
A¬ólSched
,

39 
IN
 
s_rouãr_›ts
 
RouãrO±s
,

40 
IN
 
s_dë_routög_¨ch
 
RoutögArch
,

41 
IN
 
t_£gmít_öf
 * 
Segmíts
,

42 
IN
 
t_timög_öf
 
Timög
,

43 
IN
 
t_subblock_d©a
 
Subblocks
);

	@ShowSetup.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"O±i⁄Tokís.h
"

6 
	~"RódO±i⁄s.h
"

7 
	~"xml_¨ch.h
"

8 
	~"SëupVPR.h
"

12 
ShowPœ˚rO±s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

13 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

14 
IN
 
s_™√Æög_sched
 
A¬ólSched
);

15 
ShowO≥øti⁄
(
IN
 
e_›î©i⁄
 
O≥øti⁄
);

16 
ShowRouãrO±s
(
IN
 
s_rouãr_›ts
 
RouãrO±s
);

17 
ShowA¬ólSched
(
IN
 
s_™√Æög_sched
 
A¬ólSched
);

18 
ShowRoutögArch
(
IN
 
s_dë_routög_¨ch
 
RoutögArch
);

24 
	$ShowSëup
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

25 
IN
 
t_¨ch
 
Arch
,

26 
IN
 
boﬁón
 
TimögE«bÀd
,

27 
IN
 
e_›î©i⁄
 
O≥øti⁄
,

28 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

29 
IN
 
s_™√Æög_sched
 
A¬ólSched
,

30 
IN
 
s_rouãr_›ts
 
RouãrO±s
,

31 
IN
 
s_dë_routög_¨ch
 
RoutögArch
,

32 
IN
 
t_£gmít_öf
 * 
Segmíts
,

33 
IN
 
t_timög_öf
 
Timög
,

34 
IN
 
t_subblock_d©a
 
Subblocks
)

36 
i
, 
j
, 
num_p_öputs
, 
num_p_ouçuts
;

38 
	`¥ötf
("Timögá«lysis: %s\n", (
TimögE«bÀd
 ? "ON" : "OFF"));

39 
	`¥ötf
("\n");

41 
	`ShowO≥øti⁄
(
O≥øti⁄
);

42 
	`ShowPœ˚rO±s
(
O±i⁄s
, 
Pœ˚rO±s
, 
A¬ólSched
);

43 if((
ROUTE_ONLY
 =
O≥øti⁄
Ë|| (
PLACE_AND_ROUTE
 == Operation))

45 
	`ShowRouãrO±s
(
RouãrO±s
);

49 
	`¥ötf
("Router: DISABLED\n\n");

52 if(
DETAILED
 =
RouãrO±s
.
rouã_ty≥
)

53 
	`ShowRoutögArch
(
RoutögArch
);

55 
	`¥ötf
("The circuit will be mapped intoá %d x %dárray of clbs.\n",

56 
nx
, 
ny
);

57 
	`¥ötf
("\n");

58 
	`¥ötf
("Nëli°Çum_√ts: %d\n", 
num_√ts
);

59 
	`¥ötf
("Nëli°Çum_blocks: %d\n", 
num_blocks
);

62 
num_p_öputs
 = 0;

63 
num_p_ouçuts
 = 0;

64 
i
 = 0; i < 
num_blocks
; i++)

66 if(
block
[
i
].
ty≥
 =
IO_TYPE
)

68 
j
 = 0; j < 
IO_TYPE
->
num_pös
; j++)

70 if(
block
[
i
].
√ts
[
j
] !
OPEN
)

72 if(
IO_TYPE
->

73 
˛ass_öf
[
IO_TYPE
->
pö_˛ass
[
j
]].

74 
ty≥
 =
DRIVER
)

76 
num_p_öputs
++;

80 
	`as£π
(
IO_TYPE
->

81 
˛ass_öf
[
IO_TYPE
->

82 
pö_˛ass
[
j
]].

83 
ty≥
 =
RECEIVER
);

84 
num_p_ouçuts
++;

92 
	`¥ötf
("Nëli° i≈ut†pös: %d\n", 
num_p_öputs
);

93 
	`¥ötf
("Nëli° ouçuàpös: %d\n", 
num_p_ouçuts
);

94 
	`¥ötf
("\n");

95 
	}
}

99 
	$ShowRoutögArch
(
IN
 
s_dë_routög_¨ch
 
RoutögArch
)

102 
	`¥ötf
("RoutingArch.directionality: ");

103 
RoutögArch
.
dúe˘i⁄Æôy
)

105 
BI_DIRECTIONAL
:

106 
	`¥ötf
("BI_DIRECTIONAL\n");

108 
UNI_DIRECTIONAL
:

109 
	`¥ötf
("UNI_DIRECTIONAL\n");

112 
	`¥ötf
("<Unknown>\n");

113 
	`exô
(1);

116 
	`¥ötf
("RoutingArch.switch_block_type: ");

117 
RoutögArch
.
swôch_block_ty≥
)

119 
SUBSET
:

120 
	`¥ötf
("SUBSET\n");

122 
WILTON
:

123 
	`¥ötf
("WILTON\n");

125 
UNIVERSAL
:

126 
	`¥ötf
("UNIVERSAL\n");

128 
FULL
:

129 
	`¥ötf
("FULL\n");

132 
	`¥ötf
("<Unknown>\n");

133 
	`exô
(1);

136 
	`¥ötf
("RoutögArch.Fs: %d\n", 
RoutögArch
.
Fs
);

138 
	`¥ötf
("\n");

139 
	}
}

143 
	$ShowA¬ólSched
(
IN
 
s_™√Æög_sched
 
A¬ólSched
)

146 
	`¥ötf
("AnnealSched.type: ");

147 
A¬ólSched
.
ty≥
)

149 
AUTO_SCHED
:

150 
	`¥ötf
("AUTO_SCHED\n");

152 
USER_SCHED
:

153 
	`¥ötf
("USER_SCHED\n");

156 
	`¥ötf
("<Unknown>\n");

157 
	`exô
(1);

160 
	`¥ötf
("A¬ólSched.ö√r_num: %f\n", 
A¬ólSched
.
ö√r_num
);

162 if(
USER_SCHED
 =
A¬ólSched
.
ty≥
)

164 
	`¥ötf
("A¬ólSched.öô_t: %f\n", 
A¬ólSched
.
öô_t
);

165 
	`¥ötf
("A¬ólSched.Æpha_t: %f\n", 
A¬ólSched
.
Æpha_t
);

166 
	`¥ötf
("A¬ólSched.exô_t: %f\n", 
A¬ólSched
.
exô_t
);

168 
	}
}

172 
	$ShowRouãrO±s
(
IN
 
s_rouãr_›ts
 
RouãrO±s
)

175 
	`¥ötf
("RouterOpts.route_type: ");

176 
RouãrO±s
.
rouã_ty≥
)

178 
GLOBAL
:

179 
	`¥ötf
("GLOBAL\n");

181 
DETAILED
:

182 
	`¥ötf
("DETAILED\n");

185 
	`¥ötf
("<Unknown>\n");

186 
	`exô
(1);

189 if(
DETAILED
 =
RouãrO±s
.
rouã_ty≥
)

191 
	`¥ötf
("RouterOpts.router_algorithm: ");

192 
RouãrO±s
.
rouãr_Æg‹ôhm
)

194 
BREADTH_FIRST
:

195 
	`¥ötf
("BREADTH_FIRST\n");

197 
TIMING_DRIVEN
:

198 
	`¥ötf
("TIMING_DRIVEN\n");

200 
DIRECTED_SEARCH
:

201 
	`¥ötf
("DIRECTED_SEARCH\n");

204 
	`¥ötf
("<Unknown>\n");

205 
	`exô
(1);

208 
	`¥ötf
("RouterOpts.base_cost_type: ");

209 
RouãrO±s
.
ba£_co°_ty≥
)

211 
INTRINSIC_DELAY
:

212 
	`¥ötf
("INTRINSIC_DELAY\n");

214 
DELAY_NORMALIZED
:

215 
	`¥ötf
("DELAY_NORMALIZED\n");

217 
DEMAND_ONLY
:

218 
	`¥ötf
("DEMAND_ONLY\n");

221 
	`¥ötf
("<Unknown>\n");

222 
	`exô
(1);

225 
	`¥ötf
("RouterOpts.fixed_channel_width: ");

226 if(
NO_FIXED_CHANNEL_WIDTH
 =
RouãrO±s
.
fixed_ch™√l_width
)

228 
	`¥ötf
("NO_FIXED_CHANNEL_WIDTH\n");

232 
	`¥ötf
("%d\n", 
RouãrO±s
.
fixed_ch™√l_width
);

235 
	`¥ötf
("RouãrO±s.acc_Ác: %f\n", 
RouãrO±s
.
acc_Ác
);

236 
	`¥ötf
("RouãrO±s.bb_Á˘‹: %d\n", 
RouãrO±s
.
bb_Á˘‹
);

237 
	`¥ötf
("RouãrO±s.bíd_co°: %f\n", 
RouãrO±s
.
bíd_co°
);

238 
	`¥ötf
("RouterOpts.first_iter_pres_fac: %f\n",

239 
RouãrO±s
.
fú°_ôî_¥es_Ác
);

240 
	`¥ötf
("RouterOpts.initial_pres_fac: %f\n",

241 
RouãrO±s
.
öôül_¥es_Ác
);

242 
	`¥ötf
("RouterOpts.pres_fac_mult: %f\n",

243 
RouãrO±s
.
¥es_Ác_mu…
);

244 
	`¥ötf
("RouterOpts.max_router_iterations: %d\n",

245 
RouãrO±s
.
max_rouãr_ôî©i⁄s
);

247 if(
TIMING_DRIVEN
 =
RouãrO±s
.
rouãr_Æg‹ôhm
)

249 
	`¥ötf
("RouterOpts.astar_fac: %f\n",

250 
RouãrO±s
.
a°¨_Ác
);

251 
	`¥ötf
("RouterOpts.criticality_exp: %f\n",

252 
RouãrO±s
.
¸ôiˇlôy_exp
);

253 
	`¥ötf
("RouterOpts.max_criticality: %f\n",

254 
RouãrO±s
.
max_¸ôiˇlôy
);

259 
	`as£π
(
GLOBAL
 =
RouãrO±s
.
rouã_ty≥
);

261 
	`¥ötf
("RouterOpts.router_algorithm: ");

262 
RouãrO±s
.
rouãr_Æg‹ôhm
)

264 
BREADTH_FIRST
:

265 
	`¥ötf
("BREADTH_FIRST\n");

267 
TIMING_DRIVEN
:

268 
	`¥ötf
("TIMING_DRIVEN\n");

270 
DIRECTED_SEARCH
:

271 
	`¥ötf
("DIRECTED_SEARCH\n");

274 
	`¥ötf
("<Unknown>\n");

275 
	`exô
(1);

278 
	`¥ötf
("RouterOpts.base_cost_type: ");

279 
RouãrO±s
.
ba£_co°_ty≥
)

281 
INTRINSIC_DELAY
:

282 
	`¥ötf
("INTRINSIC_DELAY\n");

284 
DELAY_NORMALIZED
:

285 
	`¥ötf
("DELAY_NORMALIZED\n");

287 
DEMAND_ONLY
:

288 
	`¥ötf
("DEMAND_ONLY\n");

291 
	`¥ötf
("<Unknown>\n");

292 
	`exô
(1);

295 
	`¥ötf
("RouterOpts.fixed_channel_width: ");

296 if(
NO_FIXED_CHANNEL_WIDTH
 =
RouãrO±s
.
fixed_ch™√l_width
)

298 
	`¥ötf
("NO_FIXED_CHANNEL_WIDTH\n");

302 
	`¥ötf
("%d\n", 
RouãrO±s
.
fixed_ch™√l_width
);

305 
	`¥ötf
("RouãrO±s.acc_Ác: %f\n", 
RouãrO±s
.
acc_Ác
);

306 
	`¥ötf
("RouãrO±s.bb_Á˘‹: %d\n", 
RouãrO±s
.
bb_Á˘‹
);

307 
	`¥ötf
("RouãrO±s.bíd_co°: %f\n", 
RouãrO±s
.
bíd_co°
);

308 
	`¥ötf
("RouterOpts.first_iter_pres_fac: %f\n",

309 
RouãrO±s
.
fú°_ôî_¥es_Ác
);

310 
	`¥ötf
("RouterOpts.initial_pres_fac: %f\n",

311 
RouãrO±s
.
öôül_¥es_Ác
);

312 
	`¥ötf
("RouterOpts.pres_fac_mult: %f\n",

313 
RouãrO±s
.
¥es_Ác_mu…
);

314 
	`¥ötf
("RouterOpts.max_router_iterations: %d\n",

315 
RouãrO±s
.
max_rouãr_ôî©i⁄s
);

316 if(
TIMING_DRIVEN
 =
RouãrO±s
.
rouãr_Æg‹ôhm
)

318 
	`¥ötf
("RouterOpts.astar_fac: %f\n",

319 
RouãrO±s
.
a°¨_Ác
);

320 
	`¥ötf
("RouterOpts.criticality_exp: %f\n",

321 
RouãrO±s
.
¸ôiˇlôy_exp
);

322 
	`¥ötf
("RouterOpts.max_criticality: %f\n",

323 
RouãrO±s
.
max_¸ôiˇlôy
);

326 
	`¥ötf
("\n");

327 
	}
}

331 
	$ShowO≥øti⁄
(
IN
 
e_›î©i⁄
 
O≥øti⁄
)

333 
	`¥ötf
("Operation: ");

334 
O≥øti⁄
)

336 
PLACE_AND_ROUTE
:

337 
	`¥ötf
("PLACE_AND_ROUTE\n");

339 
PLACE_ONLY
:

340 
	`¥ötf
("PLACE_ONLY\n");

342 
ROUTE_ONLY
:

343 
	`¥ötf
("ROUTE_ONLY\n");

345 
TIMING_ANALYSIS_ONLY
:

346 
	`¥ötf
("TIMING_ANALYSIS_ONLY\n");

349 
	`¥ötf
("<Unknown>\n");

350 
	`exô
(1);

352 
	`¥ötf
("\n");

353 
	}
}

357 
	$ShowPœ˚rO±s
(
IN
 
t_›ti⁄s
 
O±i⁄s
,

358 
IN
 
s_∂a˚r_›ts
 
Pœ˚rO±s
,

359 
IN
 
s_™√Æög_sched
 
A¬ólSched
)

362 
	`¥ötf
("PlacerOpts.place_freq: ");

363 
Pœ˚rO±s
.
∂a˚_‰eq
)

365 
PLACE_ONCE
:

366 
	`¥ötf
("PLACE_ONCE\n");

368 
PLACE_ALWAYS
:

369 
	`¥ötf
("PLACE_ALWAYS\n");

371 
PLACE_NEVER
:

372 
	`¥ötf
("PLACE_NEVER\n");

375 
	`¥ötf
("<Unknown>\n");

376 
	`exô
(1);

378 if((
PLACE_ONCE
 =
Pœ˚rO±s
.
∂a˚_‰eq
) ||

379 (
PLACE_ALWAYS
 =
Pœ˚rO±s
.
∂a˚_‰eq
))

382 
	`¥ötf
("PlacerOpts.place_algorithm: ");

383 
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
)

385 
BOUNDING_BOX_PLACE
:

386 
	`¥ötf
("BOUNDING_BOX_PLACE\n");

388 
NET_TIMING_DRIVEN_PLACE
:

389 
	`¥ötf
("NET_TIMING_DRIVEN_PLACE\n");

391 
PATH_TIMING_DRIVEN_PLACE
:

392 
	`¥ötf
("PATH_TIMING_DRIVEN_PLACE\n");

395 
	`¥ötf
("<Unknown>\n");

396 
	`exô
(1);

399 
	`¥ötf
("PlacerOpts.place_cost_type: ");

400 
Pœ˚rO±s
.
∂a˚_co°_ty≥
)

402 
LINEAR_CONG
:

403 
	`¥ötf
("LINEAR_CONG\n");

405 
NONLINEAR_CONG
:

406 
	`¥ötf
("NONLINEAR_CONG\n");

409 
	`¥ötf
("<Unknown>\n");

410 
	`exô
(1);

413 
	`¥ötf
("PlacerOpts.pad_loc_type: ");

414 
Pœ˚rO±s
.
∑d_loc_ty≥
)

416 
FREE
:

417 
	`¥ötf
("FREE\n");

419 
RANDOM
:

420 
	`¥ötf
("RANDOM\n");

422 
USER
:

423 
	`¥ötf
("USER '%s'\n", 
Pœ˚rO±s
.
∑d_loc_fûe
);

426 
	`¥ötf
("<Unknown>\n");

427 
	`exô
(1);

430 
	`¥ötf
("PlacerOpts.place_cost_exp: %f\n",

431 
Pœ˚rO±s
.
∂a˚_co°_exp
);

433 if((
LINEAR_CONG
 =
Pœ˚rO±s
.
∂a˚_co°_ty≥
) ||

434 (
O±i⁄s
.
Cou¡
[
OT_PLACE_CHAN_WIDTH
]))

436 
	`¥ötf
("PlacerOpts.place_chan_width: %d\n",

437 
Pœ˚rO±s
.
∂a˚_ch™_width
);

440 if(
NONLINEAR_CONG
 =
Pœ˚rO±s
.
∂a˚_co°_ty≥
)

442 
	`¥ötf
("PlacerOpts.num_regions: %d\n",

443 
Pœ˚rO±s
.
num_ªgi⁄s
);

446 if((
NET_TIMING_DRIVEN_PLACE
 =
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
) ||

447 (
PATH_TIMING_DRIVEN_PLACE
 =
Pœ˚rO±s
.
∂a˚_Æg‹ôhm
))

449 
	`¥ötf
("PlacerOpts.inner_loop_recompute_divider: %d\n",

450 
Pœ˚rO±s
.
ö√r_lo›_ªcompuã_dividî
);

451 
	`¥ötf
("PlacerOpts.recompute_crit_iter: %d\n",

452 
Pœ˚rO±s
.
ªcompuã_¸ô_ôî
);

453 
	`¥ötf
("PlacerOpts.timing_tradeoff: %f\n",

454 
Pœ˚rO±s
.
timög_åadeoff
);

455 
	`¥ötf
("PlacerOpts.td_place_exp_first: %f\n",

456 
Pœ˚rO±s
.
td_∂a˚_exp_fú°
);

457 
	`¥ötf
("PlacerOpts.td_place_exp_last: %f\n",

458 
Pœ˚rO±s
.
td_∂a˚_exp_œ°
);

461 
	`¥ötf
("Pœ˚O±s.£ed: %d\n", 
Pœ˚rO±s
.
£ed
);

463 
	`ShowA¬ólSched
(
A¬ólSched
);

465 
	`¥ötf
("\n");

467 
	}
}

	@check_netlist.c

1 
	~<°dio.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"hash.h
"

6 
	~"v¥_utûs.h
"

7 
	~"check_√éi°.h
"

8 
	~"as£π.h
"

13 
check_c⁄√˘i⁄s_to_globÆ_fb_pös
(
öë
);

15 
check_fb_c⁄n
(
iblk
,

16 
num_c⁄n
);

18 
check_f‹_mu…ùÀ_sök_c⁄√˘i⁄s
();

20 
check_f‹_du∂iˇã_block_«mes
();

22 
gë_num_c⁄n
(
bnum
);

24 
check_subblocks
(
iblk
,

25 
t_subblock_d©a
 * 
subblock_d©a_±r
,

26 *
num_u£s_of_fb_pö
,

27 **
num_u£s_of_sblk_›ö
);

29 
check_subblock_pö
(
fb_pö
,

30 
mö_vÆ
,

31 
max_vÆ
,

32 
e_pö_ty≥
 
pö_ty≥
,

33 
iblk
,

34 
isubblk
,

35 
t_subblock
 * 
subblock_öf
);

37 
check_öã∫Æ_subblock_c⁄√˘i⁄s
(
t_subblock_d©a


38 * 
subblock_d©a_±r
,

39 
iblk
,

40 **
num_u£s_of_sblk_›ö
);

42 
check_fb_to_subblock_c⁄√˘i⁄s
(
iblk
,

43 
t_subblock
 * 
subblock_öf
,

44 
num_subblocks
,

45 *
num_u£s_of_fb_pö
);

52 
	$check_√éi°
(
t_subblock_d©a
 * 
subblock_d©a_±r
)

59 
i
, 
îr‹
, 
num_c⁄n
, 
max_subblocks
, 
max_pös
, 
max_sub_›ös
;

60 *
num_u£s_of_fb_pö
, **
num_u£s_of_sblk_›ö
,

61 *
num_subblocks_≥r_block
;

62 
s_hash
 **
√t_hash_èbÀ
, *
h_±r
;

64 
√t_hash_èbÀ
 = 
	`Æloc_hash_èbÀ
();

66 
num_subblocks_≥r_block
 = 
subblock_d©a_±r
->num_subblocks_per_block;

67 
subblock_d©a_±r
->
num_ff
 = 0;

68 
subblock_d©a_±r
->
num_c⁄°_gí
 = 0;

70 
îr‹
 = 0;

71 
max_pös
 = 0;

72 
max_sub_›ös
 = 0;

75 
max_subblocks
 = 0;

76 
i
 = 0; i < 
num_ty≥s
; i++)

78 
max_subblocks
 =

79 
	`max
(
max_subblocks
, 
ty≥_des¸ùt‹s
[
i
].max_subblocks);

80 
max_pös
 = 
	`max
(max_pös, 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

81 
max_sub_›ös
 =

82 
	`max
(
max_sub_›ös
, 
ty≥_des¸ùt‹s
[
i
].
max_subblock_ouçuts
);

86 
num_u£s_of_fb_pö
 = (*)
	`my_mÆloc
(
max_pös
 * ());

87 
num_u£s_of_sblk_›ö
 =

88 (**)
	`Æloc_m©rix
(0, 
max_subblocks
 - 1, 0, 
max_sub_›ös
 - 1,

93 
i
 = 0; i < 
num_√ts
; i++)

95 
h_±r
 = 
	`ö£π_ö_hash_èbÀ
(
√t_hash_èbÀ
, 
√t
[
i
].
«me
, i);

96 if(
h_±r
->
cou¡
 != 1) {

97 
	`¥ötf
("Eº‹:Çë %†ha†mu…ùÀ drivîs.\n", 
√t
[
i
].
«me
);

98 
îr‹
++;

101 if(
√t
[
i
].
num_söks
 == 0)

103 
	`¥ötf
("Eº‹:Çë %†ha†nÿÁnout.\n", 
√t
[
i
].
«me
);

104 
îr‹
++;

107 
îr‹
 +
	`check_c⁄√˘i⁄s_to_globÆ_fb_pös
(
i
);

109 
	`‰ì_hash_èbÀ
(
√t_hash_èbÀ
);

112 
i
 = 0; i < 
num_blocks
; i++)

114 
num_c⁄n
 = 
	`gë_num_c⁄n
(
i
);

115 
îr‹
 +
	`check_fb_c⁄n
(
i
, 
num_c⁄n
);

116 
îr‹
 +
	`check_subblocks
(
i
, 
subblock_d©a_±r
, 
num_u£s_of_fb_pö
,

117 
num_u£s_of_sblk_›ö
);

120 
	`check_f‹_mu…ùÀ_sök_c⁄√˘i⁄s
();

122 
îr‹
 +
	`check_f‹_du∂iˇã_block_«mes
();

124 
	`‰ì
(
num_u£s_of_fb_pö
);

125 
	`‰ì_m©rix
(
num_u£s_of_sblk_›ö
, 0, 
max_subblocks
 - 1, 0, ());

127 if(
îr‹
 != 0)

129 
	`¥ötf
("Found %d f©Æ Eº‹†öÅhêöpuà√éi°.\n", 
îr‹
);

130 
	`exô
(1);

132 
	}
}

136 
	$check_c⁄√˘i⁄s_to_globÆ_fb_pös
(
öë
)

143 
ùö
, 
num_pös
, 
iblk
, 
node_block_pö
, 
îr‹
;

145 
num_pös
 = (
√t
[
öë
].
num_söks
 + 1);

146 
îr‹
 = 0;

153 
ùö
 = 0; ipö < 
num_pös
; ipin++)

155 
iblk
 = 
√t
[
öë
].
node_block
[
ùö
];

157 
node_block_pö
 = 
√t
[
öë
].node_block_pö[
ùö
];

159 if(
block
[
iblk
].
ty≥
->
is_globÆ_pö
[
node_block_pö
] !=

160 
√t
[
öë
].
is_globÆ
)

165 if(
ùö
 =0 && 
√t
[
öë
].
is_globÆ
)

167 
¥ötf


170 "\t⁄ block #%d (%s).\n", 
öë
,

171 
√t
[
öë
].
«me
, 
node_block_pö
, 
iblk
,

172 
block
[
iblk
].
«me
);

176 
¥ötf


179 "\t⁄ block #%d (%s).\n", 
ùö
, 
öë
,

180 
√t
[
öë
].
«me
, 
node_block_pö
, 
iblk
,

181 
block
[
iblk
].
«me
);

182 
îr‹
++;

185 if(
√t
[
öë
].
is_globÆ
)

186 
	`¥ötf
("\tNet is global, but FBÖin isÇot.\n\n");

188 
	`¥ötf
("\tCLBÖin is global, butÇet isÇot.\n\n");

192  (
îr‹
);

193 
	}
}

197 
	$check_fb_c⁄n
(
iblk
,

198 
num_c⁄n
)

203 
i˛ass
, 
ùö
, 
îr‹
;

204 
t_ty≥_±r
 
ty≥
;

206 
îr‹
 = 0;

207 
ty≥
 = 
block
[
iblk
].type;

209 if(
ty≥
 =
IO_TYPE
)

211 if(
num_c⁄n
 != 1)

213 
	`¥ötf
(
ERRTAG
 "io blk #%d (%s) has %dÖins.\n",

214 
iblk
, 
block
[iblk].
«me
, 
num_c⁄n
);

215 
îr‹
++;

218 if(
num_c⁄n
 < 2)

220 
	`¥ötf
("Warning:Üogic block #%d (%s) has only %dÖin.\n",

221 
iblk
, 
block
[iblk].
«me
, 
num_c⁄n
);

228 if(
num_c⁄n
 == 1)

230 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ipin++)

232 if(
block
[
iblk
].
√ts
[
ùö
] !
OPEN
)

234 
i˛ass
 = 
ty≥
->
pö_˛ass
[
ùö
];

236 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ !
DRIVER
)

238 
îr‹
++;

242 
¥ötf


253 
îr‹
++;

260 if(
num_c⁄n
 > 
ty≥
->
num_pös
)

262 
	`¥ötf
("Error:Üogic block #%d with output %s has %dÖins.\n",

263 
iblk
, 
block
[iblk].
«me
, 
num_c⁄n
);

264 
îr‹
++;

267  (
îr‹
);

268 
	}
}

272 
	$check_f‹_du∂iˇã_block_«mes
()

278 
îr‹
, 
iblk
;

279 
s_hash
 **
block_hash_èbÀ
, *
h_±r
;

280 
s_hash_ôî©‹
 
hash_ôî©‹
;

282 
îr‹
 = 0;

283 
block_hash_èbÀ
 = 
	`Æloc_hash_èbÀ
();

285 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

286 
h_±r
 =

287 
	`ö£π_ö_hash_èbÀ
(
block_hash_èbÀ
, 
block
[
iblk
].
«me
, iblk);

289 
hash_ôî©‹
 = 
	`°¨t_hash_èbÀ_ôî©‹
();

290 
h_±r
 = 
	`gë_√xt_hash
(
block_hash_èbÀ
, &
hash_ôî©‹
);

292 
h_±r
 !
NULL
)

294 if(
h_±r
->
cou¡
 != 1)

296 
¥ötf


298 "\n", 
h_±r
->
cou¡
, h_±r->
«me
);

299 
îr‹
++;

301 
h_±r
 = 
	`gë_√xt_hash
(
block_hash_èbÀ
, &
hash_ôî©‹
);

304 
	`‰ì_hash_èbÀ
(
block_hash_èbÀ
);

305  (
îr‹
);

306 
	}
}

310 
	$check_subblocks
(
iblk
,

311 
t_subblock_d©a
 * 
subblock_d©a_±r
,

312 *
num_u£s_of_fb_pö
,

313 **
num_u£s_of_sblk_›ö
)

319 
îr‹
, 
isub
, 
ùö
, 
fb_pö
, 
num_pös_fb
;

320 
num_subblocks
, 
max_subblocks_≥r_block
, 
subblock_lut_size
,

321 
num_ouçuts
;

322 
t_subblock
 *
subblock_öf
;

324 
num_pös_fb
 = 
block
[
iblk
].
ty≥
->
num_pös
;

325 
îr‹
 = 0;

326 
subblock_öf
 = 
subblock_d©a_±r
->subblock_öf[
iblk
];

327 
num_subblocks
 = 
subblock_d©a_±r
->
num_subblocks_≥r_block
[
iblk
];

328 
max_subblocks_≥r_block
 = 
block
[
iblk
].
ty≥
->
max_subblocks
;

329 
subblock_lut_size
 = 
block
[
iblk
].
ty≥
->
max_subblock_öputs
;

330 
num_ouçuts
 = 
block
[
iblk
].
ty≥
->
max_subblock_ouçuts
;

332 if(
num_subblocks
 < 1 ||Çum_subblock†> 
max_subblocks_≥r_block
)

334 
	`¥ötf
("Error: block #%d (%s) contains %d subblocks.\n",

335 
iblk
, 
block
[iblk].
«me
, 
num_subblocks
);

336 
îr‹
++;

342 
isub
 = 0; isub < 
num_subblocks
; isub++)

345 
ùö
 = 0; ipö < 
subblock_lut_size
; ipin++)

347 
fb_pö
 = 
subblock_öf
[
isub
].
öputs
[
ùö
];

348 
îr‹
 +
	`check_subblock_pö
(
fb_pö
, 0,

349 (
num_pös_fb
 +

350 (
num_subblocks
 *

351 
num_ouçuts
Ë- 1), 
RECEIVER
,

352 
iblk
, 
isub
, 
subblock_öf
);

356 
ùö
 = 0; ipö < 
num_ouçuts
; ++ipin)

358 
fb_pö
 = 
subblock_öf
[
isub
].
ouçuts
[
ùö
];

359 
îr‹
 +
	`check_subblock_pö
(
fb_pö
, 0, (
num_pös_fb
 - 1),

360 
DRIVER
, 
iblk
, 
isub
,

361 
subblock_öf
);

365 
fb_pö
 = 
subblock_öf
[
isub
].
˛ock
;

366 
îr‹
 +
	`check_subblock_pö
(
fb_pö
, 0,

367 (
num_pös_fb
 +

368 (
num_subblocks
 * 
num_ouçuts
) - 1),

369 
RECEIVER
, 
iblk
, 
isub
, 
subblock_öf
);

375 if(
îr‹
 != 0)

376  (
îr‹
);

378 
	`lﬂd_⁄e_fb_Ánout_cou¡
(
subblock_öf
,

379 
num_subblocks
, 
num_u£s_of_fb_pö
,

380 
num_u£s_of_sblk_›ö
, 
iblk
);

382 
îr‹
 +
	`check_fb_to_subblock_c⁄√˘i⁄s
(
iblk
, 
subblock_öf
,

383 
num_subblocks
,

384 
num_u£s_of_fb_pö
);

386 
îr‹
 +
	`check_öã∫Æ_subblock_c⁄√˘i⁄s
(
subblock_d©a_±r
, 
iblk
,

387 
num_u£s_of_sblk_›ö
);

389  (
îr‹
);

390 
	}
}

394 
	$check_subblock_pö
(
fb_pö
,

395 
mö_vÆ
,

396 
max_vÆ
,

397 
e_pö_ty≥
 
pö_ty≥
,

398 
iblk
,

399 
isubblk
,

400 
t_subblock
 * 
subblock_öf
)

406 
i˛ass
;

407 
t_ty≥_±r
 
ty≥
;

409 
ty≥
 = 
block
[
iblk
].type;

411 if(
fb_pö
 !
OPEN
)

413 if(
fb_pö
 < 
mö_vÆ
 || fb_pö > 
max_vÆ
)

415 
	`¥ötf
("Error: Block #%d (%s) subblock #%d (%s)"

416 "c⁄√˘†tÿn⁄exi°íà˛bÖö #%d.\n", 
iblk
,

417 
block
[
iblk
].
«me
, 
isubblk
,

418 
subblock_öf
[
isubblk
].
«me
, 
fb_pö
);

422 if(
fb_pö
 < 
ty≥
->
num_pös
)

424 
i˛ass
 = 
ty≥
->
pö_˛ass
[
fb_pö
];

425 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ !
pö_ty≥
)

427 
¥ötf


430 
iblk
, 
block
[iblk].
«me
, 
isubblk
,

431 
subblock_öf
[
isubblk
].
«me
, 
fb_pö
);

438 
	}
}

442 
	$check_f‹_mu…ùÀ_sök_c⁄√˘i⁄s
()

450 
iblk
, 
ùö
, 
öë
, 
i˛ass
, 
˛ass_pö
;

451 *
num_pös_c⁄√˘ed
;

452 
t_ty≥_±r
 
ty≥
;

454 
num_pös_c⁄√˘ed
 = 
	`my_ˇŒoc
(
num_√ts
, ());

459 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

461 
ty≥
 = 
block
[
iblk
].type;

462 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

468 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
DRIVER
)

471 
˛ass_pö
 = 0;

472 
˛ass_pö
 < 
ty≥
->
˛ass_öf
[
i˛ass
].
num_pös
;

473 
˛ass_pö
++)

475 
ùö
 = 
ty≥
->
˛ass_öf
[
i˛ass
].
pöli°
[
˛ass_pö
];

476 
öë
 = 
block
[
iblk
].
√ts
[
ùö
];

478 if(
öë
 !
OPEN
)

479 
num_pös_c⁄√˘ed
[
öë
]++;

482 
˛ass_pö
 = 0;

483 
˛ass_pö
 < 
ty≥
->
˛ass_öf
[
i˛ass
].
num_pös
;

484 
˛ass_pö
++)

487 
ùö
 = 
ty≥
->
˛ass_öf
[
i˛ass
].
pöli°
[
˛ass_pö
];

488 
öë
 = 
block
[
iblk
].
√ts
[
ùö
];

490 if(
öë
 !
OPEN
)

492 if(
num_pös_c⁄√˘ed
[
öë
] > 1)

494 
¥ötf


496 "%dÅÿ√à%d (%s).\n", 
iblk
,

497 
block
[
iblk
].
«me
,

498 
num_pös_c⁄√˘ed
[
öë
],

499 
i˛ass
, 
öë
,

500 
√t
[
öë
].
«me
);

502 
¥ötf


508 
num_pös_c⁄√˘ed
[
öë
] = 0;

514 
	`‰ì
(
num_pös_c⁄√˘ed
);

515 
	}
}

519 
	$gë_num_c⁄n
(
bnum
)

524 
i
, 
num_c⁄n
;

525 
t_ty≥_±r
 
ty≥
;

527 
ty≥
 = 
block
[
bnum
].type;

529 
num_c⁄n
 = 0;

531 
i
 = 0; i < 
ty≥
->
num_pös
; i++)

533 if(
block
[
bnum
].
√ts
[
i
] !
OPEN
)

534 
num_c⁄n
++;

537  (
num_c⁄n
);

538 
	}
}

542 
	$check_öã∫Æ_subblock_c⁄√˘i⁄s
(
t_subblock_d©a
 * 
subblock_d©a_±r
,

543 
iblk
,

544 **
num_u£s_of_sblk_›ö
)

552 
num_c⁄°_gí
, 
num_ff
, 
isub
, 
ùö
, 
îr‹
, 
›ö
, 
i
;

553 
boﬁón
 
has_öputs
, 
has_ouçuts
;

554 
subblock_lut_size
;

555 
num_subblocks
;

556 
t_subblock
 *
subblock_öf
;

557 
t_ty≥_±r
 
ty≥
;

559 
ty≥
 = 
block
[
iblk
].type;

560 
subblock_lut_size
 = 
ty≥
->
max_subblock_öputs
;

561 
num_subblocks
 = 
subblock_d©a_±r
->
num_subblocks_≥r_block
[
iblk
];

562 
subblock_öf
 = 
subblock_d©a_±r
->subblock_öf[
iblk
];

564 
num_c⁄°_gí
 = 0;

565 
num_ff
 = 0;

566 
îr‹
 = 0;

568 
isub
 = 0; isub < 
num_subblocks
; isub++)

571 
has_öputs
 = 
FALSE
;

572 
ùö
 = 0; ipö < 
subblock_lut_size
; ipin++)

574 if(
subblock_öf
[
isub
].
öputs
[
ùö
] !
OPEN
)

576 
has_öputs
 = 
TRUE
;

580 
has_ouçuts
 = 
FALSE
;

581 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

583 if(
num_u£s_of_sblk_›ö
[
isub
][
›ö
] != 0)

585 
has_ouçuts
 = 
TRUE
;

590 if(
ty≥
 =
IO_TYPE
)

593 
	`as£π
((
has_öputs
 && !
has_ouçuts
)

594 || (!
has_öputs
 && 
has_ouçuts
));

596 if(!
has_ouçuts
)

599 if(
has_öputs
 || 
subblock_öf
[
isub
].
˛ock
 !
OPEN
)

601 
¥ötf


603 "√vî u£d.\n", 
isub
,

604 
subblock_öf
[
isub
].
«me
, 
iblk
,

605 
block
[
iblk
].
«me
);

606 
îr‹
++;

616 if(!
has_öputs
)

618 if(
subblock_öf
[
isub
].
˛ock
 =
OPEN
)

620 
¥ötf


623 
iblk
, 
block
[iblk].
«me
, 
isub
,

624 
subblock_öf
[
isub
].
«me
);

625 
num_c⁄°_gí
++;

629 
¥ötf


632 
iblk
, 
block
[iblk].
«me
, 
isub
,

633 
subblock_öf
[
isub
].
«me
);

634 
num_c⁄°_gí
++;

635 
îr‹
++;

641 if(
subblock_öf
[
isub
].
˛ock
 !
OPEN
)

643 
i
 = 0; i < 
ty≥
->
max_subblock_ouçuts
;

644 
i
++)

646 if(
subblock_öf
[
isub
].

647 
ouçuts
[
i
] !
OPEN
)

649 
num_ff
++;

657 
subblock_d©a_±r
->
num_c⁄°_gí
 +=Çum_const_gen;

658 
subblock_d©a_±r
->
num_ff
 +=Çum_ff;

659  (
îr‹
);

660 
	}
}

664 
	$check_fb_to_subblock_c⁄√˘i⁄s
(
iblk
,

665 
t_subblock
 * 
subblock_öf
,

666 
num_subblocks
,

667 *
num_u£s_of_fb_pö
)

677 
ùö
, 
isub
, 
fb_pö
, 
îr‹
;

678 
num_ouçuts
;

680 
îr‹
 = 0;

681 
num_ouçuts
 = 
block
[
iblk
].
ty≥
->
max_subblock_ouçuts
;

685 
isub
 = 0; isub < 
num_subblocks
; isub++)

687 
ùö
 = 0; ipö < 
num_ouçuts
; ++ipin)

689 
fb_pö
 = 
subblock_öf
[
isub
].
ouçuts
[
ùö
];

691 if(
fb_pö
 !
OPEN
)

692 
num_u£s_of_fb_pö
[
fb_pö
]++;

696 
ùö
 = 0; ipö < 
block
[
iblk
].
ty≥
->
num_pös
; ipin++)

699 if(
block
[
iblk
].
√ts
[
ùö
] !
OPEN
)

701 if(
	`is_›ö
(
ùö
, 
block
[
iblk
].
ty≥
))

703 if(
num_u£s_of_fb_pö
[
ùö
] == 0)

705 
¥ötf


707 "byány subblock.\n", 
ùö
, 
iblk
,

708 
block
[
iblk
].
«me
);

709 
îr‹
++;

711 if(
num_u£s_of_fb_pö
[
ùö
] > 1)

713 
¥ötf


715 "by %d subblocks.\n", 
ùö
, 
iblk
,

716 
block
[
iblk
].
«me
,

717 
num_u£s_of_fb_pö
[
ùö
]);

718 
îr‹
++;

724 if(
num_u£s_of_fb_pö
[
ùö
] <= 0)

726 
¥ötf


728 "subblocks.\n", 
ùö
, 
iblk
,

729 
block
[
iblk
].
«me
);

730 
îr‹
++;

735 if(
	`is_›ö
(
ùö
, 
block
[
iblk
].
ty≥
))

737 if(
num_u£s_of_fb_pö
[
ùö
] > 1)

739 
¥ötf


741 "subblocks.\n", 
ùö
, 
iblk
, 
block
[iblk].
«me
,

742 
num_u£s_of_fb_pö
[
ùö
]);

743 
îr‹
++;

748  (
îr‹
);

749 
	}
}

	@check_netlist.h

1 
check_√éi°
(
t_subblock_d©a
 * 
subblock_d©a_±r
);

	@check_route.c

1 
	~<as£π.h
>

2 
	~<°dio.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"globÆs.h
"

6 
	~"m°.h
"

7 
	~"rouã_exp‹t.h
"

8 
	~"check_rouã.h
"

9 
	~"º_gøph.h
"

10 
	~"check_º_gøph.h
"

14 
check_node_™d_ønge
(
öode
,

15 
e_rouã_ty≥
 
rouã_ty≥
);

16 
check_sour˚
(
öode
,

17 
öë
);

18 
check_sök
(
öode
,

19 
öë
,

20 
boﬁón
 * 
pö_d⁄e
);

21 
check_swôch
(
s_åa˚
 *
çå
,

22 
num_swôch
);

23 
boﬁón
 
check_adja˚¡
(
‰om_node
,

24 
to_node
);

25 
pö_™d_ch™_adja˚¡
(
pö_node
,

26 
ch™_node
);

27 
ch™x_ch™y_adja˚¡
(
ch™x_node
,

28 
ch™y_node
);

29 
ª£t_Êags
(
öë
,

30 
boﬁón
 * 
c⁄√˘ed_to_rouã
);

31 
ªcompuã_occu∑ncy_‰om_s¸©ch
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
);

32 
check_loˇŒy_u£d_fb_›ös
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

33 
e_rouã_ty≥
 
rouã_ty≥
);

39 
	$check_rouã
(
e_rouã_ty≥
 
rouã_ty≥
,

40 
num_swôch
,

41 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
)

50 
öë
, 
ùö
, 
max_pös
, 
öode
, 
¥ev_node
;

51 
boﬁón
 
vÆid
, 
c⁄√˘s
;

52 
boﬁón
 *
c⁄√˘ed_to_rouã
;

53 
s_åa˚
 *
çå
;

54 
boﬁón
 *
pö_d⁄e
;

56 
	`¥ötf
("\nCheckingÅoÉnsureÑouting isÜegal ...\n");

62 
	`ªcompuã_occu∑ncy_‰om_s¸©ch
(
fb_›ös_u£d_loˇŒy
);

63 
vÆid
 = 
	`„asibÀ_routög
();

64 if(
vÆid
 =
FALSE
)

66 
¥ötf


68 
	`exô
(1);

71 
	`check_loˇŒy_u£d_fb_›ös
(
fb_›ös_u£d_loˇŒy
, 
rouã_ty≥
);

73 
c⁄√˘ed_to_rouã
 = (
boﬁón
 *Ë
	`my_ˇŒoc
(
num_º_nodes
, (boolean));

75 
max_pös
 = 0;

76 
öë
 = 0; i√à< 
num_√ts
; inet++)

77 
max_pös
 = 
	`max
(max_pös, (
√t
[
öë
].
num_söks
 + 1));

79 
pö_d⁄e
 = (
boﬁón
 *Ë
	`my_mÆloc
(
max_pös
 * (boolean));

83 
öë
 = 0; i√à< 
num_√ts
; inet++)

86 if(
√t
[
öë
].
is_globÆ
)

89 
ùö
 = 0; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

90 
pö_d⁄e
[
ùö
] = 
FALSE
;

94 
çå
 = 
åa˚_hód
[
öë
];

95 if(
çå
 =
NULL
)

97 
	`¥ötf
("Error in check_route:Çet %d hasÇoÑouting.\n",

98 
öë
);

99 
	`exô
(1);

102 
öode
 = 
çå
->
ödex
;

103 
	`check_node_™d_ønge
(
öode
, 
rouã_ty≥
);

104 
	`check_swôch
(
çå
, 
num_swôch
);

105 
c⁄√˘ed_to_rouã
[
öode
] = 
TRUE
;

107 
	`check_sour˚
(
öode
, 
öë
);

108 
pö_d⁄e
[0] = 
TRUE
;

110 
¥ev_node
 = 
öode
;

111 
çå
 =Å±r->
√xt
;

115 
çå
 !
NULL
)

117 
öode
 = 
çå
->
ödex
;

118 
	`check_node_™d_ønge
(
öode
, 
rouã_ty≥
);

119 
	`check_swôch
(
çå
, 
num_swôch
);

121 if(
º_node
[
¥ev_node
].
ty≥
 =
SINK
)

123 if(
c⁄√˘ed_to_rouã
[
öode
] =
FALSE
)

125 
¥ötf


128 
öode
, 
öë
);

129 
	`exô
(1);

135 
c⁄√˘s
 = 
	`check_adja˚¡
(
¥ev_node
, 
öode
);

136 if(!
c⁄√˘s
)

138 
¥ötf


140 
öë
);

141 
¥ötf


143 
	`exô
(1);

146 if(
c⁄√˘ed_to_rouã
[
öode
]

147 && 
º_node
[
öode
].
ty≥
 !
SINK
)

153 
¥ötf


155 
öë
);

156 
	`exô
(1);

159 
c⁄√˘ed_to_rouã
[
öode
] = 
TRUE
;

161 if(
º_node
[
öode
].
ty≥
 =
SINK
)

162 
	`check_sök
(
öode
, 
öë
, 
pö_d⁄e
);

165 
¥ev_node
 = 
öode
;

166 
çå
 =Å±r->
√xt
;

169 if(
º_node
[
¥ev_node
].
ty≥
 !
SINK
)

171 
	`¥ötf
("Error in check_route. Net %d doesÇotÉnd\n",

172 
öë
);

173 
	`¥ötf
("withá SINK.\n");

174 
	`exô
(1);

177 
ùö
 = 0; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

179 if(
pö_d⁄e
[
ùö
] =
FALSE
)

181 
¥ötf


183 
öë
);

184 
	`¥ötf
("c⁄√˘Åÿpö %d.\n", 
ùö
);

185 
	`exô
(1);

189 
	`ª£t_Êags
(
öë
, 
c⁄√˘ed_to_rouã
);

193 
	`‰ì
(
pö_d⁄e
);

194 
	`‰ì
(
c⁄√˘ed_to_rouã
);

195 
	`¥ötf
("CompletedÑouting consistency check successfully.\n\n");

196 
	}
}

199 
	$check_sök
(
öode
,

200 
öë
,

201 
boﬁón
 * 
pö_d⁄e
)

207 
i
, 
j
, 
ùö
, 
ifound
, 
±c_num
, 
bnum
, 
i˛ass
, 
node_block_pö
, 
iblk
;

208 
t_ty≥_±r
 
ty≥
;

210 
	`as£π
(
º_node
[
öode
].
ty≥
 =
SINK
);

211 
i
 = 
º_node
[
öode
].
xlow
;

212 
j
 = 
º_node
[
öode
].
ylow
;

213 
ty≥
 = 
grid
[
i
][
j
].type;

214 
±c_num
 = 
º_node
[
öode
].ptc_num;

215 
ifound
 = 0;

217 
iblk
 = 0; iblk < 
ty≥
->
ˇ∑côy
; iblk++)

219 
bnum
 = 
grid
[
i
][
j
].
blocks
[
iblk
];

220 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

222 if(
√t
[
öë
].
node_block
[
ùö
] =
bnum
)

224 
node_block_pö
 = 
√t
[
öë
].node_block_pö[
ùö
];

225 
i˛ass
 = 
ty≥
->
pö_˛ass
[
node_block_pö
];

226 if(
i˛ass
 =
±c_num
)

231 if(
pö_d⁄e
[
ùö
] =
FALSE
)

233 
ifound
++;

234 
pö_d⁄e
[
ùö
] = 
TRUE
;

241 if(
ifound
 > 1 && 
ty≥
 =
IO_TYPE
)

243 
	`¥ötf
("Error in check_sink: found %dÅerminals ofÇet %d ofÖad"

244 "\¿%dáàloˇti⁄ (%d, %d).\n", 
ifound
, 
öë
, 
±c_num
, 
i
,

245 
j
);

246 
	`exô
(1);

249 if(
ifound
 < 1)

251 
¥ötf


253 "\¿o‡√à%d.\n", 
öode
, 
öë
);

254 
	`exô
(1);

256 
	}
}

260 
	$check_sour˚
(
öode
,

261 
öë
)

266 
t_º_ty≥
 
º_ty≥
;

267 
t_ty≥_±r
 
ty≥
;

268 
i
, 
j
, 
±c_num
, 
bnum
, 
node_block_pö
, 
i˛ass
;

270 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

271 if(
º_ty≥
 !
SOURCE
)

273 
¥ötf


275 
öë
, 
º_ty≥
);

276 
	`exô
(1);

279 
i
 = 
º_node
[
öode
].
xlow
;

280 
j
 = 
º_node
[
öode
].
ylow
;

281 
±c_num
 = 
º_node
[
öode
].ptc_num;

282 
bnum
 = 
√t
[
öë
].
node_block
[0];

283 
ty≥
 = 
grid
[
i
][
j
].type;

285 if(
block
[
bnum
].
x
 !
i
 || block[bnum].
y
 !
j
)

287 
¥ötf


289 "\n", 
i
, 
j
);

290 
	`exô
(1);

293 
node_block_pö
 = 
√t
[
öë
].node_block_pin[0];

294 
i˛ass
 = 
ty≥
->
pö_˛ass
[
node_block_pö
];

296 if(
±c_num
 !
i˛ass
)

298 
¥ötf


300 
±c_num
);

301 
	`exô
(1);

303 
	}
}

307 
	$check_swôch
(
s_åa˚
 *
çå
,

308 
num_swôch
)

314 
öode
;

315 
swôch_ty≥
;

317 
öode
 = 
çå
->
ödex
;

318 
swôch_ty≥
 = 
çå
->
iswôch
;

320 if(
º_node
[
öode
].
ty≥
 !
SINK
)

322 if(
swôch_ty≥
 < 0 || swôch_ty≥ >
num_swôch
)

324 
¥ötf


326 
öode
, 
swôch_ty≥
);

327 
	`¥ötf
("SwitchÅype is out ofÑange.\n");

328 
	`exô
(1);

338 if(
swôch_ty≥
 !
OPEN
)

340 
¥ötf


342 "tÿu£á swôch o‡ty≥ %d.\n", 
öode
, 
swôch_ty≥
);

343 
	`exô
(1);

346 
	}
}

350 
	$ª£t_Êags
(
öë
,

351 
boﬁón
 * 
c⁄√˘ed_to_rouã
)

359 
s_åa˚
 *
çå
;

360 
öode
;

362 
çå
 = 
åa˚_hód
[
öë
];

364 
çå
 !
NULL
)

366 
öode
 = 
çå
->
ödex
;

367 
c⁄√˘ed_to_rouã
[
öode
] = 
FALSE
;

368 
çå
 =Å±r->
√xt
;

370 
	}
}

373 
boﬁón


374 
	$check_adja˚¡
(
‰om_node
,

375 
to_node
)

383 
‰om_xlow
, 
‰om_ylow
, 
to_xlow
, 
to_ylow
, 
‰om_±c
, 
to_±c
, 
i˛ass
;

384 
num_adj
, 
to_xhigh
, 
to_yhigh
, 
‰om_xhigh
, 
‰om_yhigh
, 
ic⁄n
;

385 
boﬁón
 
ªached
;

386 
t_º_ty≥
 
‰om_ty≥
, 
to_ty≥
;

387 
t_ty≥_±r
 
‰om_grid_ty≥
, 
to_grid_ty≥
;

389 
ªached
 = 
FALSE
;

391 
ic⁄n
 = 0; ic⁄¿< 
º_node
[
‰om_node
].
num_edges
; iconn++)

393 if(
º_node
[
‰om_node
].
edges
[
ic⁄n
] =
to_node
)

395 
ªached
 = 
TRUE
;

400 if(!
ªached
)

401  (
FALSE
);

406 
num_adj
 = 0;

408 
‰om_ty≥
 = 
º_node
[
‰om_node
].
ty≥
;

409 
‰om_xlow
 = 
º_node
[
‰om_node
].
xlow
;

410 
‰om_ylow
 = 
º_node
[
‰om_node
].
ylow
;

411 
‰om_xhigh
 = 
º_node
[
‰om_node
].
xhigh
;

412 
‰om_yhigh
 = 
º_node
[
‰om_node
].
yhigh
;

413 
‰om_±c
 = 
º_node
[
‰om_node
].
±c_num
;

414 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

415 
to_xlow
 = 
º_node
[
to_node
].
xlow
;

416 
to_ylow
 = 
º_node
[
to_node
].
ylow
;

417 
to_xhigh
 = 
º_node
[
to_node
].
xhigh
;

418 
to_yhigh
 = 
º_node
[
to_node
].
yhigh
;

419 
to_±c
 = 
º_node
[
to_node
].
±c_num
;

421 
‰om_ty≥
)

424 
SOURCE
:

425 
	`as£π
(
to_ty≥
 =
OPIN
);

426 if(
‰om_xlow
 =
to_xlow
 && 
‰om_ylow
 =
to_ylow


427 && 
‰om_xhigh
 =
to_xhigh
 && 
‰om_yhigh
 =
to_yhigh
)

430 
‰om_grid_ty≥
 = 
grid
[
‰om_xlow
][
‰om_ylow
].
ty≥
;

431 
to_grid_ty≥
 = 
grid
[
to_xlow
][
to_ylow
].
ty≥
;

432 
	`as£π
(
‰om_grid_ty≥
 =
to_grid_ty≥
);

434 
i˛ass
 = 
to_grid_ty≥
->
pö_˛ass
[
to_±c
];

435 if(
i˛ass
 =
‰om_±c
)

436 
num_adj
++;

440 
SINK
:

444 
OPIN
:

445 
	`as£π
(
to_ty≥
 =
CHANX
 ||Åo_ty≥ =
CHANY
);

446 
num_adj
 +
	`pö_™d_ch™_adja˚¡
(
‰om_node
, 
to_node
);

450 
IPIN
:

451 
	`as£π
(
to_ty≥
 =
SINK
);

452 if(
‰om_xlow
 =
to_xlow
 && 
‰om_ylow
 =
to_ylow


453 && 
‰om_xhigh
 =
to_xhigh
 && 
‰om_yhigh
 =
to_yhigh
)

456 
‰om_grid_ty≥
 = 
grid
[
‰om_xlow
][
‰om_ylow
].
ty≥
;

457 
to_grid_ty≥
 = 
grid
[
to_xlow
][
to_ylow
].
ty≥
;

458 
	`as£π
(
‰om_grid_ty≥
 =
to_grid_ty≥
);

460 
i˛ass
 = 
‰om_grid_ty≥
->
pö_˛ass
[
‰om_±c
];

461 if(
i˛ass
 =
to_±c
)

462 
num_adj
++;

466 
CHANX
:

467 if(
to_ty≥
 =
IPIN
)

469 
num_adj
 +
	`pö_™d_ch™_adja˚¡
(
to_node
, 
‰om_node
);

471 if(
to_ty≥
 =
CHANX
)

473 
‰om_xhigh
 = 
º_node
[
‰om_node
].
xhigh
;

474 
to_xhigh
 = 
º_node
[
to_node
].
xhigh
;

475 if(
‰om_ylow
 =
to_ylow
)

479 if(
to_xhigh
 =
‰om_xlow
 - 1

480 || 
‰om_xhigh
 =
to_xlow
 - 1)

482 
num_adj
++;

487 
i
;

489 
i
 = 
‰om_xlow
; i <
‰om_xhigh
; i++)

491 if(
i
 >
to_xlow
 && i <
to_xhigh
)

493 
num_adj
++;

501 if(
to_ty≥
 =
CHANY
)

503 
num_adj
 +
	`ch™x_ch™y_adja˚¡
(
‰om_node
, 
to_node
);

507 
	`as£π
(0);

511 
CHANY
:

512 if(
to_ty≥
 =
IPIN
)

514 
num_adj
 +
	`pö_™d_ch™_adja˚¡
(
to_node
, 
‰om_node
);

516 if(
to_ty≥
 =
CHANY
)

518 
‰om_yhigh
 = 
º_node
[
‰om_node
].
yhigh
;

519 
to_yhigh
 = 
º_node
[
to_node
].
yhigh
;

520 if(
‰om_xlow
 =
to_xlow
)

523 if(
to_yhigh
 =
‰om_ylow
 - 1

524 || 
‰om_yhigh
 =
to_ylow
 - 1)

526 
num_adj
++;

531 
j
;

533 
j
 = 
‰om_ylow
; j <
‰om_yhigh
; j++)

535 if(
j
 >
to_ylow
 && j <
to_yhigh
)

537 
num_adj
++;

545 if(
to_ty≥
 =
CHANX
)

547 
num_adj
 +
	`ch™x_ch™y_adja˚¡
(
to_node
, 
‰om_node
);

551 
	`as£π
(0);

560 if(
num_adj
 == 1)

561  (
TRUE
);

562 if(
num_adj
 == 0)

563  (
FALSE
);

565 
	`¥ötf
("Error in check_adjacent:Çum_adj = %d. Expected 0 or 1.\n",

566 
num_adj
);

567 
	`exô
(1);

568 
	}
}

572 
	$ch™x_ch™y_adja˚¡
(
ch™x_node
,

573 
ch™y_node
)

579 
ch™x_y
, 
ch™x_xlow
, 
ch™x_xhigh
;

580 
ch™y_x
, 
ch™y_ylow
, 
ch™y_yhigh
;

582 
ch™x_y
 = 
º_node
[
ch™x_node
].
ylow
;

583 
ch™x_xlow
 = 
º_node
[
ch™x_node
].
xlow
;

584 
ch™x_xhigh
 = 
º_node
[
ch™x_node
].
xhigh
;

586 
ch™y_x
 = 
º_node
[
ch™y_node
].
xlow
;

587 
ch™y_ylow
 = 
º_node
[
ch™y_node
].
ylow
;

588 
ch™y_yhigh
 = 
º_node
[
ch™y_node
].
yhigh
;

590 if(
ch™y_ylow
 > 
ch™x_y
 + 1 || 
ch™y_yhigh
 < chanx_y)

593 if(
ch™x_xlow
 > 
ch™y_x
 + 1 || 
ch™x_xhigh
 < chany_x)

597 
	}
}

601 
	$pö_™d_ch™_adja˚¡
(
pö_node
,

602 
ch™_node
)

609 
num_adj
, 
pö_xlow
, 
pö_ylow
, 
pö_xhigh
, 
pö_yhigh
, 
ch™_xlow
,

610 
ch™_ylow
, 
ch™_xhigh
, 
ch™_yhigh
;

611 
pö_±c
, 
i
;

612 
t_º_ty≥
 
ch™_ty≥
;

613 
t_ty≥_±r
 
pö_grid_ty≥
;

615 
num_adj
 = 0;

616 
pö_xlow
 = 
º_node
[
pö_node
].
xlow
;

617 
pö_ylow
 = 
º_node
[
pö_node
].
ylow
;

618 
pö_xhigh
 = 
º_node
[
pö_node
].
xhigh
;

619 
pö_yhigh
 = 
º_node
[
pö_node
].
yhigh
;

620 
pö_grid_ty≥
 = 
grid
[
pö_xlow
][
pö_ylow
].
ty≥
;

621 
pö_±c
 = 
º_node
[
pö_node
].
±c_num
;

622 
ch™_ty≥
 = 
º_node
[
ch™_node
].
ty≥
;

623 
ch™_xlow
 = 
º_node
[
ch™_node
].
xlow
;

624 
ch™_ylow
 = 
º_node
[
ch™_node
].
ylow
;

625 
ch™_xhigh
 = 
º_node
[
ch™_node
].
xhigh
;

626 
ch™_yhigh
 = 
º_node
[
ch™_node
].
yhigh
;

628 if(
ch™_ty≥
 =
CHANX
)

630 if(
ch™_ylow
 =
pö_yhigh
)

632 if(
pö_grid_ty≥
->

633 
pöloc
[
pö_grid_ty≥
->
height
 - 1][
TOP
][
pö_±c
] == 1

634 && 
pö_xlow
 <
ch™_xhigh
 && 
pö_xhigh
 >
ch™_xlow
)

635 
num_adj
++;

637 if(
ch™_ylow
 =
pö_ylow
 - 1)

639 if(
pö_grid_ty≥
->
pöloc
[0][
BOTTOM
][
pö_±c
] == 1

640 && 
pö_xlow
 <
ch™_xhigh
 && 
pö_xhigh
 >
ch™_xlow
)

641 
num_adj
++;

644 if(
ch™_ty≥
 =
CHANY
)

646 
i
 = 0; i < 
pö_grid_ty≥
->
height
; i++)

648 if(
ch™_xlow
 =
pö_xhigh
)

650 if(
pö_grid_ty≥
->
pöloc
[
i
][
RIGHT
][
pö_±c
] == 1

651 && 
pö_ylow
 <
ch™_yhigh


652 && 
pö_yhigh
 >
ch™_ylow
)

653 
num_adj
++;

655 if(
ch™_xlow
 =
pö_xlow
 - 1)

657 if(
pö_grid_ty≥
->
pöloc
[
i
][
LEFT
][
pö_±c
] == 1

658 && 
pö_ylow
 <
ch™_yhigh


659 && 
pö_yhigh
 >
ch™_ylow
)

660 
num_adj
++;

664  (
num_adj
);

665 
	}
}

669 
	$ªcompuã_occu∑ncy_‰om_s¸©ch
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
)

676 
öode
, 
öë
, 
iblk
, 
i˛ass
, 
ùö
, 
num_loˇl_›ös
;

677 
s_åa˚
 *
çå
;

681 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

682 
º_node
[
öode
].
occ
 = 0;

686 
öë
 = 0; i√à< 
num_√ts
; inet++)

689 if(
√t
[
öë
].
is_globÆ
)

692 
çå
 = 
åa˚_hód
[
öë
];

693 if(
çå
 =
NULL
)

698 
öode
 = 
çå
->
ödex
;

699 
º_node
[
öode
].
occ
++;

701 if(
º_node
[
öode
].
ty≥
 =
SINK
)

703 
çå
 =Å±r->
√xt
;

704 if(
çå
 =
NULL
)

708 
çå
 =Å±r->
√xt
;

716 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

718 
i˛ass
 = 0; i˛as†< 
block
[
iblk
].
ty≥
->
num_˛ass
; iclass++)

720 
num_loˇl_›ös
 =

721 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

723 
ùö
 = 0; ipö < 
num_loˇl_›ös
; ipin++)

725 
öode
 =

726 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

727 
li°
[
ùö
];

728 
º_node
[
öode
].
occ
++;

732 
	}
}

736 
	$check_loˇŒy_u£d_fb_›ös
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

737 
e_rouã_ty≥
 
rouã_ty≥
)

743 
i˛ass
, 
iblk
, 
num_loˇl_›ös
, 
öode
, 
ùö
;

744 
t_º_ty≥
 
º_ty≥
;

746 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

748 
i˛ass
 = 0; i˛as†< 
block
[
iblk
].
ty≥
->
num_˛ass
; iclass++)

750 
num_loˇl_›ös
 =

751 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

754 
ùö
 = 0; ipö < 
num_loˇl_›ös
; ipin++)

756 
öode
 =

757 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

758 
li°
[
ùö
];

759 
	`check_node_™d_ønge
(
öode
, 
rouã_ty≥
);

763 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

764 if(
º_ty≥
 !
OPIN
)

766 
¥ötf


770 
iblk
, 
block
[iblk].
«me
, 
i˛ass
,

771 
öode
, 
º_ty≥
);

772 
	`exô
(1);

775 
ùö
 = 
º_node
[
öode
].
±c_num
;

776 if(
block
[
iblk
].
ty≥
->
pö_˛ass
[
ùö
] !
i˛ass
)

778 
¥ötf


781 "\år_nodê#: %d.\n", 
iblk
,

782 
block
[
iblk
].
«me
, 
i˛ass
,

783 
block
[
iblk
].
ty≥
->
pö_˛ass
[
ùö
],

784 
öode
);

785 
	`exô
(1);

790 
	}
}

794 
	$check_node_™d_ønge
(
öode
,

795 
e_rouã_ty≥
 
rouã_ty≥
)

801 if(
öode
 < 0 || inodê>
num_º_nodes
)

803 
¥ötf


805 "\å™gê(0Åÿ%d).\n", 
öode
, 
num_º_nodes
 - 1);

806 
	`exô
(1);

808 
	`check_node
(
öode
, 
rouã_ty≥
);

809 
	}
}

	@check_route.h

1 
check_rouã
(
e_rouã_ty≥
 
rouã_ty≥
,

2 
num_swôch
,

3 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
);

	@check_rr_graph.c

1 
	~"utû.h
"

2 
	~"v¥_ty≥s.h
"

3 
	~"globÆs.h
"

4 
	~"º_gøph.h
"

5 
	~"check_º_gøph.h
"

10 
	#BUF_FLAG
 1

	)

11 
	#PTRANS_FLAG
 2

	)

12 
	#BUF_AND_PTRANS_FLAG
 3

	)

17 
boﬁón
 
º_node_is_globÆ_˛b_ùö
(
öode
);

19 
check_∑ss_å™si°‹s
(
‰om_node
);

24 
boﬁón
 
	gº_gøph_îr‹
;

25 
boﬁón
 
	gº_gøph_w¨n
;

28 
	$check_º_gøph
(
IN
 
t_gøph_ty≥
 
gøph_ty≥
,

29 
IN
 
num_ty≥s
,

30 
IN
 
t_ty≥_±r
 
ty≥s
,

31 
IN
 
nx
,

32 
IN
 
ny
,

33 
IN
 
s_grid_tûe
 **
grid
,

34 
IN
 
nodes_≥r_ch™
,

35 
IN
 
Fs
,

36 
IN
 
num_£g_ty≥s
,

37 
IN
 
num_swôches
,

38 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

39 
IN
 
globÆ_rouã_swôch
,

40 
IN
 
dñayÀss_swôch
,

41 
IN
 
wúe_to_ùö_swôch
,

42 
t_£g_dëaûs
 * 
£g_dëaûs
,

43 *
Fc_ö
,

44 *
Fc_out
,

45 
t_ivec
 *** 
º_node_ödi˚s
,

46 *****
›ö_to_åack_m≠
,

47 *****
ùö_to_åack_m≠
,

48 
t_ivec
 **** 
åack_to_ùö_lookup
,

49 
t_ivec
 *** 
swôch_block_c⁄n
,

50 
boﬁón
 * 
≥πurb_ùös
)

54 *
num_edges_‰om_cuºít_to_node
;

55 *
tŸÆ_edges_to_node
;

56 *
swôch_ty≥s_‰om_cuºít_to_node
;

57 
öode
, 
õdge
, 
to_node
, 
num_edges
;

58 
swôch_ty≥
;

59 
t_º_ty≥
 
º_ty≥
, 
to_º_ty≥
;

60 
e_rouã_ty≥
 
rouã_ty≥
;

61 
boﬁón
 
is_‰öge_w¨nög_£¡
;

63 
rouã_ty≥
 = 
DETAILED
;

64 if(
gøph_ty≥
 =
GRAPH_GLOBAL
)

66 
rouã_ty≥
 = 
GLOBAL
;

69 
tŸÆ_edges_to_node
 = (*)
	`my_ˇŒoc
(
num_º_nodes
, ());

70 
num_edges_‰om_cuºít_to_node
 = (*)
	`my_ˇŒoc
(
num_º_nodes
,

72 
swôch_ty≥s_‰om_cuºít_to_node
 = (*)
	`my_ˇŒoc
(
num_º_nodes
,

75 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

77 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

78 
num_edges
 = 
º_node
[
öode
].num_edges;

80 
	`check_node
(
öode
, 
rouã_ty≥
);

84 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

86 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

88 if(
to_node
 < 0 ||Åo_nodê>
num_º_nodes
)

90 
¥ötf


92 "Edgêi†ouào‡ønge.\n", 
öode
, 
to_node
);

93 
	`exô
(1);

96 
num_edges_‰om_cuºít_to_node
[
to_node
]++;

97 
tŸÆ_edges_to_node
[
to_node
]++;

99 
swôch_ty≥
 = 
º_node
[
öode
].
swôches
[
õdge
];

101 if(
swôch_ty≥
 < 0 || swôch_ty≥ >
num_swôches
)

103 
¥ötf


105 "SwôchÅy≥ i†ouào‡ønge.\n", 
öode
,

106 
swôch_ty≥
);

107 
	`exô
(1);

110 if(
swôch_öf
[
swôch_ty≥
].
buf„ªd
)

111 
swôch_ty≥s_‰om_cuºít_to_node
[
to_node
] |=

112 
BUF_FLAG
;

114 
swôch_ty≥s_‰om_cuºít_to_node
[
to_node
] |=

115 
PTRANS_FLAG
;

120 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

122 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

124 if(
num_edges_‰om_cuºít_to_node
[
to_node
] > 1)

126 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

128 if((
to_º_ty≥
 !
CHANX
 &&Åo_º_ty≥ !
CHANY
) ||

129 (
º_ty≥
 !
CHANX
 &&Ñr_ty≥ !
CHANY
))

131 
¥ötf


133 "%dÅimes.\n", 
öode
, 
to_node
,

134 
num_edges_‰om_cuºít_to_node


135 [
to_node
]);

136 
	`exô
(1);

142 if(
num_edges_‰om_cuºít_to_node
[
to_node
] !=

145 
swôch_ty≥s_‰om_cuºít_to_node
[
to_node
]

146 !
BUF_AND_PTRANS_FLAG
)

148 
¥ötf


150 "%dÅimes.\n", 
öode
, 
to_node
,

151 
num_edges_‰om_cuºít_to_node


152 [
to_node
]);

153 
	`exô
(1);

157 
num_edges_‰om_cuºít_to_node
[
to_node
] = 0;

158 
swôch_ty≥s_‰om_cuºít_to_node
[
to_node
] = 0;

163 #ifde‡
DEBUG


164 
	`check_∑ss_å™si°‹s
(
öode
);

172 
is_‰öge_w¨nög_£¡
 = 
FALSE
;

174 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

176 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

178 if(
º_ty≥
 !
SOURCE
)

180 if(
tŸÆ_edges_to_node
[
öode
] < 1 &&

181 !
	`º_node_is_globÆ_˛b_ùö
(
öode
))

183 
boﬁón
 
is_‰öge
;

184 
boﬁón
 
is_wúe
;

189 
is_‰öge
 = ((
º_node
[
öode
].
xlow
 =1Ë|| (º_node[öode].
ylow
 == 1)

190 || (
º_node
[
öode
].
xhigh
 =
nx
Ë|| (º_node[öode].
yhigh
 =
ny
));

191 
is_wúe
 = (
º_node
[
öode
].
ty≥
 =
CHANX
 ||Ñr_node[öode].ty≥ =
CHANY
);

193 i‡(!
is_‰öge
 && !
is_wúe
)

195 
	`¥ötf
 ("Eº‹ i¿check_º_gøph:Çodê%d ha†nÿÁnö.\n", 
öode
);

196 
	`exô
(1);

198 i‡(!
is_‰öge_w¨nög_£¡
)

200 
	`¥ötf
 ("WARNING: in check_rr_graph: fringeÇode %d hasÇo fanin.\n"

202 , 
öode
);

203 
is_‰öge_w¨nög_£¡
 = 
TRUE
;

210 if(
tŸÆ_edges_to_node
[
öode
] != 0)

212 
¥ötf


214 "\to‡%d,Éx≥˘ed 0.\n", 
öode
,

215 
tŸÆ_edges_to_node
[
öode
]);

216 
	`exô
(1);

221 
	`‰ì
(
num_edges_‰om_cuºít_to_node
);

222 
	`‰ì
(
tŸÆ_edges_to_node
);

223 
	`‰ì
(
swôch_ty≥s_‰om_cuºít_to_node
);

224 
	}
}

227 
boﬁón


228 
	$º_node_is_globÆ_˛b_ùö
(
öode
)

233 
ùö
;

234 
t_ty≥_±r
 
ty≥
;

236 
ty≥
 = 
grid
[
º_node
[
öode
].
xlow
][º_node[öode].
ylow
].type;

238 if(
º_node
[
öode
].
ty≥
 !
IPIN
)

239  (
FALSE
);

241 
ùö
 = 
º_node
[
öode
].
±c_num
;

243  (
ty≥
->
is_globÆ_pö
[
ùö
]);

244 
	}
}

248 
	$check_node
(
öode
,

249 
e_rouã_ty≥
 
rouã_ty≥
)

255 
xlow
, 
ylow
, 
xhigh
, 
yhigh
, 
±c_num
, 
ˇ∑côy
;

256 
t_º_ty≥
 
º_ty≥
;

257 
t_ty≥_±r
 
ty≥
;

258 
nodes_≥r_ch™
, 
åacks_≥r_node
, 
num_edges
, 
co°_ödex
;

259 
C
, 
R
;

261 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

262 
xlow
 = 
º_node
[
öode
].xlow;

263 
xhigh
 = 
º_node
[
öode
].xhigh;

264 
ylow
 = 
º_node
[
öode
].ylow;

265 
yhigh
 = 
º_node
[
öode
].yhigh;

266 
±c_num
 = 
º_node
[
öode
].ptc_num;

267 
ˇ∑côy
 = 
º_node
[
öode
].capacity;

268 
ty≥
 = 
NULL
;

270 if(
xlow
 > 
xhigh
 || 
ylow
 > 
yhigh
)

272 
¥ötf


274 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

275 
	`exô
(1);

278 if(
xlow
 < 0 || 
xhigh
 > 
nx
 + 1 || 
ylow
 < 0 || 
yhigh
 > 
ny
 + 1)

280 
¥ötf


282 "¨êouào‡ønge.\n", 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

283 
	`exô
(1);

286 if(
±c_num
 < 0)

288 
	`¥ötf
("Error in check_node. Inode %d (type %d) hadáÖtc_num\n"

289 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

290 
	`exô
(1);

295 
º_ty≥
)

298 
SOURCE
:

299 
SINK
:

300 
IPIN
:

301 
OPIN
:

303 
ty≥
 = 
grid
[
xlow
][
ylow
].type;

305 if(
ty≥
 =
NULL
)

307 
¥ötf


309 " clbÜoˇti⁄ (%d, %d).\n", 
öode
, 
º_ty≥
, 
xlow
,

310 
ylow
);

311 
	`exô
(1);

313 if(
xlow
 !
xhigh
 || 
ylow
 !(
yhigh
 - 
ty≥
->
height
 + 1))

315 
¥ötf


317 "(%d,%dË™d (%d,%d)\n", 
öode
, 
º_ty≥
, 
xlow
, 
ylow
,

318 
xhigh
, 
yhigh
);

319 
	`exô
(1);

323 
CHANX
:

324 if(
xlow
 < 1 || 
xhigh
 > 
nx
 || 
yhigh
 > 
ny
 || yhigh !
ylow
)

326 
	`¥ötf
("Error in check_node: CHANX out ofÑange.\n");

327 
	`¥ötf
("Endpoöts: (%d,%dË™d (%d,%d)\n", 
xlow
, 
ylow
,

328 
xhigh
, 
yhigh
);

329 
	`exô
(1);

331 if(
rouã_ty≥
 =
GLOBAL
 && 
xlow
 !
xhigh
)

333 
¥ötf


336 
öode
);

337 
	`exô
(1);

341 
CHANY
:

342 if(
xhigh
 > 
nx
 || 
ylow
 < 1 || 
yhigh
 > 
ny
 || 
xlow
 != xhigh)

344 
	`¥ötf
("Error in check_node: CHANY out ofÑange.\n");

345 
	`¥ötf
("Endpoöts: (%d,%dË™d (%d,%d)\n", 
xlow
, 
ylow
,

346 
xhigh
, 
yhigh
);

347 
	`exô
(1);

349 if(
rouã_ty≥
 =
GLOBAL
 && 
ylow
 !
yhigh
)

351 
¥ötf


354 
öode
);

355 
	`exô
(1);

360 
	`¥ötf
("Error in check_node: Unexpected segmentÅype: %d\n",

361 
º_ty≥
);

362 
	`exô
(1);

367 
º_ty≥
)

370 
SOURCE
:

372 if(
±c_num
 >
ty≥
->
num_˛ass


373 || 
ty≥
->
˛ass_öf
[
±c_num
].ty≥ !
DRIVER
)

375 
¥ötf


377 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

378 
	`exô
(1);

380 if(
ty≥
->
˛ass_öf
[
±c_num
].
num_pös
 !
ˇ∑côy
)

382 
¥ötf


384 "o‡%d.\n", 
öode
, 
º_ty≥
, 
ˇ∑côy
);

385 
	`exô
(1);

390 
SINK
:

392 if(
±c_num
 >
ty≥
->
num_˛ass


393 || 
ty≥
->
˛ass_öf
[
±c_num
].ty≥ !
RECEIVER
)

395 
¥ötf


397 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

398 
	`exô
(1);

400 if(
ty≥
->
˛ass_öf
[
±c_num
].
num_pös
 !
ˇ∑côy
)

402 
¥ötf


404 "o‡%d.\n", 
öode
, 
º_ty≥
, 
ˇ∑côy
);

405 
	`exô
(1);

409 
OPIN
:

411 if(
±c_num
 >
ty≥
->
num_pös


412 || 
ty≥
->
˛ass_öf
[ty≥->
pö_˛ass
[
±c_num
]].ty≥ !
DRIVER
)

414 
¥ötf


416 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

417 
	`exô
(1);

420 if(
ˇ∑côy
 != 1)

422 
¥ötf


424 "o‡%d.\n", 
öode
, 
º_ty≥
, 
ˇ∑côy
);

425 
	`exô
(1);

429 
IPIN
:

430 if(
±c_num
 >
ty≥
->
num_pös


431 || 
ty≥
->
˛ass_öf
[ty≥->
pö_˛ass
[
±c_num
]].ty≥ !
RECEIVER
)

433 
¥ötf


435 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

436 
	`exô
(1);

438 if(
ˇ∑côy
 != 1)

440 
¥ötf


442 "o‡%d.\n", 
öode
, 
º_ty≥
, 
ˇ∑côy
);

443 
	`exô
(1);

447 
CHANX
:

448 if(
rouã_ty≥
 =
DETAILED
)

450 
nodes_≥r_ch™
 = 
ch™_width_x
[
ylow
];

451 
åacks_≥r_node
 = 1;

455 
nodes_≥r_ch™
 = 1;

456 
åacks_≥r_node
 = 
ch™_width_x
[
ylow
];

459 if(
±c_num
 >
nodes_≥r_ch™
)

461 
¥ötf


463 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

464 
	`exô
(1);

467 if(
ˇ∑côy
 !
åacks_≥r_node
)

469 
¥ötf


471 "o‡%d.\n", 
öode
, 
º_ty≥
, 
ˇ∑côy
);

472 
	`exô
(1);

476 
CHANY
:

477 if(
rouã_ty≥
 =
DETAILED
)

479 
nodes_≥r_ch™
 = 
ch™_width_y
[
xlow
];

480 
åacks_≥r_node
 = 1;

484 
nodes_≥r_ch™
 = 1;

485 
åacks_≥r_node
 = 
ch™_width_y
[
xlow
];

488 if(
±c_num
 >
nodes_≥r_ch™
)

490 
¥ötf


492 "o‡%d.\n", 
öode
, 
º_ty≥
, 
±c_num
);

493 
	`exô
(1);

496 if(
ˇ∑côy
 !
åacks_≥r_node
)

498 
¥ötf


500 "o‡%d.\n", 
öode
, 
º_ty≥
, 
ˇ∑côy
);

501 
	`exô
(1);

506 
	`¥ötf
("Error in check_node: Unexpected segmentÅype: %d\n",

507 
º_ty≥
);

508 
	`exô
(1);

513 
num_edges
 = 
º_node
[
öode
].num_edges;

515 if(
º_ty≥
 !
SINK
)

517 if(
num_edges
 <= 0)

519 
	`¥ötf
("Error: in check_node:Çode %d hasÇoÉdges.\n",

520 
öode
);

521 
	`exô
(1);

527 if(
num_edges
 != 0)

529 
	`¥ötf
("Error in check_node:Çode %d isá sink, but has "

530 "%dÉdges.\n", 
öode
, 
num_edges
);

531 
	`exô
(1);

537 
C
 = 
º_node
[
öode
].C;

538 
R
 = 
º_node
[
öode
].R;

540 if(
º_ty≥
 =
CHANX
 ||Ñr_ty≥ =
CHANY
)

542 if(
C
 < 0. || 
R
 < 0.)

544 
¥ötf


546 "™d C = %g.\n", 
öode
, 
º_ty≥
, 
R
, 
C
);

547 
	`exô
(1);

553 if(
C
 !0. || 
R
 != 0.)

555 
¥ötf


557 "™d C = %g.\n", 
öode
, 
º_ty≥
, 
R
, 
C
);

558 
	`exô
(1);

562 
co°_ödex
 = 
º_node
[
öode
].cost_index;

563 if(
co°_ödex
 < 0 || co°_ödex >
num_º_ödexed_d©a
)

565 
	`¥ötf
("Error in check_node:Çode %d cost index (%d) is out of "

566 "ønge.\n", 
öode
, 
co°_ödex
);

567 
	`exô
(1);

569 
	}
}

573 
	$check_∑ss_å™si°‹s
(
‰om_node
)

579 
‰om_edge
, 
to_node
, 
to_edge
, 
‰om_num_edges
, 
to_num_edges
;

580 
t_º_ty≥
 
‰om_º_ty≥
, 
to_º_ty≥
;

581 
‰om_swôch_ty≥
;

582 
boﬁón
 
å™s_m©ched
;

585 
‰om_º_ty≥
 = 
º_node
[
‰om_node
].
ty≥
;

586 if(
‰om_º_ty≥
 !
CHANX
 && from_º_ty≥ !
CHANY
)

589 
‰om_num_edges
 = 
º_node
[
‰om_node
].
num_edges
;

591 
‰om_edge
 = 0; from_edgê< 
‰om_num_edges
; from_edge++)

593 
to_node
 = 
º_node
[
‰om_node
].
edges
[
‰om_edge
];

594 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

596 if(
to_º_ty≥
 !
CHANX
 &&Åo_º_ty≥ !
CHANY
)

599 
‰om_swôch_ty≥
 = 
º_node
[
‰om_node
].
swôches
[
‰om_edge
];

601 if(
swôch_öf
[
‰om_swôch_ty≥
].
buf„ªd
)

608 
to_num_edges
 = 
º_node
[
to_node
].
num_edges
;

609 
å™s_m©ched
 = 
FALSE
;

611 
to_edge
 = 0;Åo_edgê< 
to_num_edges
;Åo_edge++)

613 if(
º_node
[
to_node
].
edges
[
to_edge
] =
‰om_node
 &&

614 
º_node
[
to_node
].
swôches
[
to_edge
] =
‰om_swôch_ty≥
)

616 
å™s_m©ched
 = 
TRUE
;

621 if(
å™s_m©ched
 =
FALSE
)

623 
¥ötf


627 
‰om_node
, 
to_node
, 
‰om_swôch_ty≥
);

628 
	`exô
(1);

632 
	}
}

	@check_rr_graph.h

1 
check_º_gøph
(
IN
 
t_gøph_ty≥
 
gøph_ty≥
,

2 
IN
 
num_ty≥s
,

3 
IN
 
t_ty≥_±r
 
ty≥s
,

4 
IN
 
nx
,

5 
IN
 
ny
,

6 
IN
 
s_grid_tûe
 **
grid
,

7 
IN
 
nodes_≥r_ch™
,

8 
IN
 
Fs
,

9 
IN
 
num_£g_ty≥s
,

10 
IN
 
num_swôches
,

11 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

12 
IN
 
globÆ_rouã_swôch
,

13 
IN
 
dñayÀss_swôch
,

14 
IN
 
wúe_to_ùö_swôch
,

15 
t_£g_dëaûs
 * 
£g_dëaûs
,

16 *
Fc_ö
,

17 *
Fc_out
,

18 
t_ivec
 *** 
º_node_ödi˚s
,

19 *****
›ö_to_åack_m≠
,

20 *****
ùö_to_åack_m≠
,

21 
t_ivec
 **** 
åack_to_ùö_lookup
,

22 
t_ivec
 *** 
swôch_block_c⁄n
,

23 
boﬁón
 * 
≥πurb_ùös
);

25 
check_node
(
öode
,

26 
e_rouã_ty≥
 
rouã_ty≥
);

	@draw.c

1 
	~<°dio.h
>

2 
	~<°rög.h
>

3 
	~<m©h.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"v¥_utûs.h
"

7 
	~"globÆs.h
"

8 
	~"gøphics.h
"

9 
	~"∑th_dñay.h
"

10 
	~"døw.h
"

11 
	~<as£π.h
>

14 
	#MAX_BLOCK_COLOURS
 5

	)

16 
	ee_døw_º_toggÀ


18 
	mDRAW_NO_RR
 = 0,

19 
	mDRAW_ALL_RR
,

20 
	mDRAW_ALL_BUT_BUFFERS_RR
,

21 
	mDRAW_NODES_AND_SBOX_RR
,

22 
	mDRAW_NODES_RR
,

23 
	mDRAW_RR_TOGGLE_MAX


26 
	ee_døw_√t_ty≥


27 { 
	mALL_NETS
, 
	mHIGHLIGHTED
 };

29 
	ee_edge_dú


30 { 
	mFROM_X_TO_Y
, 
	mFROM_Y_TO_X
 };

35 
boﬁón
 
	gshow_√ts
 = 
FALSE
;

41 
e_døw_º_toggÀ
 
	gdøw_º_toggÀ
 = 
DRAW_NO_RR
;

43 
e_rouã_ty≥
 
	gdøw_rouã_ty≥
;

47 
boﬁón
 
	gshow_c⁄ge°i⁄
 = 
FALSE
;

49 
boﬁón
 
	gshow_gøphics
;

51 
	gdeÁu…_mesßge
[
BUFSIZE
];

53 
	ggr_automode
;

56 
pic_ty≥
 
	gpic_⁄_s¸ìn
 = 
NO_PICTURE
;

58 *
	gtûe_x
, *
	gtûe_y
;

67 
	gtûe_width
, 
	gpö_size
;

72 
cﬁ‹_ty≥s
 *
	g√t_cﬁ‹
, *
	gblock_cﬁ‹
;

80 
toggÀ_√ts
((*
døws¸ìn
) ());

81 
	`toggÀ_º
((*
døws¸ìn
) ());

82 
	`toggÀ_c⁄ge°i⁄
((*
døws¸ìn
) ());

83 
	`highlight_¸ô_∑th
((*
døws¸ìn_±r
) ());

85 
	`døws¸ìn
();

86 
	`ªdøw_s¸ìn
();

87 
	`døw∂a˚
();

88 
	`døw√ts
();

89 
	`døwrouã
(
e_døw_√t_ty≥
 
døw_√t_ty≥
);

90 
	`døw_c⁄ge°i⁄
();

92 
	`highlight_blocks
(
x
,

93 
y
);

94 
	`gë_block_˚¡î
(
bnum
,

95 *
x
,

96 *
y
);

97 
	`de£À˘_Æl
();

99 
	`døw_º
();

100 
	`døw_º_edges
(
‰om_node
);

101 
	`døw_º_pö
(
öode
,

102 
cﬁ‹_ty≥s
 
cﬁ‹
);

103 
	`døw_º_ch™x
(
öode
,

104 
ôøck
);

105 
	`døw_º_ch™y
(
öode
,

106 
ôøck
);

107 
	`gë_º_pö_døw_co‹ds
(
öode
,

108 
iside
,

109 
ioff
,

110 *
x˚n
,

111 *
y˚n
);

112 
	`døw_pö_to_ch™_edge
(
pö_node
,

113 
ch™_node
);

114 
	`døw_x
(
x
,

115 
y
,

116 
size
);

117 
	`døw_ch™y_to_ch™y_edge
(
‰om_node
,

118 
‰om_åack
,

119 
to_node
,

120 
to_åack
,

121 
swôch_ty≥
);

122 
	`døw_ch™x_to_ch™x_edge
(
‰om_node
,

123 
‰om_åack
,

124 
to_node
,

125 
to_åack
,

126 
swôch_ty≥
);

127 
	`døw_ch™x_to_ch™y_edge
(
ch™x_node
,

128 
ch™x_åack
,

129 
ch™y_node
,

130 
ch™y_åack
,

131 
e_edge_dú
 
edge_dú
,

132 
swôch_ty≥
);

133 
	`gë_åack_num
(
öode
,

134 **
ch™x_åack
,

135 **
ch™y_åack
);

136 
	`døw_º_swôch
(
‰om_x
,

137 
‰om_y
,

138 
to_x
,

139 
to_y
,

140 
boﬁón
 
buf„ªd
);

141 
	`døw_åüngÀ_Æ⁄g_löe
(
xíd
,

142 
yíd
,

144 
x1
,

145 
x2
,

147 
y1
,

148 
y2
);

155 
	$£t_gøphics_°©e
(
boﬁón
 
show_gøphics_vÆ
,

156 
gr_automode_vÆ
,

157 
e_rouã_ty≥
 
rouã_ty≥
)

164 
show_gøphics
 = 
show_gøphics_vÆ
;

165 
gr_automode
 = 
gr_automode_vÆ
;

166 
døw_rouã_ty≥
 = 
rouã_ty≥
;

167 
	}
}

171 
	$upd©e_s¸ìn
(
¥i‹ôy
,

172 *
msg
,

173 
pic_ty≥
 
pic_⁄_s¸ìn_vÆ
,

174 
boﬁón
 
¸ô_∑th_buâ⁄_íabÀd
)

181 if(!
show_gøphics
)

188 if(
pic_⁄_s¸ìn
 !
pic_⁄_s¸ìn_vÆ
)

190 if(
pic_⁄_s¸ìn_vÆ
 =
PLACEMENT
 && 
pic_⁄_s¸ìn
 =
NO_PICTURE
)

192 
	`¸óã_buâ⁄
("Wödow", "ToggÀ Nës", 
toggÀ_√ts
);

194 if(
pic_⁄_s¸ìn_vÆ
 =
ROUTING


195 && 
pic_⁄_s¸ìn
 =
PLACEMENT
)

197 
	`¸óã_buâ⁄
("ToggÀ Nës", "ToggÀ RR", 
toggÀ_º
);

198 
	`¸óã_buâ⁄
("Toggle RR", "Congestion",

199 
toggÀ_c⁄ge°i⁄
);

201 if(
¸ô_∑th_buâ⁄_íabÀd
)

203 
	`¸óã_buâ⁄
("Congestion", "Crit. Path",

204 
highlight_¸ô_∑th
);

207 if(
pic_⁄_s¸ìn_vÆ
 =
PLACEMENT


208 && 
pic_⁄_s¸ìn
 =
ROUTING
)

210 
	`de°roy_buâ⁄
("Toggle RR");

211 
	`de°roy_buâ⁄
("Congestion");

213 if(
¸ô_∑th_buâ⁄_íabÀd
)

215 
	`de°roy_buâ⁄
("Crit. Path");

218 if(
pic_⁄_s¸ìn_vÆ
 =
ROUTING


219 && 
pic_⁄_s¸ìn
 =
NO_PICTURE
)

221 
	`¸óã_buâ⁄
("Wödow", "ToggÀ Nës", 
toggÀ_√ts
);

222 
	`¸óã_buâ⁄
("ToggÀ Nës", "ToggÀ RR", 
toggÀ_º
);

223 
	`¸óã_buâ⁄
("Toggle RR", "Congestion",

224 
toggÀ_c⁄ge°i⁄
);

226 if(
¸ô_∑th_buâ⁄_íabÀd
)

228 
	`¸óã_buâ⁄
("Congestion", "Crit. Path",

229 
highlight_¸ô_∑th
);

235 
	`my_°∫˝y
(
deÁu…_mesßge
, 
msg
, 
BUFSIZE
);

237 
pic_⁄_s¸ìn
 = 
pic_⁄_s¸ìn_vÆ
;

238 
	`upd©e_mesßge
(
msg
);

239 
	`døws¸ìn
();

240 if(
¥i‹ôy
 >
gr_automode
)

242 
	`evít_lo›
(
highlight_blocks
, 
døws¸ìn
);

246 
	`Êushöput
();

248 
	}
}

252 
	$døws¸ìn
()

259 
	`˛órs¸ìn
();

260 
	`ªdøw_s¸ìn
();

261 
	}
}

265 
	$ªdøw_s¸ìn
()

273 
	`£tf⁄tsize
(20);

274 if(
pic_⁄_s¸ìn
 =
PLACEMENT
)

276 
	`døw∂a˚
();

277 if(
show_√ts
)

279 
	`døw√ts
();

284 
	`døw∂a˚
();

286 if(
show_√ts
)

288 
	`døwrouã
(
ALL_NETS
);

292 
	`døw_º
();

295 if(
show_c⁄ge°i⁄
)

297 
	`døw_c⁄ge°i⁄
();

300 
	}
}

304 
toggÀ_√ts
((*
døws¸ìn_±r
) ())

311 
show_√ts
 = !show_nets;

312 
døw_º_toggÀ
 = 
DRAW_NO_RR
;

313 
show_c⁄ge°i⁄
 = 
FALSE
;

315 
	`upd©e_mesßge
(
deÁu…_mesßge
);

316 
	`døws¸ìn_±r
();

317 
	}
}

321 
toggÀ_º
((*
døws¸ìn_±r
) ())

331 
døw_º_toggÀ
 = (døw_º_toggÀ + 1Ë% (
DRAW_RR_TOGGLE_MAX
);

332 
show_√ts
 = 
FALSE
;

333 
show_c⁄ge°i⁄
 = 
FALSE
;

335 
	`upd©e_mesßge
(
deÁu…_mesßge
);

336 
	`døws¸ìn_±r
();

337 
	}
}

341 
toggÀ_c⁄ge°i⁄
((*
døws¸ìn_±r
) ())

345 
msg
[
BUFSIZE
];

346 
öode
, 
num_c⁄ge°ed
;

348 
show_√ts
 = 
FALSE
;

349 
døw_º_toggÀ
 = 
DRAW_NO_RR
;

350 
show_c⁄ge°i⁄
 = !show_congestion;

352 if(!
show_c⁄ge°i⁄
)

354 
	`upd©e_mesßge
(
deÁu…_mesßge
);

358 
num_c⁄ge°ed
 = 0;

359 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

361 if(
º_node
[
öode
].
occ
 >Ñr_node[öode].
ˇ∑côy
)

363 
num_c⁄ge°ed
++;

367 
	`•rötf
(
msg
, "%dÑoutögÑesour˚†¨êovîu£d.", 
num_c⁄ge°ed
);

368 
	`upd©e_mesßge
(
msg
);

371 
	`døws¸ìn_±r
();

372 
	}
}

376 
highlight_¸ô_∑th
((*
døws¸ìn_±r
) ())

381 
t_löked_öt
 *
¸ôiˇl_∑th_hód
, *
¸ôiˇl_∑th_node
;

382 
öode
, 
iblk
, 
öë
, 
num_√ts_£í
;

383 
√ts_to_highlight
 = 1;

384 
msg
[
BUFSIZE
];

386 if(
√ts_to_highlight
 == 0)

388 
√ts_to_highlight
 = 1;

389 
	`de£À˘_Æl
();

390 
	`upd©e_mesßge
(
deÁu…_mesßge
);

391 
	`døws¸ìn_±r
();

395 
¸ôiˇl_∑th_hód
 = 
	`Æloˇã_™d_lﬂd_¸ôiˇl_∑th
();

396 
¸ôiˇl_∑th_node
 = 
¸ôiˇl_∑th_hód
;

397 
num_√ts_£í
 = 0;

399 
¸ôiˇl_∑th_node
 !
NULL
)

401 
öode
 = 
¸ôiˇl_∑th_node
->
d©a
;

402 
	`gë_äode_block_™d_ouçut_√t
(
öode
, &
iblk
, &
öë
);

404 if(
num_√ts_£í
 =
√ts_to_highlight
)

406 
block_cﬁ‹
[
iblk
] = 
MAGENTA
;

408 if(
num_√ts_£í
 =
√ts_to_highlight
 - 1)

410 
block_cﬁ‹
[
iblk
] = 
YELLOW
;

412 if(
num_√ts_£í
 < 
√ts_to_highlight
)

414 
block_cﬁ‹
[
iblk
] = 
DARKGREEN
;

417 if(
öë
 !
OPEN
)

419 
num_√ts_£í
++;

421 if(
num_√ts_£í
 < 
√ts_to_highlight
)

423 
√t_cﬁ‹
[
öë
] = 
DARKGREEN
;

425 if(
num_√ts_£í
 =
√ts_to_highlight
)

427 
√t_cﬁ‹
[
öë
] = 
CYAN
;

431 
¸ôiˇl_∑th_node
 = crôiˇl_∑th_node->
√xt
;

434 if(
√ts_to_highlight
 =
num_√ts_£í
)

436 
√ts_to_highlight
 = 0;

437 
	`•rötf
(
msg
, "All %dÇets onÅhe criticalÖath highlighted.",

438 
num_√ts_£í
);

442 
	`•rötf
(
msg
, "First %dÇets onÅhe criticalÖath highlighted.",

443 
√ts_to_highlight
);

444 
√ts_to_highlight
++;

447 
	`‰ì_öt_li°
(&
¸ôiˇl_∑th_hód
);

449 
	`upd©e_mesßge
(
msg
);

450 
	`døws¸ìn_±r
();

451 
	}
}

455 
	$Æloc_døw_°ru˘s
()

461 
tûe_x
 = (*)
	`my_mÆloc
((
nx
 + 2) * ());

462 
tûe_y
 = (*)
	`my_mÆloc
((
ny
 + 2) * ());

464 
√t_cﬁ‹
 = (
cﬁ‹_ty≥s
 *)

465 
	`my_mÆloc
(
num_√ts
 * (
cﬁ‹_ty≥s
));

467 
block_cﬁ‹
 = (
cﬁ‹_ty≥s
 *)

468 
	`my_mÆloc
(
num_blocks
 * (
cﬁ‹_ty≥s
));

470 
	`de£À˘_Æl
();

471 
	}
}

475 
	$öô_døw_co‹ds
(
width_vÆ
)

482 
i
;

483 
j
;

485 if(!
show_gøphics
)

488 
tûe_width
 = 
width_vÆ
;

489 
pö_size
 = 0.3;

490 
i
 = 0; i < 
num_ty≥s
; ++i)

492 
pö_size
 =

493 
	`mö
(
pö_size
,

494 (
tûe_width
 / (4.0 * 
ty≥_des¸ùt‹s
[
i
].
num_pös
)));

497 
j
 = 0;

498 
i
 = 0; i < (
nx
 + 1); i++)

500 
tûe_x
[
i
] = (ò* 
tûe_width
Ë+ 
j
;

501 
j
 +
ch™_width_y
[
i
] + 1;

503 
tûe_x
[
nx
 + 1] = (“x + 1Ë* 
tûe_width
Ë+ 
j
;

505 
j
 = 0;

506 
i
 = 0; i < (
ny
 + 1); ++i)

508 
tûe_y
[
i
] = (ò* 
tûe_width
Ë+ 
j
;

509 
j
 +
ch™_width_x
[
i
] + 1;

511 
tûe_y
[
ny
 + 1] = (“y + 1Ë* 
tûe_width
Ë+ 
j
;

513 
	`öô_w‹ld
(0.0,

514 
tûe_y
[
ny
 + 1] + 
tûe_width
, 
tûe_x
[
nx
 + 1] +Åile_width, 0.0);

515 
	}
}

519 
	$døw∂a˚
()

525 
sub_tûe_°ï
;

526 
x1
, 
y1
, 
x2
, 
y2
;

527 
i
, 
j
, 
k
, 
bnum
;

528 
num_sub_tûes
;

529 
height
;

531 
	`£éöewidth
(0);

533 
i
 = 0; i <(
nx
 + 1); i++)

535 
j
 = 0; j <(
ny
 + 1); j++)

538 if(
grid
[
i
][
j
].
off£t
 > 0)

542 if(((
i
 < 1Ë|| (ò> 
nx
)Ë&& ((
j
 < 1Ë|| (j > 
ny
)))

545 
num_sub_tûes
 = 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
;

546 
sub_tûe_°ï
 = 
tûe_width
 / 
num_sub_tûes
;

547 
height
 = 
grid
[
i
][
j
].
ty≥
->height;

549 if(
num_sub_tûes
 < 1)

551 
	`£tcﬁ‹
(
BLACK
);

552 
	`£éöe°yÀ
(
DASHED
);

553 
	`døwª˘
(
tûe_x
[
i
], 
tûe_y
[
j
],

554 
tûe_x
[
i
] + 
tûe_width
,

555 
tûe_y
[
j
] + 
tûe_width
);

556 
	`døw_x
(
tûe_x
[
i
] + (
tûe_width
 / 2),

557 
tûe_y
[
j
] + (
tûe_width
 / 2),

558 (
tûe_width
 / 2));

561 
k
 = 0; k < 
num_sub_tûes
; ++k)

564 
	`as£π
(
height
 =1 || 
num_sub_tûes
 == 1);

566 if((
i
 < 1Ë|| (ò> 
nx
))

568 
x1
 = 
tûe_x
[
i
];

569 
y1
 = 
tûe_y
[
j
] + (
k
 * 
sub_tûe_°ï
);

570 
x2
 = 
x1
 + 
tûe_width
;

571 
y2
 = 
y1
 + 
sub_tûe_°ï
;

573 if((
j
 < 1Ë|| (j > 
ny
))

575 
x1
 = 
tûe_x
[
i
] + (
k
 * 
sub_tûe_°ï
);

576 
y1
 = 
tûe_y
[
j
];

577 
x2
 = 
x1
 + 
sub_tûe_°ï
;

578 
y2
 = 
y1
 + 
tûe_width
;

582 
	`as£π
(
num_sub_tûes
 <= 1);

584 
x1
 = 
tûe_x
[
i
];

585 
y1
 = 
tûe_y
[
j
];

586 
x2
 = 
x1
 + 
tûe_width
;

587 
y2
 = 
tûe_y
[
j
 + 
height
 - 1] + 
tûe_width
;

591 
bnum
 = 
grid
[
i
][
j
].
blocks
[
k
];

595 if(
bnum
 !
EMPTY
)

597 
	`£tcﬁ‹
(
block_cﬁ‹
[
bnum
]);

598 
	`fûÃe˘
(
x1
, 
y1
, 
x2
, 
y2
);

601 if(
grid
[
i
][
j
].
ty≥
->
ödex
 < 3) {

602 
	`£tcﬁ‹
(
WHITE
);

603 } if(
grid
[
i
][
j
].
ty≥
->
ödex
 < 3 + 
MAX_BLOCK_COLOURS
) {

604 
	`£tcﬁ‹
(
BISQUE
 + 
grid
[
i
][
j
].
ty≥
->
ödex
 - 3);

606 
	`£tcﬁ‹
(
BISQUE
 + 
MAX_BLOCK_COLOURS
 - 1);

608 
	`fûÃe˘
(
x1
, 
y1
, 
x2
, 
y2
);

611 
	`£tcﬁ‹
(
BLACK
);

613 
	`£éöe°yÀ
((
EMPTY
 =
bnum
Ë? 
DASHED
 : 
SOLID
);

614 
	`døwª˘
(
x1
, 
y1
, 
x2
, 
y2
);

617 if(
bnum
 !
EMPTY
)

619 
	`døwãxt
((
x1
 + 
x2
Ë/ 2.0, (
y1
 + 
y2
) / 2.0,

620 
block
[
bnum
].
«me
, 
tûe_width
);

624 if(
grid
[
i
][
j
].
off£t
 == 0) {

625 if(
i
 > 0 && i <
nx
 && 
j
 > 0 && j <
ny
) {

626 
	`døwãxt
((
x1
 + 
x2
Ë/ 2.0, 
y1
 + (
tûe_width
 / 4.0),

627 
grid
[
i
][
j
].
ty≥
->
«me
, 
tûe_width
);

633 
	}
}

637 
	$døw√ts
()

644 
öë
, 
ùö
, 
b1
, 
b2
;

645 
x1
, 
y1
, 
x2
, 
y2
;

647 
	`£éöe°yÀ
(
SOLID
);

648 
	`£éöewidth
(0);

653 
öë
 = 0; i√à< 
num_√ts
; inet++)

655 if(
√t
[
öë
].
is_globÆ
)

658 
	`£tcﬁ‹
(
√t_cﬁ‹
[
öë
]);

659 
b1
 = 
√t
[
öë
].
node_block
[0];

660 
	`gë_block_˚¡î
(
b1
, &
x1
, &
y1
);

662 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

664 
b2
 = 
√t
[
öë
].
node_block
[
ùö
];

665 
	`gë_block_˚¡î
(
b2
, &
x2
, &
y2
);

666 
	`døwlöe
(
x1
, 
y1
, 
x2
, 
y2
);

673 
	}
}

677 
	$gë_block_˚¡î
(
bnum
,

678 *
x
,

679 *
y
)

685 
i
, 
j
, 
k
;

686 
sub_tûe_°ï
;

688 
i
 = 
block
[
bnum
].
x
;

689 
j
 = 
block
[
bnum
].
y
;

690 
k
 = 
block
[
bnum
].
z
;

692 
sub_tûe_°ï
 = 
tûe_width
 / 
block
[
bnum
].
ty≥
->
ˇ∑côy
;

694 if((
i
 < 1Ë|| (ò> 
nx
))

696 *
x
 = 
tûe_x
[
i
] + (
sub_tûe_°ï
 * (
k
 + 0.5));

700 *
x
 = 
tûe_x
[
i
] + (
tûe_width
 / 2.0);

703 if((
j
 < 1Ë|| (j > 
ny
))

705 *
y
 = 
tûe_y
[
j
] + (
sub_tûe_°ï
 * (
k
 + 0.5));

709 *
y
 = 
tûe_y
[
j
] + (
tûe_width
 / 2.0);

711 
	}
}

715 
	$døw_c⁄ge°i⁄
()

720 
öode
, 
ôøck
;

722 
	`£tcﬁ‹
(
RED
);

723 
	`£éöewidth
(2);

725 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

727 if(
º_node
[
öode
].
occ
 >Ñr_node[öode].
ˇ∑côy
)

729 
º_node
[
öode
].
ty≥
)

731 
CHANX
:

732 
ôøck
 = 
º_node
[
öode
].
±c_num
;

733 
	`døw_º_ch™x
(
öode
, 
ôøck
);

736 
CHANY
:

737 
ôøck
 = 
º_node
[
öode
].
±c_num
;

738 
	`døw_º_ch™y
(
öode
, 
ôøck
);

741 
IPIN
:

742 
OPIN
:

743 
	`døw_º_pö
(
öode
, 
RED
);

748 
	}
}

752 
	$døw_º
()

758 
öode
, 
ôøck
;

760 if(
døw_º_toggÀ
 =
DRAW_NO_RR
)

762 
	`£éöewidth
(3);

763 
	`døwrouã
(
HIGHLIGHTED
);

764 
	`£éöewidth
(0);

768 
	`£éöe°yÀ
(
SOLID
);

769 
	`£éöewidth
(0);

771 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

773 
º_node
[
öode
].
ty≥
)

776 
SOURCE
:

777 
SINK
:

780 
CHANX
:

781 
	`£tcﬁ‹
(
BLACK
);

782 
ôøck
 = 
º_node
[
öode
].
±c_num
;

783 
	`døw_º_ch™x
(
öode
, 
ôøck
);

784 
	`døw_º_edges
(
öode
);

787 
CHANY
:

788 
	`£tcﬁ‹
(
BLACK
);

789 
ôøck
 = 
º_node
[
öode
].
±c_num
;

790 
	`døw_º_ch™y
(
öode
, 
ôøck
);

791 
	`døw_º_edges
(
öode
);

794 
IPIN
:

795 
	`døw_º_pö
(
öode
, 
BLUE
);

798 
OPIN
:

799 
	`døw_º_pö
(
öode
, 
RED
);

800 
	`£tcﬁ‹
(
RED
);

801 
	`døw_º_edges
(
öode
);

805 
¥ötf


807 
º_node
[
öode
].
ty≥
);

808 
	`exô
(1);

812 
	`£éöewidth
(3);

813 
	`døwrouã
(
HIGHLIGHTED
);

814 
	`£éöewidth
(0);

815 
	}
}

819 
	$døw_º_ch™x
(
öode
,

820 
ôøck
)

826 { 
BUFFSIZE
 = 80 };

827 
x1
, 
x2
, 
y
;

828 
y1
, 
y2
;

829 
k
;

830 
°r
[
BUFFSIZE
];

834 
x1
 = 
tûe_x
[
º_node
[
öode
].
xlow
];

835 
x2
 = 
tûe_y
[
º_node
[
öode
].
xhigh
] + 
tûe_width
;

836 
y
 = 
tûe_y
[
º_node
[
öode
].
ylow
] + 
tûe_width
 + 1.0 + 
ôøck
;

837 
	`døwlöe
(
x1
, 
y
, 
x2
, y);

840 
y1
 = 
y
 - 0.25;

841 
y2
 = 
y
 + 0.25;

843 if(
º_node
[
öode
].
dúe˘i⁄
 =
INC_DIRECTION
)

845 
	`£éöewidth
(2);

846 
	`£tcﬁ‹
(
YELLOW
);

847 
	`døwlöe
(
x1
, 
y1
, x1, 
y2
);

850 
	`£tcﬁ‹
(
BLACK
);

851 
	`•rötf
(
°r
, "%d", 
º_node
[
öode
].
Án_ö
);

852 
	`døwãxt
(
x1
, 
y
, 
°r
, 5);

854 
	`£tcﬁ‹
(
BLACK
);

855 
	`£éöewidth
(0);

856 
	`døw_åüngÀ_Æ⁄g_löe
(
x2
 - 0.15, 
y
, 
x1
, x2, y, y);

858 
	`£tcﬁ‹
(
LIGHTGREY
);

860 
k
 = 
º_node
[
öode
].
xlow
; k <Ñr_node[öode].
xhigh
; k++)

862 
x2
 = 
tûe_x
[
k
] + 
tûe_width
;

863 
	`døw_åüngÀ_Æ⁄g_löe
(
x2
 - 0.15, 
y
, 
x1
, x2, y, y);

864 
x2
 = 
tûe_x
[
k
 + 1];

865 
	`døw_åüngÀ_Æ⁄g_löe
(
x2
 + 0.15, 
y
, 
x1
, x2, y, y);

867 
	`£tcﬁ‹
(
BLACK
);

869 if(
º_node
[
öode
].
dúe˘i⁄
 =
DEC_DIRECTION
)

871 
	`£éöewidth
(2);

872 
	`£tcﬁ‹
(
YELLOW
);

873 
	`døwlöe
(
x2
, 
y1
, x2, 
y2
);

876 
	`£tcﬁ‹
(
BLACK
);

877 
	`•rötf
(
°r
, "%d", 
º_node
[
öode
].
Án_ö
);

878 
	`døwãxt
(
x2
, 
y
, 
°r
, 5);

880 
	`£éöewidth
(0);

881 
	`døw_åüngÀ_Æ⁄g_löe
(
x1
 + 0.15, 
y
, 
x2
, x1, y, y);

882 
	`£tcﬁ‹
(
LIGHTGREY
);

883 
k
 = 
º_node
[
öode
].
xhigh
; k >Ñr_node[öode].
xlow
; k--)

885 
x1
 = 
tûe_x
[
k
];

886 
	`døw_åüngÀ_Æ⁄g_löe
(
x1
 + 0.15, 
y
, 
x2
, x1, y, y);

887 
x1
 = 
tûe_x
[
k
 - 1] + 
tûe_width
;

888 
	`døw_åüngÀ_Æ⁄g_löe
(
x1
 - 0.15, 
y
, 
x2
, x1, y, y);

890 
	`£tcﬁ‹
(
BLACK
);

893 
	}
}

897 
	$døw_º_ch™y
(
öode
,

898 
ôøck
)

903 { 
BUFFSIZE
 = 80 };

904 
x
, 
y1
, 
y2
;

905 
x1
, 
x2
;

906 
k
;

907 
°r
[
BUFFSIZE
];

911 
x
 = 
tûe_x
[
º_node
[
öode
].
xlow
] + 
tûe_width
 + 1. + 
ôøck
;

912 
y1
 = 
tûe_y
[
º_node
[
öode
].
ylow
];

913 
y2
 = 
tûe_y
[
º_node
[
öode
].
yhigh
] + 
tûe_width
;

914 
	`døwlöe
(
x
, 
y1
, x, 
y2
);

917 
x1
 = 
x
 - 0.25;

918 
x2
 = 
x
 + 0.25;

919 if(
º_node
[
öode
].
dúe˘i⁄
 =
INC_DIRECTION
)

921 
	`£éöewidth
(2);

922 
	`£tcﬁ‹
(
YELLOW
);

923 
	`døwlöe
(
x1
, 
y1
, 
x2
, y1);

926 
	`£tcﬁ‹
(
BLACK
);

927 
	`•rötf
(
°r
, "%d", 
º_node
[
öode
].
Án_ö
);

928 
	`døwãxt
(
x
, 
y1
, 
°r
, 5);

929 
	`£tcﬁ‹
(
BLACK
);

932 
	`£éöewidth
(0);

933 
	`døw_åüngÀ_Æ⁄g_löe
(
x
, 
y2
 - 0.15, x, x, 
y1
, y2);

934 
	`£tcﬁ‹
(
LIGHTGREY
);

935 
k
 = 
º_node
[
öode
].
ylow
; k <Ñr_node[öode].
yhigh
; k++)

937 
y2
 = 
tûe_y
[
k
] + 
tûe_width
;

938 
	`døw_åüngÀ_Æ⁄g_löe
(
x
, 
y2
 - 0.15, x, x, 
y1
, y2);

939 
y2
 = 
tûe_y
[
k
 + 1];

940 
	`døw_åüngÀ_Æ⁄g_löe
(
x
, 
y2
 + 0.15, x, x, 
y1
, y2);

942 
	`£tcﬁ‹
(
BLACK
);

944 if(
º_node
[
öode
].
dúe˘i⁄
 =
DEC_DIRECTION
)

946 
	`£éöewidth
(2);

947 
	`£tcﬁ‹
(
YELLOW
);

948 
	`døwlöe
(
x1
, 
y2
, 
x2
, y2);

951 
	`£tcﬁ‹
(
BLACK
);

952 
	`•rötf
(
°r
, "%d", 
º_node
[
öode
].
Án_ö
);

953 
	`døwãxt
(
x
, 
y2
, 
°r
, 5);

954 
	`£tcﬁ‹
(
BLACK
);

957 
	`£éöewidth
(0);

958 
	`døw_åüngÀ_Æ⁄g_löe
(
x
, 
y1
 + 0.15, x, x, 
y2
, y1);

959 
	`£tcﬁ‹
(
LIGHTGREY
);

960 
k
 = 
º_node
[
öode
].
yhigh
; k >Ñr_node[öode].
ylow
; k--)

962 
y1
 = 
tûe_y
[
k
];

963 
	`døw_åüngÀ_Æ⁄g_löe
(
x
, 
y1
 + 0.15, x, x, 
y2
, y1);

964 
y1
 = 
tûe_y
[
k
 - 1] + 
tûe_width
;

965 
	`døw_åüngÀ_Æ⁄g_löe
(
x
, 
y1
 - 0.15, x, x, 
y2
, y1);

967 
	`£tcﬁ‹
(
BLACK
);

970 
	}
}

974 
	$døw_º_edges
(
öode
)

980 
t_º_ty≥
 
‰om_ty≥
, 
to_ty≥
;

981 
õdge
, 
to_node
, 
‰om_±c_num
, 
to_±c_num
;

982 
swôch_ty≥
;

984 
‰om_ty≥
 = 
º_node
[
öode
].
ty≥
;

986 if((
døw_º_toggÀ
 =
DRAW_NODES_RR
) ||

987 (
døw_º_toggÀ
 =
DRAW_NODES_AND_SBOX_RR
 && 
‰om_ty≥
 =
OPIN
))

992 
‰om_±c_num
 = 
º_node
[
öode
].
±c_num
;

994 
õdge
 = 0; iedgê< 
º_node
[
öode
].
num_edges
; iedge++)

996 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

997 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

998 
to_±c_num
 = 
º_node
[
to_node
].
±c_num
;

1000 
‰om_ty≥
)

1003 
OPIN
:

1004 
to_ty≥
)

1006 
CHANX
:

1007 
CHANY
:

1008 
	`£tcﬁ‹
(
RED
);

1009 
	`døw_pö_to_ch™_edge
(
öode
, 
to_node
);

1013 
¥ötf


1015 "nodê%d (ty≥: %d).\n", 
öode
, 
‰om_ty≥
,

1016 
to_node
, 
to_ty≥
);

1017 
	`exô
(1);

1022 
CHANX
:

1023 
to_ty≥
)

1025 
IPIN
:

1026 if(
døw_º_toggÀ
 =
DRAW_NODES_AND_SBOX_RR
)

1031 
	`£tcﬁ‹
(
BLUE
);

1032 
	`døw_pö_to_ch™_edge
(
to_node
, 
öode
);

1035 
CHANX
:

1036 
	`£tcﬁ‹
(
DARKGREEN
);

1037 
swôch_ty≥
 = 
º_node
[
öode
].
swôches
[
õdge
];

1038 
	`døw_ch™x_to_ch™x_edge
(
öode
, 
‰om_±c_num
,

1039 
to_node
, 
to_±c_num
,

1040 
swôch_ty≥
);

1043 
CHANY
:

1044 
	`£tcﬁ‹
(
DARKGREEN
);

1045 
swôch_ty≥
 = 
º_node
[
öode
].
swôches
[
õdge
];

1046 
	`døw_ch™x_to_ch™y_edge
(
öode
, 
‰om_±c_num
,

1047 
to_node
, 
to_±c_num
,

1048 
FROM_X_TO_Y
,

1049 
swôch_ty≥
);

1053 
¥ötf


1055 "nodê%d (ty≥: %d).\n", 
öode
, 
‰om_ty≥
,

1056 
to_node
, 
to_ty≥
);

1057 
	`exô
(1);

1063 
CHANY
:

1064 
to_ty≥
)

1066 
IPIN
:

1067 if(
døw_º_toggÀ
 =
DRAW_NODES_AND_SBOX_RR
)

1072 
	`£tcﬁ‹
(
BLUE
);

1073 
	`døw_pö_to_ch™_edge
(
to_node
, 
öode
);

1076 
CHANX
:

1077 
	`£tcﬁ‹
(
DARKGREEN
);

1078 
swôch_ty≥
 = 
º_node
[
öode
].
swôches
[
õdge
];

1079 
	`døw_ch™x_to_ch™y_edge
(
to_node
, 
to_±c_num
,

1080 
öode
, 
‰om_±c_num
,

1081 
FROM_Y_TO_X
,

1082 
swôch_ty≥
);

1085 
CHANY
:

1086 
	`£tcﬁ‹
(
DARKGREEN
);

1087 
swôch_ty≥
 = 
º_node
[
öode
].
swôches
[
õdge
];

1088 
	`døw_ch™y_to_ch™y_edge
(
öode
, 
‰om_±c_num
,

1089 
to_node
, 
to_±c_num
,

1090 
swôch_ty≥
);

1094 
¥ötf


1096 "nodê%d (ty≥: %d).\n", 
öode
, 
‰om_ty≥
,

1097 
to_node
, 
to_ty≥
);

1098 
	`exô
(1);

1104 
¥ötf


1106 
öode
, 
‰om_ty≥
);

1107 
	`exô
(1);

1111 
	}
}

1114 
	$døw_x
(
x
,

1115 
y
,

1116 
size
)

1122 
	`døwlöe
(
x
 - 
size
, 
y
 + size, x + size, y - size);

1123 
	`døwlöe
(
x
 - 
size
, 
y
 - size, x + size, y + size);

1124 
	}
}

1129 
	$døw_ch™x_to_ch™y_edge
(
ch™x_node
,

1130 
ch™x_åack
,

1131 
ch™y_node
,

1132 
ch™y_åack
,

1133 
e_edge_dú
 
edge_dú
,

1134 
swôch_ty≥
)

1140 
x1
, 
y1
, 
x2
, 
y2
;

1141 
ch™x_y
, 
ch™y_x
, 
ch™x_xlow
, 
ch™y_ylow
;

1143 
ch™x_y
 = 
º_node
[
ch™x_node
].
ylow
;

1144 
ch™x_xlow
 = 
º_node
[
ch™x_node
].
xlow
;

1145 
ch™y_x
 = 
º_node
[
ch™y_node
].
xlow
;

1146 
ch™y_ylow
 = 
º_node
[
ch™y_node
].
ylow
;

1150 
y1
 = 
tûe_y
[
ch™x_y
] + 
tûe_width
 + 1. + 
ch™x_åack
;

1151 
x2
 = 
tûe_x
[
ch™y_x
] + 
tûe_width
 + 1. + 
ch™y_åack
;

1153 if(
ch™x_xlow
 <
ch™y_x
)

1155 
x1
 = 
tûe_x
[
ch™y_x
] + 
tûe_width
;

1157 if(
º_node
[
ch™x_node
].
dúe˘i⁄
 !
BI_DIRECTION
)

1159 if(
edge_dú
 =
FROM_X_TO_Y
)

1161 if((
ch™x_åack
 % 2) == 1)

1163 
x1
 = 
tûe_x
[
ch™y_x
 + 1];

1171 
x1
 = 
tûe_x
[
ch™x_xlow
];

1174 if(
ch™y_ylow
 <
ch™x_y
)

1176 
y2
 = 
tûe_y
[
ch™x_y
] + 
tûe_width
;

1178 if(
º_node
[
ch™y_node
].
dúe˘i⁄
 !
BI_DIRECTION
)

1180 if(
edge_dú
 =
FROM_Y_TO_X
)

1182 if((
ch™y_åack
 % 2) == 1)

1184 
y2
 = 
tûe_y
[
ch™x_y
 + 1];

1192 
y2
 = 
tûe_y
[
ch™y_ylow
];

1195 
	`døwlöe
(
x1
, 
y1
, 
x2
, 
y2
);

1197 if(
døw_º_toggÀ
 !
DRAW_ALL_RR
)

1200 if(
edge_dú
 =
FROM_X_TO_Y
)

1201 
	`døw_º_swôch
(
x1
, 
y1
, 
x2
, 
y2
, 
swôch_öf
[
swôch_ty≥
].
buf„ªd
);

1203 
	`døw_º_swôch
(
x2
, 
y2
, 
x1
, 
y1
, 
swôch_öf
[
swôch_ty≥
].
buf„ªd
);

1204 
	}
}

1208 
	$døw_ch™x_to_ch™x_edge
(
‰om_node
,

1209 
‰om_åack
,

1210 
to_node
,

1211 
to_åack
,

1212 
swôch_ty≥
)

1219 
x1
, 
x2
, 
y1
, 
y2
;

1220 
‰om_y
, 
to_y
, 
‰om_xlow
, 
to_xlow
, 
‰om_xhigh
, 
to_xhigh
;

1222 
‰om_y
 = 
º_node
[
‰om_node
].
ylow
;

1223 
‰om_xlow
 = 
º_node
[
‰om_node
].
xlow
;

1224 
‰om_xhigh
 = 
º_node
[
‰om_node
].
xhigh
;

1225 
to_y
 = 
º_node
[
to_node
].
ylow
;

1226 
to_xlow
 = 
º_node
[
to_node
].
xlow
;

1227 
to_xhigh
 = 
º_node
[
to_node
].
xhigh
;

1231 
y1
 = 
tûe_y
[
‰om_y
] + 
tûe_width
 + 1 + 
‰om_åack
;

1232 
y2
 = 
tûe_y
[
to_y
] + 
tûe_width
 + 1 + 
to_åack
;

1235 if(
to_xhigh
 < 
‰om_xlow
)

1239 
x1
 = 
tûe_x
[
‰om_xlow
];

1240 
x2
 = 
tûe_x
[
to_xhigh
] + 
tûe_width
;

1242 if(
to_xlow
 > 
‰om_xhigh
)

1246 
x1
 = 
tûe_x
[
‰om_xhigh
] + 
tûe_width
;

1247 
x2
 = 
tûe_x
[
to_xlow
];

1257 if(
º_node
[
to_node
].
dúe˘i⁄
 !
BI_DIRECTION
)

1260 if(
to_åack
 % 2 == 0)

1262 
	`as£π
(
‰om_xlow
 < 
to_xlow
);

1263 
x2
 = 
tûe_x
[
to_xlow
];

1265 
x1
 = 
tûe_x
[
to_xlow
 - 1] + 
tûe_width
;

1269 
	`as£π
(
‰om_xhigh
 > 
to_xhigh
);

1270 
x2
 = 
tûe_x
[
to_xhigh
] + 
tûe_width
;

1271 
x1
 = 
tûe_x
[
to_xhigh
 + 1];

1276 if(
to_xlow
 < 
‰om_xlow
)

1278 
x1
 = 
tûe_x
[
‰om_xlow
];

1279 
x2
 = 
tûe_x
[
‰om_xlow
 - 1] + 
tûe_width
;

1281 if(
‰om_xlow
 < 
to_xlow
)

1283 
x1
 = 
tûe_x
[
to_xlow
 - 1] + 
tûe_width
;

1284 
x2
 = 
tûe_x
[
to_xlow
];

1286 if(
to_xhigh
 > 
‰om_xhigh
)

1288 
x1
 = 
tûe_x
[
‰om_xhigh
] + 
tûe_width
;

1289 
x2
 = 
tûe_x
[
‰om_xhigh
 + 1];

1291 if(
‰om_xhigh
 > 
to_xhigh
)

1293 
x1
 = 
tûe_x
[
to_xhigh
 + 1];

1294 
x2
 = 
tûe_x
[
to_xhigh
] + 
tûe_width
;

1298 
x1
 = 
tûe_x
[
‰om_xlow
];

1299 
x2
 = 
tûe_x
[
‰om_xlow
] + 
tûe_width
;

1304 
	`døwlöe
(
x1
, 
y1
, 
x2
, 
y2
);

1306 if(
døw_º_toggÀ
 =
DRAW_ALL_RR
)

1307 
	`døw_º_swôch
(
x1
, 
y1
, 
x2
, 
y2
, 
swôch_öf
[
swôch_ty≥
].
buf„ªd
);

1308 
	}
}

1312 
	$døw_ch™y_to_ch™y_edge
(
‰om_node
,

1313 
‰om_åack
,

1314 
to_node
,

1315 
to_åack
,

1316 
swôch_ty≥
)

1323 
x1
, 
x2
, 
y1
, 
y2
;

1324 
‰om_x
, 
to_x
, 
‰om_ylow
, 
to_ylow
, 
‰om_yhigh
, 
to_yhigh
;

1326 
‰om_x
 = 
º_node
[
‰om_node
].
xlow
;

1327 
‰om_ylow
 = 
º_node
[
‰om_node
].
ylow
;

1328 
‰om_yhigh
 = 
º_node
[
‰om_node
].
yhigh
;

1329 
to_x
 = 
º_node
[
to_node
].
xlow
;

1330 
to_ylow
 = 
º_node
[
to_node
].
ylow
;

1331 
to_yhigh
 = 
º_node
[
to_node
].
yhigh
;

1335 
x1
 = 
tûe_x
[
‰om_x
] + 
tûe_width
 + 1 + 
‰om_åack
;

1336 
x2
 = 
tûe_x
[
to_x
] + 
tûe_width
 + 1 + 
to_åack
;

1338 if(
to_yhigh
 < 
‰om_ylow
)

1340 
y1
 = 
tûe_y
[
‰om_ylow
];

1341 
y2
 = 
tûe_y
[
to_yhigh
] + 
tûe_width
;

1343 if(
to_ylow
 > 
‰om_yhigh
)

1345 
y1
 = 
tûe_y
[
‰om_yhigh
] + 
tûe_width
;

1346 
y2
 = 
tûe_y
[
to_ylow
];

1356 if(
º_node
[
to_node
].
dúe˘i⁄
 !
BI_DIRECTION
)

1358 if(
to_åack
 % 2 == 0)

1360 
	`as£π
(
‰om_ylow
 < 
to_ylow
);

1361 
y2
 = 
tûe_y
[
to_ylow
];

1363 
y1
 = 
tûe_y
[
to_ylow
 - 1] + 
tûe_width
;

1367 if(!(
‰om_yhigh
 > 
to_yhigh
))

1369 
¥ötf


1371 
‰om_yhigh
, 
to_yhigh
);

1372 
¥ötf


1374 
º_node
[
‰om_node
].
xhigh
,

1375 
º_node
[
‰om_node
].
yhigh
,

1376 
º_node
[
‰om_node
].
xlow
,

1377 
º_node
[
‰om_node
].
ylow
,

1378 
º_node
[
‰om_node
].
±c_num
);

1379 
¥ötf


1381 
º_node
[
to_node
].
xhigh
,

1382 
º_node
[
to_node
].
yhigh
,

1383 
º_node
[
to_node
].
xlow
,

1384 
º_node
[
to_node
].
ylow
,

1385 
º_node
[
to_node
].
±c_num
);

1386 
	`exô
(1);

1388 
y2
 = 
tûe_y
[
to_yhigh
] + 
tûe_width
;

1389 
y1
 = 
tûe_y
[
to_yhigh
 + 1];

1394 if(
to_ylow
 < 
‰om_ylow
)

1396 
y1
 = 
tûe_y
[
‰om_ylow
];

1397 
y2
 = 
tûe_y
[
‰om_ylow
 - 1] + 
tûe_width
;

1399 if(
‰om_ylow
 < 
to_ylow
)

1401 
y1
 = 
tûe_y
[
to_ylow
 - 1] + 
tûe_width
;

1402 
y2
 = 
tûe_y
[
to_ylow
];

1404 if(
to_yhigh
 > 
‰om_yhigh
)

1406 
y1
 = 
tûe_y
[
‰om_yhigh
] + 
tûe_width
;

1407 
y2
 = 
tûe_y
[
‰om_yhigh
 + 1];

1409 if(
‰om_yhigh
 > 
to_yhigh
)

1411 
y1
 = 
tûe_y
[
to_yhigh
 + 1];

1412 
y2
 = 
tûe_y
[
to_yhigh
] + 
tûe_width
;

1416 
y1
 = 
tûe_y
[
‰om_ylow
];

1417 
y2
 = 
tûe_y
[
‰om_ylow
] + 
tûe_width
;

1422 
	`døwlöe
(
x1
, 
y1
, 
x2
, 
y2
);

1424 if(
døw_º_toggÀ
 =
DRAW_ALL_RR
)

1425 
	`døw_º_swôch
(
x1
, 
y1
, 
x2
, 
y2
, 
swôch_öf
[
swôch_ty≥
].
buf„ªd
);

1426 
	}
}

1430 
	$døw_º_swôch
(
‰om_x
,

1431 
‰om_y
,

1432 
to_x
,

1433 
to_y
,

1434 
boﬁón
 
buf„ªd
)

1441 c⁄° 
swôch_ød
 = 0.15;

1442 
magnôude
, 
x˚n
, 
y˚n
, 
xdñè
, 
ydñè
, 
xba£löe
, 
yba£löe
;

1443 
xunô
, 
yunô
;

1444 
t_poöt
 
pﬁy
[3];

1446 
x˚n
 = 
‰om_x
 + (
to_x
 - from_x) / 10.;

1447 
y˚n
 = 
‰om_y
 + (
to_y
 - from_y) / 10.;

1449 if(!
buf„ªd
)

1451 
	`døw¨c
(
x˚n
, 
y˚n
, 
swôch_ød
, 0., 360.);

1455 
xdñè
 = 
to_x
 - 
‰om_x
;

1456 
ydñè
 = 
to_y
 - 
‰om_y
;

1457 
magnôude
 = 
	`sqπ
(
xdñè
 * xdñè + 
ydñè
 * ydelta);

1458 
xunô
 = 
xdñè
 / 
magnôude
;

1459 
yunô
 = 
ydñè
 / 
magnôude
;

1460 
pﬁy
[0].
x
 = 
x˚n
 + 
xunô
 * 
swôch_ød
;

1461 
pﬁy
[0].
y
 = 
y˚n
 + 
yunô
 * 
swôch_ød
;

1462 
xba£löe
 = 
x˚n
 - 
xunô
 * 
swôch_ød
;

1463 
yba£löe
 = 
y˚n
 - 
yunô
 * 
swôch_ød
;

1468 
pﬁy
[1].
x
 = 
xba£löe
 + 
yunô
 * 
swôch_ød
;

1469 
pﬁy
[1].
y
 = 
yba£löe
 - 
xunô
 * 
swôch_ød
;

1470 
pﬁy
[2].
x
 = 
xba£löe
 - 
yunô
 * 
swôch_ød
;

1471 
pﬁy
[2].
y
 = 
yba£löe
 + 
xunô
 * 
swôch_ød
;

1472 
	`fûÕﬁy
(
pﬁy
, 3);

1474 
	}
}

1478 
	$døw_º_pö
(
öode
,

1479 
cﬁ‹_ty≥s
 
cﬁ‹
)

1486 
ùö
, 
i
, 
j
, 
iside
, 
i˛ass
, 
ioff
;

1487 
x˚n
, 
y˚n
;

1488 
°r
[
BUFSIZE
];

1489 
t_ty≥_±r
 
ty≥
;

1491 
i
 = 
º_node
[
öode
].
xlow
;

1492 
j
 = 
º_node
[
öode
].
ylow
;

1493 
ùö
 = 
º_node
[
öode
].
±c_num
;

1494 
ty≥
 = 
grid
[
i
][
j
].type;

1495 
ioff
 = 
grid
[
i
][
j
].
off£t
;

1497 
	`£tcﬁ‹
(
cﬁ‹
);

1498 
i˛ass
 = 
ty≥
->
pö_˛ass
[
ùö
];

1500 
iside
 = 0; iside < 4; iside++)

1502 if(
ty≥
->
pöloc
[
grid
[
i
][
j
].
off£t
][
iside
][
ùö
])

1504 
	`gë_º_pö_døw_co‹ds
(
öode
, 
iside
, 
ioff
, &
x˚n
, &
y˚n
);

1505 
	`fûÃe˘
(
x˚n
 - 
pö_size
, 
y˚n
 -Öin_size,

1506 
x˚n
 + 
pö_size
, 
y˚n
 +Öin_size);

1507 
	`•rötf
(
°r
, "%d", 
ùö
);

1508 
	`£tcﬁ‹
(
BLACK
);

1509 
	`døwãxt
(
x˚n
, 
y˚n
, 
°r
, 2 * 
pö_size
);

1510 
	`£tcﬁ‹
(
cﬁ‹
);

1513 
	}
}

1517 
	$gë_º_pö_døw_co‹ds
(
öode
,

1518 
iside
,

1519 
ioff
,

1520 *
x˚n
,

1521 *
y˚n
)

1528 
i
, 
j
, 
k
, 
ùö
, 
pös_≥r_sub_tûe
;

1529 
off£t
, 
xc
, 
yc
, 
°ï
;

1530 
t_ty≥_±r
 
ty≥
;

1532 
i
 = 
º_node
[
öode
].
xlow
;

1533 
j
 = 
º_node
[
öode
].
ylow
 + 
ioff
;

1535 
xc
 = 
tûe_x
[
i
];

1536 
yc
 = 
tûe_y
[
j
];

1538 
ùö
 = 
º_node
[
öode
].
±c_num
;

1539 
ty≥
 = 
grid
[
i
][
j
].type;

1540 
pös_≥r_sub_tûe
 = 
grid
[
i
][
j
].
ty≥
->
num_pös
 / grid[i][j].ty≥->
ˇ∑côy
;

1541 
k
 = 
ùö
 / 
pös_≥r_sub_tûe
;

1547 
°ï
 = ()(
tûe_width
Ë/ ()(
ty≥
->
num_pös
 +Åy≥->
ˇ∑côy
);

1548 
off£t
 = (
ùö
 + 
k
 + 1Ë* 
°ï
;

1550 
iside
)

1552 
LEFT
:

1553 
yc
 +
off£t
;

1556 
RIGHT
:

1557 
xc
 +
tûe_width
;

1558 
yc
 +
off£t
;

1561 
BOTTOM
:

1562 
xc
 +
off£t
;

1565 
TOP
:

1566 
xc
 +
off£t
;

1567 
yc
 +
tûe_width
;

1571 
	`¥ötf
("Error in get_rr_pin_draw_coords: Unexpected iside %d.\n",

1572 
iside
);

1573 
	`exô
(1);

1577 *
x˚n
 = 
xc
;

1578 *
y˚n
 = 
yc
;

1579 
	}
}

1583 
	$døwrouã
(
e_døw_√t_ty≥
 
døw_√t_ty≥
)

1592 **
ch™x_åack
 = 
NULL
;

1593 **
ch™y_åack
 = 
NULL
;

1595 
öë
, 
i
, 
j
, 
öode
, 
¥ev_node
, 
¥ev_åack
, 
ôøck
;

1596 
swôch_ty≥
;

1597 
s_åa˚
 *
çå
;

1598 
t_º_ty≥
 
º_ty≥
, 
¥ev_ty≥
;

1601 if(
døw_rouã_ty≥
 =
GLOBAL
)

1604 if(
ch™x_åack
 =
NULL
)

1606 
ch™x_åack
 =

1607 (**)
	`Æloc_m©rix
(1, 
nx
, 0, 
ny
, ());

1610 if(
ch™y_åack
 =
NULL
)

1612 
ch™y_åack
 =

1613 (**)
	`Æloc_m©rix
(0, 
nx
, 1, 
ny
, ());

1616 
i
 = 1; i <
nx
; i++)

1617 
j
 = 0; j <
ny
; j++)

1618 
ch™x_åack
[
i
][
j
] = (-1);

1620 
i
 = 0; i <
nx
; i++)

1621 
j
 = 1; j <
ny
; j++)

1622 
ch™y_åack
[
i
][
j
] = (-1);

1625 
	`£éöe°yÀ
(
SOLID
);

1629 
öë
 = 0; i√à< 
num_√ts
; inet++)

1631 if(
√t
[
öë
].
is_globÆ
)

1634 if(
åa˚_hód
[
öë
] =
NULL
)

1637 if(
døw_√t_ty≥
 =
HIGHLIGHTED
 && 
√t_cﬁ‹
[
öë
] =
BLACK
)

1640 
	`£tcﬁ‹
(
√t_cﬁ‹
[
öë
]);

1641 
çå
 = 
åa˚_hód
[
öë
];

1642 
öode
 = 
çå
->
ödex
;

1643 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

1648 
¥ev_node
 = 
öode
;

1649 
¥ev_ty≥
 = 
º_ty≥
;

1650 
swôch_ty≥
 = 
çå
->
iswôch
;

1651 
çå
 =Å±r->
√xt
;

1652 
öode
 = 
çå
->
ödex
;

1653 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

1655 
º_ty≥
)

1658 
OPIN
:

1659 
	`døw_º_pö
(
öode
, 
√t_cﬁ‹
[
öë
]);

1662 
IPIN
:

1663 
	`døw_º_pö
(
öode
, 
√t_cﬁ‹
[
öë
]);

1664 
¥ev_åack
 =

1665 
	`gë_åack_num
(
¥ev_node
, 
ch™x_åack
,

1666 
ch™y_åack
);

1667 
	`døw_pö_to_ch™_edge
(
öode
, 
¥ev_node
);

1670 
CHANX
:

1671 if(
døw_rouã_ty≥
 =
GLOBAL
)

1672 
ch™x_åack
[
º_node
[
öode
].

1673 
xlow
][
º_node
[
öode
].
ylow
]++;

1675 
ôøck
 =

1676 
	`gë_åack_num
(
öode
, 
ch™x_åack
,

1677 
ch™y_åack
);

1678 
	`døw_º_ch™x
(
öode
, 
ôøck
);

1680 
¥ev_ty≥
)

1683 
CHANX
:

1684 
¥ev_åack
 =

1685 
	`gë_åack_num
(
¥ev_node
, 
ch™x_åack
,

1686 
ch™y_åack
);

1687 
	`døw_ch™x_to_ch™x_edge
(
¥ev_node
,

1688 
¥ev_åack
,

1689 
öode
, 
ôøck
,

1690 
swôch_ty≥
);

1693 
CHANY
:

1694 
¥ev_åack
 =

1695 
	`gë_åack_num
(
¥ev_node
, 
ch™x_åack
,

1696 
ch™y_åack
);

1697 
	`døw_ch™x_to_ch™y_edge
(
öode
, 
ôøck
,

1698 
¥ev_node
,

1699 
¥ev_åack
,

1700 
FROM_Y_TO_X
,

1701 
swôch_ty≥
);

1704 
OPIN
:

1705 
	`døw_pö_to_ch™_edge
(
¥ev_node
, 
öode
);

1709 
¥ötf


1712 
¥ev_ty≥
, 
º_ty≥
);

1713 
	`exô
(1);

1718 
CHANY
:

1719 if(
døw_rouã_ty≥
 =
GLOBAL
)

1720 
ch™y_åack
[
º_node
[
öode
].

1721 
xlow
][
º_node
[
öode
].
ylow
]++;

1723 
ôøck
 =

1724 
	`gë_åack_num
(
öode
, 
ch™x_åack
,

1725 
ch™y_åack
);

1726 
	`døw_º_ch™y
(
öode
, 
ôøck
);

1728 
¥ev_ty≥
)

1731 
CHANX
:

1732 
¥ev_åack
 =

1733 
	`gë_åack_num
(
¥ev_node
, 
ch™x_åack
,

1734 
ch™y_åack
);

1735 
	`døw_ch™x_to_ch™y_edge
(
¥ev_node
,

1736 
¥ev_åack
,

1737 
öode
, 
ôøck
,

1738 
FROM_X_TO_Y
,

1739 
swôch_ty≥
);

1742 
CHANY
:

1743 
¥ev_åack
 =

1744 
	`gë_åack_num
(
¥ev_node
, 
ch™x_åack
,

1745 
ch™y_åack
);

1746 
	`døw_ch™y_to_ch™y_edge
(
¥ev_node
,

1747 
¥ev_åack
,

1748 
öode
, 
ôøck
,

1749 
swôch_ty≥
);

1752 
OPIN
:

1753 
	`døw_pö_to_ch™_edge
(
¥ev_node
, 
öode
);

1758 
¥ötf


1761 
¥ev_ty≥
, 
º_ty≥
);

1762 
	`exô
(1);

1772 if(
º_ty≥
 =
SINK
)

1774 
çå
 =Å±r->
√xt
;

1775 if(
çå
 =
NULL
)

1777 
öode
 = 
çå
->
ödex
;

1778 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

1783 
	}
}

1787 
	$gë_åack_num
(
öode
,

1788 **
ch™x_åack
,

1789 **
ch™y_åack
)

1794 
i
, 
j
;

1795 
t_º_ty≥
 
º_ty≥
;

1797 if(
døw_rouã_ty≥
 =
DETAILED
)

1798  (
º_node
[
öode
].
±c_num
);

1802 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

1803 
i
 = 
º_node
[
öode
].
xlow
;

1804 
j
 = 
º_node
[
öode
].
ylow
;

1806 
º_ty≥
)

1808 
CHANX
:

1809  (
ch™x_åack
[
i
][
j
]);

1811 
CHANY
:

1812  (
ch™y_åack
[
i
][
j
]);

1815 
¥ötf


1817 "\n", 
º_ty≥
, 
öode
);

1818 
	`exô
(1);

1820 
	}
}

1824 
	$highlight_blocks
(
x
,

1825 
y
)

1837 
i
, 
j
, 
k
, 
hô
, 
bnum
, 
ùö
, 
√äum
, 
Ánblk
;

1838 
i˛ass
;

1839 
io_°ï
;

1840 
t_ty≥_±r
 
ty≥
;

1841 
msg
[
BUFSIZE
];

1843 
	`de£À˘_Æl
();

1845 
hô
 = 0;

1846 
i
 = 0; i <(
nx
 + 1Ë&& !
hô
; i++)

1848 if(
x
 <
tûe_x
[
i
] + 
tûe_width
)

1850 if(
x
 >
tûe_x
[
i
]){

1851 
j
 = 0; j <(
ny
 + 1Ë&& !
hô
; j++)

1853 if(
grid
[
i
][
j
].
off£t
 != 0)

1855 
ty≥
 = 
grid
[
i
][
j
].type;

1856 if(
y
 <
tûe_y
[
j
 + 
ty≥
->
height
 - 1] + 
tûe_width
)

1858 if(
y
 >
tûe_y
[
j
])

1859 
hô
 = 1;

1866 
i
--;

1867 
j
--;

1869 if(!
hô
)

1871 
	`upd©e_mesßge
(
deÁu…_mesßge
);

1872 
	`døws¸ìn
();

1875 
ty≥
 = 
grid
[
i
][
j
].type;

1876 
hô
 = 0;

1878 if(
EMPTY_TYPE
 =
ty≥
)

1880 
	`upd©e_mesßge
(
deÁu…_mesßge
);

1881 
	`døws¸ìn
();

1886 
io_°ï
 = 
tûe_width
 / 
ty≥
->
ˇ∑côy
;

1888 if((
i
 < 1Ë|| (ò> 
nx
))

1889 
k
 = ()((
y
 - 
tûe_y
[
j
]Ë/ 
io_°ï
);

1891 
k
 = ()((
x
 - 
tûe_x
[
i
]Ë/ 
io_°ï
);

1893 
	`as£π
(
k
 < 
ty≥
->
ˇ∑côy
);

1894 if(
grid
[
i
][
j
].
blocks
[
k
] =
EMPTY
)

1896 
	`upd©e_mesßge
(
deÁu…_mesßge
);

1897 
	`døws¸ìn
();

1900 
bnum
 = 
grid
[
i
][
j
].
blocks
[
k
];

1904 
k
 = 0; k < 
ty≥
->
num_pös
; k++)

1906 
√äum
 = 
block
[
bnum
].
√ts
[
k
];

1908 if(
√äum
 =
OPEN
)

1911 
i˛ass
 = 
ty≥
->
pö_˛ass
[
k
];

1913 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
DRIVER
)

1915 
√t_cﬁ‹
[
√äum
] = 
RED
;

1916 
ùö
 = 1; ipö <
√t
[
√äum
].
num_söks
; ipin++)

1918 
Ánblk
 = 
√t
[
√äum
].
node_block
[
ùö
];

1919 
block_cﬁ‹
[
Ánblk
] = 
RED
;

1924 
√t_cﬁ‹
[
√äum
] = 
BLUE
;

1925 
Ánblk
 = 
√t
[
√äum
].
node_block
[0];

1926 
block_cﬁ‹
[
Ánblk
] = 
BLUE
;

1930 
block_cﬁ‹
[
bnum
] = 
GREEN
;

1932 
	`•rötf
(
msg
, "Block %d (%sË© (%d, %dË£À˘ed.", 
bnum
,

1933 
block
[
bnum
].
«me
, 
i
, 
j
);

1934 
	`upd©e_mesßge
(
msg
);

1935 
	`døws¸ìn
();

1936 
	}
}

1940 
	$de£À˘_Æl
()

1944 
i
;

1947 
i
 = 0; i < 
num_blocks
; i++) {

1948 if(
block
[
i
].
ty≥
->
ödex
 < 3) {

1949 
block_cﬁ‹
[
i
] = 
LIGHTGREY
;

1950 } if(
block
[
i
].
ty≥
->
ödex
 < 3 + 
MAX_BLOCK_COLOURS
) {

1951 
block_cﬁ‹
[
i
] = 
BISQUE
 + 
MAX_BLOCK_COLOURS
 + 
block
[i].
ty≥
->
ödex
 - 3;

1953 
block_cﬁ‹
[
i
] = 
BISQUE
 + 2 * 
MAX_BLOCK_COLOURS
 - 1;

1957 
i
 = 0; i < 
num_√ts
; i++)

1958 
√t_cﬁ‹
[
i
] = 
BLACK
;

1959 
	}
}

1964 
	$døw_åüngÀ_Æ⁄g_löe
(
xíd
,

1965 
yíd
,

1966 
x1
,

1967 
x2
,

1968 
y1
,

1969 
y2
)

1971 
swôch_ød
 = 0.15;

1972 
xdñè
, 
ydñè
;

1973 
magnôude
;

1974 
xunô
, 
yunô
;

1975 
xba£löe
, 
yba£löe
;

1976 
t_poöt
 
pﬁy
[3];

1978 
xdñè
 = 
x2
 - 
x1
;

1979 
ydñè
 = 
y2
 - 
y1
;

1980 
magnôude
 = 
	`sqπ
(
xdñè
 * xdñè + 
ydñè
 * ydelta);

1981 
xunô
 = 
xdñè
 / 
magnôude
;

1982 
yunô
 = 
ydñè
 / 
magnôude
;

1984 
pﬁy
[0].
x
 = 
xíd
 + 
xunô
 * 
swôch_ød
;

1985 
pﬁy
[0].
y
 = 
yíd
 + 
yunô
 * 
swôch_ød
;

1986 
xba£löe
 = 
xíd
 - 
xunô
 * 
swôch_ød
;

1987 
yba£löe
 = 
yíd
 - 
yunô
 * 
swôch_ød
;

1988 
pﬁy
[1].
x
 = 
xba£löe
 + 
yunô
 * 
swôch_ød
;

1989 
pﬁy
[1].
y
 = 
yba£löe
 - 
xunô
 * 
swôch_ød
;

1990 
pﬁy
[2].
x
 = 
xba£löe
 - 
yunô
 * 
swôch_ød
;

1991 
pﬁy
[2].
y
 = 
yba£löe
 + 
xunô
 * 
swôch_ød
;

1993 
	`fûÕﬁy
(
pﬁy
, 3);

1994 
	}
}

1998 
	$døw_pö_to_ch™_edge
(
pö_node
,

1999 
ch™_node
)

2010 
t_º_ty≥
 
ch™_ty≥
;

2011 
grid_x
, 
grid_y
, 
pö_num
, 
ch™_xlow
, 
ch™_ylow
, 
ioff
, 
height
;

2012 
x1
, 
x2
, 
y1
, 
y2
;

2013 
°¨t
, 
íd
, 
i
;

2014 
ôøck
;

2015 
xíd
, 
yíd
;

2016 
døw_pö_off
;

2017 
e_dúe˘i⁄
 
dúe˘i⁄
;

2018 
e_side
 
iside
;

2019 
t_ty≥_±r
 
ty≥
;

2021 
dúe˘i⁄
 = 
º_node
[
ch™_node
].direction;

2022 
grid_x
 = 
º_node
[
pö_node
].
xlow
;

2023 
grid_y
 = 
º_node
[
pö_node
].
ylow
;

2024 
pö_num
 = 
º_node
[
pö_node
].
±c_num
;

2025 
ch™_ty≥
 = 
º_node
[
ch™_node
].
ty≥
;

2026 
ôøck
 = 
º_node
[
ch™_node
].
±c_num
;

2027 
ty≥
 = 
grid
[
grid_x
][
grid_y
].type;

2029 
ioff
 = 
grid
[
grid_x
][
grid_y
].
off£t
;

2031 
grid_y
 = grid_y - 
ioff
;

2032 
height
 = 
grid
[
grid_x
][
grid_y
].
ty≥
->height;

2033 
ch™_ylow
 = 
º_node
[
ch™_node
].
ylow
;

2034 
ch™_xlow
 = 
º_node
[
ch™_node
].
xlow
;

2035 
°¨t
 = -1;

2036 
íd
 = -1;

2039 
ch™_ty≥
)

2042 
CHANX
:

2043 
°¨t
 = 
º_node
[
ch™_node
].
xlow
;

2044 
íd
 = 
º_node
[
ch™_node
].
xhigh
;

2045 if(
	`is_›ö
(
pö_num
, 
ty≥
))

2047 if(
dúe˘i⁄
 =
INC_DIRECTION
)

2049 
íd
 = 
º_node
[
ch™_node
].
xlow
;

2051 if(
dúe˘i⁄
 =
DEC_DIRECTION
)

2053 
°¨t
 = 
º_node
[
ch™_node
].
xhigh
;

2057 
°¨t
 = 
	`max
(°¨t, 
grid_x
);

2058 
íd
 = 
	`mö
”nd, 
grid_x
);

2059 
	`as£π
(
íd
 >
°¨t
);

2061 if((
grid_y
 + 
height
 - 1Ë=
ch™_ylow
)

2063 
iside
 = 
TOP
;

2064 
ioff
 = 
height
 - 1;

2065 
døw_pö_off
 = 
pö_size
;

2069 
	`as£π
((
grid_y
 - 1Ë=
ch™_ylow
);

2071 
iside
 = 
BOTTOM
;

2072 
ioff
 = 0;

2073 
døw_pö_off
 = -
pö_size
;

2075 
	`as£π
(
grid
[
grid_x
][
grid_y
].
ty≥
->
pöloc
[
ioff
][
iside
][
pö_num
]);

2077 
	`gë_º_pö_døw_co‹ds
(
pö_node
, 
iside
, 
ioff
, &
x1
, &
y1
);

2078 
y1
 +
døw_pö_off
;

2080 
y2
 = 
tûe_y
[
º_node
[
ch™_node
].
ylow
] + 
tûe_width
 + 1. + 
ôøck
;

2081 
x2
 = 
x1
;

2082 if(
	`is_›ö
(
pö_num
, 
ty≥
))

2084 if(
dúe˘i⁄
 =
INC_DIRECTION
)

2086 
x2
 = 
tûe_x
[
º_node
[
ch™_node
].
xlow
];

2088 if(
dúe˘i⁄
 =
DEC_DIRECTION
)

2090 
x2
 = 
tûe_x
[
º_node
[
ch™_node
].
xhigh
] +

2091 
tûe_width
;

2096 
CHANY
:

2097 
°¨t
 = 
º_node
[
ch™_node
].
ylow
;

2098 
íd
 = 
º_node
[
ch™_node
].
yhigh
;

2099 if(
	`is_›ö
(
pö_num
, 
ty≥
))

2101 if(
dúe˘i⁄
 =
INC_DIRECTION
)

2103 
íd
 = 
º_node
[
ch™_node
].
ylow
;

2105 if(
dúe˘i⁄
 =
DEC_DIRECTION
)

2107 
°¨t
 = 
º_node
[
ch™_node
].
yhigh
;

2111 
°¨t
 = 
	`max
(°¨t, 
grid_y
);

2112 
íd
 = 
	`mö
”nd, (
grid_y
 + 
height
 - 1));

2113 
	`as£π
(
íd
 >
°¨t
);

2115 if((
grid_x
Ë=
ch™_xlow
)

2117 
iside
 = 
RIGHT
;

2118 
døw_pö_off
 = 
pö_size
;

2122 
	`as£π
((
grid_x
 - 1Ë=
ch™_xlow
);

2123 
iside
 = 
LEFT
;

2124 
døw_pö_off
 = -
pö_size
;

2126 
i
 = 
°¨t
; i <
íd
; i++)

2128 
ioff
 = 
i
 - 
grid_y
;

2129 
	`as£π
(
ioff
 >0 && iof‡< 
ty≥
->
height
);

2135 if(
grid
[
grid_x
][
grid_y
].
ty≥
->

2136 
pöloc
[
ioff
][
iside
][
pö_num
])

2141 
	`as£π
(
grid
[
grid_x
][
grid_y
].
ty≥
->
pöloc
[
ioff
][
iside
][
pö_num
]);

2143 
	`gë_º_pö_døw_co‹ds
(
pö_node
, 
iside
, 
ioff
, &
x1
, &
y1
);

2144 
x1
 +
døw_pö_off
;

2146 
x2
 = 
tûe_x
[
ch™_xlow
] + 
tûe_width
 + 1 + 
ôøck
;

2147 
y2
 = 
y1
;

2148 if(
	`is_›ö
(
pö_num
, 
ty≥
))

2150 if(
dúe˘i⁄
 =
INC_DIRECTION
)

2152 
y2
 = 
tûe_y
[
º_node
[
ch™_node
].
ylow
];

2154 if(
dúe˘i⁄
 =
DEC_DIRECTION
)

2156 
y2
 = 
tûe_y
[
º_node
[
ch™_node
].
yhigh
] +

2157 
tûe_width
;

2163 
¥ötf


2165 
ch™_node
);

2166 
	`exô
(1);

2169 
	`døwlöe
(
x1
, 
y1
, 
x2
, 
y2
);

2170 if(
dúe˘i⁄
 =
BI_DIRECTION
 || !
	`is_›ö
(
pö_num
, 
ty≥
))

2172 
	`døw_x
(
x2
, 
y2
, 0.7 * 
pö_size
);

2176 
xíd
 = 
x2
 + (
x1
 - x2) / 10.;

2177 
yíd
 = 
y2
 + (
y1
 - y2) / 10.;

2178 
	`døw_åüngÀ_Æ⁄g_löe
(
xíd
, 
yíd
, 
x1
, 
x2
, 
y1
, 
y2
);

2180 
	}
}

	@draw.h

1 
upd©e_s¸ìn
(
¥i‹ôy
,

2 *
msg
,

3 
pic_ty≥
 
pic_⁄_s¸ìn_vÆ
,

4 
boﬁón
 
¸ô_∑th_buâ⁄_íabÀd
);

6 
Æloc_døw_°ru˘s
();

8 
öô_døw_co‹ds
(
˛b_width
);

10 
£t_gøphics_°©e
(
boﬁón
 
show_gøphics_vÆ
,

11 
gr_automode_vÆ
,

12 
e_rouã_ty≥
 
rouã_ty≥
);

	@ezxml.c

26 #i‡
deföed
(
WIN32
Ë|| deföed(
_WIN32
)

27 
	~<io.h
>

29 #i‚de‡
EZXML_NOMMAP


30 
	#EZXML_NOMMAP


	)

34 
	~<°dlib.h
>

35 
	~<°dio.h
>

36 
	~<°d¨g.h
>

37 
	~<°rög.h
>

38 
	~<˘y≥.h
>

41 #i‡!
deföed
(
WIN32
Ë&& !deföed(
_WIN32
)

42 
	~<uni°d.h
>

45 
	~<sys/ty≥s.h
>

46 #i‚de‡
EZXML_NOMMAP


47 
	~<sys/mm™.h
>

49 
	~<sys/°©.h
>

50 
	~"ezxml.h
"

53 
	~"utû.h
"

56 #i‡
deföed
(
WIN32
Ë|| deföed(
_WIN32
)

57 
	#¢¥ötf
 
_¢¥ötf


	)

58 
	#›í
 
_›í


	)

59 
	#ªad
 
_ªad


	)

60 
	#wrôe
 
_wrôe


	)

61 
	#˛o£
 
_˛o£


	)

64 
	#EZXML_WS
 "\t\r\¿"

	)

65 
	#EZXML_ERRL
 128

	)

67 
ezxml_roŸ
 *
	tezxml_roŸ_t
;

68 
	sezxml_roŸ


70 
ezxml
 
	mxml
;

71 
ezxml_t
 
	mcur
;

72 *
	mm
;

73 
size_t
 
	mÀn
;

74 *
	mu
;

75 *
	ms
;

76 *
	me
;

77 **
	mít
;

78 ***
	m©å
;

79 ***
	mpi
;

80 
	m°™dÆ⁄e
;

81 
	mîr
[
EZXML_ERRL
];

84 *
	gEZXML_NIL
[] = { 
NULL
 };

87 
ezxml_t


88 
	$ezxml_chûd
(
ezxml_t
 
xml
,

89 c⁄° *
«me
)

91 
xml
 = (xmlË? xml->
chûd
 : 
NULL
;

92 
xml
 && 
	`°rcmp
(
«me
, xml->name))

93 
xml
 = xml->
siblög
;

94  
xml
;

95 
	}
}

99 
ezxml_t


100 
	$ezxml_idx
(
ezxml_t
 
xml
,

101 
idx
)

103 ; 
xml
 && 
idx
; idx--)

104 
xml
 = xml->
√xt
;

105  
xml
;

106 
	}
}

110 
	$ezxml_©å
(
ezxml_t
 
xml
,

111 c⁄° *
©å
)

113 
i
 = 0, 
j
 = 1;

114 
ezxml_roŸ_t
 
roŸ
 = (ezxml_roŸ_tË
xml
;

116 if(!
xml
 || !xml->
©å
)

117  
NULL
;

118 
xml
->
©å
[
i
] && 
	`°rcmp
(attr, xml->attr[i]))

119 
i
 += 2;

120 if(
xml
->
©å
[
i
])

121  
xml
->
©å
[
i
 + 1];

123 
roŸ
->
xml
.
∑ª¡
)

124 
roŸ
 = (
ezxml_roŸ_t
ËroŸ->
xml
.
∑ª¡
;

125 
i
 = 0; 
roŸ
->
©å
[i] && 
	`°rcmp
(
xml
->
«me
,Ñoot->attr[i][0]); i++);

126 if(!
roŸ
->
©å
[
i
])

127  
NULL
;

128 
roŸ
->
©å
[
i
][
j
] && 
	`°rcmp
(attr,Ñoot->attr[i][j]))

129 
j
 += 3;

130  (
roŸ
->
©å
[
i
][
j
]Ë?ÑoŸ->©å[i][j + 1] : 
NULL
;

131 
	}
}

134 
ezxml_t


135 
	$ezxml_vgë
(
ezxml_t
 
xml
,

136 
va_li°
 
≠
)

138 *
«me
 = 
	`va_¨g
(
≠
, *);

139 
idx
 = -1;

141 if(
«me
 && *name)

143 
idx
 = 
	`va_¨g
(
≠
, );

145 
xml
 = 
	`ezxml_chûd
(xml, 
«me
);

147  (
idx
 < 0Ë? 
xml
 : 
	`ezxml_vgë
(
	`ezxml_idx
(xml, idx), 
≠
);

148 
	}
}

156 
ezxml_t


157 
	$ezxml_gë
(
ezxml_t
 
xml
,

160 
va_li°
 
≠
;

161 
ezxml_t
 
r
;

163 
	`va_°¨t
(
≠
, 
xml
);

164 
r
 = 
	`ezxml_vgë
(
xml
, 
≠
);

165 
	`va_íd
(
≠
);

166  
r
;

167 
	}
}

172 
	$ezxml_pi
(
ezxml_t
 
xml
,

173 c⁄° *
èrgë
)

175 
ezxml_roŸ_t
 
roŸ
 = (ezxml_roŸ_tË
xml
;

176 
i
 = 0;

178 if(!
roŸ
)

179  (c⁄° **)
EZXML_NIL
;

180 
roŸ
->
xml
.
∑ª¡
)

181 
roŸ
 = (
ezxml_roŸ_t
ËroŸ->
xml
.
∑ª¡
;

182 
roŸ
->
pi
[
i
] && 
	`°rcmp
(
èrgë
,Ñoot->pi[i][0]))

183 
i
++;

184  (c⁄° **)((
roŸ
->
pi
[
i
]Ë?ÑoŸ->pi[i] + 1 : 
EZXML_NIL
);

185 
	}
}

188 
ezxml_t


189 
	$ezxml_îr
(
ezxml_roŸ_t
 
roŸ
,

190 *
s
,

191 c⁄° *
îr
,

194 
va_li°
 
≠
;

195 
löe
 = 1;

196 *
t
, 
fmt
[
EZXML_ERRL
];

198 
t
 = 
roŸ
->
s
;Å < s;Å++)

199 if(*
t
 == '\n')

200 
löe
++;

201 
	`¢¥ötf
(
fmt
, 
EZXML_ERRL
, "[îr‹Çó∏löê%d]: %s", 
löe
, 
îr
);

203 
	`va_°¨t
(
≠
, 
îr
);

204 
	`v¢¥ötf
(
roŸ
->
îr
, 
EZXML_ERRL
, 
fmt
, 
≠
);

205 
	`va_íd
(
≠
);

207  &
roŸ
->
xml
;

208 
	}
}

217 
	$ezxml_decode
(*
s
,

218 **
ít
,

219 
t
)

221 *
e
, *
r
 = 
s
, *
m
 = s;

222 
b
, 
c
, 
d
, 
l
;

224 ; *
s
; s++)

226 *
s
 == '\r')

228 *(
s
++) = '\n';

229 if(*
s
 == '\n')

230 
	`memmove
(
s
, (†+ 1), 
	`°æí
(s));

234 
s
 = 
r
;;)

236 *
s
 && *†!'&' && (*†!'%' || 
t
 !'%'Ë&& !
	`is•a˚
(*s))

237 
s
++;

239 if(!*
s
)

241 if(
t
 !'c' && !
	`°∫cmp
(
s
, "&#", 2))

243 if(
s
[2] == 'x')

244 
c
 = 
	`°πﬁ
(
s
 + 3, &
e
, 16);

246 
c
 = 
	`°πﬁ
(
s
 + 2, &
e
, 10);

247 if(!
c
 || *
e
 != ';')

249 
s
++;

253 if(
c
 < 0x80)

254 *(
s
++Ë
c
;

257 
b
 = 0, 
d
 = 
c
; d; d /= 2)

258 
b
++;

259 
b
 = (b - 2) / 5;

260 *(
s
++Ë(0xFF << (7 - 
b
)Ë| (
c
 >> (6 * b));

261 
b
)

262 *(
s
++Ë0x80 | ((
c
 >> (6 * --
b
)) & 0x3F);

265 
	`memmove
(
s
, 
	`°rchr
(s, ';'Ë+ 1, 
	`°æí
(strchr(s, ';')));

267 if((*
s
 ='&' && (
t
 == '&' ||Å == ' ' ||Å == '*'))

268 || (*
s
 ='%' && 
t
 == '%'))

270 
b
 = 0; 
ít
[b] && 
	`°∫cmp
(
s
 + 1,É¡[b], 
	`°æí
(ent[b])); b += 2);

272 if(
ít
[
b
++])

274 if((
c
 = 
	`°æí
(
ít
[
b
])Ë- 1 > (
e
 =

275 
	`°rchr
(
s
,

276 ';')Ë- 
s
)

278 
l
 = (
d
 = (
s
 - 
r
)Ë+ 
c
 + 
	`°æí
(
e
);

279 
r
 = (∏=
m
Ë? 
	`°r˝y
(
	`mÆloc
(
l
),

280 
r
Ë: 
	`ªÆloc
‘, 
l
);

281 
e
 = 
	`°rchr
((
s
 = 
r
 + 
d
), ';');

284 
	`memmove
(
s
 + 
c
, 
e
 + 1, 
	`°æí
(e));

285 
	`°∫˝y
(
s
, 
ít
[
b
], 
c
);

288 
s
++;

290 if((
t
 =' ' ||Å ='*'Ë&& 
	`is•a˚
(*
s
))

291 *(
s
++) = ' ';

293 
s
++;

296 if(
t
 == '*')

298 
s
 = 
r
; *s; s++)

301 
l
 = 
	`°r•n
(
s
, " ");

302 if(
l
)

303 
	`memmove
(
s
, s + 
l
, 
	`°æí
(s +Ü) + 1);

304 *
s
 && *s != ' ')

305 
s
++;

307 if(--
s
 >
r
 && *s == ' ')

308 *
s
 = '\0';

310  
r
;

311 
	}
}

315 
	$ezxml_›í_èg
(
ezxml_roŸ_t
 
roŸ
,

316 *
«me
,

317 **
©å
)

319 
ezxml_t
 
xml
 = 
roŸ
->
cur
;

321 if(
xml
->
«me
)

322 
xml
 = 
	`ezxml_add_chûd
(xml, 
«me
, 
	`°æí
(xml->
txt
));

324 
xml
->
«me
 =Çame;

326 
xml
->
©å
 =áttr;

327 
roŸ
->
cur
 = 
xml
;

328 
	}
}

332 
	$ezxml_ch¨_c⁄ã¡
(
ezxml_roŸ_t
 
roŸ
,

333 *
s
,

334 
size_t
 
Àn
,

335 
t
)

337 
ezxml_t
 
xml
 = 
roŸ
->
cur
;

338 *
m
 = 
s
;

339 
size_t
 
l
;

341 if(!
xml
 || !xml->
«me
 || !
Àn
)

344 
s
[
Àn
] = '\0';

345 
Àn
 = 
	`°æí
(
s
 = 
	`ezxml_decode
(s, 
roŸ
->
ít
, 
t
)) + 1;

347 if(!*(
xml
->
txt
))

348 
xml
->
txt
 = 
s
;

351 
xml
->
txt
 = (xml->
Êags
 & 
EZXML_TXTM
)

352 ? 
	`ªÆloc
(
xml
->
txt
, (
l
 = 
	`°æí
(xml->txt)Ë+ 
Àn
)

353 : 
	`°r˝y
(
	`mÆloc
((
l
 = 
	`°æí
(
xml
->
txt
)Ë+ 
Àn
), xml->txt);

354 
	`°r˝y
(
xml
->
txt
 + 
l
, 
s
);

355 if(
s
 !
m
)

356 
	`‰ì
(
s
);

359 if(
xml
->
txt
 !
m
)

360 
	`ezxml_£t_Êag
(
xml
, 
EZXML_TXTM
);

361 
	}
}

364 
ezxml_t


365 
	$ezxml_˛o£_èg
(
ezxml_roŸ_t
 
roŸ
,

366 *
«me
,

367 *
s
)

369 if(!
roŸ
->
cur
 || !roŸ->cur->
«me
 || 
	`°rcmp
(name,Ñoot->cur->name))

370  
	`ezxml_îr
(
roŸ
, 
s
, "u√x≥˘ed closögÅag </%s>", 
«me
);

372 
roŸ
->
cur
 =ÑoŸ->cur->
∑ª¡
;

373  
NULL
;

374 
	}
}

379 
	$ezxml_ít_ok
(*
«me
,

380 *
s
,

381 **
ít
)

383 
i
;

385 ;; 
s
++)

387 *
s
 && *s != '&')

388 
s
++;

389 if(!*
s
)

391 if(!
	`°∫cmp
(
s
 + 1, 
«me
, 
	`°æí
(name)))

393 
i
 = 0; 
ít
[i] && 
	`°∫cmp
”¡[i], 
s
 + 1, 
	`°æí
(ent[i]));

394 
i
 += 2);

395 if(
ít
[
i
] && !
	`ezxml_ít_ok
(
«me
,Ént[i + 1],Ént))

398 
	}
}

402 
	$ezxml_¥oc_ö°
(
ezxml_roŸ_t
 
roŸ
,

403 *
s
,

404 
size_t
 
Àn
)

406 
i
 = 0, 
j
 = 1;

407 *
èrgë
 = 
s
;

409 
s
[
Àn
] = '\0';

410 if(*(
s
 +
	`°rc•n
(s, 
EZXML_WS
)))

412 *
s
 = '\0';

413 
s
 +
	`°r•n
(†+ 1, 
EZXML_WS
) + 1;

416 if(!
	`°rcmp
(
èrgë
, "xml"))

419 
s
 = 
	`°r°r
(s, "standalone");

420 if(
s
 && !
	`°∫cmp
(†+ 
	`°r•n
(s + 10,

421 
EZXML_WS
 "='\"") + 10, "yes", 3))

422 
roŸ
->
°™dÆ⁄e
 = 1;

426 if(!
roŸ
->
pi
[0])

427 *(
roŸ
->
pi
 = 
	`mÆloc
((**))Ë
NULL
;

429 
roŸ
->
pi
[
i
] && 
	`°rcmp
(
èrgë
,Ñoot->pi[i][0]))

430 
i
++;

431 if(!
roŸ
->
pi
[
i
])

433 
roŸ
->
pi
 = 
	`ªÆloc
‘oŸ->pi, (**Ë* (
i
 + 2));

434 
roŸ
->
pi
[
i
] = 
	`mÆloc
((*) * 3);

435 
roŸ
->
pi
[
i
][0] = 
èrgë
;

436 
roŸ
->
pi
[
i
][1] = (*)‘oŸ->pi[ò+ 1] = 
NULL
);

438 
roŸ
->
pi
[
i
][2] = 
	`my_°rdup
("");

441 
roŸ
->
pi
[
i
][
j
])

442 
j
++;

443 
roŸ
->
pi
[
i
] = 
	`ªÆloc
‘oŸ->pi[i], (*Ë* (
j
 + 3));

444 
roŸ
->
pi
[
i
][
j
 + 2] = 
	`ªÆloc
(root->pi[i][j + 1], j + 1);

445 
	`°r˝y
(
roŸ
->
pi
[
i
][
j
 + 2] + j - 1, (roŸ->
xml
.
«me
) ? ">" : "<");

446 
roŸ
->
pi
[
i
][
j
 + 1] = 
NULL
;

447 
roŸ
->
pi
[
i
][
j
] = 
s
;

448 
	}
}

452 
	$ezxml_öã∫Æ_dtd
(
ezxml_roŸ_t
 
roŸ
,

453 *
s
,

454 
size_t
 
Àn
)

456 
q
, *
c
, *
t
, *
n
 = 
NULL
, *
v
, **
ít
, **
≥
;

457 
i
, 
j
;

459 
≥
 = 
	`mem˝y
(
	`mÆloc
((
EZXML_NIL
)), EZXML_NIL, (EZXML_NIL));

461 
s
[
Àn
] = '\0'; s;)

463 *
s
 && *s != '<' && *s != '%')

464 
s
++;

466 if(!*
s
)

468 if(!
	`°∫cmp
(
s
, "<!ENTITY", 8))

470 
c
 = 
s
 +
	`°r•n
(†+ 8, 
EZXML_WS
) + 8;

471 
n
 = 
s
 + 
	`°r•n
(s, 
EZXML_WS
 "%");

472 *(
s
 = 
n
 + 
	`°rc•n
“, 
EZXML_WS
)) = ';';

474 
v
 = 
s
 + 
	`°r•n
(†+ 1, 
EZXML_WS
) + 1;

475 if((
q
 = *(
v
++)) != '"' && q != '\'')

477 
s
 = 
	`°rchr
(s, '>');

481 
i
 = 0, 
ít
 = (*
c
 ='%'Ë? 
≥
 : 
roŸ
->ent;Ént[i];

482 
i
++);

483 
ít
 = 
	`ªÆloc
”¡, (
i
 + 3) * (*));

484 if(*
c
 == '%')

485 
≥
 = 
ít
;

487 
roŸ
->
ít
 =Ént;

489 *(++
s
) = '\0';

491 
s
 = 
	`°rchr
(
v
, 
q
);

492 if(
s
)

493 *(
s
++) = '\0';

494 
ít
[
i
 + 1] = 
	`ezxml_decode
(
v
, 
≥
, '%');

495 
ít
[
i
 + 2] = 
NULL
;

496 if(!
	`ezxml_ít_ok
(
n
, 
ít
[
i
 + 1],Ént))

498 if(
ít
[
i
 + 1] !
v
)

499 
	`‰ì
(
ít
[
i
 + 1]);

500 
	`ezxml_îr
(
roŸ
, 
v
,

501 "cúcuœ∏ítôy de˛¨©i⁄ &%s", 
n
);

505 
ít
[
i
] = 
n
;

507 if(!
	`°∫cmp
(
s
, "<!ATTLIST", 9))

509 
t
 = 
s
 + 
	`°r•n
(†+ 9, 
EZXML_WS
) + 9;

510 if(!*
t
)

512 
	`ezxml_îr
(
roŸ
, 
t
, "unclosed <!ATTLIST");

515 if(*(
s
 = 
t
 + 
	`°rc•n
—, 
EZXML_WS
 ">")) == '>')

518 *
s
 = '\0';

519 
i
 = 0; 
roŸ
->
©å
[i] && 
	`°rcmp
(
n
,Ñoot->attr[i][0]);

520 
i
++);

522 *(
n
 = ++
s
 + 
	`°r•n
(s, 
EZXML_WS
)) && *n != '>')

524 if(*(
s
 = 
n
 + 
	`°rc•n
“, 
EZXML_WS
)))

525 *
s
 = '\0';

528 
	`ezxml_îr
(
roŸ
, 
t
, "malformed <!ATTLIST");

532 
s
 +
	`°r•n
(†+ 1, 
EZXML_WS
) + 1;

533 
c
 = (
	`°∫cmp
(
s
, "CDATA", 5)) ? "*" : " ";

534 if(!
	`°∫cmp
(
s
, "NOTATION", 8))

535 
s
 +
	`°r•n
(†+ 8, 
EZXML_WS
) + 8;

536 
s
 = (*†='('Ë? 
	`°rchr
(s, ')'Ë: s + 
	`°rc•n
(s,

537 
EZXML_WS
);

538 if(!
s
)

540 
	`ezxml_îr
(
roŸ
, 
t
, "malformed <!ATTLIST");

544 
s
 +
	`°r•n
(s, 
EZXML_WS
 ")");

545 if(!
	`°∫cmp
(
s
, "#FIXED", 6))

546 
s
 +
	`°r•n
(†+ 6, 
EZXML_WS
) + 6;

547 if(*
s
 == '#')

549 
s
 +
	`°rc•n
(s, 
EZXML_WS
 ">") - 1;

550 if(*
c
 == ' ')

552 
v
 = 
NULL
;

557 
s
 = 
	`°rchr
(
v
 = s + 1, *s);

558 if((*
s
 == '"' || *s == '\'') &&

559 
s
)

560 *
s
 = '\0';

563 
	`ezxml_îr
(
roŸ
, 
t
,

569 if(!
roŸ
->
©å
[
i
])

571 
roŸ
->
©å
 =

572 (!
i
Ë? 
	`mÆloc
(2 *

574 
	`ªÆloc
(
roŸ
->
©å
,

575 (
i
 + 2) * (**));

576 
roŸ
->
©å
[
i
] =

577 
	`mÆloc
(2 * (*));

578 
roŸ
->
©å
[
i
][0] = 
t
;

579 
roŸ
->
©å
[
i
][1] =

580 (*)(
roŸ
->
©å
[
i
 + 1] = 
NULL
);

583 
j
 = 1; 
roŸ
->
©å
[
i
][j]; j += 3);

584 
roŸ
->
©å
[
i
] = 
	`ªÆloc
(root->attr[i],

585 (
j
 + 4) * (*));

587 
roŸ
->
©å
[
i
][
j
 + 3] = 
NULL
;

588 
roŸ
->
©å
[
i
][
j
 + 2] = 
c
;

589 
roŸ
->
©å
[
i
][
j
 + 1] =

590 (
v
Ë? 
	`ezxml_decode
(v, 
roŸ
->
ít
, *
c
Ë: 
NULL
;

591 
roŸ
->
©å
[
i
][
j
] = 
n
;

594 if(!
	`°∫cmp
(
s
, "<!--", 4))

595 
s
 = 
	`°r°r
(s + 4, "-->");

596 if(!
	`°∫cmp
(
s
, "<?", 2))

599 
s
 = 
	`°r°r
(
c
 = s + 2, "?>");

600 if(
s
)

601 
	`ezxml_¥oc_ö°
(
roŸ
, 
c
, 
s
++ - c);

603 if(*
s
 == '<')

604 
s
 = 
	`°rchr
(s, '>');

605 if(*(
s
++Ë='%' && !
roŸ
->
°™dÆ⁄e
)

609 
	`‰ì
(
≥
);

610  !*
roŸ
->
îr
;

611 
	}
}

616 
	$ezxml_°r2utf8
(**
s
,

617 
size_t
 * 
Àn
)

619 *
u
;

620 
size_t
 
l
 = 0, 
¶
, 
max
 = *
Àn
;

621 
c
, 
d
;

622 
b
, 
be
 = (**
s
 == '\xFE') ? 1 : (**s == '\xFF') ? 0 : -1;

624 if(
be
 == -1)

625  
NULL
;

627 
u
 = 
	`mÆloc
(
max
);

628 
¶
 = 2; s»< *
Àn
 - 1; sl += 2)

630 
c
 = (
be
Ë? (((*
s
)[
¶
] & 0xFF) << 8) | ((*s)[sl + 1] & 0xFF)

631 : (((*
s
)[
¶
 + 1] & 0xFF) << 8) | ((*s)[sl] & 0xFF);

632 if(
c
 >0xD800 && c <0xDFFF && (
¶
 +2Ë< *
Àn
 - 1)

634 
d
 = (
be
Ë? (((*
s
)[
¶
] & 0xFF) << 8) | ((*s)[sl + 1] &

636 : (((*
s
)[
¶
 + 1] & 0xFF) << 8) | ((*s)[sl] & 0xFF);

637 
c
 = (((¯& 0x3FFË<< 10Ë| (
d
 & 0x3FF)) + 0x10000;

640 
l
 + 6 > 
max
)

641 
u
 = 
	`ªÆloc
(u, 
max
 +
EZXML_BUFSIZE
);

642 if(
c
 < 0x80)

643 
u
[
l
++] = 
c
;

646 
b
 = 0, 
d
 = 
c
; d; d /= 2)

647 
b
++;

648 
b
 = (b - 2) / 5;

649 
u
[
l
++] = (0xFF << (7 - 
b
)Ë| (
c
 >> (6 * b));

650 
b
)

651 
u
[
l
++] = 0x80 | ((
c
 >> (6 * --
b
)) & 0x3F);

654  *
s
 = 
	`ªÆloc
(
u
, *
Àn
 = 
l
);

655 
	}
}

659 
	$ezxml_‰ì_©å
(**
©å
)

661 
i
 = 0;

662 *
m
;

664 if(!
©å
 ||áâ∏=
EZXML_NIL
)

666 
©å
[
i
])

667 
i
 += 2;

668 
m
 = 
©å
[
i
 + 1];

669 
i
 = 0; 
m
[i]; i++)

671 if(
m
[
i
] & 
EZXML_NAMEM
)

672 
	`‰ì
(
©å
[
i
 * 2]);

673 if(
m
[
i
] & 
EZXML_TXTM
)

674 
	`‰ì
(
©å
[(
i
 * 2) + 1]);

676 
	`‰ì
(
m
);

677 
	`‰ì
(
©å
);

678 
	}
}

681 
ezxml_t


682 
	$ezxml_∑r£_°r
(*
s
,

683 
size_t
 
Àn
)

685 
ezxml_roŸ_t
 
roŸ
 = (ezxml_roŸ_tË
	`ezxml_√w
(
NULL
);

686 
q
, 
e
, *
d
, **
©å
, **
a
 = 
NULL
;

687 
l
, 
i
, 
j
;

689 
roŸ
->
m
 = 
s
;

690 if(!
Àn
)

691  
	`ezxml_îr
(
roŸ
, 
NULL
, "rootÅag missing");

692 
roŸ
->
u
 = 
	`ezxml_°r2utf8
(&
s
, &
Àn
);

693 
roŸ
->
e
 = (roŸ->
s
 = sË+ 
Àn
;

695 
e
 = 
s
[
Àn
 - 1];

696 
s
[
Àn
 - 1] = '\0';

698 *
s
 && *s != '<')

699 
s
++;

700 if(!*
s
)

701  
	`ezxml_îr
(
roŸ
, 
s
, "rootÅag missing");

705 
©å
 = (**)
EZXML_NIL
;

706 
d
 = ++
s
;

708 if(
	`ißÕha
(*
s
) || *s == '_' || *s == ':' || *s < '\0')

710 if(!
roŸ
->
cur
)

711  
	`ezxml_îr
(
roŸ
, 
d
,

714 
s
 +
	`°rc•n
(s, 
EZXML_WS
 "/>");

715 
	`is•a˚
(*
s
))

716 *(
s
++) = '\0';

718 if(*
s
 && *s != '/' && *s != '>')

721 
a
 = 
roŸ
->
©å
[0];

722 
i
 = 0; 
a
 && 
	`°rcmp
◊[0], 
d
); i++)

724 
a
 = 
roŸ
->
©å
[
i
];

728 
l
 = 0; *
s
 && *s != '/' && *s != '>';Ü += 2)

730 
©å
 = (
l
Ë? 
	`ªÆloc
◊âr, (»+ 4Ë* (*)Ë: 
	`mÆloc
(4 * (*));

731 
©å
[
l
 + 3] = (lË? 
	`ªÆloc
◊âr[»+ 1], (»/ 2Ë+ 2Ë: 
	`mÆloc
(2);

732 
	`°r˝y
(
©å
[
l
 + 3] + (l / 2), " ");

733 
©å
[
l
 + 2] = 
NULL
;

734 
©å
[
l
 + 1] = "";

735 
©å
[
l
] = 
s
;

737 
s
 +
	`°rc•n
(s, 
EZXML_WS
 "=/>");

738 if(*
s
 ='=' || 
	`is•a˚
(*s))

740 *(
s
++) = '\0';

741 
q
 = *(
s
 +
	`°r•n
(s, 
EZXML_WS
 "="));

742 if(
q
 == '"' || q == '\'')

744 
©å
[
l
 + 1] = ++
s
;

745 *
s
 && *†!
q
)

746 
s
++;

747 if(*
s
)

748 *(
s
++) = '\0';

751 
	`ezxml_‰ì_©å
(
©å
);

752  
	`ezxml_îr
(
roŸ
, 
d
,

754 
q
);

757 
j
 = 1; 
a
 &&á[j]

758 && 
	`°rcmp
(
a
[
j
], 
©å
[
l
]);

759 
j
 += 3);

760 
©å
[
l
 + 1] =

761 
	`ezxml_decode
(
©å
[
l
 + 1],

762 
roŸ
->
ít
, (
a


764 
a
[
j
])

765 ? *
a
[
j
 +

767 if(
©å
[
l
 + 1] < 
d


768 || 
©å
[
l
 + 1] > 
s
)

769 
©å
[
l
 + 3][»/ 2] = 
EZXML_TXTM
;

772 
	`is•a˚
(*
s
))

773 
s
++;

776 if(*
s
 == '/')

778 *(
s
++) = '\0';

779 if((*
s
 && *†!'>'Ë|| (!*†&& 
e
 != '>'))

781 if(
l
)

782 
	`ezxml_‰ì_©å
(
©å
);

783  
	`ezxml_îr
(
roŸ
, 
d
, "missing >");

785 
	`ezxml_›í_èg
(
roŸ
, 
d
, 
©å
);

786 
	`ezxml_˛o£_èg
(
roŸ
, 
d
, 
s
);

788 if((
q
 = *
s
Ë='>' || (!*†&& 
e
 == '>'))

790 *
s
 = '\0';

791 
	`ezxml_›í_èg
(
roŸ
, 
d
, 
©å
);

792 *
s
 = 
q
;

796 if(
l
)

797 
	`ezxml_‰ì_©å
(
©å
);

798  
	`ezxml_îr
(
roŸ
, 
d
, "missing >");

801 if(*
s
 == '/')

803 
s
 +
	`°rc•n
(
d
 = s + 1, 
EZXML_WS
 ">") + 1;

805 
q
 = *
s
;

806 if(!
q
 && 
e
 != '>')

807  
	`ezxml_îr
(
roŸ
, 
d
, "missing >");

808 *
s
 = '\0';

809 if(
	`ezxml_˛o£_èg
(
roŸ
, 
d
, 
s
))

810  &
roŸ
->
xml
;

811 if(
	`is•a˚
(*
s
 = 
q
))

812 
s
 +
	`°r•n
(s, 
EZXML_WS
);

814 if(!
	`°∫cmp
(
s
, "!--", 3))

816 
s
 = 
	`°r°r
(s + 3, "--");

817 if(!
s
 || (*(†+2Ë!'>' && *sË|| (!*†&& 
e
 != '>'))

818  
	`ezxml_îr
(
roŸ
, 
d
, "unclosed <!--");

820 if(!
	`°∫cmp
(
s
, "![CDATA[", 8))

823 
s
 = 
	`°r°r
(s, "]]>");

824 if(
s
)

825 
	`ezxml_ch¨_c⁄ã¡
(
roŸ
, 
d
 + 8, (
s
 += 2) - d - 10,

828  
	`ezxml_îr
(
roŸ
, 
d
, "unclosed <![CDATA[");

830 if(!
	`°∫cmp
(
s
, "!DOCTYPE", 8))

832 
l
 = 0; *
s
 && ((!l && *s != '>') || (l && (*s != ']' ||

833 *(
s
 +

834 
	`°r•n
(
s
 +

836 
EZXML_WS
)

839 
l
 = (*
s
 == '[') ? 1 :Ü)

840 
s
 +
	`°rc•n
(s + 1, "[]>") + 1;

841 if(!*
s
 && 
e
 != '>')

842  
	`ezxml_îr
(
roŸ
, 
d
, "unclosed <!DOCTYPE");

843 
d
 = (
l
Ë? 
	`°rchr
(d, '[') + 1 : d;

844 if(
l
 && !
	`ezxml_öã∫Æ_dtd
(
roŸ
, 
d
, 
s
++ - d))

845  &
roŸ
->
xml
;

847 if(*
s
 == '?')

851 
s
 = 
	`°rchr
(s, '?');

853 
s
 && *(++s) && *s != '>');

854 if(!
s
 || (!*†&& 
e
 != '>'))

855  
	`ezxml_îr
(
roŸ
, 
d
, "unclosed <?");

857 
	`ezxml_¥oc_ö°
(
roŸ
, 
d
 + 1, 
s
 - d - 2);

860  
	`ezxml_îr
(
roŸ
, 
d
, "unexpected <");

862 if(!
s
 || !*s)

864 *
s
 = '\0';

865 
d
 = ++
s
;

866 if(*
s
 && *s != '<')

868 *
s
 && *s != '<')

869 
s
++;

870 if(*
s
)

871 
	`ezxml_ch¨_c⁄ã¡
(
roŸ
, 
d
, 
s
 - d, '&');

875 if(!*
s
)

879 if(!
roŸ
->
cur
)

880  &
roŸ
->
xml
;

881 if(!
roŸ
->
cur
->
«me
)

882  
	`ezxml_îr
(
roŸ
, 
d
, "rootÅag missing");

884  
	`ezxml_îr
(
roŸ
, 
d
, "un˛o£dÅag <%s>",ÑoŸ->
cur
->
«me
);

885 
	}
}

890 
ezxml_t


891 
	$ezxml_∑r£_Â
(
FILE
 * 
Â
)

893 
ezxml_roŸ_t
 
roŸ
;

894 
size_t
 
l
, 
Àn
 = 0;

895 *
s
;

898 
s
 = 
	`mÆloc
(
EZXML_BUFSIZE
);

899 if(!
s
)

900  
NULL
;

903 
Àn
 +(
l
 = 
	`‰ód
((
s
 +Üí), 1, 
EZXML_BUFSIZE
, 
Â
));

904 if(
l
 =
EZXML_BUFSIZE
)

905 
s
 = 
	`ªÆloc
(s, 
Àn
 + 
EZXML_BUFSIZE
);

907 
s
 && 
l
 =
EZXML_BUFSIZE
);

909 if(!
s
)

910  
NULL
;

911 
roŸ
 = (
ezxml_roŸ_t
Ë
	`ezxml_∑r£_°r
(
s
, 
Àn
);

913 
roŸ
->
Àn
 = (
size_t
) (-1);

914  &
roŸ
->
xml
;

915 
	}
}

920 
ezxml_t


921 
	$ezxml_∑r£_fd
(
fd
)

923 
ezxml_roŸ_t
 
roŸ
;

924 
°©
 
°
;

925 
size_t
 
l
;

926 *
m
;

928 if(
fd
 < 0)

929  
NULL
;

930 
	`f°©
(
fd
, &
°
);

932 #i‚de‡
EZXML_NOMMAP


933 
l
 = (
°
.
°_size
 + 
	`sysc⁄f
(
_SC_PAGESIZE
) -

934 1Ë& ~(
	`sysc⁄f
(
_SC_PAGESIZE
) - 1);

935 if((
m
 =

936 
	`mm≠
(
NULL
, 
l
, 
PROT_READ
 | 
PROT_WRITE
, 
MAP_PRIVATE
, 
fd
,

937 0)Ë!
MAP_FAILED
)

939 
	`madvi£
(
m
, 
l
, 
MADV_SEQUENTIAL
);

940 
roŸ
 = (
ezxml_roŸ_t
Ë
	`ezxml_∑r£_°r
(
m
, 
°
.
°_size
);

941 
	`madvi£
(
m
, 
roŸ
->
Àn
 = 
l
, 
MADV_NORMAL
);

946 
l
 = 
	`ªad
(
fd
, 
m
 = 
	`mÆloc
(
°
.
°_size
), st.st_size);

947 
roŸ
 = (
ezxml_roŸ_t
Ë
	`ezxml_∑r£_°r
(
m
, 
l
);

949 
roŸ
->
Àn
 = (
size_t
) (-1);

950 #i‚de‡
EZXML_NOMMAP


953  &
roŸ
->
xml
;

954 
	}
}

957 
ezxml_t


958 
	$ezxml_∑r£_fûe
(c⁄° *
fûe
)

960 
fd
 = 
	`›í
(
fûe
, 
O_RDONLY
, 0);

961 
ezxml_t
 
xml
 = 
	`ezxml_∑r£_fd
(
fd
);

963 if(
fd
 >= 0)

964 
	`˛o£
(
fd
);

965  
xml
;

966 
	}
}

971 
	$ezxml_am≥ncode
(c⁄° *
s
,

972 
size_t
 
Àn
,

973 **
d°
,

974 
size_t
 * 
dÀn
,

975 
size_t
 * 
max
,

976 
a
)

978 c⁄° *
e
;

980 
e
 = 
s
 + 
Àn
; s !=É; s++)

982 *
dÀn
 + 10 > *
max
)

983 *
d°
 = 
	`ªÆloc
(*d°, *
max
 +
EZXML_BUFSIZE
);

985 *
s
)

988  *
d°
;

990 *
dÀn
 +
	`•rötf
(*
d°
 + *dlen, "&amp;");

993 *
dÀn
 +
	`•rötf
(*
d°
 + *dlen, "&lt;");

996 *
dÀn
 +
	`•rötf
(*
d°
 + *dlen, "&gt;");

999 *
dÀn
 +
	`•rötf
(*
d°
 + *dÀn, (
a
) ? "&quot;" : "\"");

1002 *
dÀn
 +
	`•rötf
(*
d°
 + *dÀn, (
a
) ? "&#xA;" : "\n");

1005 *
dÀn
 +
	`•rötf
(*
d°
 + *dÀn, (
a
) ? "&#x9;" : "\t");

1008 *
dÀn
 +
	`•rötf
(*
d°
 + *dlen, "&#xD;");

1011 (*
d°
)[(*
dÀn
)++] = *
s
;

1014  *
d°
;

1015 
	}
}

1021 
	$ezxml_toxml_r
(
ezxml_t
 
xml
,

1022 **
s
,

1023 
size_t
 * 
Àn
,

1024 
size_t
 * 
max
,

1025 
size_t
 
°¨t
,

1026 ***
©å
)

1028 
i
, 
j
;

1029 *
txt
 = (
xml
->
∑ª¡
) ? xml->parent->txt : "";

1030 
size_t
 
off
 = 0;

1033 *
s
 = 
	`ezxml_am≥ncode
(
txt
 + 
°¨t
, 
xml
->
off
 - sèπ, s, 
Àn
, 
max
, 0);

1035 *
Àn
 + 
	`°æí
(
xml
->
«me
Ë+ 4 > *
max
)

1036 *
s
 = 
	`ªÆloc
(*s, *
max
 +
EZXML_BUFSIZE
);

1038 *
Àn
 +
	`•rötf
(*
s
 + *Àn, "<%s", 
xml
->
«me
);

1039 
i
 = 0; 
xml
->
©å
[i]; i += 2)

1041 if(
	`ezxml_©å
(
xml
, xml->
©å
[
i
]) != xml->attr[i + 1])

1043 *
Àn
 + 
	`°æí
(
xml
->
©å
[
i
]Ë+ 7 > *
max
)

1044 *
s
 = 
	`ªÆloc
(*s, *
max
 +
EZXML_BUFSIZE
);

1046 *
Àn
 +
	`•rötf
(*
s
 + *Àn, " %s=\"", 
xml
->
©å
[
i
]);

1048 
	`ezxml_am≥ncode
(
xml
->
©å
[
i
 + 1], (
size_t
Ë(-1), 
s
, 
Àn
, 
max
, 1);

1049 *
Àn
 +
	`•rötf
(*
s
 + *len, "\"");

1052 
i
 = 0; 
©å
[i] && 
	`°rcmp
◊âr[i][0], 
xml
->
«me
); i++);

1053 
j
 = 1; 
©å
[
i
] &&áttr[i][j]; j += 3)

1055 if(!
©å
[
i
][
j
 + 1]

1056 || 
	`ezxml_©å
(
xml
, 
©å
[
i
][
j
]) !=áttr[i][j + 1])

1058 *
Àn
 + 
	`°æí
(
©å
[
i
][
j
]Ë+ 7 > *
max
)

1059 *
s
 = 
	`ªÆloc
(*s, *
max
 +
EZXML_BUFSIZE
);

1061 *
Àn
 +
	`•rötf
(*
s
 + *Àn, " %s=\"", 
©å
[
i
][
j
]);

1063 
	`ezxml_am≥ncode
(
©å
[
i
][
j
 + 1], (
size_t
Ë(-1), 
s
, 
Àn
, 
max
, 1);

1064 *
Àn
 +
	`•rötf
(*
s
 + *len, "\"");

1066 *
Àn
 +
	`•rötf
(*
s
 + *len, ">");

1069 *
s
 = (
xml
->
chûd
Ë? 
	`ezxml_toxml_r
(xml->chûd, s, 
Àn
, 
max
, 0, 
©å
)

1070 : 
	`ezxml_am≥ncode
(
xml
->
txt
, (
size_t
Ë(-1), 
s
, 
Àn
, 
max
, 0);

1072 *
Àn
 + 
	`°æí
(
xml
->
«me
Ë+ 4 > *
max
)

1073 *
s
 = 
	`ªÆloc
(*s, *
max
 +
EZXML_BUFSIZE
);

1075 *
Àn
 +
	`•rötf
(*
s
 + *Àn, "</%s>", 
xml
->
«me
);

1077 
txt
[
off
] && of‡< 
xml
->off)

1078 
off
++;

1080  (
xml
->
‹dîed
Ë? 
	`ezxml_toxml_r
(xml->‹dîed, 
s
, 
Àn
, 
max
, 
off
,

1081 
©å
Ë: 
	`ezxml_am≥ncode
(
txt
 +

1082 
off
,

1083 (
size_t
)

1084 (-1), 
s
,

1085 
Àn
, 
max
,

1087 
	}
}

1092 
	$ezxml_toxml
(
ezxml_t
 
xml
)

1094 
ezxml_t
 
p
 = (
xml
Ë? xml->
∑ª¡
 : 
NULL
,

1095 
o
 = (
xml
Ë? xml->
‹dîed
 : 
NULL
;

1096 
ezxml_roŸ_t
 
roŸ
 = (ezxml_roŸ_tË
xml
;

1097 
size_t
 
Àn
 = 0, 
max
 = 
EZXML_BUFSIZE
;

1098 *
s
 = 
	`°r˝y
(
	`mÆloc
(
max
), ""),

1099 *
t
,

1100 *
n
;

1101 
i
, 
j
, 
k
;

1103 if(!
xml
 || !xml->
«me
)

1104  
	`ªÆloc
(
s
, 
Àn
 + 1);

1105 
roŸ
->
xml
.
∑ª¡
)

1106 
roŸ
 = (
ezxml_roŸ_t
ËroŸ->
xml
.
∑ª¡
;

1108 
i
 = 0; !
p
 && 
roŸ
->
pi
[i]; i++)

1110 
k
 = 2; 
roŸ
->
pi
[
i
][k - 1]; k++);

1111 
j
 = 1; 
roŸ
->
pi
[
i
][j]; j++)

1114 
n
 = 
roŸ
->
pi
[
i
][
j
];

1115 if(
roŸ
->
pi
[
i
][
k
][
j
 - 1] == '>')

1117 
Àn
 + 
	`°æí
(
t
 = 
roŸ
->
pi
[
i
][0]Ë+ såÀn(
n
) + 7 >

1118 
max
)

1119 
s
 = 
	`ªÆloc
(s, 
max
 +
EZXML_BUFSIZE
);

1120 
Àn
 +=

1121 
	`•rötf
(
s
 + 
Àn
, "<?%s%s%s?>\n", 
t
, *
n
 ? " " : "",Ç);

1125 
xml
->
∑ª¡
 = xml->
‹dîed
 = 
NULL
;

1126 
s
 = 
	`ezxml_toxml_r
(
xml
, &s, &
Àn
, &
max
, 0, 
roŸ
->
©å
);

1127 
xml
->
∑ª¡
 = 
p
;

1128 
xml
->
‹dîed
 = 
o
;

1130 
i
 = 0; !
p
 && 
roŸ
->
pi
[i]; i++)

1132 
k
 = 2; 
roŸ
->
pi
[
i
][k - 1]; k++);

1133 
j
 = 1; 
roŸ
->
pi
[
i
][j]; j++)

1136 
n
 = 
roŸ
->
pi
[
i
][
j
];

1137 if(
roŸ
->
pi
[
i
][
k
][
j
 - 1] == '<')

1139 
Àn
 + 
	`°æí
(
t
 = 
roŸ
->
pi
[
i
][0]Ë+ såÀn(
n
) + 7 >

1140 
max
)

1141 
s
 = 
	`ªÆloc
(s, 
max
 +
EZXML_BUFSIZE
);

1142 
Àn
 +=

1143 
	`•rötf
(
s
 + 
Àn
, "\n<?%s%s%s?>", 
t
, *
n
 ? " " : "",Ç);

1146  
	`ªÆloc
(
s
, 
Àn
 + 1);

1147 
	}
}

1151 
	$ezxml_‰ì
(
ezxml_t
 
xml
)

1153 
ezxml_roŸ_t
 
roŸ
 = (ezxml_roŸ_tË
xml
;

1154 
i
, 
j
;

1155 **
a
, *
s
;

1157 if(!
xml
)

1159 
	`ezxml_‰ì
(
xml
->
chûd
);

1160 
	`ezxml_‰ì
(
xml
->
‹dîed
);

1162 if(!
xml
->
∑ª¡
)

1164 
i
 = 10; 
roŸ
->
ít
[i]; i += 2)

1165 if((
s
 = 
roŸ
->
ít
[
i
 + 1]Ë<ÑoŸ->†|| s >ÑoŸ->
e
)

1166 
	`‰ì
(
s
);

1167 
	`‰ì
(
roŸ
->
ít
);

1169 
i
 = 0; 
roŸ
->
©å
[i]; i++)

1172 
a
 = 
roŸ
->
©å
[
i
];

1173 
j
 = 1; 
a
[j++]; j += 2)

1174 if(
a
[
j
] && (a[j] < 
roŸ
->
s
 ||á[j] >ÑoŸ->
e
))

1175 
	`‰ì
(
a
[
j
]);

1176 
	`‰ì
(
a
);

1178 if(
roŸ
->
©å
[0])

1179 
	`‰ì
(
roŸ
->
©å
);

1181 
i
 = 0; 
roŸ
->
pi
[i]; i++)

1183 
j
 = 1; 
roŸ
->
pi
[
i
][j]; j++);

1184 
	`‰ì
(
roŸ
->
pi
[
i
][
j
 + 1]);

1185 
	`‰ì
(
roŸ
->
pi
[
i
]);

1187 if(
roŸ
->
pi
[0])

1188 
	`‰ì
(
roŸ
->
pi
);

1190 if(
roŸ
->
Àn
 == -1)

1191 
	`‰ì
(
roŸ
->
m
);

1192 #i‚de‡
EZXML_NOMMAP


1193 if(
roŸ
->
Àn
)

1194 
	`munm≠
(
roŸ
->
m
,ÑoŸ->
Àn
);

1196 if(
roŸ
->
u
)

1197 
	`‰ì
(
roŸ
->
u
);

1200 
	`ezxml_‰ì_©å
(
xml
->
©å
);

1201 if((
xml
->
Êags
 & 
EZXML_TXTM
))

1202 
	`‰ì
(
xml
->
txt
);

1203 if((
xml
->
Êags
 & 
EZXML_NAMEM
))

1204 
	`‰ì
(
xml
->
«me
);

1205 
	`‰ì
(
xml
);

1206 
	}
}

1210 
	$ezxml_îr‹
(
ezxml_t
 
xml
)

1212 
xml
 && xml->
∑ª¡
)

1213 
xml
 = xml->
∑ª¡
;

1214  (
xml
Ë? ((
ezxml_roŸ_t
Ëxml)->
îr
 : "";

1215 
	}
}

1218 
ezxml_t


1219 
	$ezxml_√w
(c⁄° *
«me
)

1221 *
ít
[] = { "lt;", "&#60;", "gt;", "&#62;", "quot;", "&#34;",

1222 "≠os;", "&#39;", "amp;", "&#38;", 
NULL


1224 
ezxml_roŸ_t
 
roŸ
 =

1225 (
ezxml_roŸ_t
Ë
	`mem£t
(
	`mÆloc
((
ezxml_roŸ
)),

1226 '\0', (
ezxml_roŸ
));

1228 
roŸ
->
xml
.
«me
 = (*)name;

1229 
roŸ
->
cur
 = &roŸ->
xml
;

1230 
	`°r˝y
(
roŸ
->
îr
,ÑoŸ->
xml
.
txt
 = "");

1231 
roŸ
->
ít
 = 
	`mem˝y
(
	`mÆloc
((ent)),Ént, (ent));

1232 
roŸ
->
©å
 =ÑoŸ->
pi
 = (***)‘oŸ->
xml
.©å = 
EZXML_NIL
);

1233  &
roŸ
->
xml
;

1234 
	}
}

1237 
ezxml_t


1238 
	$ezxml_ö£π
(
ezxml_t
 
xml
,

1239 
ezxml_t
 
de°
,

1240 
size_t
 
off
)

1242 
ezxml_t
 
cur
, 
¥ev
, 
hód
;

1244 
xml
->
√xt
 = xml->
siblög
 = xml->
‹dîed
 = 
NULL
;

1245 
xml
->
off
 = off;

1246 
xml
->
∑ª¡
 = 
de°
;

1249 
hód
 = 
de°
->
chûd
;

1250 if(
hód
)

1252 if(
hód
->
off
 <= off)

1254 
cur
 = 
hód
; cur->
‹dîed
 && cur->‹dîed->
off
 <= off;

1255 
cur
 = cur->
‹dîed
);

1256 
xml
->
‹dîed
 = 
cur
->ordered;

1257 
cur
->
‹dîed
 = 
xml
;

1261 
xml
->
‹dîed
 = 
hód
;

1262 
de°
->
chûd
 = 
xml
;

1265 
cur
 = 
hód
, 
¥ev
 = 
NULL
; cu∏&& 
	`°rcmp
(cur->
«me
, 
xml
->«me);Öªv = cur, cu∏cur->
siblög
);

1266 if(
cur
 && cur->
off
 <= off)

1268 
cur
->
√xt
 && cur->√xt->
off
 <= off)

1269 
cur
 = cur->
√xt
;

1270 
xml
->
√xt
 = 
cur
->next;

1271 
cur
->
√xt
 = 
xml
;

1275 if(
¥ev
 && 
cur
)

1276 
¥ev
->
siblög
 = 
cur
->sibling;

1277 
xml
->
√xt
 = 
cur
;

1278 
cur
 = 
hód
, 
¥ev
 = 
NULL
; cu∏&& cur->
off
 <off;Öªv = cur, cu∏cur->
siblög
);

1279 
xml
->
siblög
 = 
cur
;

1280 if(
¥ev
)

1281 
¥ev
->
siblög
 = 
xml
;

1285 
de°
->
chûd
 = 
xml
;

1287  
xml
;

1288 
	}
}

1292 
ezxml_t


1293 
	$ezxml_add_chûd
(
ezxml_t
 
xml
,

1294 c⁄° *
«me
,

1295 
size_t
 
off
)

1297 
ezxml_t
 
chûd
;

1299 if(!
xml
)

1300  
NULL
;

1301 
chûd
 = (
ezxml_t
Ë
	`mem£t
(
	`mÆloc
((
ezxml
)), '\0',

1302 (
ezxml
));

1303 
chûd
->
«me
 = (*)name;

1304 
chûd
->
©å
 = 
EZXML_NIL
;

1305 
chûd
->
txt
 = "";

1307  
	`ezxml_ö£π
(
chûd
, 
xml
, 
off
);

1308 
	}
}

1311 
ezxml_t


1312 
	$ezxml_£t_txt
(
ezxml_t
 
xml
,

1313 c⁄° *
txt
)

1315 if(!
xml
)

1316  
NULL
;

1317 if(
xml
->
Êags
 & 
EZXML_TXTM
)

1318 
	`‰ì
(
xml
->
txt
);

1319 
xml
->
Êags
 &~
EZXML_TXTM
;

1320 
xml
->
txt
 = (*)txt;

1321  
xml
;

1322 
	}
}

1326 
ezxml_t


1327 
	$ezxml_£t_©å
(
ezxml_t
 
xml
,

1328 c⁄° *
«me
,

1329 c⁄° *
vÆue
)

1331 
l
 = 0, 
c
;

1333 if(!
xml
)

1334  
NULL
;

1335 
xml
->
©å
[
l
] && 
	`°rcmp
(xml->©å[l], 
«me
))

1336 
l
 += 2;

1337 if(!
xml
->
©å
[
l
])

1339 if(!
vÆue
)

1340  
xml
;

1341 if(
xml
->
©å
 =
EZXML_NIL
)

1343 
xml
->
©å
 = 
	`mÆloc
(4 * (*));

1345 
xml
->
©å
[1] = 
	`my_°rdup
("");

1348 
xml
->
©å
 = 
	`ªÆloc
(xml->©å, (
l
 + 4) * (*));

1350 
xml
->
©å
[
l
] = (*)
«me
;

1351 
xml
->
©å
[
l
 + 2] = 
NULL
;

1352 
xml
->
©å
[
l
 + 3] = 
	`ªÆloc
(xml->attr[l + 1],

1353 (
c
 = 
	`°æí
(
xml
->
©å
[
l
 + 1])) + 2);

1354 
	`°r˝y
(
xml
->
©å
[
l
 + 3] + 
c
, " ");

1355 if(
xml
->
Êags
 & 
EZXML_DUP
)

1356 
xml
->
©å
[
l
 + 3][
c
] = ()()
EZXML_NAMEM
;

1358 if(
xml
->
Êags
 & 
EZXML_DUP
)

1359 
	`‰ì
((*)
«me
);

1361 
c
 = 
l
; 
xml
->
©å
[c]; c += 2);

1362 if(
xml
->
©å
[
c
 + 1][
l
 / 2] & 
EZXML_TXTM
)

1363 
	`‰ì
(
xml
->
©å
[
l
 + 1]);

1364 if(
xml
->
Êags
 & 
EZXML_DUP
)

1365 
xml
->
©å
[
c
 + 1][
l
 / 2] |
EZXML_TXTM
;

1367 
xml
->
©å
[
c
 + 1][
l
 / 2] &~
EZXML_TXTM
;

1369 if(
vÆue
)

1370 
xml
->
©å
[
l
 + 1] = (*)
vÆue
;

1373 if(
xml
->
©å
[
c
 + 1][
l
 / 2] & 
EZXML_NAMEM
)

1374 
	`‰ì
(
xml
->
©å
[
l
]);

1377 
	`memmove
(
xml
->
©å
 + 
l
, xml->attr +Ü + 2,

1378 (
c
 - 
l
) * (*));

1381 
c
 -= 2;

1382 
xml
->
©å
 = 
	`ªÆloc
(xml->©å, (
c
 + 2) * (*));

1383 
	`memmove
(
xml
->
©å
[
c
 + 1] + (
l
 / 2), xml->attr[c + 1] + (l / 2) + 1, (c / 2) - (l / 2));

1385 
xml
->
Êags
 &~
EZXML_DUP
;

1386  
xml
;

1387 
	}
}

1390 
ezxml_t


1391 
	$ezxml_£t_Êag
(
ezxml_t
 
xml
,

1392 
Êag
)

1394 if(
xml
)

1395 
xml
->
Êags
 |
Êag
;

1396  
xml
;

1397 
	}
}

1400 
ezxml_t


1401 
	$ezxml_cut
(
ezxml_t
 
xml
)

1403 
ezxml_t
 
cur
;

1405 if(!
xml
)

1406  
NULL
;

1407 if(
xml
->
√xt
)

1408 
xml
->
√xt
->
siblög
 = xml->sibling;

1410 if(
xml
->
∑ª¡
)

1412 
cur
 = 
xml
->
∑ª¡
->
chûd
;

1413 if(
cur
 =
xml
)

1414 
xml
->
∑ª¡
->
chûd
 = xml->
‹dîed
;

1417 
cur
->
‹dîed
 !
xml
)

1418 
cur
 = cur->
‹dîed
;

1419 
cur
->
‹dîed
 = cur->ordered->ordered;

1421 
cur
 = 
xml
->
∑ª¡
->
chûd
;

1422 if(
	`°rcmp
(
cur
->
«me
, 
xml
->name))

1424 
	`°rcmp
(
cur
->
siblög
->
«me
, 
xml
->name))

1425 
cur
 = cur->
siblög
;

1426 if(
cur
->
siblög
 =
xml
)

1428 
cur
->
siblög
 = (
xml
->
√xt
) ? xml->next

1429 : 
cur
->
siblög
->sibling;

1432 
cur
 = cur->
siblög
;

1435 
cur
->
√xt
 && cur->√xà!
xml
)

1436 
cur
 = cur->
√xt
;

1437 if(
cur
->
√xt
)

1438 
cur
->
√xt
 = cur->next->next;

1441 
xml
->
‹dîed
 = xml->
siblög
 = xml->
√xt
 = 
NULL
;

1442  
xml
;

1443 
	}
}

1445 #ifde‡
EZXML_TEST


1447 
	$maö
(
¨gc
,

1448 **
¨gv
)

1450 
ezxml_t
 
xml
;

1451 *
s
;

1452 
i
;

1454 if(
¨gc
 != 2)

1455  
	`Ârötf
(
°dîr
, "ußge: %†xmlfûe\n", 
¨gv
[0]);

1457 
xml
 = 
	`ezxml_∑r£_fûe
(
¨gv
[1]);

1458 
	`¥ötf
("%s\n", (
s
 = 
	`ezxml_toxml
(
xml
)));

1459 
	`‰ì
(
s
);

1460 
i
 = 
	`Ârötf
(
°dîr
, "%s", 
	`ezxml_îr‹
(
xml
));

1461 
	`ezxml_‰ì
(
xml
);

1462  (
i
) ? 1 : 0;

1463 
	}
}

	@ezxml.h

25 #i‚de‡
_EZXML_H


26 
	#_EZXML_H


	)

28 
	~<°dlib.h
>

29 
	~<°dio.h
>

30 
	~<°d¨g.h
>

31 
	~<f˙é.h
>

33 #ifde‡
__˝lu•lus


38 
	#EZXML_BUFSIZE
 1024

	)

39 
	#EZXML_NAMEM
 0x80

	)

40 
	#EZXML_TXTM
 0x40

	)

41 
	#EZXML_DUP
 0x20

	)

43 
ezxml
 *
	tezxml_t
;

44 
	sezxml


46 *
«me
;

47 **
©å
;

48 *
txt
;

49 
size_t
 
off
;

50 
ezxml_t
 
√xt
;

51 
ezxml_t
 
siblög
;

52 
ezxml_t
 
‹dîed
;

53 
ezxml_t
 
chûd
;

54 
ezxml_t
 
∑ª¡
;

55 
Êags
;

62 
ezxml_t
 
ezxml_∑r£_°r
(*
s
,

63 
size_t
 
Àn
);

68 
ezxml_t
 
ezxml_∑r£_fd
(
fd
);

71 
ezxml_t
 
ezxml_∑r£_fûe
(c⁄° *
fûe
);

76 
ezxml_t
 
ezxml_∑r£_Â
(
FILE
 * 
Â
);

80 
ezxml_t
 
ezxml_chûd
”zxml_à
xml
,

81 c⁄° *
«me
);

85 
	#ezxml_√xt
(
xml
Ë((xmlË? xml->
√xt
 : 
NULL
)

	)

89 
ezxml_t
 
ezxml_idx
”zxml_à
xml
,

90 
idx
);

93 
	#ezxml_«me
(
xml
Ë((xmlË? xml->
«me
 : 
NULL
)

	)

96 
	#ezxml_txt
(
xml
Ë((xmlË? xml->
txt
 : "")

	)

99 c⁄° *
ezxml_©å
(
ezxml_t
 
xml
,

100 c⁄° *
©å
);

108 
ezxml_t
 
ezxml_gë
”zxml_à
xml
,

113 *
ezxml_toxml
(
ezxml_t
 
xml
);

117 c⁄° **
ezxml_pi
(
ezxml_t
 
xml
,

118 c⁄° *
èrgë
);

121 
ezxml_‰ì
(
ezxml_t
 
xml
);

124 c⁄° *
ezxml_îr‹
(
ezxml_t
 
xml
);

127 
ezxml_t
 
ezxml_√w
(c⁄° *
«me
);

130 
	#ezxml_√w_d
(
«me
Ë
	`ezxml_£t_Êag
(
	`ezxml_√w
(
	`°rdup
“ame)), 
EZXML_NAMEM
)

	)

134 
ezxml_t
 
ezxml_add_chûd
”zxml_à
xml
,

135 c⁄° *
«me
,

136 
size_t
 
off
);

139 
	#ezxml_add_chûd_d
(
xml
, 
«me
, 
off
) \

140 
	`ezxml_£t_Êag
(
	`ezxml_add_chûd
(
xml
, 
	`°rdup
(
«me
), 
off
), 
EZXML_NAMEM
)

	)

143 
ezxml_t
 
ezxml_£t_txt
”zxml_à
xml
,

144 c⁄° *
txt
);

147 
	#ezxml_£t_txt_d
(
xml
, 
txt
) \

148 
	`ezxml_£t_Êag
(
	`ezxml_£t_txt
(
xml
, 
	`°rdup
(
txt
)), 
EZXML_TXTM
)

	)

152 
ezxml_t
 
ezxml_£t_©å
”zxml_à
xml
,

153 c⁄° *
«me
,

154 c⁄° *
vÆue
);

157 
	#ezxml_£t_©å_d
(
xml
, 
«me
, 
vÆue
) \

158 
	`ezxml_£t_©å
(
	`ezxml_£t_Êag
(
xml
, 
EZXML_DUP
), 
	`°rdup
(
«me
), sådup(
vÆue
))

	)

161 
ezxml_t
 
ezxml_£t_Êag
”zxml_à
xml
,

162 
Êag
);

165 
ezxml_t
 
ezxml_cut
”zxml_à
xml
);

168 
ezxml_t
 
ezxml_ö£π
”zxml_à
xml
,

169 
ezxml_t
 
de°
,

170 
size_t
 
off
);

174 
	#ezxml_move
(
xml
, 
de°
, 
off
Ë
	`ezxml_ö£π
(
	`ezxml_cut
(xml), de°, off)

	)

177 
	#ezxml_ªmove
(
xml
Ë
	`ezxml_‰ì
(
	`ezxml_cut
(xml))

	)

179 #ifde‡
__˝lu•lus


	@globals.h

1 
boﬁón
 
WMF_DEBUG
;

2 *
OutFûePªfix
;

4 
grid_logic_tûe_¨ó
;

5 
ùö_mux_å™s_size
;

7 
num_√ts
;

8 
s_√t
 *
√t
;

10 
num_blocks
;

11 
s_block
 *
block
;

14 
nx
, 
ny
;

17 *
ch™_width_x
, *
ch™_width_y
;

18 
s_grid_tûe
 **
grid
;

21 
s_åa˚
 **
åa˚_hód
, **
åa˚_èû
;

24 
num_º_nodes
;

25 
t_º_node
 *
º_node
;

26 
num_º_ödexed_d©a
;

27 
t_º_ödexed_d©a
 *
º_ödexed_d©a
;

28 
t_ivec
 ***
º_node_ödi˚s
;

29 **
√t_º_ãrmöÆs
;

30 
s_swôch_öf
 *
swôch_öf
;

31 **
º_blk_sour˚
;

34 
t_ty≥_±r
 
IO_TYPE
;

37 
t_ty≥_±r
 
EMPTY_TYPE
;

40 
t_ty≥_±r
 
FILL_TYPE
;

43 
num_ty≥s
;

44 
s_ty≥_des¸ùt‹
 *
ty≥_des¸ùt‹s
;

	@globals_declare.h

2 
	gnum_√ts
, 
	gnum_blocks
;

3 
s_√t
 *
	g√t
;

4 
s_block
 *
	gblock
;

5 
boﬁón
 *
	gis_globÆ
;

8 
	gnx
, 
	gny
;

11 *
	gch™_width_x
, *
	gch™_width_y
;

12 
s_grid_tûe
 **
	ggrid
;

15 
s_åa˚
 **
	gåa˚_hód
, **
	gåa˚_èû
;

18 
	gnum_º_nodes
;

19 
t_º_node
 *
	gº_node
;

20 
t_ivec
 ***
	gº_node_ödi˚s
;

21 
	gnum_º_ödexed_d©a
;

22 
t_º_ödexed_d©a
 *
	gº_ödexed_d©a
;

23 **
	g√t_º_ãrmöÆs
;

24 
s_swôch_öf
 *
	gswôch_öf
;

25 **
	gº_blk_sour˚
;

	@graphics.c

1 
	~<m©h.h
>

2 
	~<°dlib.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

6 
	~"utû.h
"

7 
	~"gøphics.h
"

8 
	~"v¥_ty≥s.h
"

11 #i‚de‡
NO_GRAPHICS


13 
	~<X11/Xlib.h
>

14 
	~<X11/Xutû.h
>

15 
	~<X11/Xos.h
>

16 
	~<X11/X©om.h
>

69 #i‚de‡
NO_GRAPHICS


75 
	#XPOST
(
w‹ldx
Ë(((w‹ldx)-
xÀ·
)*
ps_xmu…
 + 
ps_À·
)

	)

76 
	#YPOST
(
w‹ldy
Ë(((w‹ldy)-
ybŸ
)*
ps_ymu…
 + 
ps_bŸ
)

	)

81 
	#XTOWORLD
(
x
Ë(((Ëx)/
xmu…
 + 
xÀ·
)

	)

82 
	#YTOWORLD
(
y
Ë(((Ëy)/
ymu…
 + 
yt›
)

	)

84 
	#max
(
a
,
b
Ë((◊Ë> (b))? (aË: (b))

	)

85 
	#mö
(
a
,
b
Ë(◊Ë> (b)? (bË: (a))

	)

87 
	#MWIDTH
 104

	)

88 
	#T_AREA_HEIGHT
 24

	)

89 
	#MAX_FONT_SIZE
 40

	)

90 
	#PI
 3.141592654

	)

92 
	#BUTTON_TEXT_LEN
 20

	)

96 
	mwidth
;

97 
	mheight
;

98 
	mxÀ·
;

99 
	myt›
;

100 (*
	mf˙
Ë((*
	mdøws¸ìn
) ());

101 
Wödow
 
	mwö
;

102 
	mi°ext
;

103 
	mãxt
[
BUTTON_TEXT_LEN
];

104 
	mi•ﬁy
;

105 
	mpﬁy
[3][2];

106 
	mi•ªs£d
;

108 
	tt_buâ⁄
;

115 c⁄° 
	gmíu_f⁄t_size
 = 14;

117 
t_buâ⁄
 *
	gbuâ⁄
;

118 
	gnum_buâ⁄s
;

120 
	gdi•_ty≥
;

121 
Di•œy
 *
	gdi•œy
;

122 
	gs¸ìn_num
;

123 
GC
 
	ggc
, 
	ggcx‹
, 
	ggc_míus
;

124 
XF⁄tSåu˘
 *
	gf⁄t_öfo
[
MAX_FONT_SIZE
 + 1];

125 
	gf⁄t_is_lﬂded
[
MAX_FONT_SIZE
 + 1];

126 
	gdi•œy_width
, 
	gdi•œy_height
;

127 
	gt›_width
, 
	gt›_height
;

128 
Wödow
 
	gt›Àvñ
, 
	gmíu
, 
	gãxèªa
;

129 
	gxÀ·
, 
	gxright
, 
	gyt›
, 
	gybŸ
;

132 
	gßved_xÀ·
, 
	gßved_xright
, 
	gßved_yt›
, 
	gßved_ybŸ
;

134 
	gps_À·
, 
	gps_right
, 
	gps_t›
, 
	gps_bŸ
;

136 
	gps_xmu…
, 
	gps_ymu…
;

137 
	gxmu…
, 
	gymu…
;

138 
Cﬁ‹m≠
 
	g¥iv©e_cm≠
;

141 
	gcuºítcﬁ‹
 = 
BLACK
;

142 
	gcuºíéöe°yÀ
 = 
SOLID
;

143 
	gcuºíéöewidth
 = 0;

144 
	gcuºítf⁄tsize
 = 10;

146 
	gmesßge
[
BUFSIZE
] = "\0";

149 
	gcﬁ‹s
[
NUM_COLOR
];

152 
FILE
 *
	gps
;

157 
	#MAXPIXEL
 15000

	)

158 
	#MINPIXEL
 -15000

	)

165 
å™¶©e_up
((*
døws¸ìn
) ());

166 
	`å™¶©e_À·
((*
døws¸ìn
) ());

167 
	`å™¶©e_right
((*
døws¸ìn
) ());

168 
	`å™¶©e_down
((*
døws¸ìn
) ());

169 
	`zoom_ö
((*
døws¸ìn
) ());

170 
	`zoom_out
((*
døws¸ìn
) ());

171 
	`zoom_fô
((*
døws¸ìn
) ());

172 
	`adju°wö
((*
døws¸ìn
) ());

173 
	`po°s¸ùt
((*
døws¸ìn
) ());

174 
	`¥o˚ed
((*
døws¸ìn
) ());

175 
	`quô
((*
døws¸ìn
) ());

177 
Boﬁ
 
	`ã°_if_expo£d
(
Di•œy
 * 
di•
,

178 
XEvít
 * 
evít_±r
,

179 
XPoöãr
 
dummy
);

180 
	`m≠_buâ⁄
(
bnum
);

181 
	`unm≠_buâ⁄
(
bnum
);

189 
	$xco‹d
(
w‹ldx
)

194 
wöx
;

196 
wöx
 = ()((
w‹ldx
 - 
xÀ·
Ë* 
xmu…
 + 0.5);

208 
wöx
 = 
	`max
(wöx, 
MINPIXEL
);

209 
wöx
 = 
	`mö
(wöx, 
MAXPIXEL
);

211  (
wöx
);

212 
	}
}

216 
	$yco‹d
(
w‹ldy
)

221 
wöy
;

223 
wöy
 = ()((
w‹ldy
 - 
yt›
Ë* 
ymu…
 + 0.5);

226 
wöy
 = 
	`max
(wöy, 
MINPIXEL
);

227 
wöy
 = 
	`mö
(wöy, 
MAXPIXEL
);

229  (
wöy
);

230 
	}
}

234 
	$lﬂd_f⁄t
(
poötsize
)

241 
f⁄äame
[44];

243 
	`•rötf
(
f⁄äame
, "-*-helvetica-medium-r-*--*-%d0-*-*-*-*-*-*",

244 
poötsize
);

246 #ifde‡
VERBOSE


247 
	`¥ötf
("Lﬂdög f⁄t:Öoöàsize: %d, f⁄äame: %s\n", 
poötsize
,

248 
f⁄äame
);

253 if((
f⁄t_öfo
[
poötsize
] = 
	`XLﬂdQuîyF⁄t
(
di•œy
, 
f⁄äame
)Ë=
NULL
)

255 
	`Ârötf
(
°dîr
, "Cannot open desired font\n");

256 
	`exô
(-1);

258 
	}
}

262 
	$f‹˚_£tcﬁ‹
(
cödex
)

265 *
ps_˙ames
[
NUM_COLOR
] =

272 
cuºítcﬁ‹
 = 
cödex
;

274 if(
di•_ty≥
 =
SCREEN
)

276 
	`XSëF‹eground
(
di•œy
, 
gc
, 
cﬁ‹s
[
cödex
]);

280 
	`Ârötf
(
ps
, "%s\n", 
ps_˙ames
[
cödex
]);

282 
	}
}

286 
	$£tcﬁ‹
(
cödex
)

289 if(
cuºítcﬁ‹
 !
cödex
)

290 
	`f‹˚_£tcﬁ‹
(
cödex
);

291 
	}
}

295 
	$f‹˚_£éöe°yÀ
(
löe°yÀ
)

302 *
ps_ãxt
[2] = { "linesolid", "linedashed" };

303 
x_vÆs
[2] = { 
LöeSﬁid
, 
LöeOnOffDash
 };

305 
cuºíéöe°yÀ
 = 
löe°yÀ
;

307 if(
di•_ty≥
 =
SCREEN
)

309 
	`XSëLöeAâribuãs
(
di•œy
, 
gc
, 
cuºíéöewidth
,

310 
x_vÆs
[
löe°yÀ
], 
C≠Buâ
, 
JoöMôî
);

314 
	`Ârötf
(
ps
, "%s\n", 
ps_ãxt
[
löe°yÀ
]);

316 
	}
}

320 
	$£éöe°yÀ
(
löe°yÀ
)

323 if(
löe°yÀ
 !
cuºíéöe°yÀ
)

324 
	`f‹˚_£éöe°yÀ
(
löe°yÀ
);

325 
	}
}

329 
	$f‹˚_£éöewidth
(
löewidth
)

335 
x_vÆs
[2] = { 
LöeSﬁid
, 
LöeOnOffDash
 };

337 
cuºíéöewidth
 = 
löewidth
;

339 if(
di•_ty≥
 =
SCREEN
)

341 
	`XSëLöeAâribuãs
(
di•œy
, 
gc
, 
löewidth
,

342 
x_vÆs
[
cuºíéöe°yÀ
], 
C≠Buâ
, 
JoöMôî
);

346 
	`Ârötf
(
ps
, "%d sëlöewidth\n", 
löewidth
);

348 
	}
}

352 
	$£éöewidth
(
löewidth
)

355 if(
löewidth
 !
cuºíéöewidth
)

356 
	`f‹˚_£éöewidth
(
löewidth
);

357 
	}
}

361 
	$f‹˚_£tf⁄tsize
(
poötsize
)

366 if(
poötsize
 < 1)

367 
poötsize
 = 1;

368 if(
poötsize
 > 
MAX_FONT_SIZE
)

369 
poötsize
 = 
MAX_FONT_SIZE
;

371 
cuºítf⁄tsize
 = 
poötsize
;

374 if(
di•_ty≥
 =
SCREEN
)

376 if(!
f⁄t_is_lﬂded
[
poötsize
])

378 
	`lﬂd_f⁄t
(
poötsize
);

379 
f⁄t_is_lﬂded
[
poötsize
] = 1;

381 
	`XSëF⁄t
(
di•œy
, 
gc
, 
f⁄t_öfo
[
poötsize
]->
fid
);

388 
	`Ârötf
(
ps
, "%d sëf⁄tsize\n", 
poötsize
);

390 
	}
}

394 
	$£tf⁄tsize
(
poötsize
)

401 if(
poötsize
 !
cuºítf⁄tsize
)

402 
	`f‹˚_£tf⁄tsize
(
poötsize
);

403 
	}
}

407 
	$buûd_ãxèªa
()

412 
XSëWödowAâribuãs
 
míu_©åibuãs
;

413 
vÆuemask
;

415 
ãxèªa
 = 
	`XCª©eSim∂eWödow
(
di•œy
, 
t›Àvñ
,

416 0, 
t›_height
 - 
T_AREA_HEIGHT
,

417 
di•œy_width
, 
T_AREA_HEIGHT
 - 4, 2,

418 
cﬁ‹s
[
BLACK
], cﬁ‹s[
LIGHTGREY
]);

419 
míu_©åibuãs
.
evít_mask
 = 
ExposuªMask
;

421 
míu_©åibuãs
.
do_nŸ_¥›ag©e_mask
 = 
Buâ⁄PªssMask
;

423 
míu_©åibuãs
.
wö_gøvôy
 = 
SouthWe°Gøvôy
;

424 
vÆuemask
 = 
CWWöGøvôy
 | 
CWEvítMask
 | 
CWD⁄tPr›ag©e
;

425 
	`XCh™geWödowAâribuãs
(
di•œy
, 
ãxèªa
, 
vÆuemask
, &
míu_©åibuãs
);

426 
	`XM≠Wödow
(
di•œy
, 
ãxèªa
);

427 
	}
}

431 
	$£çﬁy
(
bnum
,

432 
xc
,

433 
yc
,

434 
r
,

435 
thëa
)

440 
i
;

442 
buâ⁄
[
bnum
].
i°ext
 = 0;

443 
buâ⁄
[
bnum
].
i•ﬁy
 = 1;

444 
i
 = 0; i < 3; i++)

446 
buâ⁄
[
bnum
].
pﬁy
[
i
][0] = ()(
xc
 + 
r
 * 
	`cos
(
thëa
) + 0.5);

447 
buâ⁄
[
bnum
].
pﬁy
[
i
][1] = ()(
yc
 + 
r
 * 
	`sö
(
thëa
) + 0.5);

448 
thëa
 +2 * 
PI
 / 3;

450 
	}
}

454 
	$buûd_deÁu…_míu
()

459 
XSëWödowAâribuãs
 
míu_©åibuãs
;

460 
vÆuemask
;

461 
i
, 
x˚n
, 
x1
, 
y1
, 
bwid
, 
bheight
, 
•a˚
;

464 
míu
 = 
	`XCª©eSim∂eWödow
(
di•œy
, 
t›Àvñ
,

465 
t›_width
 - 
MWIDTH
, 0, MWIDTH - 4,

466 
di•œy_height
, 2, 
cﬁ‹s
[
BLACK
],

467 
cﬁ‹s
[
LIGHTGREY
]);

468 
míu_©åibuãs
.
evít_mask
 = 
ExposuªMask
;

470 
míu_©åibuãs
.
do_nŸ_¥›ag©e_mask
 = 
Buâ⁄PªssMask
;

472 
míu_©åibuãs
.
wö_gøvôy
 = 
N‹thEa°Gøvôy
;

473 
vÆuemask
 = 
CWWöGøvôy
 | 
CWEvítMask
 | 
CWD⁄tPr›ag©e
;

474 
	`XCh™geWödowAâribuãs
(
di•œy
, 
míu
, 
vÆuemask
, &
míu_©åibuãs
);

475 
	`XM≠Wödow
(
di•œy
, 
míu
);

477 
num_buâ⁄s
 = 11;

478 
buâ⁄
 = (
t_buâ⁄
 *Ë
	`my_mÆloc
(
num_buâ⁄s
 * (t_button));

481 
bwid
 = 28;

482 
•a˚
 = 3;

483 
y1
 = 10;

484 
x˚n
 = 51;

485 
x1
 = 
x˚n
 - 
bwid
 / 2;

486 
buâ⁄
[0].
xÀ·
 = 
x1
;

487 
buâ⁄
[0].
yt›
 = 
y1
;

488 
	`£çﬁy
(0, 
bwid
 / 2, bwid / 2, bwid / 3, -
PI
 / 2.);

489 
buâ⁄
[0].
f˙
 = 
å™¶©e_up
;

491 
y1
 +
bwid
 + 
•a˚
;

492 
x1
 = 
x˚n
 - 3 * 
bwid
 / 2 - 
•a˚
;

493 
buâ⁄
[1].
xÀ·
 = 
x1
;

494 
buâ⁄
[1].
yt›
 = 
y1
;

495 
	`£çﬁy
(1, 
bwid
 / 2, bwid / 2, bwid / 3, 
PI
);

496 
buâ⁄
[1].
f˙
 = 
å™¶©e_À·
;

498 
x1
 = 
x˚n
 + 
bwid
 / 2 + 
•a˚
;

499 
buâ⁄
[2].
xÀ·
 = 
x1
;

500 
buâ⁄
[2].
yt›
 = 
y1
;

501 
	`£çﬁy
(2, 
bwid
 / 2, bwid / 2, bwid / 3, 0);

502 
buâ⁄
[2].
f˙
 = 
å™¶©e_right
;

504 
y1
 +
bwid
 + 
•a˚
;

505 
x1
 = 
x˚n
 - 
bwid
 / 2;

506 
buâ⁄
[3].
xÀ·
 = 
x1
;

507 
buâ⁄
[3].
yt›
 = 
y1
;

508 
	`£çﬁy
(3, 
bwid
 / 2, bwid / 2, bwid / 3, +
PI
 / 2.);

509 
buâ⁄
[3].
f˙
 = 
å™¶©e_down
;

511 
i
 = 0; i < 4; i++)

513 
buâ⁄
[
i
].
width
 = 
bwid
;

514 
buâ⁄
[
i
].
height
 = 
bwid
;

519 
y1
 +
bwid
 + 
•a˚
 + 6;

520 
•a˚
 = 8;

521 
bwid
 = 90;

522 
bheight
 = 26;

523 
x1
 = 
x˚n
 - 
bwid
 / 2;

524 
i
 = 4; i < 
num_buâ⁄s
; i++)

526 
buâ⁄
[
i
].
xÀ·
 = 
x1
;

527 
buâ⁄
[
i
].
yt›
 = 
y1
;

528 
y1
 +
bheight
 + 
•a˚
;

529 
buâ⁄
[
i
].
i°ext
 = 1;

530 
buâ⁄
[
i
].
i•ﬁy
 = 0;

531 
buâ⁄
[
i
].
width
 = 
bwid
;

532 
buâ⁄
[
i
].
height
 = 
bheight
;

535 
	`°r˝y
(
buâ⁄
[4].
ãxt
, "Zoom In");

536 
	`°r˝y
(
buâ⁄
[5].
ãxt
, "Zoom Out");

537 
	`°r˝y
(
buâ⁄
[6].
ãxt
, "Zoom Fit");

538 
	`°r˝y
(
buâ⁄
[7].
ãxt
, "Window");

539 
	`°r˝y
(
buâ⁄
[8].
ãxt
, "PostScript");

540 
	`°r˝y
(
buâ⁄
[9].
ãxt
, "Proceed");

541 
	`°r˝y
(
buâ⁄
[10].
ãxt
, "Exit");

543 
buâ⁄
[4].
f˙
 = 
zoom_ö
;

544 
buâ⁄
[5].
f˙
 = 
zoom_out
;

545 
buâ⁄
[6].
f˙
 = 
zoom_fô
;

546 
buâ⁄
[7].
f˙
 = 
adju°wö
;

547 
buâ⁄
[8].
f˙
 = 
po°s¸ùt
;

548 
buâ⁄
[9].
f˙
 = 
¥o˚ed
;

549 
buâ⁄
[10].
f˙
 = 
quô
;

551 
i
 = 0; i < 
num_buâ⁄s
; i++)

552 
	`m≠_buâ⁄
(
i
);

553 
	}
}

557 
	$m≠_buâ⁄
(
bnum
)

562 
buâ⁄
[
bnum
].
wö
 = 
	`XCª©eSim∂eWödow
(
di•œy
, 
míu
,

563 
buâ⁄
[
bnum
].
xÀ·
,

564 
buâ⁄
[
bnum
].
yt›
,

565 
buâ⁄
[
bnum
].
width
,

566 
buâ⁄
[
bnum
].
height
, 0,

567 
cﬁ‹s
[
WHITE
], cﬁ‹s[
LIGHTGREY
]);

568 
	`XM≠Wödow
(
di•œy
, 
buâ⁄
[
bnum
].
wö
);

569 
	`XSñe˘I≈ut
(
di•œy
, 
buâ⁄
[
bnum
].
wö
, 
Buâ⁄PªssMask
);

570 
buâ⁄
[
bnum
].
i•ªs£d
 = 1;

571 
	}
}

575 
	$unm≠_buâ⁄
(
bnum
)

580 
	`XUnm≠Wödow
(
di•œy
, 
buâ⁄
[
bnum
].
wö
);

581 
	}
}

585 
¸óã_buâ⁄
(*
¥ev_buâ⁄_ãxt
,

586 *
buâ⁄_ãxt
,

587 (*
buâ⁄_func
Ë((*
døws¸ìn
) ()))

594 
i
, 
bnum
, 
•a˚
;

596 
•a˚
 = 8;

600 
bnum
 = -1;

601 
i
 = 4; i < 
num_buâ⁄s
; i++)

603 if(
buâ⁄
[
i
].
i°ext
 == 1 &&

604 
	`°rcmp
(
buâ⁄
[
i
].
ãxt
, 
¥ev_buâ⁄_ãxt
) == 0)

606 
bnum
 = 
i
 + 1;

611 if(
bnum
 == -1)

613 
¥ötf


615 
¥ev_buâ⁄_ãxt
);

616 
	`exô
(1);

619 
num_buâ⁄s
++;

620 
buâ⁄
 = (
t_buâ⁄
 *Ë
	`my_ªÆloc
(buâ⁄, 
num_buâ⁄s
 * (t_button));

625 
buâ⁄
[
num_buâ⁄s
 - 1].
xÀ·
 = button[num_buttons - 2].xleft;

626 
buâ⁄
[
num_buâ⁄s
 - 1].
yt›
 = button[num_buttons - 2].ytop +

627 
buâ⁄
[
num_buâ⁄s
 - 2].
height
 + 
•a˚
;

628 
buâ⁄
[
num_buâ⁄s
 - 1].
height
 = button[num_buttons - 2].height;

629 
buâ⁄
[
num_buâ⁄s
 - 1].
width
 = button[num_buttons - 2].width;

630 
	`m≠_buâ⁄
(
num_buâ⁄s
 - 1);

633 
i
 = 
num_buâ⁄s
 - 1; i > 
bnum
; i--)

635 
buâ⁄
[
i
].
i•ﬁy
 = button[i - 1].ispoly;

639 
buâ⁄
[
i
].
i°ext
 = button[i - 1].istext;

640 
	`°r˝y
(
buâ⁄
[
i
].
ãxt
, button[i - 1].text);

641 
buâ⁄
[
i
].
f˙
 = button[i - 1].fcn;

642 
buâ⁄
[
i
].
i•ªs£d
 = button[i - 1].ispressed;

645 
buâ⁄
[
bnum
].
i°ext
 = 1;

646 
buâ⁄
[
bnum
].
i•ﬁy
 = 0;

647 
	`my_°∫˝y
(
buâ⁄
[
bnum
].
ãxt
, 
buâ⁄_ãxt
, 
BUTTON_TEXT_LEN
);

648 
buâ⁄
[
bnum
].
f˙
 = 
buâ⁄_func
;

649 
buâ⁄
[
bnum
].
i•ªs£d
 = 1;

650 
	}
}

654 
	$de°roy_buâ⁄
(*
buâ⁄_ãxt
)

659 
i
, 
bnum
;

661 
bnum
 = -1;

662 
i
 = 4; i < 
num_buâ⁄s
; i++)

664 if(
buâ⁄
[
i
].
i°ext
 == 1 &&

665 
	`°rcmp
(
buâ⁄
[
i
].
ãxt
, 
buâ⁄_ãxt
) == 0)

667 
bnum
 = 
i
;

672 if(
bnum
 == -1)

674 
¥ötf


676 
buâ⁄_ãxt
);

677 
	`exô
(1);

680 
i
 = 
bnum
 + 1; i < 
num_buâ⁄s
; i++)

682 
buâ⁄
[
i
 - 1].
i•ﬁy
 = button[i].ispoly;

686 
buâ⁄
[
i
 - 1].
i°ext
 = button[i].istext;

687 
	`°r˝y
(
buâ⁄
[
i
 - 1].
ãxt
, button[i].text);

688 
buâ⁄
[
i
 - 1].
f˙
 = button[i].fcn;

689 
buâ⁄
[
i
 - 1].
i•ªs£d
 = button[i].ispressed;

692 
	`unm≠_buâ⁄
(
num_buâ⁄s
 - 1);

693 
num_buâ⁄s
--;

694 
buâ⁄
 = (
t_buâ⁄
 *Ë
	`my_ªÆloc
(buâ⁄, 
num_buâ⁄s
 * (t_button));

695 
	}
}

699 
	$öô_gøphics
(*
wödow_«me
)

706 *
di•œy_«me
 = 
NULL
;

707 
x
, 
y
;

708 
b‹dî_width
 = 2;

709 
XTextPr›îty
 
wödowName
;

712 *
˙ames
[
NUM_COLOR
] = { "white", "black", "grey55", "grey75", "blue",

718 
XCﬁ‹
 
exa˘_def
;

719 
Cﬁ‹m≠
 
cm≠
;

720 
i
;

721 
vÆuemask
 = 0;

722 
XGCVÆues
 
vÆues
;

723 
XEvít
 
evít
;

726 
di•_ty≥
 = 
SCREEN
;

728 
i
 = 0; i <
MAX_FONT_SIZE
; i++)

729 
f⁄t_is_lﬂded
[
i
] = 0;

732 if((
di•œy
 = 
	`XO≥nDi•œy
(
di•œy_«me
)Ë=
NULL
)

734 
	`Ârötf
(
°dîr
, "Cannot connectÅo X server %s\n",

735 
	`XDi•œyName
(
di•œy_«me
));

736 
	`exô
(-1);

740 
s¸ìn_num
 = 
	`DeÁu…S¸ìn
(
di•œy
);

741 
di•œy_width
 = 
	`Di•œyWidth
(
di•œy
, 
s¸ìn_num
);

742 
di•œy_height
 = 
	`Di•œyHeight
(
di•œy
, 
s¸ìn_num
);

744 
x
 = 
y
 = 0;

746 
t›_width
 = 2 * 
di•œy_width
 / 3;

747 
t›_height
 = 4 * 
di•œy_height
 / 5;

749 
cm≠
 = 
	`DeÁu…Cﬁ‹m≠
(
di•œy
, 
s¸ìn_num
);

750 
¥iv©e_cm≠
 = 
N⁄e
;

752 
i
 = 0; i < 
NUM_COLOR
; i++)

754 if(!
	`XP¨£Cﬁ‹
(
di•œy
, 
cm≠
, 
˙ames
[
i
], &
exa˘_def
))

756 
	`Ârötf
(
°dîr
, "ColorÇame %sÇot in database",

757 
˙ames
[
i
]);

758 
	`exô
(-1);

760 if(!
	`XAŒocCﬁ‹
(
di•œy
, 
cm≠
, &
exa˘_def
))

762 
	`Ârötf
(
°dîr
, "Couldn'tállocate color %s.\n",

763 
˙ames
[
i
]);

765 if(
¥iv©e_cm≠
 =
N⁄e
)

767 
	`Ârötf
(
°dîr
,

769 
	`Ârötf
(
°dîr
,

775 
¥iv©e_cm≠
 =

776 
	`XC›yCﬁ‹m≠AndFªe
(
di•œy
, 
cm≠
);

777 
cm≠
 = 
¥iv©e_cm≠
;

778 if(!
	`XAŒocCﬁ‹
(
di•œy
, 
cm≠
, &
exa˘_def
))

780 
	`Ârötf
(
°dîr
,

782 
˙ames
[
i
]);

783 
	`exô
(1);

789 
	`Ârötf
(
°dîr
,

791 
˙ames
[
i
]);

792 
	`exô
(1);

795 
cﬁ‹s
[
i
] = 
exa˘_def
.
pixñ
;

798 
t›Àvñ
 =

799 
	`XCª©eSim∂eWödow
(
di•œy
, 
	`RoŸWödow
(di•œy, 
s¸ìn_num
), 
x
, 
y
,

800 
t›_width
, 
t›_height
, 
b‹dî_width
,

801 
cﬁ‹s
[
BLACK
], cﬁ‹s[
WHITE
]);

803 if(
¥iv©e_cm≠
 !
N⁄e
)

804 
	`XSëWödowCﬁ‹m≠
(
di•œy
, 
t›Àvñ
, 
¥iv©e_cm≠
);

808 
	`XSñe˘I≈ut
(
di•œy
, 
t›Àvñ
, 
ExposuªMask
 | 
Såu˘uªNŸifyMask
 |

809 
Buâ⁄PªssMask
);

813 
gc
 = 
	`XCª©eGC
(
di•œy
, 
t›Àvñ
, 
vÆuemask
, &
vÆues
);

814 
gc_míus
 = 
	`XCª©eGC
(
di•œy
, 
t›Àvñ
, 
vÆuemask
, &
vÆues
);

817 
vÆues
.
fun˘i⁄
 = 
GXx‹
;

818 
vÆues
.
f‹eground
 = 
cﬁ‹s
[
BLACK
];

819 
gcx‹
 = 
	`XCª©eGC
(
di•œy
, 
t›Àvñ
, (
GCFun˘i⁄
 | 
GCF‹eground
),

820 &
vÆues
);

823 
	`lﬂd_f⁄t
(
míu_f⁄t_size
);

824 
f⁄t_is_lﬂded
[
míu_f⁄t_size
] = 1;

825 
	`XSëF⁄t
(
di•œy
, 
gc_míus
, 
f⁄t_öfo
[
míu_f⁄t_size
]->
fid
);

829 
	`f‹˚_£tf⁄tsize
(
cuºítf⁄tsize
);

830 
	`f‹˚_£tcﬁ‹
(
cuºítcﬁ‹
);

831 
	`f‹˚_£éöe°yÀ
(
cuºíéöe°yÀ
);

832 
	`f‹˚_£éöewidth
(
cuºíéöewidth
);

834 
	`XSåögLi°ToTextPr›îty
(&
wödow_«me
, 1, &
wödowName
);

835 
	`XSëWMName
(
di•œy
, 
t›Àvñ
, &
wödowName
);

842 
	`‰ì
(
wödowName
.
vÆue
);

844 
	`XM≠Wödow
(
di•œy
, 
t›Àvñ
);

845 
	`buûd_ãxèªa
();

846 
	`buûd_deÁu…_míu
();

855 
	`XPìkIfEvít
(
di•œy
, &
evít
, 
ã°_if_expo£d
, 
NULL
);

856 
	}
}

859 
Boﬁ


860 
	$ã°_if_expo£d
(
Di•œy
 * 
di•
,

861 
XEvít
 * 
evít_±r
,

862 
XPoöãr
 
dummy
)

868 if(
evít_±r
->
ty≥
 =
Expo£
)

870  (
True
);

873  (
FÆ£
);

874 
	}
}

878 
	$míuãxt
(
Wödow
 
wö
,

879 
xc
,

880 
yc
,

881 *
ãxt
)

886 
Àn
, 
width
;

888 
Àn
 = 
	`°æí
(
ãxt
);

889 
width
 = 
	`XTextWidth
(
f⁄t_öfo
[
míu_f⁄t_size
], 
ãxt
, 
Àn
);

890 
	`XDøwSåög
(
di•œy
, 
wö
, 
gc_míus
, 
xc
 - 
width
 / 2, 
yc
 +

891 (
f⁄t_öfo
[
míu_f⁄t_size
]->
as˚¡
 -

892 
f⁄t_öfo
[
míu_f⁄t_size
]->
des˚¡
Ë/ 2, 
ãxt
, 
Àn
);

893 
	}
}

897 
	$døwbut
(
bnum
)

902 
width
, 
height
, 
thick
, 
i
, 
i•ªs£d
;

903 
XPoöt
 
mypﬁy
[6];

905 
i•ªs£d
 = 
buâ⁄
[
bnum
].ispressed;

906 
thick
 = 2;

907 
width
 = 
buâ⁄
[
bnum
].width;

908 
height
 = 
buâ⁄
[
bnum
].height;

910 if(
i•ªs£d
)

912 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
BLACK
]);

916 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
WHITE
]);

922 
mypﬁy
[0].
x
 = 0;

923 
mypﬁy
[0].
y
 = 
height
;

924 
mypﬁy
[1].
x
 = 0;

925 
mypﬁy
[1].
y
 = 0;

926 
mypﬁy
[2].
x
 = 
width
;

927 
mypﬁy
[2].
y
 = 0;

928 
mypﬁy
[3].
x
 = 
width
 - 
thick
;

929 
mypﬁy
[3].
y
 = 
thick
;

930 
mypﬁy
[4].
x
 = 
thick
;

931 
mypﬁy
[4].
y
 = 
thick
;

932 
mypﬁy
[5].
x
 = 
thick
;

933 
mypﬁy
[5].
y
 = 
height
 - 
thick
;

934 
	`XFûlPﬁyg⁄
(
di•œy
, 
buâ⁄
[
bnum
].
wö
, 
gc_míus
, 
mypﬁy
, 6, 
C⁄vex
,

935 
Co‹dModeOrigö
);

938 if(
i•ªs£d
)

940 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
WHITE
]);

944 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
BLACK
]);

946 
mypﬁy
[0].
x
 = 0;

947 
mypﬁy
[0].
y
 = 
height
;

948 
mypﬁy
[1].
x
 = 
width
;

949 
mypﬁy
[1].
y
 = 
height
;

950 
mypﬁy
[2].
x
 = 
width
;

951 
mypﬁy
[2].
y
 = 0;

952 
mypﬁy
[3].
x
 = 
width
 - 
thick
;

953 
mypﬁy
[3].
y
 = 
thick
;

954 
mypﬁy
[4].
x
 = 
width
 - 
thick
;

955 
mypﬁy
[4].
y
 = 
height
 - 
thick
;

956 
mypﬁy
[5].
x
 = 
thick
;

957 
mypﬁy
[5].
y
 = 
height
 - 
thick
;

958 
	`XFûlPﬁyg⁄
(
di•œy
, 
buâ⁄
[
bnum
].
wö
, 
gc_míus
, 
mypﬁy
, 6, 
C⁄vex
,

959 
Co‹dModeOrigö
);

962 if(
i•ªs£d
)

964 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
DARKGREY
]);

968 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
LIGHTGREY
]);

972 
	`XFûlRe˘™gÀ
(
di•œy
, 
buâ⁄
[
bnum
].
wö
, 
gc_míus
, 
thick
,Åhick,

973 
width
 - 2 * 
thick
, 
height
 - 2 *Åhick);

976 if(
buâ⁄
[
bnum
].
i•ﬁy
)

978 
i
 = 0; i < 3; i++)

980 
mypﬁy
[
i
].
x
 = 
buâ⁄
[
bnum
].
pﬁy
[i][0];

981 
mypﬁy
[
i
].
y
 = 
buâ⁄
[
bnum
].
pﬁy
[i][1];

983 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
BLACK
]);

984 
	`XFûlPﬁyg⁄
(
di•œy
, 
buâ⁄
[
bnum
].
wö
, 
gc_míus
, 
mypﬁy
, 3,

985 
C⁄vex
, 
Co‹dModeOrigö
);

989 if(
buâ⁄
[
bnum
].
i°ext
)

991 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
BLACK
]);

992 
	`míuãxt
(
buâ⁄
[
bnum
].
wö
, buâ⁄[bnum].
width
 / 2,

993 
buâ⁄
[
bnum
].
height
 / 2, buâ⁄[bnum].
ãxt
);

995 
	}
}

999 
	$tu∫_⁄_off
(
¥es£d
)

1005 
i
;

1007 
i
 = 0; i < 
num_buâ⁄s
; i++)

1009 
buâ⁄
[
i
].
i•ªs£d
 = 
¥es£d
;

1010 
	`døwbut
(
i
);

1012 
	}
}

1016 
	$which_buâ⁄
(
Wödow
 
wö
)

1018 
i
;

1020 
i
 = 0; i < 
num_buâ⁄s
; i++)

1022 if(
buâ⁄
[
i
].
wö
 == win)

1023  (
i
);

1025 
	`¥ötf
("Error: Unknown button ID in which_button.\n");

1027 
	}
}

1031 
	$døwmíu
()

1033 
i
;

1035 
i
 = 0; i < 
num_buâ⁄s
; i++)

1037 
	`døwbut
(
i
);

1039 
	}
}

1043 
	$upd©e_å™sf‹m
()

1049 
mu…
, 
y1
, 
y2
, 
x1
, 
x2
;

1052 
xmu…
 = (()
t›_width
 - 1. - 
MWIDTH
Ë/ (
xright
 - 
xÀ·
);

1053 
ymu…
 = (()
t›_height
 - 1. - 
T_AREA_HEIGHT
Ë/ (
ybŸ
 - 
yt›
);

1055 if(
	`Ábs
(
xmu…
Ë<Ábs(
ymu…
))

1057 
mu…
 = 
	`Ábs
(
ymu…
 / 
xmu…
);

1058 
y1
 = 
yt›
 - (
ybŸ
 - yt›Ë* (
mu…
 - 1.) / 2.;

1059 
y2
 = 
ybŸ
 + (ybŸ - 
yt›
Ë* (
mu…
 - 1.) / 2.;

1060 
yt›
 = 
y1
;

1061 
ybŸ
 = 
y2
;

1065 
mu…
 = 
	`Ábs
(
xmu…
 / 
ymu…
);

1066 
x1
 = 
xÀ·
 - (
xright
 - xÀ·Ë* (
mu…
 - 1.) / 2.;

1067 
x2
 = 
xright
 + (xrighà- 
xÀ·
Ë* (
mu…
 - 1.) / 2.;

1068 
xÀ·
 = 
x1
;

1069 
xright
 = 
x2
;

1071 
xmu…
 = (()
t›_width
 - 1. - 
MWIDTH
Ë/ (
xright
 - 
xÀ·
);

1072 
ymu…
 = (()
t›_height
 - 1. - 
T_AREA_HEIGHT
Ë/ (
ybŸ
 - 
yt›
);

1073 
	}
}

1077 
	$upd©e_ps_å™sf‹m
()

1086 
ps_width
, 
ps_height
;

1088 
ps_width
 = 540.;

1089 
ps_height
 = 720.;

1091 
ps_xmu…
 = 
ps_width
 / (
xright
 - 
xÀ·
);

1092 
ps_ymu…
 = 
ps_height
 / (
yt›
 - 
ybŸ
);

1096 if(
	`Ábs
(
ps_xmu…
Ë<Ábs(
ps_ymu…
))

1098 
ps_À·
 = 36.;

1099 
ps_right
 = 36. + 
ps_width
;

1100 
ps_bŸ
 = 396. - 
	`Ábs
(
ps_xmu…
 * (
yt›
 - 
ybŸ
)) / 2.;

1101 
ps_t›
 = 396. + 
	`Ábs
(
ps_xmu…
 * (
yt›
 - 
ybŸ
)) / 2.;

1103 
ps_ymu…
 = (
ps_xmu…
 *Ös_ymult < 0) ? -ps_xmult :Ös_xmult;

1107 
ps_bŸ
 = 36.;

1108 
ps_t›
 = 36. + 
ps_height
;

1109 
ps_À·
 = 306. - 
	`Ábs
(
ps_ymu…
 * (
xright
 - 
xÀ·
)) / 2.;

1110 
ps_right
 = 306. + 
	`Ábs
(
ps_ymu…
 * (
xright
 - 
xÀ·
)) / 2.;

1112 
ps_xmu…
 = (ps_xmu… * 
ps_ymu…
 < 0) ? -ps_ymult :Ös_ymult;

1114 
	}
}

1118 
evít_lo›
((*
a˘_⁄_buâ⁄
Ë(
x
,

1119 
y
),

1120 (*
døws¸ìn
) ())

1128 
XEvít
 
ªp‹t
;

1129 
bnum
;

1130 
x
, 
y
;

1132 
	#OFF
 1

	)

1133 
	#ON
 0

	)

1135 
	`tu∫_⁄_off
(
ON
);

1138 
	`XNextEvít
(
di•œy
, &
ªp‹t
);

1139 
ªp‹t
.
ty≥
)

1141 
Expo£
:

1142 #ifde‡
VERBOSE


1143 
	`¥ötf
("GotánÉxposeÉvent.\n");

1144 
	`¥ötf
("Cou¡ is: %d.\n", 
ªp‹t
.
xexpo£
.
cou¡
);

1145 
	`¥ötf
("Wödow ID is: %d.\n", 
ªp‹t
.
xexpo£
.
wödow
);

1147 if(
ªp‹t
.
xexpo£
.
cou¡
 != 0)

1149 if(
ªp‹t
.
xexpo£
.
wödow
 =
míu
)

1150 
	`døwmíu
();

1151 if(
ªp‹t
.
xexpo£
.
wödow
 =
t›Àvñ
)

1152 
	`døws¸ìn
();

1153 if(
ªp‹t
.
xexpo£
.
wödow
 =
ãxèªa
)

1154 
	`døw_mesßge
();

1156 
C⁄figuªNŸify
:

1157 
t›_width
 = 
ªp‹t
.
xc⁄figuª
.
width
;

1158 
t›_height
 = 
ªp‹t
.
xc⁄figuª
.
height
;

1159 
	`upd©e_å™sf‹m
();

1160 #ifde‡
VERBOSE


1161 
	`¥ötf
("Gotá ConfigureNotify.\n");

1162 
	`¥ötf
("New width: %d New height: %d.\n", 
t›_width
,

1163 
t›_height
);

1166 
Buâ⁄Pªss
:

1167 #ifde‡
VERBOSE


1168 
	`¥ötf
("Gotá buttonpress.\n");

1169 
	`¥ötf
("Wödow ID is: %d.\n", 
ªp‹t
.
xbuâ⁄
.
wödow
);

1171 if(
ªp‹t
.
xbuâ⁄
.
wödow
 =
t›Àvñ
)

1173 
x
 = 
	`XTOWORLD
(
ªp‹t
.
xbuâ⁄
.x);

1174 
y
 = 
	`YTOWORLD
(
ªp‹t
.
xbuâ⁄
.y);

1175 
	`a˘_⁄_buâ⁄
(
x
, 
y
);

1179 
bnum
 = 
	`which_buâ⁄
(
ªp‹t
.
xbuâ⁄
.
wödow
);

1180 #ifde‡
VERBOSE


1181 
	`¥ötf
("Buâ⁄Çumbî i†%d\n", 
bnum
);

1183 
buâ⁄
[
bnum
].
i•ªs£d
 = 1;

1184 
	`døwbut
(
bnum
);

1185 
	`XFlush
(
di•œy
);

1186 
buâ⁄
[
bnum
].
	`f˙
(
døws¸ìn
);

1187 
buâ⁄
[
bnum
].
i•ªs£d
 = 0;

1188 
	`døwbut
(
bnum
);

1189 if(
buâ⁄
[
bnum
].
f˙
 =
¥o˚ed
)

1191 
	`tu∫_⁄_off
(
OFF
);

1192 
	`Êushöput
();

1200 
	}
}

1205 
	$˛órs¸ìn
()

1207 
ßvecﬁ‹
;

1209 if(
di•_ty≥
 =
SCREEN
)

1211 
	`XCÀ¨Wödow
(
di•œy
, 
t›Àvñ
);

1218 
ßvecﬁ‹
 = 
cuºítcﬁ‹
;

1219 
	`£tcﬁ‹
(
WHITE
);

1220 
	`Ârötf
(
ps
, "clippath fill\n\n");

1221 
	`£tcﬁ‹
(
ßvecﬁ‹
);

1223 
	}
}

1226 
	$ª˘_off_s¸ìn
(
x1
,

1227 
y1
,

1228 
x2
,

1229 
y2
)

1239 
xmö
, 
xmax
, 
ymö
, 
ymax
;

1241 
xmö
 = 
	`mö
(
xÀ·
, 
xright
);

1242 if(
x1
 < 
xmö
 && 
x2
 < xmin)

1245 
xmax
 = 
	`max
(
xÀ·
, 
xright
);

1246 if(
x1
 > 
xmax
 && 
x2
 > xmax)

1249 
ymö
 = 
	`mö
(
yt›
, 
ybŸ
);

1250 if(
y1
 < 
ymö
 && 
y2
 < ymin)

1253 
ymax
 = 
	`max
(
yt›
, 
ybŸ
);

1254 if(
y1
 > 
ymax
 && 
y2
 > ymax)

1258 
	}
}

1262 
	$døwlöe
(
x1
,

1263 
y1
,

1264 
x2
,

1265 
y2
)

1271 if(
	`ª˘_off_s¸ìn
(
x1
, 
y1
, 
x2
, 
y2
))

1274 if(
di•_ty≥
 =
SCREEN
)

1277 
	`XDøwLöe
(
di•œy
, 
t›Àvñ
, 
gc
, 
	`xco‹d
(
x1
), 
	`yco‹d
(
y1
),

1278 
	`xco‹d
(
x2
), 
	`yco‹d
(
y2
));

1282 
	`Ârötf
(
ps
, "%.2‡%.2‡%.2‡%.2‡døwlöe\n", 
	`XPOST
(
x1
),

1283 
	`YPOST
(
y1
), 
	`XPOST
(
x2
), YPOST(
y2
));

1285 
	}
}

1288 
	$døwª˘
(
x1
,

1289 
y1
,

1290 
x2
,

1291 
y2
)

1296 
width
, 
height
;

1297 
xw1
, 
yw1
, 
xw2
, 
yw2
, 
xl
, 
yt
;

1299 if(
	`ª˘_off_s¸ìn
(
x1
, 
y1
, 
x2
, 
y2
))

1302 if(
di•_ty≥
 =
SCREEN
)

1305 
xw1
 = 
	`xco‹d
(
x1
);

1306 
xw2
 = 
	`xco‹d
(
x2
);

1307 
yw1
 = 
	`yco‹d
(
y1
);

1308 
yw2
 = 
	`yco‹d
(
y2
);

1309 
xl
 = 
	`mö
(
xw1
, 
xw2
);

1310 
yt
 = 
	`mö
(
yw1
, 
yw2
);

1311 
width
 = 
	`abs
(
xw1
 - 
xw2
);

1312 
height
 = 
	`abs
(
yw1
 - 
yw2
);

1313 
	`XDøwRe˘™gÀ
(
di•œy
, 
t›Àvñ
, 
gc
, 
xl
, 
yt
, 
width
, 
height
);

1317 
	`Ârötf
(
ps
, "%.2‡%.2‡%.2‡%.2‡døwª˘\n", 
	`XPOST
(
x1
),

1318 
	`YPOST
(
y1
), 
	`XPOST
(
x2
), YPOST(
y2
));

1320 
	}
}

1324 
	$fûÃe˘
(
x1
,

1325 
y1
,

1326 
x2
,

1327 
y2
)

1332 
width
, 
height
;

1333 
xw1
, 
yw1
, 
xw2
, 
yw2
, 
xl
, 
yt
;

1335 if(
	`ª˘_off_s¸ìn
(
x1
, 
y1
, 
x2
, 
y2
))

1338 if(
di•_ty≥
 =
SCREEN
)

1341 
xw1
 = 
	`xco‹d
(
x1
);

1342 
xw2
 = 
	`xco‹d
(
x2
);

1343 
yw1
 = 
	`yco‹d
(
y1
);

1344 
yw2
 = 
	`yco‹d
(
y2
);

1345 
xl
 = 
	`mö
(
xw1
, 
xw2
);

1346 
yt
 = 
	`mö
(
yw1
, 
yw2
);

1347 
width
 = 
	`abs
(
xw1
 - 
xw2
);

1348 
height
 = 
	`abs
(
yw1
 - 
yw2
);

1349 
	`XFûlRe˘™gÀ
(
di•œy
, 
t›Àvñ
, 
gc
, 
xl
, 
yt
, 
width
, 
height
);

1353 
	`Ârötf
(
ps
, "%.2‡%.2‡%.2‡%.2‡fûÃe˘\n", 
	`XPOST
(
x1
),

1354 
	`YPOST
(
y1
), 
	`XPOST
(
x2
), YPOST(
y2
));

1356 
	}
}

1360 
	$™gn‹m
(
™g
)

1364 
sˇÀ
;

1366 if(
™g
 < 0)

1368 
sˇÀ
 = ()(
™g
 / 360. - 1);

1372 
sˇÀ
 = ()(
™g
 / 360.);

1374 
™g
 =áng - 
sˇÀ
 * 360.;

1375  (
™g
);

1376 
	}
}

1380 
	$døw¨c
(
xc
,

1381 
yc
,

1382 
ød
,

1383 
°¨èng
,

1384 
™gexã¡
)

1393 
xl
, 
yt
;

1394 
width
, 
height
;

1399 if(
	`ª˘_off_s¸ìn
(
xc
 - 
ød
, 
yc
 -Ñad, xc +Ñad, yc +Ñad))

1404 if(
	`Ábs
(
™gexã¡
) > 360.)

1405 
™gexã¡
 = 360.;

1407 
°¨èng
 = 
	`™gn‹m
(startang);

1409 if(
di•_ty≥
 =
SCREEN
)

1411 
xl
 = ()(
	`xco‹d
(
xc
Ë- 
	`Ábs
(
xmu…
 * 
ød
));

1412 
yt
 = ()(
	`yco‹d
(
yc
Ë- 
	`Ábs
(
ymu…
 * 
ød
));

1413 
width
 = ()(2 * 
	`Ábs
(
xmu…
 * 
ød
));

1414 
height
 = 
width
;

1415 
	`XDøwArc
(
di•œy
, 
t›Àvñ
, 
gc
, 
xl
, 
yt
, 
width
, 
height
,

1416 ()(
°¨èng
 * 64), ()(
™gexã¡
 * 64));

1420 
	`Ârötf
(
ps
, "%.2‡%.2‡%.2‡%.2‡%.2‡%†°roke\n", 
	`XPOST
(
xc
),

1421 
	`YPOST
(
yc
), 
	`Ábs
(
ød
 * 
ps_xmu…
), 
°¨èng
,

1422 
°¨èng
 + 
™gexã¡
,

1423 (
™gexã¡
 < 0) ? "drawarcn" : "drawarc");

1425 
	}
}

1429 
	$fûœrc
(
xc
,

1430 
yc
,

1431 
ød
,

1432 
°¨èng
,

1433 
™gexã¡
)

1439 
xl
, 
yt
;

1440 
width
, 
height
;

1445 if(
	`ª˘_off_s¸ìn
(
xc
 - 
ød
, 
yc
 -Ñad, xc +Ñad, yc +Ñad))

1451 if(
	`Ábs
(
™gexã¡
) > 360.)

1452 
™gexã¡
 = 360.;

1454 
°¨èng
 = 
	`™gn‹m
(startang);

1456 if(
di•_ty≥
 =
SCREEN
)

1458 
xl
 = ()(
	`xco‹d
(
xc
Ë- 
	`Ábs
(
xmu…
 * 
ød
));

1459 
yt
 = ()(
	`yco‹d
(
yc
Ë- 
	`Ábs
(
ymu…
 * 
ød
));

1460 
width
 = ()(2 * 
	`Ábs
(
xmu…
 * 
ød
));

1461 
height
 = 
width
;

1462 
	`XFûlArc
(
di•œy
, 
t›Àvñ
, 
gc
, 
xl
, 
yt
, 
width
, 
height
,

1463 ()(
°¨èng
 * 64), ()(
™gexã¡
 * 64));

1467 
	`Ârötf
(
ps
, "%.2‡%.2‡%.2‡%.2‡%.2‡%s\n", 
	`Ábs
(
ød
 * 
ps_xmu…
),

1468 
°¨èng
, sèπ™g + 
™gexã¡
, 
	`XPOST
(
xc
), 
	`YPOST
(
yc
),

1469 (
™gexã¡
 < 0) ? "fillarcn" : "fillarc");

1471 
	}
}

1475 
	$fûÕﬁy
(
t_poöt
 * 
poöts
,

1476 
≈oöts
)

1479 
XPoöt
 
å™•oöts
[
MAXPTS
];

1480 
i
;

1481 
xmö
, 
ymö
, 
xmax
, 
ymax
;

1483 if(
≈oöts
 > 
MAXPTS
)

1485 
¥ötf


1487 
MAXPTS
);

1488 
	`¥ötf
("%dÖoints wereÑequested. Polygon isÇot drawn.\n",

1489 
≈oöts
);

1496 
xmö
 = 
xmax
 = 
poöts
[0].
x
;

1497 
ymö
 = 
ymax
 = 
poöts
[0].
y
;

1499 
i
 = 1; i < 
≈oöts
; i++)

1501 
xmö
 = 
	`mö
(xmö, 
poöts
[
i
].
x
);

1502 
xmax
 = 
	`max
(xmax, 
poöts
[
i
].
x
);

1503 
ymö
 = 
	`mö
(ymö, 
poöts
[
i
].
y
);

1504 
ymax
 = 
	`max
(ymax, 
poöts
[
i
].
y
);

1507 if(
	`ª˘_off_s¸ìn
(
xmö
, 
ymö
, 
xmax
, 
ymax
))

1510 if(
di•_ty≥
 =
SCREEN
)

1512 
i
 = 0; i < 
≈oöts
; i++)

1514 
å™•oöts
[
i
].
x
 = ()
	`xco‹d
(
poöts
[i].x);

1515 
å™•oöts
[
i
].
y
 = ()
	`yco‹d
(
poöts
[i].y);

1517 
	`XFûlPﬁyg⁄
(
di•œy
, 
t›Àvñ
, 
gc
, 
å™•oöts
, 
≈oöts
, 
Com∂ex
,

1518 
Co‹dModeOrigö
);

1522 
	`Ârötf
(
ps
, "\n");

1524 
i
 = 
≈oöts
 - 1; i >= 0; i--)

1525 
	`Ârötf
(
ps
, "%.2‡%.2f\n", 
	`XPOST
(
poöts
[
i
].
x
),

1526 
	`YPOST
(
poöts
[
i
].
y
));

1528 
	`Ârötf
(
ps
, "%d fûÕﬁy\n", 
≈oöts
);

1530 
	}
}

1533 
	$døwãxt
(
xc
,

1534 
yc
,

1535 c⁄° *
ãxt
,

1536 
boundx
)

1541 
Àn
, 
width
, 
xw_off
, 
yw_off
;

1543 
Àn
 = 
	`°æí
(
ãxt
);

1544 
width
 = 
	`XTextWidth
(
f⁄t_öfo
[
cuºítf⁄tsize
], 
ãxt
, 
Àn
);

1545 if(
width
 > 
	`Ábs
(
boundx
 * 
xmu…
))

1548 
xw_off
 = 
width
 / (2. * 
xmu…
);

1551 
yw_off
 = (
f⁄t_öfo
[
cuºítf⁄tsize
]->
as˚¡
 +

1552 2 * 
f⁄t_öfo
[
cuºítf⁄tsize
]->
des˚¡
Ë/ (2. * 
ymu…
);

1559 if(
	`ª˘_off_s¸ìn
(
xc
 - 
xw_off
, 
yc
 - 
yw_off
, xc + xw_off, yc + yw_off))

1562 if(
di•_ty≥
 =
SCREEN
)

1564 
	`XDøwSåög
(
di•œy
, 
t›Àvñ
, 
gc
, 
	`xco‹d
(
xc
Ë- 
width
 / 2,

1565 
	`yco‹d
(
yc
Ë+ (
f⁄t_öfo
[
cuºítf⁄tsize
]->
as˚¡
 -

1566 
f⁄t_öfo
[
cuºítf⁄tsize
]->
des˚¡
) /

1567 2, 
ãxt
, 
Àn
);

1571 
	`Ârötf
(
ps
, "(%sË%.2‡%.2‡˚nshow\n", 
ãxt
, 
	`XPOST
(
xc
),

1572 
	`YPOST
(
yc
));

1574 
	}
}

1578 
	$Êushöput
()

1580 if(
di•_ty≥
 !
SCREEN
)

1582 
	`XFlush
(
di•œy
);

1583 
	}
}

1587 
	$öô_w‹ld
(
x1
,

1588 
y1
,

1589 
x2
,

1590 
y2
)

1595 
xÀ·
 = 
x1
;

1596 
xright
 = 
x2
;

1597 
yt›
 = 
y1
;

1598 
ybŸ
 = 
y2
;

1600 
ßved_xÀ·
 = 
xÀ·
;

1601 
ßved_xright
 = 
xright
;

1602 
ßved_yt›
 = 
yt›
;

1603 
ßved_ybŸ
 = 
ybŸ
;

1605 if(
di•_ty≥
 =
SCREEN
)

1607 
	`upd©e_å™sf‹m
();

1611 
	`upd©e_ps_å™sf‹m
();

1613 
	}
}

1617 
	$døw_mesßge
()

1622 
Àn
, 
width
, 
ßvef⁄tsize
, 
ßvecﬁ‹
;

1623 
ylow
;

1625 if(
di•_ty≥
 =
SCREEN
)

1627 
	`XCÀ¨Wödow
(
di•œy
, 
ãxèªa
);

1628 
Àn
 = 
	`°æí
(
mesßge
);

1629 
width
 = 
	`XTextWidth
(
f⁄t_öfo
[
míu_f⁄t_size
], 
mesßge
, 
Àn
);

1631 
	`XSëF‹eground
(
di•œy
, 
gc_míus
, 
cﬁ‹s
[
BLACK
]);

1632 
	`XDøwSåög
(
di•œy
, 
ãxèªa
, 
gc_míus
,

1633 (
t›_width
 - 
MWIDTH
 - 
width
) / 2,

1634 (
T_AREA_HEIGHT
 - 4) / 2 +

1635 (
f⁄t_öfo
[
míu_f⁄t_size
]->
as˚¡
 -

1636 
f⁄t_öfo
[
míu_f⁄t_size
]->
des˚¡
Ë/ 2, 
mesßge
,

1637 
Àn
);

1645 
ßvecﬁ‹
 = 
cuºítcﬁ‹
;

1646 
	`£tcﬁ‹
(
BLACK
);

1647 
ßvef⁄tsize
 = 
cuºítf⁄tsize
;

1648 
	`£tf⁄tsize
(
míu_f⁄t_size
 - 2);

1649 
ylow
 = 
ps_bŸ
 - 8.;

1650 
	`Ârötf
(
ps
, "(%sË%.2‡%.2‡˚nshow\n", 
mesßge
,

1651 (
ps_À·
 + 
ps_right
Ë/ 2., 
ylow
);

1652 
	`£tcﬁ‹
(
ßvecﬁ‹
);

1653 
	`£tf⁄tsize
(
ßvef⁄tsize
);

1655 
	}
}

1659 
	$upd©e_mesßge
(*
msg
)

1664 
	`my_°∫˝y
(
mesßge
, 
msg
, 
BUFSIZE
);

1665 
	`døw_mesßge
();

1666 
	}
}

1670 
zoom_ö
((*
døws¸ìn
) ())

1675 
xdiff
, 
ydiff
;

1677 
xdiff
 = 
xright
 - 
xÀ·
;

1678 
ydiff
 = 
ybŸ
 - 
yt›
;

1679 
xÀ·
 +
xdiff
 / 5.;

1680 
xright
 -
xdiff
 / 5.;

1681 
yt›
 +
ydiff
 / 5.;

1682 
ybŸ
 -
ydiff
 / 5.;

1684 
	`upd©e_å™sf‹m
();

1685 
	`døws¸ìn
();

1686 
	}
}

1690 
zoom_out
((*
døws¸ìn
) ())

1695 
xdiff
, 
ydiff
;

1697 
xdiff
 = 
xright
 - 
xÀ·
;

1698 
ydiff
 = 
ybŸ
 - 
yt›
;

1699 
xÀ·
 -
xdiff
 / 3.;

1700 
xright
 +
xdiff
 / 3.;

1701 
yt›
 -
ydiff
 / 3.;

1702 
ybŸ
 +
ydiff
 / 3.;

1704 
	`upd©e_å™sf‹m
();

1705 
	`døws¸ìn
();

1706 
	}
}

1710 
zoom_fô
((*
døws¸ìn
) ())

1716 
xÀ·
 = 
ßved_xÀ·
;

1717 
xright
 = 
ßved_xright
;

1718 
yt›
 = 
ßved_yt›
;

1719 
ybŸ
 = 
ßved_ybŸ
;

1721 
	`upd©e_å™sf‹m
();

1722 
	`døws¸ìn
();

1723 
	}
}

1727 
å™¶©e_up
((*
døws¸ìn
) ())

1732 
y°ï
;

1734 
y°ï
 = (
ybŸ
 - 
yt›
) / 2.;

1735 
yt›
 -
y°ï
;

1736 
ybŸ
 -
y°ï
;

1737 
	`upd©e_å™sf‹m
();

1738 
	`døws¸ìn
();

1739 
	}
}

1743 
å™¶©e_down
((*
døws¸ìn
) ())

1748 
y°ï
;

1750 
y°ï
 = (
ybŸ
 - 
yt›
) / 2.;

1751 
yt›
 +
y°ï
;

1752 
ybŸ
 +
y°ï
;

1753 
	`upd©e_å™sf‹m
();

1754 
	`døws¸ìn
();

1755 
	}
}

1759 
å™¶©e_À·
((*
døws¸ìn
) ())

1764 
x°ï
;

1766 
x°ï
 = (
xright
 - 
xÀ·
) / 2.;

1767 
xÀ·
 -
x°ï
;

1768 
xright
 -
x°ï
;

1769 
	`upd©e_å™sf‹m
();

1770 
	`døws¸ìn
();

1771 
	}
}

1775 
å™¶©e_right
((*
døws¸ìn
) ())

1780 
x°ï
;

1782 
x°ï
 = (
xright
 - 
xÀ·
) / 2.;

1783 
xÀ·
 +
x°ï
;

1784 
xright
 +
x°ï
;

1785 
	`upd©e_å™sf‹m
();

1786 
	`døws¸ìn
();

1787 
	}
}

1791 
upd©e_wö
(
x
[2],

1792 
y
[2],

1793 (*
døws¸ìn
) ())

1795 
x1
, 
x2
, 
y1
, 
y2
;

1797 
x
[0] = 
	`mö
(x[0], 
t›_width
 - 
MWIDTH
);

1798 
x
[1] = 
	`mö
(x[1], 
t›_width
 - 
MWIDTH
);

1799 
y
[0] = 
	`mö
(y[0], 
t›_height
 - 
T_AREA_HEIGHT
);

1800 
y
[1] = 
	`mö
(y[1], 
t›_height
 - 
T_AREA_HEIGHT
);

1802 if((
x
[0] =x[1]Ë|| (
y
[0] == y[1]))

1804 
	`¥ötf
("Illegal (zeroárea) window. Window unchanged.\n");

1807 
x1
 = 
	`XTOWORLD
(
	`mö
(
x
[0], x[1]));

1808 
x2
 = 
	`XTOWORLD
(
	`max
(
x
[0], x[1]));

1809 
y1
 = 
	`YTOWORLD
(
	`mö
(
y
[0], y[1]));

1810 
y2
 = 
	`YTOWORLD
(
	`max
(
y
[0], y[1]));

1811 
xÀ·
 = 
x1
;

1812 
xright
 = 
x2
;

1813 
yt›
 = 
y1
;

1814 
ybŸ
 = 
y2
;

1815 
	`upd©e_å™sf‹m
();

1816 
	`døws¸ìn
();

1817 
	}
}

1821 
adju°wö
((*
døws¸ìn
) ())

1826 
XEvít
 
ªp‹t
;

1827 
c‹√r
, 
xﬁd
, 
yﬁd
, 
x
[2], 
y
[2];

1829 
c‹√r
 = 0;

1830 
xﬁd
 = -1;

1831 
yﬁd
 = -1;

1833 
c‹√r
 < 2)

1835 
	`XNextEvít
(
di•œy
, &
ªp‹t
);

1836 
ªp‹t
.
ty≥
)

1838 
Expo£
:

1839 #ifde‡
VERBOSE


1840 
	`¥ötf
("GotánÉxposeÉvent.\n");

1841 
	`¥ötf
("Cou¡ is: %d.\n", 
ªp‹t
.
xexpo£
.
cou¡
);

1842 
	`¥ötf
("Wödow ID is: %d.\n", 
ªp‹t
.
xexpo£
.
wödow
);

1844 if(
ªp‹t
.
xexpo£
.
cou¡
 != 0)

1846 if(
ªp‹t
.
xexpo£
.
wödow
 =
míu
)

1847 
	`døwmíu
();

1848 if(
ªp‹t
.
xexpo£
.
wödow
 =
t›Àvñ
)

1850 
	`døws¸ìn
();

1851 
xﬁd
 = -1;

1853 if(
ªp‹t
.
xexpo£
.
wödow
 =
ãxèªa
)

1854 
	`døw_mesßge
();

1856 
C⁄figuªNŸify
:

1857 
t›_width
 = 
ªp‹t
.
xc⁄figuª
.
width
;

1858 
t›_height
 = 
ªp‹t
.
xc⁄figuª
.
height
;

1859 
	`upd©e_å™sf‹m
();

1860 #ifde‡
VERBOSE


1861 
	`¥ötf
("Gotá ConfigureNotify.\n");

1862 
	`¥ötf
("New width: %d New height: %d.\n", 
t›_width
,

1863 
t›_height
);

1866 
Buâ⁄Pªss
:

1867 #ifde‡
VERBOSE


1868 
	`¥ötf
("Gotá buttonpress.\n");

1869 
	`¥ötf
("Wödow ID is: %d.\n", 
ªp‹t
.
xbuâ⁄
.
wödow
);

1870 
	`¥ötf
("Loˇti⁄ (%d, %d).\n", 
ªp‹t
.
xbuâ⁄
.
x
,

1871 
ªp‹t
.
xbuâ⁄
.
y
);

1873 if(
ªp‹t
.
xbuâ⁄
.
wödow
 !
t›Àvñ
)

1875 
x
[
c‹√r
] = 
ªp‹t
.
xbuâ⁄
.x;

1876 
y
[
c‹√r
] = 
ªp‹t
.
xbuâ⁄
.y;

1877 if(
c‹√r
 == 0)

1879 
	`XSñe˘I≈ut
(
di•œy
, 
t›Àvñ
, 
ExposuªMask
 |

1880 
Såu˘uªNŸifyMask
 | 
Buâ⁄PªssMask


1881 | 
PoöãrMŸi⁄Mask
);

1885 
	`upd©e_wö
(
x
, 
y
, 
døws¸ìn
);

1887 
c‹√r
++;

1889 
MŸi⁄NŸify
:

1890 #ifde‡
VERBOSE


1891 
	`¥ötf
("Gotá MotionNotify Event.\n");

1892 
	`¥ötf
("x: %d y: %d\n", 
ªp‹t
.
xmŸi⁄
.
x
,

1893 
ªp‹t
.
xmŸi⁄
.
y
);

1895 if(
xﬁd
 >= 0)

1897 
	`XDøwRe˘™gÀ
(
di•œy
, 
t›Àvñ
, 
gcx‹
,

1898 
	`mö
(
x
[0], 
xﬁd
), mö(
y
[0], 
yﬁd
),

1899 
	`abs
(
x
[0] - 
xﬁd
),

1900 
	`abs
(
y
[0] - 
yﬁd
));

1903 
xﬁd
 = 
	`mö
(
ªp‹t
.
xmŸi⁄
.
x
, 
t›_width
 - 1 - 
MWIDTH
);

1904 
yﬁd
 = 
ªp‹t
.
xmŸi⁄
.
y
;

1905 
	`XDøwRe˘™gÀ
(
di•œy
, 
t›Àvñ
, 
gcx‹
, 
	`mö
(
x
[0], 
xﬁd
),

1906 
	`mö
(
y
[0], 
yﬁd
), 
	`abs
(
x
[0] - 
xﬁd
),

1907 
	`abs
(
y
[0] - 
yﬁd
));

1911 
	`XSñe˘I≈ut
(
di•œy
, 
t›Àvñ
, 
ExposuªMask
 | 
Såu˘uªNŸifyMask


1912 | 
Buâ⁄PªssMask
);

1913 
	}
}

1917 
po°s¸ùt
((*
døws¸ìn
) ())

1923 
piccou¡
 = 1;

1924 
suc˚ss
;

1925 
‚ame
[20];

1927 
	`•rötf
(
‚ame
, "pic%d.ps", 
piccou¡
);

1928 
suc˚ss
 = 
	`öô_po°s¸ùt
(
‚ame
);

1930 if(
suc˚ss
 == 0)

1933 
	`døws¸ìn
();

1934 
	`˛o£_po°s¸ùt
();

1935 
piccou¡
++;

1936 
	}
}

1940 
¥o˚ed
((*
døws¸ìn
) ())

1945 
	}
}

1949 
quô
((*
døws¸ìn
) ())

1952 
	`˛o£_gøphics
();

1953 
	`exô
(0);

1954 
	}
}

1958 
	$˛o£_gøphics
()

1964 
i
;

1966 
i
 = 1; i <
MAX_FONT_SIZE
; i++)

1967 if(
f⁄t_is_lﬂded
[
i
])

1968 
	`XFªeF⁄t
(
di•œy
, 
f⁄t_öfo
[
i
]);

1970 
	`XFªeGC
(
di•œy
, 
gc
);

1971 
	`XFªeGC
(
di•œy
, 
gcx‹
);

1972 
	`XFªeGC
(
di•œy
, 
gc_míus
);

1974 if(
¥iv©e_cm≠
 !
N⁄e
)

1975 
	`XFªeCﬁ‹m≠
(
di•œy
, 
¥iv©e_cm≠
);

1977 
	`XClo£Di•œy
(
di•œy
);

1978 
	`‰ì
(
buâ⁄
);

1979 
	}
}

1983 
	$öô_po°s¸ùt
(*
‚ame
)

1989 
ps
 = 
	`f›í
(
‚ame
, "w");

1990 if(
ps
 =
NULL
)

1992 
	`¥ötf
("Error: couldÇot open %s for PostScript output.\n",

1993 
‚ame
);

1994 
	`¥ötf
("DrawingÅo screen instead.\n");

1997 
di•_ty≥
 = 
POSTSCRIPT
;

2000 
	`Ârötf
(
ps
, "%%!PS-Adobe-1.0\n");

2001 
	`Ârötf
(
ps
, "%%%%DocumentFonts: Helvetica\n");

2002 
	`Ârötf
(
ps
, "%%%%Pages: 1\n");

2004 
	`upd©e_ps_å™sf‹m
();

2006 
	`Ârötf
(
ps
, "%%%%BoundingBox: %d %d %d %d\n",

2007 ()
ps_À·
, ()(
ps_bŸ
 - 15.), ()
ps_right
, ()
ps_t›
);

2008 
	`Ârötf
(
ps
, "%%%%EndComments\n");

2010 
	`Ârötf
(
ps
, "/censhow %%drawá centered string\n");

2011 
	`Ârötf
(
ps
, " { moveto %% moveÅoÖroper spot\n");

2012 
	`Ârötf
(
ps
, " dup stringwidthÖop %% get xÜength of string\n");

2013 
	`Ârötf
(
ps
, " -2 div %% ProperÜeft start\n");

2014 
	`Ârötf
(
ps
,

2016 
	`Ârötf
(
ps
, " showÇewpath } def %% showÅhe string\n\n");

2018 
	`Ârötf
(
ps
, "/setfontsize %% set fontÅo desired sizeánd compute "

2020 
	`Ârötf
(
ps
, " { /Helvetica findfont\n");

2021 
	`Ârötf
(
ps
, "Éxch scalefont\n");

2022 
	`Ârötf
(
ps
, " setfont %% Font size set ...\n\n");

2023 
	`Ârötf
(
ps
, " 0 0 moveto %% Get vertical centering offset\n");

2024 
	`Ârötf
(
ps
, " (Xg)Årue charpath\n");

2025 
	`Ârötf
(
ps
, " flattenpathÖathbbox\n");

2026 
	`Ârötf
(
ps
, " /ascentÉxch defÖop -1 mul /descentÉxch defÖop\n");

2027 
	`Ârötf
(
ps
, "Çewpath\n");

2028 
	`Ârötf
(
ps
, " descentáscent sub 2 div /yoffÉxch def } def\n\n");

2030 
	`Ârötf
(
ps
, "%% NextÅwoÜines for debugging only.\n");

2031 
	`Ârötf
(
ps
, "/str 20 string def\n");

2032 
	`Ârötf
(
ps
, "/pnum {str cvsÖrint ( )Örint} def\n");

2034 
	`Ârötf
(
ps
, "/drawline %% drawáÜine from (x2,y2)Åo (x1,y1)\n");

2035 
	`Ârötf
(
ps
, " { movetoÜineto stroke } def\n\n");

2037 
	`Ârötf
(
ps
, "/rect %% outlineáÑectangle \n");

2038 
	`Ârötf
(
ps
, " { /y2Éxch def /x2Éxch def /y1Éxch def /x1Éxch def\n");

2039 
	`Ârötf
(
ps
, " x1 y1 moveto\n");

2040 
	`Ârötf
(
ps
, " x2 y1Üineto\n");

2041 
	`Ârötf
(
ps
, " x2 y2Üineto\n");

2042 
	`Ârötf
(
ps
, " x1 y2Üineto\n");

2043 
	`Ârötf
(
ps
, " closepath } def\n\n");

2045 
	`Ârötf
(
ps
, "/drawrect %% draw outline ofáÑectanagle\n");

2046 
	`Ârötf
(
ps
, " {Ñect stroke } def\n\n");

2048 
	`Ârötf
(
ps
, "/fillrect %% fill ináÑectanagle\n");

2049 
	`Ârötf
(
ps
, " {Ñect fill } def\n\n");

2051 
	`Ârötf
(
ps
, "/drawarc {árc stroke } def %% drawánárc\n");

2052 
	`Ârötf
(
ps
, "/drawarcn {árcn stroke } def "

2055 
	`Ârötf
(
ps
, "%%Fillá counterclockwise or clockwiseárc sector, "

2057 
	`Ârötf
(
ps
,

2060 
	`Ârötf
(
ps
,

2064 
	`Ârötf
(
ps
,

2070 
	`Ârötf
(
ps
, "%%Color Definitions:\n");

2071 
	`Ârötf
(
ps
, "/white { 1 setgray } def\n");

2072 
	`Ârötf
(
ps
, "/black { 0 setgray } def\n");

2073 
	`Ârötf
(
ps
, "/grey55 { .55 setgray } def\n");

2074 
	`Ârötf
(
ps
, "/grey75 { .75 setgray } def\n");

2075 
	`Ârötf
(
ps
, "/blue { 0 0 1 setrgbcolor } def\n");

2076 
	`Ârötf
(
ps
, "/green { 0 1 0 setrgbcolor } def\n");

2077 
	`Ârötf
(
ps
, "/yellow { 1 1 0 setrgbcolor } def\n");

2078 
	`Ârötf
(
ps
, "/cyan { 0 1 1 setrgbcolor } def\n");

2079 
	`Ârötf
(
ps
, "/red { 1 0 0 setrgbcolor } def\n");

2080 
	`Ârötf
(
ps
, "/darkgreen { 0 0.5 0 setrgbcolor } def\n");

2081 
	`Ârötf
(
ps
, "/magenta { 1 0 1 setrgbcolor } def\n");

2082 
	`Ârötf
(
ps
, "/bisque { 1 0.9 0.8 setrgbcolor } def\n");

2083 
	`Ârötf
(
ps
, "/lightblue { 0.7 0.8 0.9 setrgbcolor } def\n");

2084 
	`Ârötf
(
ps
, "/thistle { 0.8 0.7 0.8 setrgbcolor } def\n");

2085 
	`Ârötf
(
ps
, "/plum {0.8 0.6 0.8 setrgbcolor } def\n");

2086 
	`Ârötf
(
ps
, "/khaki { 1 0.9 0.6 setrgbcolor } def\n");

2087 
	`Ârötf
(
ps
, "/coral { 1 0.7 0.6 setrgbcolor } def\n");

2088 
	`Ârötf
(
ps
, "/turquoise { 0.5 0.6 0.9 setrgbcolor } def\n");

2089 
	`Ârötf
(
ps
, "/mediumpurple { 0.7 0.6 0.7 setrgbcolor } def\n");

2090 
	`Ârötf
(
ps
, "/darkslateblue { 0.7 0.5 0.7 setrgbcolor } def\n");

2091 
	`Ârötf
(
ps
, "/darkkhaki { 0.9 0.7 0.4 setrgbcolor } def\n");

2093 
	`Ârötf
(
ps
, "\n%%Solidánd dashedÜine definitions:\n");

2094 
	`Ârötf
(
ps
, "/linesolid {[] 0 setdash} def\n");

2095 
	`Ârötf
(
ps
, "/linedashed {[3 3] 0 setdash} def\n");

2097 
	`Ârötf
(
ps
, "\n%%%%EndProlog\n");

2098 
	`Ârötf
(
ps
, "%%%%Page: 1 1\n\n");

2101 
	`f‹˚_£tcﬁ‹
(
cuºítcﬁ‹
);

2102 
	`f‹˚_£éöe°yÀ
(
cuºíéöe°yÀ
);

2103 
	`f‹˚_£éöewidth
(
cuºíéöewidth
);

2104 
	`f‹˚_£tf⁄tsize
(
cuºítf⁄tsize
);

2107 
	`døw_mesßge
();

2110 
	`Ârötf
(
ps
, "%.2‡%.2‡%.2‡%.2‡ª˘ ", 
ps_À·
, 
ps_bŸ
, 
ps_right
,

2111 
ps_t›
);

2112 
	`Ârötf
(
ps
, "clipÇewpath\n\n");

2115 
	}
}

2118 
	$˛o£_po°s¸ùt
()

2123 
	`Ârötf
(
ps
, "showpage\n");

2124 
	`Ârötf
(
ps
, "\n%%%%Trailer\n");

2125 
	`f˛o£
(
ps
);

2126 
di•_ty≥
 = 
SCREEN
;

2127 
	`upd©e_å™sf‹m
();

2134 
	`f‹˚_£tcﬁ‹
(
cuºítcﬁ‹
);

2135 
	`f‹˚_£éöe°yÀ
(
cuºíéöe°yÀ
);

2136 
	`f‹˚_£éöewidth
(
cuºíéöewidth
);

2137 
	`f‹˚_£tf⁄tsize
(
cuºítf⁄tsize
);

2138 
	}
}

2143 
evít_lo›
((*
a˘_⁄_buâ⁄
Ë(
x
,

2144 
y
),

2145 (*
døws¸ìn
) ())

2147 
	}
}

2150 
	$öô_gøphics
(*
wödow_«me
)

2152 
	}
}

2154 
	$˛o£_gøphics
()

2156 
	}
}

2158 
	$upd©e_mesßge
(*
msg
)

2160 
	}
}

2162 
	$døw_mesßge
()

2164 
	}
}

2166 
	$öô_w‹ld
(
xl
,

2167 
yt
,

2168 
xr
,

2169 
yb
)

2171 
	}
}

2173 
	$Êushöput
()

2175 
	}
}

2177 
	$£tcﬁ‹
(
cödex
)

2179 
	}
}

2181 
	$£éöe°yÀ
(
löe°yÀ
)

2183 
	}
}

2185 
	$£éöewidth
(
löewidth
)

2187 
	}
}

2189 
	$£tf⁄tsize
(
poötsize
)

2191 
	}
}

2193 
	$døwlöe
(
x1
,

2194 
y1
,

2195 
x2
,

2196 
y2
)

2198 
	}
}

2200 
	$døwª˘
(
x1
,

2201 
y1
,

2202 
x2
,

2203 
y2
)

2205 
	}
}

2207 
	$fûÃe˘
(
x1
,

2208 
y1
,

2209 
x2
,

2210 
y2
)

2212 
	}
}

2214 
	$fûÕﬁy
(
t_poöt
 * 
poöts
,

2215 
≈oöts
)

2217 
	}
}

2219 
	$døw¨c
(
x˚n
,

2220 
y˚n
,

2221 
ød
,

2222 
°¨èng
,

2223 
™gexã¡
)

2225 
	}
}

2228 
	$fûœrc
(
x˚n
,

2229 
y˚n
,

2230 
ød
,

2231 
°¨èng
,

2232 
™gexã¡
)

2234 
	}
}

2237 
	$døwãxt
(
xc
,

2238 
yc
,

2239 c⁄° *
ãxt
,

2240 
boundx
)

2242 
	}
}

2244 
	$˛órs¸ìn
()

2246 
	}
}

2249 
¸óã_buâ⁄
(*
¥ev_buâ⁄_ãxt
,

2250 *
buâ⁄_ãxt
,

2251 (*
buâ⁄_func
Ë((*
døws¸ìn
) ()))

2253 
	}
}

2256 
	$de°roy_buâ⁄
(*
buâ⁄_ãxt
)

2258 
	}
}

2261 
	$öô_po°s¸ùt
(*
‚ame
)

2264 
	}
}

2267 
	$˛o£_po°s¸ùt
()

2269 
	}
}

	@graphics.h

1 
	#SCREEN
 0

	)

2 
	#POSTSCRIPT
 1

	)

4 
	ecﬁ‹_ty≥s


5 { 
	mWHITE
, 
	mBLACK
, 
	mDARKGREY
, 
	mLIGHTGREY
, 
	mBLUE
, 
	mGREEN
, 
	mYELLOW
,

6 
	mCYAN
, 
	mRED
, 
	mDARKGREEN
, 
	mMAGENTA
, 
	mBISQUE
, 
	mLIGHTBLUE
, 
	mTHISTLE
, 
	mPLUM
, 
	mKHAKI
,

7 
	mCORAL
, 
	mTURQUOISE
, 
	mMEDIUMPURPLE
, 
	mDARKSLATEBLUE
, 
	mDARKKHAKI
, 
	mNUM_COLOR


10 
	elöe_ty≥s


11 { 
	mSOLID
, 
	mDASHED
 };

13 
	#MAXPTS
 100

	)

16 
	mx
;

17 
	my
;

19 
	tt_poöt
;

26 
evít_lo›
((*
a˘_⁄_buâ⁄
Ë(
x
,

27 
y
),

28 (*
døws¸ìn
) ());

30 
	`öô_gøphics
(*
wödow_«me
);

31 
	`˛o£_gøphics
();

34 
	`upd©e_mesßge
(*
msg
);

40 
	`døw_mesßge
();

43 
	`öô_w‹ld
(
xl
,

44 
yt
,

45 
xr
,

46 
yb
);

48 
	`Êushöput
();

53 
	`£tcﬁ‹
(
cödex
);

54 
	`£éöe°yÀ
(
löe°yÀ
);

55 
	`£éöewidth
(
löewidth
);

56 
	`£tf⁄tsize
(
poötsize
);

57 
	`døwlöe
(
x1
,

58 
y1
,

59 
x2
,

60 
y2
);

61 
	`døwª˘
(
x1
,

62 
y1
,

63 
x2
,

64 
y2
);

65 
	`fûÃe˘
(
x1
,

66 
y1
,

67 
x2
,

68 
y2
);

69 
	`fûÕﬁy
(
t_poöt
 * 
poöts
,

70 
≈oöts
);

76 
	`døw¨c
(
x˚n
,

77 
y˚n
,

78 
ød
,

79 
°¨èng
,

80 
™gexã¡
);

81 
	`fûœrc
(
x˚n
,

82 
y˚n
,

83 
ød
,

84 
°¨èng
,

85 
™gexã¡
);

90 
	`døwãxt
(
xc
,

91 
yc
,

92 c⁄° *
ãxt
,

93 
boundx
);

94 
	`˛órs¸ìn
();

99 
	`¸óã_buâ⁄
(*
¥ev_buâ⁄_ãxt
,

100 *
buâ⁄_ãxt
,

101 (*
buâ⁄_func
Ë((*
døws¸ìn
) ()));

102 
	`de°roy_buâ⁄
(*
buâ⁄_ãxt
);

108 
	`öô_po°s¸ùt
(*
‚ame
);

112 
	`˛o£_po°s¸ùt
();

	@hash.c

1 
	~<°dlib.h
>

2 
	~<°rög.h
>

3 
	~"hash.h
"

4 
	~"utû.h
"

6 
	#HASHSIZE
 4093

	)

8 
hash_vÆue
(*
«me
);

12 
s_hash
 **

13 
	$Æloc_hash_èbÀ
()

18 
s_hash
 **
hash_èbÀ
;

20 
hash_èbÀ
 = (
s_hash
 **)
	`my_ˇŒoc
((s_hash *),

21 
HASHSIZE
);

22  (
hash_èbÀ
);

23 
	}
}

27 
	$‰ì_hash_èbÀ
(
s_hash
 **
hash_èbÀ
)

32 
i
;

33 
s_hash
 *
h_±r
, *
ãmp_±r
;

35 
i
 = 0; i < 
HASHSIZE
; i++)

37 
h_±r
 = 
hash_èbÀ
[
i
];

38 
h_±r
 !
NULL
)

40 
	`‰ì
(
h_±r
->
«me
);

41 
ãmp_±r
 = 
h_±r
->
√xt
;

42 
	`‰ì
(
h_±r
);

43 
h_±r
 = 
ãmp_±r
;

47 
	`‰ì
(
hash_èbÀ
);

48 
	}
}

51 
s_hash_ôî©‹


52 
	$°¨t_hash_èbÀ_ôî©‹
()

58 
s_hash_ôî©‹
 
hash_ôî©‹
;

60 
hash_ôî©‹
.
i
 = -1;

61 
hash_ôî©‹
.
h_±r
 = 
NULL
;

62  (
hash_ôî©‹
);

63 
	}
}

66 
s_hash
 *

67 
	$gë_√xt_hash
(
s_hash
 **
hash_èbÀ
,

68 
s_hash_ôî©‹
 *
hash_ôî©‹
)

74 
i
;

75 
s_hash
 *
h_±r
;

77 
i
 = 
hash_ôî©‹
->i;

78 
h_±r
 = 
hash_ôî©‹
->h_ptr;

80 
h_±r
 =
NULL
)

82 
i
++;

83 if(
i
 >
HASHSIZE
)

84  (
NULL
);

86 
h_±r
 = 
hash_èbÀ
[
i
];

89 
hash_ôî©‹
->
h_±r
 = h_±r->
√xt
;

90 
hash_ôî©‹
->
i
 = i;

91  (
h_±r
);

92 
	}
}

95 
s_hash
 *

96 
	$ö£π_ö_hash_èbÀ
(
s_hash
 **
hash_èbÀ
,

97 *
«me
,

98 
√xt_‰ì_ödex
)

107 
i
;

108 
s_hash
 *
h_±r
, *
¥ev_±r
;

110 
i
 = 
	`hash_vÆue
(
«me
);

111 
¥ev_±r
 = 
NULL
;

112 
h_±r
 = 
hash_èbÀ
[
i
];

114 
h_±r
 !
NULL
)

116 if(
	`°rcmp
(
h_±r
->
«me
,Çame) == 0)

118 
h_±r
->
cou¡
++;

119  (
h_±r
);

122 
¥ev_±r
 = 
h_±r
;

123 
h_±r
 = h_±r->
√xt
;

128 
h_±r
 = (
s_hash
 *)
	`my_mÆloc
((s_hash));

129 if(
¥ev_±r
 =
NULL
)

131 
hash_èbÀ
[
i
] = 
h_±r
;

135 
¥ev_±r
->
√xt
 = 
h_±r
;

137 
h_±r
->
√xt
 = 
NULL
;

138 
h_±r
->
ödex
 = 
√xt_‰ì_ödex
;

139 
h_±r
->
cou¡
 = 1;

140 
h_±r
->
«me
 = (*)
	`my_mÆloc
((
	`°æí
(name) + 1) * ());

141 
	`°r˝y
(
h_±r
->
«me
,Çame);

142  (
h_±r
);

143 
	}
}

146 
s_hash
 *

147 
	$gë_hash_íåy
(
s_hash
 **
hash_èbÀ
,

148 *
«me
)

154 
i
;

155 
s_hash
 *
h_±r
;

157 
i
 = 
	`hash_vÆue
(
«me
);

158 
h_±r
 = 
hash_èbÀ
[
i
];

160 
h_±r
 !
NULL
)

162 if(
	`°rcmp
(
h_±r
->
«me
,Çame) == 0)

163  (
h_±r
);

165 
h_±r
 = h_±r->
√xt
;

168  (
NULL
);

169 
	}
}

173 
	$hash_vÆue
(*
«me
)

179 
i
, 
k
;

180 
vÆ
 = 0, 
mu…
 = 1;

182 
i
 = 
	`°æí
(
«me
);

183 
k
 = 
	`max
(
i
 - 8, 0);

184 
i
 = 
	`°æí
(
«me
Ë- 1; i >
k
; i--)

186 
vÆ
 +
mu…
 * (()
«me
[
i
]);

187 
mu…
 *= 7;

189 
vÆ
 +()
«me
[0];

190 
vÆ
 %
HASHSIZE
;

191  (
vÆ
);

192 
	}
}

	@hash.h

1 
	ss_hash


3 *
	m«me
;

4 
	mödex
;

5 
	mcou¡
;

6 
s_hash
 *
	m√xt
;

17 
	ss_hash_ôî©‹


19 
	mi
;

20 
s_hash
 *
	mh_±r
;

29 
s_hash
 **
Æloc_hash_èbÀ
();

30 
‰ì_hash_èbÀ
(
s_hash
 **
hash_èbÀ
);

31 
s_hash_ôî©‹
 
°¨t_hash_èbÀ_ôî©‹
();

32 
s_hash
 *
gë_√xt_hash
(s_hash **
hash_èbÀ
,

33 
s_hash_ôî©‹
 *
hash_ôî©‹
);

34 
s_hash
 *
ö£π_ö_hash_èbÀ
(s_hash **
hash_èbÀ
,

35 *
«me
,

36 
√xt_‰ì_ödex
);

37 
s_hash
 *
gë_hash_íåy
(s_hash **
hash_èbÀ
,

38 *
«me
);

	@heapsort.c

1 
	~"hóps‹t.h
"

5 
add_to_s‹t_hóp
(*
hóp
,

6 *
s‹t_vÆues
,

7 
ödex
,

8 
hóp_èû
);

10 
gë_t›_of_hóp_ödex
(*
hóp
,

11 *
s‹t_vÆues
,

12 
hóp_èû
);

19 
	$hóps‹t
(*
s‹t_ödex
,

20 *
s‹t_vÆues
,

21 
√Àm
)

28 
i
;

32 
i
 = 1; i <
√Àm
; i++)

33 
	`add_to_s‹t_hóp
(
s‹t_ödex
, 
s‹t_vÆues
, 
i
, i);

40 
i
 = 
√Àm
; i >= 1; i--)

41 
s‹t_ödex
[
i
] = 
	`gë_t›_of_hóp_ödex
(s‹t_ödex, 
s‹t_vÆues
, i);

42 
	}
}

46 
	$add_to_s‹t_hóp
(*
hóp
,

47 *
s‹t_vÆues
,

48 
ödex
,

49 
hóp_èû
)

55 
i‰om
, 
ôo
;

56 
ãmp
;

58 
hóp
[
hóp_èû
] = 
ödex
;

59 
i‰om
 = 
hóp_èû
;

60 
ôo
 = 
i‰om
 / 2;

62 
ôo
 >1 && 
s‹t_vÆues
[
hóp
[
i‰om
]] < sort_values[heap[ito]])

64 
ãmp
 = 
hóp
[
ôo
];

65 
hóp
[
ôo
] = hóp[
i‰om
];

66 
hóp
[
i‰om
] = 
ãmp
;

67 
i‰om
 = 
ôo
;

68 
ôo
 = 
i‰om
 / 2;

70 
	}
}

74 
	$gë_t›_of_hóp_ödex
(*
hóp
,

75 *
s‹t_vÆues
,

76 
hóp_èû
)

83 
ödex_of_smÆÀ°
, 
ãmp
;

84 
i‰om
, 
ôo
, 
hóp_íd
;

86 
ödex_of_smÆÀ°
 = 
hóp
[1];

87 
hóp
[1] = hóp[
hóp_èû
];

88 
hóp_íd
 = 
hóp_èû
 - 1;

89 
i‰om
 = 1;

90 
ôo
 = 2 * 
i‰om
;

92 
ôo
 <
hóp_íd
)

94 if(
s‹t_vÆues
[
hóp
[
ôo
 + 1]] < sort_values[heap[ito]])

95 
ôo
++;

97 if(
s‹t_vÆues
[
hóp
[
ôo
]] > s‹t_vÆues[hóp[
i‰om
]])

100 
ãmp
 = 
hóp
[
ôo
];

101 
hóp
[
ôo
] = hóp[
i‰om
];

102 
hóp
[
i‰om
] = 
ãmp
;

103 
i‰om
 = 
ôo
;

104 
ôo
 = 2 * 
i‰om
;

107  (
ödex_of_smÆÀ°
);

108 
	}
}

	@heapsort.h

1 
hóps‹t
(*
s‹t_ödex
,

2 *
s‹t_vÆues
,

3 
√Àm
);

	@main.c

1 
	~<°dio.h
>

2 
	~<°rög.h
>

3 
	~<as£π.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"globÆs.h
"

7 
	~"gøphics.h
"

8 
	~"ªad_√éi°.h
"

9 
	~"¥öt_√éi°.h
"

10 
	~"døw.h
"

11 
	~"∂a˚_™d_rouã.h
"

12 
	~"°©s.h
"

13 
	~"∑th_dñay.h
"

14 
	~"O±i⁄Tokís.h
"

15 
	~"RódO±i⁄s.h
"

16 
	~"xml_¨ch.h
"

17 
	~"SëupVPR.h
"

18 
	~"º_gøph.h
"

21 
	gFs_£ed
 = -1;

22 
boﬁón
 
	gWMF_DEBUG
 = 
FALSE
;

24 
	gW_£ed
 = -1;

25 
	gbö¨y_£¨ch
 = -1;

26 *
	gOutFûePªfix
 = 
NULL
;

28 
	ggrid_logic_tûe_¨ó
 = 0;

29 
	gùö_mux_å™s_size
 = 0;

33 
	gnum_√ts
 = 0;

34 
s_√t
 *
	g√t
 = 
NULL
;

36 
	gnum_blocks
 = 0;

37 
s_block
 *
	gblock
 = 
NULL
;

41 
	gnum_ty≥s
 = 0;

42 
s_ty≥_des¸ùt‹
 *
	gty≥_des¸ùt‹s
 = 
NULL
;

44 
t_ty≥_±r
 
	gIO_TYPE
 = 
NULL
;

45 
t_ty≥_±r
 
	gEMPTY_TYPE
 = 
NULL
;

46 
t_ty≥_±r
 
	gFILL_TYPE
 = 
NULL
;

51 
	gnx
 = 0;

52 
	gny
 = 0;

61 *
	gch™_width_x
 = 
NULL
;

62 *
	gch™_width_y
 = 
NULL
;

64 
s_grid_tûe
 **
	ggrid
 = 
NULL
;

70 
s_åa˚
 **
	gåa˚_hód
 = 
NULL
;

71 
s_åa˚
 **
	gåa˚_èû
 = 
NULL
;

76 
	gnum_º_nodes
 = 0;

77 
t_º_node
 *
	gº_node
 = 
NULL
;

78 
t_ivec
 ***
	gº_node_ödi˚s
 = 
NULL
;

80 
	gnum_º_ödexed_d©a
 = 0;

81 
t_º_ödexed_d©a
 *
	gº_ödexed_d©a
 = 
NULL
;

85 **
	g√t_º_ãrmöÆs
 = 
NULL
;

90 
s_swôch_öf
 *
	gswôch_öf
 = 
NULL
;

94 **
	gº_blk_sour˚
 = 
NULL
;

99 
PrötUßge
();

100 
PrötTôÀ
();

101 
‰ìArch
(
t_¨ch
* 
Arch
);

108 
	$maö
(
¨gc
,

109 **
¨gv
)

111 
t_›ti⁄s
 
O±i⁄s
;

112 
t_¨ch
 
Arch
 = { 0 };

114 
e_›î©i⁄
 
O≥øti⁄
;

115 
s_∂a˚r_›ts
 
Pœ˚rO±s
;

116 
s_™√Æög_sched
 
A¬ólSched
;

117 
s_rouãr_›ts
 
RouãrO±s
;

118 
s_dë_routög_¨ch
 
RoutögArch
;

119 
t_£gmít_öf
 *
Segmíts
;

120 
t_timög_öf
 
Timög
;

121 
t_subblock_d©a
 
Subblocks
;

122 
boﬁón
 
ShowGøphics
;

123 
boﬁón
 
TimögE«bÀd
;

124 
GøphPau£
;

128 
	`PrötTôÀ
();

131 if(
¨gc
 < 2)

133 
	`PrötUßge
();

134 
	`exô
(1);

138 
	`RódO±i⁄s
(
¨gc
, 
¨gv
, &
O±i⁄s
);

141 
TimögE«bÀd
 = 
	`IsTimögE«bÀd
(
O±i⁄s
);

144 
	`SëupVPR
(
O±i⁄s
, 
TimögE«bÀd
, &
Arch
, &
O≥øti⁄
, &
Pœ˚rO±s
,

145 &
A¬ólSched
, &
RouãrO±s
, &
RoutögArch
, &
Segmíts
,

146 &
Timög
, &
Subblocks
, &
ShowGøphics
, &
GøphPau£
);

149 
	`CheckO±i⁄s
(
O±i⁄s
, 
TimögE«bÀd
);

150 
	`CheckArch
(
Arch
, 
TimögE«bÀd
);

153 
	`CheckSëup
(
O≥øti⁄
, 
Pœ˚rO±s
, 
A¬ólSched
, 
RouãrO±s
,

154 
RoutögArch
, 
Segmíts
, 
Timög
, 
Subblocks
, 
Arch
.
Ch™s
);

157 
	`ShowSëup
(
O±i⁄s
, 
Arch
, 
TimögE«bÀd
, 
O≥øti⁄
, 
Pœ˚rO±s
,

158 
A¬ólSched
, 
RouãrO±s
, 
RoutögArch
, 
Segmíts
, 
Timög
,

159 
Subblocks
);

161 if(
O≥øti⁄
 =
TIMING_ANALYSIS_ONLY
) {

162 
	`do_c⁄°™t_√t_dñay_timög_™Æysis
(

163 
Timög
, 
Subblocks
, 
O±i⁄s
.
c⁄°™t_√t_dñay
);

168 
	`£t_gøphics_°©e
(
ShowGøphics
, 
GøphPau£
, 
RouãrO±s
.
rouã_ty≥
);

169 if(
ShowGøphics
)

171 
	`öô_gøphics
("VPR: Versatile Placeánd Route for FPGAs");

172 
	`Æloc_døw_°ru˘s
();

176 
	`∂a˚_™d_rouã
(
O≥øti⁄
, 
Pœ˚rO±s
, 
O±i⁄s
.
Pœ˚Fûe
,

177 
O±i⁄s
.
NëFûe
, O±i⁄s.
ArchFûe
, O±i⁄s.
RouãFûe
,

178 
A¬ólSched
, 
RouãrO±s
, 
RoutögArch
,

179 
Segmíts
, 
Timög
, &
Subblocks
, 
Arch
.
Ch™s
);

182 if(
ShowGøphics
)

183 
	`˛o£_gøphics
();

186 
	`‰ì
(
O±i⁄s
.
Pœ˚Fûe
);

187 
	`‰ì
(
O±i⁄s
.
NëFûe
);

188 
	`‰ì
(
O±i⁄s
.
ArchFûe
);

189 
	`‰ì
(
O±i⁄s
.
RouãFûe
);

191 
	`‰ìArch
(&
Arch
);

195 
	}
}

201 
	$PrötUßge
()

203 
	`puts
("Usage: vpr circuit.net fpga.archÖlaced.outÑouted.out [Options ...]");

204 
	`puts
("");

205 
	`puts
("General Options: [-nodisp] [-auto <int>] [-route_only]");

206 
	`puts
("\t[-place_only] [-timing_analyze_only_with_net_delay <float>]");

207 
	`puts
("\t[-fast] [-full_stats] [-timing_analysis on | off] [-outfile_prefix <string>]");

208 
	`puts
("");

209 
	`puts
("Placer Options:");

210 
	`puts
("\t[-place_algorithm bounding_box |Çet_timing_driven |Öath_timing_driven]");

211 
	`puts
("\t[-init_t <float>] [-exit_t <float>]");

212 
	`puts
("\t[-alpha_t <float>] [-inner_num <float>] [-seed <int>]");

213 
	`puts
("\t[-place_cost_exp <float>] [-place_cost_typeÜinear |Çonlinear]");

214 
	`puts
("\t[-place_chan_width <int>] [-num_regions <int>] ");

215 
	`puts
("\t[-fix_pinsÑandom | <file.pads>]");

216 
	`puts
("\t[-enable_timing_computations on | off]");

217 
	`puts
("\t[-block_dist <int>]");

218 
	`puts
("");

219 
	`puts
("Placement Options Valid Only for Timing-Driven Placement:");

220 
	`puts
("\t[-timing_tradeoff <float>]");

221 
	`puts
("\t[-recompute_crit_iter <int>]");

222 
	`puts
("\t[-inner_loop_recompute_divider <int>]");

223 
	`puts
("\t[-td_place_exp_first <float>]");

224 
	`puts
("\t[-td_place_exp_last <float>]");

225 
	`puts
("");

226 
	`puts
("Router Options: [-max_router_iterations <int>] [-bb_factor <int>]");

227 
	`puts
("\t[-initial_pres_fac <float>] [-pres_fac_mult <float>]");

228 
	`puts
("\t[-acc_fac <float>] [-first_iter_pres_fac <float>]");

229 
	`puts
("\t[-bend_cost <float>] [-route_type global | detailed]");

230 
	`puts
("\t[-verify_binary_search] [-route_chan_width <int>]");

231 
	`puts
("\t[-router_algorithm breadth_first |Åiming_driven]");

232 
	`puts
("\t[-base_cost_type intrinsic_delay | delay_normalized | demand_only]");

233 
	`puts
("");

234 
	`puts
("Routing options valid only forÅiming-drivenÑouting:");

235 
	`puts
("\t[-astar_fac <float>] [-max_criticality <float>]");

236 
	`puts
("\t[-criticality_exp <float>]");

237 
	`puts
("");

238 
	}
}

243 
	$PrötTôÀ
()

245 
	`puts
("");

246 
	`puts
("VPR FPGA Placementánd Routing.");

247 
	`puts
("Version: Version 5.0.2");

248 
	`puts
("Compûed: " 
__DATE__
 ".");

249 
	`puts
("Original VPR by V. Betz.");

250 
	`puts
("Timing-drivenÖlacementÉnhancements by A. Marquardt.");

251 
	`puts
("Single-driversÉnhancements by Andy Ye withádditions by.");

252 
	`puts
("Mark Fang, Jason Luu, Ted Campbell");

253 
	`puts
("Heterogeneous stucture support by Jason Luuánd Ted Campbell.");

254 
	`puts
("This code isÜicensed only forÇon-commercial use.");

255 
	`puts
("");

256 
	}
}

258 
	$‰ìArch
(
t_¨ch
* 
Arch
)

260 
i
;

261 
i
 = 0; i < 
Arch
->
num_swôches
; i++) {

262 if(
Arch
->
Swôches
->
«me
 !
NULL
) {

263 
	`‰ì
(
Arch
->
Swôches
[
i
].
«me
);

266 
	`‰ì
(
Arch
->
Swôches
);

267 
i
 = 0; i < 
Arch
->
num_£gmíts
; i++) {

268 if(
Arch
->
Segmíts
->
cb
 !
NULL
) {

269 
	`‰ì
(
Arch
->
Segmíts
[
i
].
cb
);

271 if(
Arch
->
Segmíts
->
sb
 !
NULL
) {

272 
	`‰ì
(
Arch
->
Segmíts
[
i
].
sb
);

275 
	`‰ì
(
Arch
->
Segmíts
);

276 
	}
}

	@mst.c

1 
	~<limôs.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"m°.h
"

7 
	#ABS_DIFF
(
X
, 
Y
Ë(((XË> (Y))? ((XË- (Y)):((YË- (X)))

	)

9 
mö_di°_‰om_m°
(
node_outside
,

10 
öë
,

11 
boﬁón
 * 
ö_m°
,

12 *
node_öside
);

14 
t_m°_edge
 *

15 
	$gë_m°_of_√t
(
öë
)

17 
i
, 
ùö
, 
node_di°
, 
node_ö_m°
, 
num_pös_⁄_√t
, 
num_edges
;

18 
√¨e°_node
, 
√¨e°_node_di°
, 
√¨e°_node_ö_m°
;

19 
t_m°_edge
 *
mö_•™åì
;

20 
boﬁón
 *
ö_m°
;

24 
num_pös_⁄_√t
 = (
√t
[
öë
].
num_söks
 + 1);

25 if(
num_pös_⁄_√t
 > 
USHRT_MAX
)

27 
	`¥ötf
("Error:Çum_pins_on_net (%d) > USHRT_MAX(%u)\n",

28 
num_pös_⁄_√t
, 
USHRT_MAX
);

29 
	`exô
(1);

33 
mö_•™åì
 =

34 (
t_m°_edge
 *Ë
	`my_mÆloc
(—_m°_edgeË* (
num_pös_⁄_√t
 - 1));

35 
ö_m°
 = (
boﬁón
 *Ë
	`my_mÆloc
((boﬁónË* (
num_pös_⁄_√t
));

38 
ö_m°
[0] = 
TRUE
;

39 
ùö
 = 1; ipö < 
num_pös_⁄_√t
; ipin++)

40 
ö_m°
[
ùö
] = 
FALSE
;

42 
num_edges
 = 0;

45 
i
 = 1; i < 
num_pös_⁄_√t
; i++)

49 
√¨e°_node
 = -1;

50 
√¨e°_node_di°
 = -1;

51 
√¨e°_node_ö_m°
 = -1;

53 
ùö
 = 1; ipö < 
num_pös_⁄_√t
; ipin++)

56 if(!
ö_m°
[
ùö
])

58 
node_di°
 =

59 
	`mö_di°_‰om_m°
(
ùö
, 
öë
, 
ö_m°
,

60 &
node_ö_m°
);

62 if(
√¨e°_node
 == -1)

64 
√¨e°_node
 = 
ùö
;

65 
√¨e°_node_di°
 = 
node_di°
;

66 
√¨e°_node_ö_m°
 = 
node_ö_m°
;

71 if(
√¨e°_node_di°
 >
node_di°
)

73 
√¨e°_node
 = 
ùö
;

74 
√¨e°_node_di°
 = 
node_di°
;

75 
√¨e°_node_ö_m°
 = 
node_ö_m°
;

78 if(
√¨e°_node_di°
 < 0)

80 
¥ötf


82 
	`exô
(1);

89 
mö_•™åì
[
num_edges
].
‰om_node
 = 
√¨e°_node_ö_m°
;

91 
mö_•™åì
[
num_edges
].
to_node
 = 
√¨e°_node
;

93 
num_edges
++;

95 
ö_m°
[
√¨e°_node
] = 
TRUE
;

98 
	`‰ì
(
ö_m°
);

99  
mö_•™åì
;

100 
	}
}

103 
	$mö_di°_‰om_m°
(
node_outside
,

104 
öë
,

105 
boﬁón
 * 
ö_m°
,

106 *
node_öside
)

108 
ùö
, 
blk1
, 
blk2
, 
di°
, 
˛o£°_node_ö_m°
, 
sh‹ã°_di°
;

113 
˛o£°_node_ö_m°
 = -1;

114 
sh‹ã°_di°
 = -1;

116 
ùö
 = 0; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

118 if(
ö_m°
[
ùö
])

120 
blk1
 = 
√t
[
öë
].
node_block
[
node_outside
];

121 
blk2
 = 
√t
[
öë
].
node_block
[
ùö
];

123 
di°
 =

124 
	`ABS_DIFF
(
block
[
blk1
].
x
,

125 
block
[
blk2
].
x
Ë+ 
	`ABS_DIFF
(block[
blk1
].
y
,

126 
block
[
blk2
].
y
);

128 if(
˛o£°_node_ö_m°
 == -1)

130 
˛o£°_node_ö_m°
 = 
ùö
;

131 
sh‹ã°_di°
 = 
di°
;

135 if(
sh‹ã°_di°
 > 
di°
)

137 
˛o£°_node_ö_m°
 = 
ùö
;

138 
sh‹ã°_di°
 = 
di°
;

144 *
node_öside
 = 
˛o£°_node_ö_m°
;

146  
sh‹ã°_di°
;

147 
	}
}

	@mst.h

1 
	ss_m°_edge


3 
	m‰om_node
;

4 
	mto_node
;

7 
	tt_m°_edge
;

9 
t_m°_edge
 *
gë_m°_of_√t
(
öë
);

	@net_delay.c

1 
	~<°dio.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"√t_dñay.h
"

10 
	ss_löked_rc_edge


12 
s_rc_node
 *
	mchûd
;

13 
	miswôch
;

14 
s_löked_rc_edge
 *
	m√xt
;

17 
s_löked_rc_edge
 
	tt_löked_rc_edge
;

27 
	ss_rc_node


31 
t_löked_rc_edge
 *
	mchûd_li°
;

32 
s_rc_node
 *
	m√xt
;

34 
	mu
;

35 
	möode
;

36 
	mC_down°ªam
;

37 
	mTdñ
;

40 
s_rc_node
 
	tt_rc_node
;

55 
	ss_löked_rc_±r


57 
s_rc_node
 *
	mrc_node
;

58 
s_löked_rc_±r
 *
	m√xt
;

61 
s_löked_rc_±r
 
	tt_löked_rc_±r
;

71 
t_rc_node
 *
Æloc_™d_lﬂd_rc_åì
(
öë
,

72 
t_rc_node
 ** 
rc_node_‰ì_li°_±r
,

73 
t_löked_rc_edge
 **

74 
rc_edge_‰ì_li°_±r
,

75 
t_löked_rc_±r
 *

76 
º_node_to_rc_node
);

78 
add_to_rc_åì
(
t_rc_node
 * 
∑ª¡_rc
,

79 
t_rc_node
 * 
chûd_rc
,

80 
iswôch
,

81 
öode
,

82 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
);

84 
t_rc_node
 *
Æloc_rc_node
—_rc_nodê** 
rc_node_‰ì_li°_±r
);

86 
‰ì_rc_node
(
t_rc_node
 * 
rc_node
,

87 
t_rc_node
 ** 
rc_node_‰ì_li°_±r
);

89 
t_löked_rc_edge
 *
Æloc_löked_rc_edge
(t_linked_rc_edge

90 ** 
rc_edge_‰ì_li°_±r
);

92 
‰ì_löked_rc_edge
(
t_löked_rc_edge
 * 
rc_edge
,

93 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
);

95 
lﬂd_rc_åì_C
(
t_rc_node
 * 
rc_node
);

97 
lﬂd_rc_åì_T
(
t_rc_node
 * 
rc_node
,

98 
T_¨rivÆ
);

100 
lﬂd_⁄e_√t_dñay
(**
√t_dñay
,

101 
öë
,

102 
t_löked_rc_±r
 * 
º_node_to_rc_node
);

104 
lﬂd_⁄e_c⁄°™t_√t_dñay
(**
√t_dñay
,

105 
öë
,

106 
dñay_vÆue
);

108 
‰ì_rc_åì
(
t_rc_node
 * 
rc_roŸ
,

109 
t_rc_node
 ** 
rc_node_‰ì_li°_±r
,

110 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
);

112 
ª£t_º_node_to_rc_node
(
t_löked_rc_±r
 * 
º_node_to_rc_node
,

113 
öë
);

115 
‰ì_rc_node_‰ì_li°
(
t_rc_node
 * 
rc_node_‰ì_li°
);

117 
‰ì_rc_edge_‰ì_li°
(
t_löked_rc_edge
 * 
rc_edge_‰ì_li°
);

125 
	$Æloc_√t_dñay
(
s_löked_v±r
 **
chunk_li°_hód_±r
)

132 **
√t_dñay
;

133 *
tmp_±r
;

134 
öë
;

135 
chunk_byãs_avaû
;

136 *
chunk_√xt_avaû_mem
;

138 *
chunk_li°_hód_±r
 = 
NULL
;

139 
chunk_byãs_avaû
 = 0;

140 
chunk_√xt_avaû_mem
 = 
NULL
;

142 
√t_dñay
 = (**)
	`my_mÆloc
(
num_√ts
 * (*));

144 
öë
 = 0; i√à< 
num_√ts
; inet++)

146 
tmp_±r
 =

147 (*)
	`my_chunk_mÆloc
(((
√t
[
öë
].
num_söks
 + 1) - 1) *

148 (), 
chunk_li°_hód_±r
,

149 &
chunk_byãs_avaû
,

150 &
chunk_√xt_avaû_mem
);

152 
√t_dñay
[
öë
] = 
tmp_±r
 - 1;

155  (
√t_dñay
);

156 
	}
}

160 
	$‰ì_√t_dñay
(**
√t_dñay
,

161 
s_löked_v±r
 **
chunk_li°_hód_±r
)

166 
	`‰ì
(
√t_dñay
);

167 
	`‰ì_chunk_mem‹y
(*
chunk_li°_hód_±r
);

168 *
chunk_li°_hód_±r
 = 
NULL
;

169 
	}
}

173 
	$lﬂd_√t_dñay_‰om_routög
(**
√t_dñay
)

182 
t_rc_node
 *
rc_node_‰ì_li°
, *
rc_roŸ
;

183 
t_löked_rc_edge
 *
rc_edge_‰ì_li°
;

184 
öë
;

185 
t_löked_rc_±r
 *
º_node_to_rc_node
;

187 
º_node_to_rc_node
 = (
t_löked_rc_±r
 *Ë
	`my_ˇŒoc
(
num_º_nodes
,

189 (
t_löked_rc_±r
));

191 
rc_node_‰ì_li°
 = 
NULL
;

192 
rc_edge_‰ì_li°
 = 
NULL
;

194 
öë
 = 0; i√à< 
num_√ts
; inet++)

196 if(
√t
[
öë
].
is_globÆ
)

198 
	`lﬂd_⁄e_c⁄°™t_√t_dñay
(
√t_dñay
, 
öë
, 0.);

202 
rc_roŸ
 = 
	`Æloc_™d_lﬂd_rc_åì
(
öë
, &
rc_node_‰ì_li°
,

203 &
rc_edge_‰ì_li°
,

204 
º_node_to_rc_node
);

205 
	`lﬂd_rc_åì_C
(
rc_roŸ
);

206 
	`lﬂd_rc_åì_T
(
rc_roŸ
, 0.);

207 
	`lﬂd_⁄e_√t_dñay
(
√t_dñay
, 
öë
, 
º_node_to_rc_node
);

208 
	`‰ì_rc_åì
(
rc_roŸ
, &
rc_node_‰ì_li°
,

209 &
rc_edge_‰ì_li°
);

210 
	`ª£t_º_node_to_rc_node
(
º_node_to_rc_node
, 
öë
);

214 
	`‰ì_rc_node_‰ì_li°
(
rc_node_‰ì_li°
);

215 
	`‰ì_rc_edge_‰ì_li°
(
rc_edge_‰ì_li°
);

216 
	`‰ì
(
º_node_to_rc_node
);

217 
	}
}

221 
	$lﬂd_c⁄°™t_√t_dñay
(**
√t_dñay
,

222 
dñay_vÆue
)

230 
öë
;

232 
öë
 = 0; i√à< 
num_√ts
; inet++)

234 if(
√t
[
öë
].
is_globÆ
)

236 
	`lﬂd_⁄e_c⁄°™t_√t_dñay
(
√t_dñay
, 
öë
, 0.);

240 
	`lﬂd_⁄e_c⁄°™t_√t_dñay
(
√t_dñay
, 
öë
, 
dñay_vÆue
);

243 
	}
}

246 
t_rc_node
 *

247 
	$Æloc_™d_lﬂd_rc_åì
(
öë
,

248 
t_rc_node
 ** 
rc_node_‰ì_li°_±r
,

249 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
,

250 
t_löked_rc_±r
 * 
º_node_to_rc_node
)

256 
t_rc_node
 *
cuº_rc
, *
¥ev_rc
, *
roŸ_rc
;

257 
s_åa˚
 *
çå
;

258 
öode
, 
¥ev_node
;

259 
iswôch
;

260 
t_löked_rc_±r
 *
löked_rc_±r
;

262 
roŸ_rc
 = 
	`Æloc_rc_node
(
rc_node_‰ì_li°_±r
);

263 
çå
 = 
åa˚_hód
[
öë
];

265 if(
çå
 =
NULL
)

267 
¥ötf


269 "exi°.\n", 
öë
);

270 
	`exô
(1);

273 
öode
 = 
çå
->
ödex
;

274 
iswôch
 = 
çå
->iswitch;

275 
roŸ_rc
->
öode
 = inode;

276 
roŸ_rc
->
u
.
chûd_li°
 = 
NULL
;

277 
º_node_to_rc_node
[
öode
].
rc_node
 = 
roŸ_rc
;

279 
¥ev_rc
 = 
roŸ_rc
;

280 
çå
 =Å±r->
√xt
;

282 
çå
 !
NULL
)

284 
öode
 = 
çå
->
ödex
;

289 if(
º_node_to_rc_node
[
öode
].
rc_node
 =
NULL
)

291 
cuº_rc
 = 
	`Æloc_rc_node
(
rc_node_‰ì_li°_±r
);

292 
	`add_to_rc_åì
(
¥ev_rc
, 
cuº_rc
, 
iswôch
, 
öode
,

293 
rc_edge_‰ì_li°_±r
);

294 
º_node_to_rc_node
[
öode
].
rc_node
 = 
cuº_rc
;

295 
¥ev_rc
 = 
cuº_rc
;

298 if(
º_node
[
öode
].
ty≥
 !
SINK
)

301 #ifde‡
DEBUG


302 
¥ev_node
 = 
¥ev_rc
->
öode
;

303 if(
º_node
[
¥ev_node
].
ty≥
 !
SINK
)

305 
¥ötf


307 "nŸáÅªe.\n", 
öë
);

308 
	`exô
(1);

312 
¥ev_rc
 = 
º_node_to_rc_node
[
öode
].
rc_node
;

325 
cuº_rc
 = 
	`Æloc_rc_node
(
rc_node_‰ì_li°_±r
);

326 
	`add_to_rc_åì
(
¥ev_rc
, 
cuº_rc
, 
iswôch
, 
öode
,

327 
rc_edge_‰ì_li°_±r
);

329 
löked_rc_±r
 = (
t_löked_rc_±r
 *)

330 
	`my_mÆloc
((
t_löked_rc_±r
));

331 
löked_rc_±r
->
√xt
 = 
º_node_to_rc_node
[
öode
].next;

332 
º_node_to_rc_node
[
öode
].
√xt
 = 
löked_rc_±r
;

333 
löked_rc_±r
->
rc_node
 = 
cuº_rc
;

335 
¥ev_rc
 = 
cuº_rc
;

337 
iswôch
 = 
çå
->iswitch;

338 
çå
 =Å±r->
√xt
;

341  (
roŸ_rc
);

342 
	}
}

346 
	$add_to_rc_åì
(
t_rc_node
 * 
∑ª¡_rc
,

347 
t_rc_node
 * 
chûd_rc
,

348 
iswôch
,

349 
öode
,

350 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
)

357 
t_löked_rc_edge
 *
löked_rc_edge
;

359 
löked_rc_edge
 = 
	`Æloc_löked_rc_edge
(
rc_edge_‰ì_li°_±r
);

361 
löked_rc_edge
->
√xt
 = 
∑ª¡_rc
->
u
.
chûd_li°
;

362 
∑ª¡_rc
->
u
.
chûd_li°
 = 
löked_rc_edge
;

364 
löked_rc_edge
->
chûd
 = 
chûd_rc
;

365 
löked_rc_edge
->
iswôch
 = iswitch;

367 
chûd_rc
->
u
.
chûd_li°
 = 
NULL
;

368 
chûd_rc
->
öode
 = inode;

369 
	}
}

372 
t_rc_node
 *

373 
	$Æloc_rc_node
(
t_rc_node
 ** 
rc_node_‰ì_li°_±r
)

379 
t_rc_node
 *
rc_node
;

381 
rc_node
 = *
rc_node_‰ì_li°_±r
;

383 if(
rc_node
 !
NULL
)

385 *
rc_node_‰ì_li°_±r
 = 
rc_node
->
u
.
√xt
;

389 
rc_node
 = (
t_rc_node
 *Ë
	`my_mÆloc
((t_rc_node));

392  (
rc_node
);

393 
	}
}

397 
	$‰ì_rc_node
(
t_rc_node
 * 
rc_node
,

398 
t_rc_node
 ** 
rc_node_‰ì_li°_±r
)

403 
rc_node
->
u
.
√xt
 = *
rc_node_‰ì_li°_±r
;

404 *
rc_node_‰ì_li°_±r
 = 
rc_node
;

405 
	}
}

408 
t_löked_rc_edge
 *

409 
	$Æloc_löked_rc_edge
(
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
)

415 
t_löked_rc_edge
 *
löked_rc_edge
;

417 
löked_rc_edge
 = *
rc_edge_‰ì_li°_±r
;

419 if(
löked_rc_edge
 !
NULL
)

421 *
rc_edge_‰ì_li°_±r
 = 
löked_rc_edge
->
√xt
;

425 
löked_rc_edge
 = (
t_löked_rc_edge
 *Ë
	`my_mÆloc
(

426 (
t_löked_rc_edge
));

429  (
löked_rc_edge
);

430 
	}
}

434 
	$‰ì_löked_rc_edge
(
t_löked_rc_edge
 * 
rc_edge
,

435 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
)

440 
rc_edge
->
√xt
 = *
rc_edge_‰ì_li°_±r
;

441 *
rc_edge_‰ì_li°_±r
 = 
rc_edge
;

442 
	}
}

446 
	$lﬂd_rc_åì_C
(
t_rc_node
 * 
rc_node
)

453 
t_löked_rc_edge
 *
löked_rc_edge
;

454 
t_rc_node
 *
chûd_node
;

455 
öode
;

456 
iswôch
;

457 
C
, 
C_down°ªam
;

459 
löked_rc_edge
 = 
rc_node
->
u
.
chûd_li°
;

460 
öode
 = 
rc_node
->inode;

461 
C
 = 
º_node
[
öode
].C;

463 
löked_rc_edge
 !
NULL
)

465 
iswôch
 = 
löked_rc_edge
->iswitch;

466 
chûd_node
 = 
löked_rc_edge
->
chûd
;

467 
C_down°ªam
 = 
	`lﬂd_rc_åì_C
(
chûd_node
);

469 if(
swôch_öf
[
iswôch
].
buf„ªd
 =
FALSE
)

470 
C
 +
C_down°ªam
;

472 
löked_rc_edge
 =Üöked_rc_edge->
√xt
;

475 
rc_node
->
C_down°ªam
 = 
C
;

476  (
C
);

477 
	}
}

481 
	$lﬂd_rc_åì_T
(
t_rc_node
 * 
rc_node
,

482 
T_¨rivÆ
)

490 
Tdñ
, 
RmëÆ
, 
Tchûd
;

491 
t_löked_rc_edge
 *
löked_rc_edge
;

492 
t_rc_node
 *
chûd_node
;

493 
iswôch
;

494 
öode
;

496 
Tdñ
 = 
T_¨rivÆ
;

497 
öode
 = 
rc_node
->inode;

498 
RmëÆ
 = 
º_node
[
öode
].
R
;

512 
Tdñ
 +0.5 * 
rc_node
->
C_down°ªam
 * 
RmëÆ
;

513 
rc_node
->
Tdñ
 = Tdel;

517 
löked_rc_edge
 = 
rc_node
->
u
.
chûd_li°
;

519 
löked_rc_edge
 !
NULL
)

521 
iswôch
 = 
löked_rc_edge
->iswitch;

522 
chûd_node
 = 
löked_rc_edge
->
chûd
;

524 
Tchûd
 = 
Tdñ
 + 
swôch_öf
[
iswôch
].
R
 * 
chûd_node
->
C_down°ªam
;

525 
Tchûd
 +
swôch_öf
[
iswôch
].
Tdñ
;

526 
	`lﬂd_rc_åì_T
(
chûd_node
, 
Tchûd
);

528 
löked_rc_edge
 =Üöked_rc_edge->
√xt
;

530 
	}
}

534 
	$lﬂd_⁄e_√t_dñay
(**
√t_dñay
,

535 
öë
,

536 
t_löked_rc_±r
 * 
º_node_to_rc_node
)

542 
ùö
, 
öode
;

543 
Tmax
;

544 
t_rc_node
 *
rc_node
;

545 
t_löked_rc_±r
 *
löked_rc_±r
, *
√xt_±r
;

547 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

550 
öode
 = 
√t_º_ãrmöÆs
[
öë
][
ùö
];

553 
löked_rc_±r
 = 
º_node_to_rc_node
[
öode
].
√xt
;

554 
rc_node
 = 
º_node_to_rc_node
[
öode
].rc_node;

555 
Tmax
 = 
rc_node
->
Tdñ
;

566 if(
löked_rc_±r
 !
NULL
)

575 
rc_node
 = 
löked_rc_±r
->rc_node;

576 if(
rc_node
->
Tdñ
 > 
Tmax
)

578 
Tmax
 = 
rc_node
->
Tdñ
;

579 
º_node_to_rc_node
[
öode
].
rc_node
 =

580 
rc_node
;

582 
√xt_±r
 = 
löked_rc_±r
->
√xt
;

583 
	`‰ì
(
löked_rc_±r
);

584 
löked_rc_±r
 = 
√xt_±r
;

586 
löked_rc_±r
 !
NULL
);

588 
º_node_to_rc_node
[
öode
].
√xt
 = 
NULL
;

591 
√t_dñay
[
öë
][
ùö
] = 
Tmax
;

593 
	}
}

597 
	$lﬂd_⁄e_c⁄°™t_√t_dñay
(**
√t_dñay
,

598 
öë
,

599 
dñay_vÆue
)

604 
ùö
;

606 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

607 
√t_dñay
[
öë
][
ùö
] = 
dñay_vÆue
;

608 
	}
}

612 
	$‰ì_rc_åì
(
t_rc_node
 * 
rc_roŸ
,

613 
t_rc_node
 ** 
rc_node_‰ì_li°_±r
,

614 
t_löked_rc_edge
 ** 
rc_edge_‰ì_li°_±r
)

620 
t_rc_node
 *
rc_node
, *
chûd_node
;

621 
t_löked_rc_edge
 *
rc_edge
, *
√xt_edge
;

623 
rc_node
 = 
rc_roŸ
;

624 
rc_edge
 = 
rc_node
->
u
.
chûd_li°
;

626 
rc_edge
 !
NULL
)

628 
chûd_node
 = 
rc_edge
->
chûd
;

629 
	`‰ì_rc_åì
(
chûd_node
, 
rc_node_‰ì_li°_±r
,

630 
rc_edge_‰ì_li°_±r
);

631 
√xt_edge
 = 
rc_edge
->
√xt
;

632 
	`‰ì_löked_rc_edge
(
rc_edge
, 
rc_edge_‰ì_li°_±r
);

633 
rc_edge
 = 
√xt_edge
;

636 
	`‰ì_rc_node
(
rc_node
, 
rc_node_‰ì_li°_±r
);

637 
	}
}

641 
	$ª£t_º_node_to_rc_node
(
t_löked_rc_±r
 * 
º_node_to_rc_node
,

642 
öë
)

650 
s_åa˚
 *
çå
;

651 
öode
;

653 
çå
 = 
åa˚_hód
[
öë
];

655 
çå
 !
NULL
)

657 
öode
 = 
çå
->
ödex
;

658 
º_node_to_rc_node
[
öode
].
rc_node
 = 
NULL
;

659 
çå
 =Å±r->
√xt
;

661 
	}
}

665 
	$‰ì_rc_node_‰ì_li°
(
t_rc_node
 * 
rc_node_‰ì_li°
)

670 
t_rc_node
 *
rc_node
, *
√xt_node
;

672 
rc_node
 = 
rc_node_‰ì_li°
;

674 
rc_node
 !
NULL
)

676 
√xt_node
 = 
rc_node
->
u
.
√xt
;

677 
	`‰ì
(
rc_node
);

678 
rc_node
 = 
√xt_node
;

680 
	}
}

685 
	$‰ì_rc_edge_‰ì_li°
(
t_löked_rc_edge
 * 
rc_edge_‰ì_li°
)

690 
t_löked_rc_edge
 *
rc_edge
, *
√xt_edge
;

692 
rc_edge
 = 
rc_edge_‰ì_li°
;

694 
rc_edge
 !
NULL
)

696 
√xt_edge
 = 
rc_edge
->
√xt
;

697 
	`‰ì
(
rc_edge
);

698 
rc_edge
 = 
√xt_edge
;

700 
	}
}

704 
	$¥öt_√t_dñay
(**
√t_dñay
,

705 *
‚ame
)

710 
FILE
 *
Â
;

711 
öë
, 
ùö
;

713 
Â
 = 
	`my_f›í
(
‚ame
, "w");

715 
öë
 = 0; i√à< 
num_√ts
; inet++)

717 
	`Ârötf
(
Â
, "Në: %d.\n", 
öë
);

718 
	`Ârötf
(
Â
, "Delays:");

720 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

721 
	`Ârötf
(
Â
, " %g", 
√t_dñay
[
öë
][
ùö
]);

723 
	`Ârötf
(
Â
, "\n\n");

726 
	`f˛o£
(
Â
);

727 
	}
}

	@net_delay.h

1 **
Æloc_√t_dñay
(
s_löked_v±r
 **
chunk_li°_hód_±r
);

3 
‰ì_√t_dñay
(**
√t_dñay
,

4 
s_löked_v±r
 **
chunk_li°_hód_±r
);

6 
lﬂd_√t_dñay_‰om_routög
(**
√t_dñay
);

8 
lﬂd_c⁄°™t_√t_dñay
(**
√t_dñay
,

9 
dñay_vÆue
);

11 
¥öt_√t_dñay
(**
√t_dñay
,

12 *
‚ame
);

	@path_delay.c

1 
	~<°dio.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"∑th_dñay.h
"

6 
	~"∑th_dñay2.h
"

7 
	~"√t_dñay.h
"

8 
	~"v¥_utûs.h
"

9 
	~<as£π.h
>

76 
	#T_CONSTANT_GENERATOR
 -1000

	)

80 
	ee_subblock_pö_ty≥


81 { 
	mSUB_INPUT
 = 0, 
	mSUB_OUTPUT
, 
	mSUB_CLOCK
, 
	mNUM_SUB_PIN_TYPES
 };

88 
s_löked_v±r
 *
	gãdge_ch_li°_hód
 = 
NULL
;

89 
	gãdge_ch_byãs_avaû
 = 0;

90 *
	gãdge_ch_√xt_avaû
 = 
NULL
;

95 
Æloc_™d_lﬂd_pö_m≠pögs
(***
block_pö_to_äode_±r
,

96 *****
¢ode_block_pö_to_äode_±r
,

97 
t_subblock_d©a
 
subblock_d©a
,

98 ***
num_u£s_of_sblk_›ö
);

100 
‰ì_pö_m≠pögs
(**
block_pö_to_äode
,

101 ****
¢ode_block_pö_to_äode
,

102 *
num_subblocks_≥r_block
);

104 
Æloc_™d_lﬂd_Ánout_cou¡s
(***
num_u£s_of_fb_ùö_±r
,

105 ****
num_u£s_of_sblk_›ö_±r
,

106 
t_subblock_d©a
 
subblock_d©a
);

108 
‰ì_Ánout_cou¡s
(**
num_u£s_of_fb_ùö
,

109 ***
num_u£s_of_sblk_›ö
);

111 **
Æloc_√t_¶ack
();

113 
compuã_√t_¶acks
(**
√t_¶ack
);

115 
Æloc_™d_lﬂd_äodes_™d_√t_m≠pög
(**
num_u£s_of_fb_ùö
,

117 ***
num_u£s_of_sblk_›ö
,

118 **
block_pö_to_äode
,

120 ****
¢ode_block_pö_to_äode
,

121 
t_subblock_d©a


122 
subblock_d©a
,

123 
t_timög_öf
 
timög_öf
);

125 
buûd_fb_äodes
(
iblk
,

126 *
n_u£s_of_fb_ùö
,

127 **
block_pö_to_äode
,

128 ***
sub_pö_to_äode
,

129 
num_subs
,

130 
t_subblock
 * 
sub_öf
,

131 
T_fb_ùö_to_sblk_ùö
);

133 
buûd_subblock_äodes
(**
n_u£s_of_sblk_›ö
,

134 *
node_block_pö_to_äode
,

135 ***
sub_pö_to_äode
,

136 *
num_subblocks_≥r_block
,

137 
t_subblock
 ** 
subblock_öf
,

138 
t_timög_öf
 
timög_öf
,

139 
iblk
);

142 
boﬁón
 
is_globÆ_˛ock
(
iblk
,

143 
sub
,

144 
subpö
,

145 *
num_subblocks_≥r_block
,

146 
t_subblock
 ** 
subblock_öf
);

148 
buûd_block_ouçut_äode
(
öode
,

149 
iblk
,

150 
ùö
,

151 **
block_pö_to_äode
);

158 
	$Æloc_™d_lﬂd_timög_gøph
(
t_timög_öf
 
timög_öf
,

159 
t_subblock_d©a
 
subblock_d©a
)

169 
i
;

170 **
num_u£s_of_fb_ùö
;

171 ***
num_u£s_of_sblk_›ö
;

178 **
block_pö_to_äode
;

185 ****
¢ode_block_pö_to_äode
;

187 
num_söks
;

188 **
√t_¶ack
;

192 if(
ãdge_ch_li°_hód
 !
NULL
)

194 
	`¥ötf
("Error inálloc_and_load_timing_graph:\n"

196 
	`exô
(1);

202 
i
 = 0; i < 
num_ty≥s
; i++)

204 if(
ty≥_des¸ùt‹s
[
i
].
num_pös
 > 
MAX_SHORT
)

206 
¥ötf


209 
ty≥_des¸ùt‹s
[
i
].
«me
,

210 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

211 
	`exô
(1);

214 if(
ty≥_des¸ùt‹s
[
i
].
max_subblocks
 > 
MAX_SHORT
)

216 
¥ötf


219 
ty≥_des¸ùt‹s
[
i
].
max_subblocks
);

220 
	`exô
(1);

224 
	`Æloc_™d_lﬂd_Ánout_cou¡s
(&
num_u£s_of_fb_ùö
,

225 &
num_u£s_of_sblk_›ö
, 
subblock_d©a
);

227 
num_äodes
 = 
	`Æloc_™d_lﬂd_pö_m≠pögs
(&
block_pö_to_äode
,

228 &
¢ode_block_pö_to_äode
,

229 
subblock_d©a
,

230 
num_u£s_of_sblk_›ö
);

232 
	`Æloc_™d_lﬂd_äodes_™d_√t_m≠pög
(
num_u£s_of_fb_ùö
,

233 
num_u£s_of_sblk_›ö
,

234 
block_pö_to_äode
,

235 
¢ode_block_pö_to_äode
,

236 
subblock_d©a
, 
timög_öf
);

238 
num_söks
 = 
	`Æloc_™d_lﬂd_timög_gøph_Àvñs
();

240 
	`check_timög_gøph
(
subblock_d©a
.
num_c⁄°_gí
, subblock_d©a.
num_ff
,

241 
num_söks
);

243 
	`‰ì_Ánout_cou¡s
(
num_u£s_of_fb_ùö
, 
num_u£s_of_sblk_›ö
);

244 
	`‰ì_pö_m≠pögs
(
block_pö_to_äode
, 
¢ode_block_pö_to_äode
,

245 
subblock_d©a
.
num_subblocks_≥r_block
);

247 
√t_¶ack
 = 
	`Æloc_√t_¶ack
();

248  (
√t_¶ack
);

249 
	}
}

253 
	$Æloc_√t_¶ack
()

258 **
√t_¶ack
;

259 *
tmp_±r
;

260 
öë
;

262 
√t_¶ack
 = (**)
	`my_mÆloc
(
num_√ts
 * (*));

264 
öë
 = 0; i√à< 
num_√ts
; inet++)

266 
tmp_±r
 =

267 (*)
	`my_chunk_mÆloc
(((
√t
[
öë
].
num_söks
 + 1) - 1) *

268 (), &
ãdge_ch_li°_hód
,

269 &
ãdge_ch_byãs_avaû
,

270 &
ãdge_ch_√xt_avaû
);

271 
√t_¶ack
[
öë
] = 
tmp_±r
 - 1;

274  (
√t_¶ack
);

275 
	}
}

279 
	$Æloc_™d_lﬂd_pö_m≠pögs
(***
block_pö_to_äode_±r
,

280 *****
¢ode_block_pö_to_äode_±r
,

281 
t_subblock_d©a
 
subblock_d©a
,

282 ***
num_u£s_of_sblk_›ö
)

288 
iblk
, 
isub
, 
ùö
, 
num_subblocks
, 
›ö
, 
˛k_pö
;

289 
cuº_äode
;

290 ****
¢ode_block_pö_to_äode
, **
block_pö_to_äode
;

291 *
num_subblocks_≥r_block
;

292 
t_ty≥_±r
 
ty≥
;

293 
t_subblock
 **
subblock_öf
;

294 
boﬁón
 
has_öputs
;

296 
num_subblocks_≥r_block
 = 
subblock_d©a
.num_subblocks_per_block;

297 
subblock_öf
 = 
subblock_d©a
.subblock_inf;

300 
block_pö_to_äode
 = (**)
	`my_mÆloc
(
num_blocks
 * (*));

302 
¢ode_block_pö_to_äode
 =

303 (****)
	`my_mÆloc
(
num_blocks
 * (***));

305 
cuº_äode
 = 0;

307 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

309 
ty≥
 = 
block
[
iblk
].type;

310 
block_pö_to_äode
[
iblk
] =

311 (*)
	`my_mÆloc
(
ty≥
->
num_pös
 * ());

313 
ùö
 = 0; ipö < 
block
[
iblk
].
ty≥
->
num_pös
; ipin++)

315 if(
block
[
iblk
].
√ts
[
ùö
] =
OPEN
)

317 
block_pö_to_äode
[
iblk
][
ùö
] = 
OPEN
;

321 
block_pö_to_äode
[
iblk
][
ùö
] = 
cuº_äode
;

322 
cuº_äode
++;

328 
num_subblocks
 = 
num_subblocks_≥r_block
[
iblk
];

329 
¢ode_block_pö_to_äode
[
iblk
] = (***)
	`Æloc_m©rix
(0, 
num_subblocks
 - 1, 0, 
NUM_SUB_PIN_TYPES
 - 1, (*));

331 
isub
 = 0; isub < 
num_subblocks
; isub++)

334 
¢ode_block_pö_to_äode
[
iblk
][
isub
][
SUB_INPUT
] =

335 (*)
	`my_mÆloc
(
ty≥
->
max_subblock_öputs
 *

337 
¢ode_block_pö_to_äode
[
iblk
][
isub
][
SUB_OUTPUT
] =

338 (*)
	`my_mÆloc
(
ty≥
->
max_subblock_ouçuts
 *

340 
¢ode_block_pö_to_äode
[
iblk
][
isub
][
SUB_CLOCK
] =

341 (*)
	`my_mÆloc
(());

345 
has_öputs
 = 
FALSE
;

346 
ùö
 = 0; ipö < 
ty≥
->
max_subblock_öputs
; ipin++)

348 if(
subblock_öf
[
iblk
][
isub
].
öputs
[
ùö
] !
OPEN
)

350 
has_öputs
 = 
TRUE
;

351 
¢ode_block_pö_to_äode
[
iblk
][
isub
]

352 [
SUB_INPUT
][
ùö
] = 
cuº_äode
;

353 
cuº_äode
++;

354 if(
ty≥
 =
IO_TYPE
)

355 
cuº_äode
++;

359 
¢ode_block_pö_to_äode
[
iblk
][
isub
]

360 [
SUB_INPUT
][
ùö
] = 
OPEN
;

368 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

371 if(
num_u£s_of_sblk_›ö
[
iblk
][
isub
][
›ö
] != 0)

373 
¢ode_block_pö_to_äode
[
iblk
][
isub
]

374 [
SUB_OUTPUT
][
›ö
] = 
cuº_äode
;

376 if(
ty≥
 =
IO_TYPE
)

377 
cuº_äode
 += 2;

378 if(
has_öputs
)

379 
cuº_äode
++;

381 
cuº_äode
 += 2;

385 
¢ode_block_pö_to_äode
[
iblk
][
isub
]

386 [
SUB_OUTPUT
][
›ö
] = 
OPEN
;

390 
˛k_pö
 = 0;

392 if(
subblock_öf
[
iblk
][
isub
].
˛ock
 !
OPEN
)

398 
¢ode_block_pö_to_äode
[
iblk
][
isub
][
SUB_CLOCK
]

399 [
˛k_pö
] = 
cuº_äode
;

401 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
;

402 
›ö
++)

404 if(
subblock_öf
[
iblk
][
isub
].

405 
ouçuts
[
›ö
] !
OPEN
)

406 
cuº_äode
 += 2;

411 
¢ode_block_pö_to_äode
[
iblk
][
isub
][
SUB_CLOCK
]

412 [
˛k_pö
] = 
OPEN
;

418 *
¢ode_block_pö_to_äode_±r
 = 
¢ode_block_pö_to_äode
;

419 *
block_pö_to_äode_±r
 = 
block_pö_to_äode
;

420  (
cuº_äode
);

421 
	}
}

425 
	$‰ì_pö_m≠pögs
(**
block_pö_to_äode
,

426 ****
¢ode_block_pö_to_äode
,

427 *
num_subblocks_≥r_block
)

432 
isub
, 
iblk
, 
isubty≥
, 
num_subblocks
;

434 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

436 
num_subblocks
 = 
num_subblocks_≥r_block
[
iblk
];

437 
isub
 = 0; isub < 
num_subblocks
; isub++)

439 
isubty≥
 = 0; isubty≥ < 
NUM_SUB_PIN_TYPES
;

440 
isubty≥
++)

442 
	`‰ì
(
¢ode_block_pö_to_äode
[
iblk
][
isub
]

443 [
isubty≥
]);

446 
	`‰ì_m©rix
(
¢ode_block_pö_to_äode
[
iblk
], 0,

447 
num_subblocks_≥r_block
[
iblk
] - 1, 0, (*));

448 
	`‰ì
(
block_pö_to_äode
[
iblk
]);

450 
	`‰ì
(
block_pö_to_äode
);

451 
	`‰ì
(
¢ode_block_pö_to_äode
);

452 
	}
}

456 
	$Æloc_™d_lﬂd_Ánout_cou¡s
(***
num_u£s_of_fb_ùö_±r
,

457 ****
num_u£s_of_sblk_›ö_±r
,

458 
t_subblock_d©a
 
subblock_d©a
)

464 
iblk
;

465 **
num_u£s_of_fb_ùö
, ***
num_u£s_of_sblk_›ö
;

466 *
num_subblocks_≥r_block
;

467 
t_subblock
 **
subblock_öf
;

469 
num_subblocks_≥r_block
 = 
subblock_d©a
.num_subblocks_per_block;

470 
subblock_öf
 = 
subblock_d©a
.subblock_inf;

472 
num_u£s_of_fb_ùö
 = (**)
	`my_mÆloc
(
num_blocks
 * (*));

474 
num_u£s_of_sblk_›ö
 = (***)
	`my_mÆloc
(
num_blocks
 * (**));

476 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

478 
num_u£s_of_fb_ùö
[
iblk
] =

479 (*)
	`my_ˇŒoc
(
block
[
iblk
].
ty≥
->
num_pös
, ());

480 
num_u£s_of_sblk_›ö
[
iblk
] =

481 (**)
	`Æloc_m©rix
(0, 
block
[
iblk
].
ty≥
->
max_subblocks
 - 1,

483 
block
[
iblk
].
ty≥
->
max_subblock_ouçuts
 -

486 
	`lﬂd_⁄e_fb_Ánout_cou¡
(
subblock_öf
[
iblk
],

487 
num_subblocks_≥r_block
[
iblk
],

488 
num_u£s_of_fb_ùö
[
iblk
],

489 
num_u£s_of_sblk_›ö
[
iblk
], iblk);

493 *
num_u£s_of_fb_ùö_±r
 = 
num_u£s_of_fb_ùö
;

494 *
num_u£s_of_sblk_›ö_±r
 = 
num_u£s_of_sblk_›ö
;

495 
	}
}

499 
	$‰ì_Ánout_cou¡s
(**
num_u£s_of_fb_ùö
,

500 ***
num_u£s_of_sblk_›ö
)

505 
iblk
;

506 
t_ty≥_±r
 
ty≥
;

508 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

510 
ty≥
 = 
block
[
iblk
].type;

511 
	`‰ì
(
num_u£s_of_fb_ùö
[
iblk
]);

512 
	`‰ì_m©rix
(
num_u£s_of_sblk_›ö
[
iblk
], 0,

513 
ty≥
->
max_subblocks
 - 1, 0, ());

516 
	`‰ì
(
num_u£s_of_fb_ùö
);

517 
	`‰ì
(
num_u£s_of_sblk_›ö
);

518 
	}
}

522 
	$Æloc_™d_lﬂd_äodes_™d_√t_m≠pög
(**
num_u£s_of_fb_ùö
,

523 ***
num_u£s_of_sblk_›ö
,

524 **
block_pö_to_äode
,

525 ****
¢ode_block_pö_to_äode
,

526 
t_subblock_d©a
 
subblock_d©a
,

527 
t_timög_öf
 
timög_öf
)

530 
iblk
;

531 *
num_subblocks_≥r_block
;

532 
t_subblock
 **
subblock_öf
;

535 
äode
 = (
t_äode
 *Ë
	`my_mÆloc
(
num_äodes
 * (t_tnode));

536 
äode_des¸ùt
 = (
t_äode_des¸ùt
 *Ë
	`my_mÆloc
(
num_äodes
 *

537 (
t_äode_des¸ùt
));

539 
√t_to_drivî_äode
 = (*)
	`my_mÆloc
(
num_√ts
 * ());

541 
subblock_öf
 = 
subblock_d©a
.subblock_inf;

542 
num_subblocks_≥r_block
 = 
subblock_d©a
.num_subblocks_per_block;

545 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

547 
	`buûd_fb_äodes
(
iblk
, 
num_u£s_of_fb_ùö
[iblk],

548 
block_pö_to_äode
,

549 
¢ode_block_pö_to_äode
[
iblk
],

550 
num_subblocks_≥r_block
[
iblk
], 
subblock_öf
[iblk],

551 
block
[
iblk
].
ty≥
->
ty≥_timög_öf
.

552 
T_fb_ùö_to_sblk_ùö
);

554 
	`buûd_subblock_äodes
(
num_u£s_of_sblk_›ö
[
iblk
],

555 
block_pö_to_äode
[
iblk
],

556 
¢ode_block_pö_to_äode
[
iblk
],

557 
num_subblocks_≥r_block
, 
subblock_öf
,

558 
timög_öf
, 
iblk
);

560 
	}
}

564 
	$buûd_fb_äodes
(
iblk
,

565 *
n_u£s_of_fb_ùö
,

566 **
block_pö_to_äode
,

567 ***
sub_pö_to_äode
,

568 
num_subs
,

569 
t_subblock
 * 
sub_öf
,

570 
T_fb_ùö_to_sblk_ùö
)

579 
isub
, 
ùö
, 
õdge
, 
‰om_pö
, 
›ö
;

580 
öode
, 
to_node
, 
num_edges
;

581 
t_ãdge
 *
ãdge
;

582 
˛k_pö
;

583 
t_ty≥_±r
 
ty≥
;

584 *
√xt_ùö_edge
;

586 
ty≥
 = 
block
[
iblk
].type;

587 
√xt_ùö_edge
 = (*)
	`my_mÆloc
(
ty≥
->
num_pös
 * ());

588 
˛k_pö
 = 0;

592 
ùö
 = 0; ipö < 
block
[
iblk
].
ty≥
->
num_pös
; ipin++)

594 
öode
 = 
block_pö_to_äode
[
iblk
][
ùö
];

596 if(
öode
 !
OPEN
)

598 if(
	`is_›ö
(
ùö
, 
block
[
iblk
].
ty≥
))

600 
	`buûd_block_ouçut_äode
(
öode
, 
iblk
, 
ùö
,

601 
block_pö_to_äode
);

602 
äode_des¸ùt
[
öode
].
ty≥
 = 
FB_OPIN
;

606 
√xt_ùö_edge
[
ùö
] = 0;

607 
num_edges
 = 
n_u£s_of_fb_ùö
[
ùö
];

610 
isub
 = 0; isub < 
num_subs
; isub++)

612 if(
sub_öf
[
isub
].
˛ock
 =
ùö
)

614 
›ö
 = 0;

615 
›ö
 <

616 
ty≥
->
max_subblock_ouçuts
;

617 
›ö
++)

619 if(
sub_öf
[
isub
].

620 
ouçuts
[
›ö
] !
OPEN
)

622 
num_edges
++;

625 
num_edges
--;

629 
äode
[
öode
].
num_edges
 =Çum_edges;

631 
äode
[
öode
].
out_edges
 =

632 (
t_ãdge
 *Ë
	`my_chunk_mÆloc
(
num_edges
 *

633 (
t_ãdge
),

634 &
ãdge_ch_li°_hód
,

635 &
ãdge_ch_byãs_avaû
,

636 &
ãdge_ch_√xt_avaû
);

638 
äode_des¸ùt
[
öode
].
ty≥
 = 
FB_IPIN
;

641 
äode_des¸ùt
[
öode
].
ùö
 = ipin;

642 
äode_des¸ùt
[
öode
].
isubblk
 = 
OPEN
;

643 
äode_des¸ùt
[
öode
].
iblk
 = iblk;

650 
isub
 = 0; isub < 
num_subs
; isub++)

652 
ùö
 = 0; ipö < 
ty≥
->
max_subblock_öputs
; ipin++)

654 
‰om_pö
 = 
sub_öf
[
isub
].
öputs
[
ùö
];

658 if(
‰om_pö
 !
OPEN


659 && 
‰om_pö
 < 
block
[
iblk
].
ty≥
->
num_pös
)

661 
öode
 = 
block_pö_to_äode
[
iblk
][
‰om_pö
];

662 
	`as£π
(
öode
 !
OPEN
);

663 
to_node
 = 
sub_pö_to_äode
[
isub
][
SUB_INPUT
][
ùö
];

664 
ãdge
 = 
äode
[
öode
].
out_edges
;

665 
õdge
 = 
√xt_ùö_edge
[
‰om_pö
]++;

666 
ãdge
[
õdge
].
to_node
 =Åo_node;

667 
ãdge
[
õdge
].
Tdñ
 = 
T_fb_ùö_to_sblk_ùö
;

671 
‰om_pö
 = 
sub_öf
[
isub
].
˛ock
;

673 if(
‰om_pö
 !
OPEN
 && from_pö < 
block
[
iblk
].
ty≥
->
num_pös
)

675 
öode
 = 
block_pö_to_äode
[
iblk
][
‰om_pö
];

676 
to_node
 = 
sub_pö_to_äode
[
isub
][
SUB_CLOCK
][
˛k_pö
];

678 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

680 if(
sub_öf
[
isub
].
ouçuts
[
›ö
] !
OPEN
)

682 
ãdge
 = 
äode
[
öode
].
out_edges
;

683 
õdge
 = 
√xt_ùö_edge
[
‰om_pö
]++;

684 
ãdge
[
õdge
].
to_node
 =Åo_node;

691 
ãdge
[
õdge
].
Tdñ
 = 0.;

692 
to_node
 += 2;

697 
	`‰ì
(
√xt_ùö_edge
);

698 
	}
}

702 
	$buûd_block_ouçut_äode
(
öode
,

703 
iblk
,

704 
ùö
,

705 **
block_pö_to_äode
)

711 
õdge
, 
to_blk
, 
to_pö
, 
to_node
, 
num_edges
, 
öë
;

712 
t_ãdge
 *
ãdge
;

714 
öë
 = 
block
[
iblk
].
√ts
[
ùö
];

715 
	`as£π
(
öë
 !
OPEN
);

717 
√t_to_drivî_äode
[
öë
] = 
öode
;

719 
num_edges
 = (
√t
[
öë
].
num_söks
 + 1) - 1;

720 
äode
[
öode
].
num_edges
 =Çum_edges;

722 
äode
[
öode
].
out_edges
 = (
t_ãdge
 *Ë
	`my_chunk_mÆloc
(
num_edges
 *

723 (
t_ãdge
),

724 &
ãdge_ch_li°_hód
,

725 &
ãdge_ch_byãs_avaû
,

726 &
ãdge_ch_√xt_avaû
);

728 
ãdge
 = 
äode
[
öode
].
out_edges
;

730 
õdge
 = 0; iedgê< (
√t
[
öë
].
num_söks
 + 1) - 1; iedge++)

732 
to_blk
 = 
√t
[
öë
].
node_block
[
õdge
 + 1];

734 
to_pö
 = 
√t
[
öë
].
node_block_pö
[
õdge
 + 1];

736 
to_node
 = 
block_pö_to_äode
[
to_blk
][
to_pö
];

737 
ãdge
[
õdge
].
to_node
 =Åo_node;

740 
	}
}

744 
	$buûd_subblock_äodes
(**
n_u£s_of_sblk_›ö
,

745 *
node_block_pö_to_äode
,

746 ***
sub_pö_to_äode
,

747 *
num_subblocks_≥r_block
,

748 
t_subblock
 ** 
subblock_öf
,

749 
t_timög_öf
 
timög_öf
,

750 
iblk
)

757 
isub
, 
ùö
, 
öode
, 
to_node
, 
‰om_pö
, 
to_pö
, 
›ö
, 
‰om_›ö
,

758 
˛k_pö
, 
u£d_›ö_cou¡
;

759 
num_subs
, 
‰om_sub
;

760 
t_subblock
 *
sub_öf
;

761 
õdge
, 
num_edges
;

762 
sök_dñay
;

763 
t_ãdge
 *
ãdge
;

764 
boﬁón
 
has_öputs
, 
has_ouçuts
;

765 **
√xt_sblk_›ö_edge
;

766 *
num_›ö_u£d_ö_sblk
;

767 
t_ty≥_±r
 
ty≥
 = 
block
[
iblk
].type;

769 
sub_öf
 = 
subblock_öf
[
iblk
];

770 
num_subs
 = 
num_subblocks_≥r_block
[
iblk
];

772 
√xt_sblk_›ö_edge
 =

773 (**)
	`Æloc_m©rix
(0, 
ty≥
->
max_subblocks
 - 1, 0,

774 
ty≥
->
max_subblock_ouçuts
 - 1, ());

775 
num_›ö_u£d_ö_sblk
 =

776 (*)
	`my_mÆloc
(
ty≥
->
max_subblocks
 * ());

778 
˛k_pö
 = 0;

781 
isub
 = 0; isub < 
num_subs
; isub++)

783 
num_›ö_u£d_ö_sblk
[
isub
] = 0;

784 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

786 
öode
 = 
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
];

788 if(
öode
 !
OPEN
)

790 
num_›ö_u£d_ö_sblk
[
isub
]++;

791 
√xt_sblk_›ö_edge
[
isub
][
›ö
] = 0;

792 
num_edges
 = 
n_u£s_of_sblk_›ö
[
isub
][
›ö
];

793 
äode
[
öode
].
num_edges
 =Çum_edges;

795 
äode
[
öode
].
out_edges
 =

796 (
t_ãdge
 *Ë
	`my_chunk_mÆloc
(
num_edges
 *

797 (
t_ãdge
),

798 &
ãdge_ch_li°_hód
,

799 &
ãdge_ch_byãs_avaû
,

800 &
ãdge_ch_√xt_avaû
);

802 if(
IO_TYPE
 =
ty≥
)

804 
äode_des¸ùt
[
öode
].
ty≥
 = 
INPAD_OPIN
;

805 
äode
[
öode
 + 1].
num_edges
 = 1;

806 
äode
[
öode
 + 1].
out_edges
 = (
t_ãdge
 *)

807 
	`my_chunk_mÆloc
((
t_ãdge
),

808 &
ãdge_ch_li°_hód
,

809 &
ãdge_ch_byãs_avaû
,

810 &
ãdge_ch_√xt_avaû
);

811 
ãdge
 = 
äode
[
öode
 + 1].
out_edges
;

812 
ãdge
[0].
to_node
 = 
öode
;

815 if(
is_globÆ_˛ock


816 (
iblk
, 
isub
, 
›ö
,

817 
num_subblocks_≥r_block
,

818 
subblock_öf
))

819 
ãdge
[0].
Tdñ
 = 0.;

821 
ãdge
[0].
Tdñ
 =

822 
ty≥
->
ty≥_timög_öf
.

823 
T_subblock
[
isub
].
T_£q_out
[
›ö
];

825 
äode_des¸ùt
[
öode
 + 1].
ty≥
 =

826 
INPAD_SOURCE
;

827 
äode_des¸ùt
[
öode
 + 1].
ùö
 = 
OPEN
;

828 
äode_des¸ùt
[
öode
 + 1].
isubblk
 = 
isub
;

829 
äode_des¸ùt
[
öode
 + 1].
iblk
 = iblk;

833 
äode_des¸ùt
[
öode
].
ty≥
 = 
SUBBLK_OPIN
;

836 
äode_des¸ùt
[
öode
].
ùö
 = 
›ö
;

837 
äode_des¸ùt
[
öode
].
isubblk
 = 
isub
;

838 
äode_des¸ùt
[
öode
].
iblk
 = iblk;

847 
isub
 = 0; isub < 
num_subs
; isub++)

849 
has_ouçuts
 = 
FALSE
;

851 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

853 if(
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
] !
OPEN
)

855 
has_ouçuts
 = 
TRUE
;

859 if(!
has_ouçuts
 && 
ty≥
 !
IO_TYPE
)

864 if(
sub_öf
[
isub
].
˛ock
 !
OPEN
)

866 
öode
 = 
sub_pö_to_äode
[
isub
][
SUB_CLOCK
][
˛k_pö
];

868 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

870 if(
sub_öf
[
isub
].
ouçuts
[
›ö
] !
OPEN
)

873 
äode
[
öode
].
num_edges
 = 1;

874 
äode
[
öode
].
out_edges
 = (
t_ãdge
 *)

875 
	`my_chunk_mÆloc
((
t_ãdge
),

876 &
ãdge_ch_li°_hód
,

877 &
ãdge_ch_byãs_avaû
,

878 &
ãdge_ch_√xt_avaû
);

880 
äode_des¸ùt
[
öode
].
ty≥
 = 
FF_SOURCE
;

881 
äode_des¸ùt
[
öode
].
ùö
 = 
OPEN
;

882 
äode_des¸ùt
[
öode
].
isubblk
 = 
isub
;

883 
äode_des¸ùt
[
öode
].
iblk
 = iblk;

887 
öode
++;

888 
äode
[
öode
].
num_edges
 = 0;

889 
äode
[
öode
].
out_edges
 = 
NULL
;

891 
äode_des¸ùt
[
öode
].
ty≥
 = 
FF_SINK
;

892 
äode_des¸ùt
[
öode
].
ùö
 = 
OPEN
;

893 
äode_des¸ùt
[
öode
].
isubblk
 = 
isub
;

894 
äode_des¸ùt
[
öode
].
iblk
 = iblk;

895 
öode
++;

902 
ùö
 = 0; ipö < 
ty≥
->
max_subblock_öputs
; ipin++)

904 
öode
 = 
sub_pö_to_äode
[
isub
][
SUB_INPUT
][
ùö
];

906 if(
öode
 !
OPEN
)

908 if(
ty≥
 =
IO_TYPE
)

910 
äode
[
öode
].
num_edges
 = 1;

911 
›ö
 = 0;

912 
äode
[
öode
].
out_edges
 = (
t_ãdge
 *)

913 
	`my_chunk_mÆloc
((
t_ãdge
),

914 &
ãdge_ch_li°_hód
,

915 &
ãdge_ch_byãs_avaû
,

916 &
ãdge_ch_√xt_avaû
);

917 
äode_des¸ùt
[
öode
].
ty≥
 = 
OUTPAD_IPIN
;

918 
äode
[
öode
 + 1].
num_edges
 = 0;

919 
äode
[
öode
 + 1].
out_edges
 = 
NULL
;

920 
ãdge
 = 
äode
[
öode
].
out_edges
;

921 
ãdge
[0].
to_node
 = 
öode
 + 1;

925 
ãdge
[0].
Tdñ
 =

926 
ty≥
->
ty≥_timög_öf
.

927 
T_subblock
[
isub
].
T_comb
[
ùö
][
›ö
] +

928 
ty≥
->
ty≥_timög_öf
.

929 
T_subblock
[
isub
].
T_£q_ö
[
›ö
];

931 
äode_des¸ùt
[
öode
 + 1].
ty≥
 =

932 
OUTPAD_SINK
;

933 
äode_des¸ùt
[
öode
 + 1].
ùö
 = 
OPEN
;

934 
äode_des¸ùt
[
öode
 + 1].
isubblk
 = 
isub
;

935 
äode_des¸ùt
[
öode
 + 1].
iblk
 = iblk;

939 
äode
[
öode
].
num_edges
 =

940 
num_›ö_u£d_ö_sblk
[
isub
];

941 
äode
[
öode
].
out_edges
 =

942 (
t_ãdge
 *)

943 
	`my_chunk_mÆloc
(
num_›ö_u£d_ö_sblk


944 [
isub
] *

945 (
t_ãdge
),

946 &
ãdge_ch_li°_hód
,

947 &
ãdge_ch_byãs_avaû
,

948 &
ãdge_ch_√xt_avaû
);

949 
äode
[
öode
].
num_edges
 =

950 
num_›ö_u£d_ö_sblk
[
isub
];

951 
äode_des¸ùt
[
öode
].
ty≥
 = 
SUBBLK_IPIN
;

954 
äode_des¸ùt
[
öode
].
ùö
 = ipin;

955 
äode_des¸ùt
[
öode
].
isubblk
 = 
isub
;

956 
äode_des¸ùt
[
öode
].
iblk
 = iblk;

963 
isub
 = 0; isub < 
num_subs
; isub++)

965 
u£d_›ö_cou¡
 = 0;

966 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

968 if(
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
] =
OPEN
)

972 
ùö
 = 0; ipö < 
ty≥
->
max_subblock_öputs
; ipin++)

975 
‰om_pö
 = 
sub_öf
[
isub
].
öputs
[
ùö
];

979 if(
‰om_pö
 >
ty≥
->
num_pös
)

984 
‰om_sub
 =

985 (
‰om_pö
 -

986 
ty≥
->
num_pös
) /

987 
ty≥
->
max_subblock_ouçuts
;

988 
‰om_›ö
 =

989 (
‰om_pö
 -

990 
ty≥
->
num_pös
) %

991 
ty≥
->
max_subblock_ouçuts
;

992 
öode
 =

993 
sub_pö_to_äode
[
‰om_sub
][
SUB_OUTPUT
]

994 [
‰om_›ö
];

995 
to_node
 =

996 
sub_pö_to_äode
[
isub
][
SUB_INPUT
]

997 [
ùö
];

998 
ãdge
 = 
äode
[
öode
].
out_edges
;

999 
õdge
 = 
√xt_sblk_›ö_edge
[
‰om_sub
]

1000 [
‰om_›ö
]++;

1001 
ãdge
[
õdge
].
to_node
 =Åo_node;

1002 
ãdge
[
õdge
].
Tdñ
 =

1003 
ty≥
->
ty≥_timög_öf
.

1004 
T_sblk_›ö_to_sblk_ùö
;

1007 
‰om_pö
 = 
sub_öf
[
isub
].
˛ock
;

1011 if(
‰om_pö
 >
ty≥
->
num_pös
)

1013 
‰om_sub
 =

1014 (
‰om_pö
 -

1015 
ty≥
->
num_pös
Ë/Åy≥->
max_subblock_ouçuts
;

1016 
‰om_›ö
 =

1017 (
‰om_pö
 -

1018 
ty≥
->
num_pös
Ë%Åy≥->
max_subblock_ouçuts
;

1019 
öode
 = 
sub_pö_to_äode
[
‰om_sub
][
SUB_OUTPUT
]

1020 [
‰om_›ö
];

1022 
to_node
 =

1023 
sub_pö_to_äode
[
isub
][
SUB_CLOCK
][
˛k_pö
] +

1024 2 * 
u£d_›ö_cou¡
;

1025 
ãdge
 = 
äode
[
öode
].
out_edges
;

1026 
õdge
 =

1027 
√xt_sblk_›ö_edge
[
‰om_sub
][
‰om_›ö
]++;

1028 
ãdge
[
õdge
].
to_node
 =Åo_node;

1031 
ãdge
[
õdge
].
Tdñ
 =

1032 
ty≥
->
ty≥_timög_öf
.

1033 
T_sblk_›ö_to_sblk_ùö
;

1036 
to_pö
 = 
sub_öf
[
isub
].
ouçuts
[
›ö
];

1037 if(
to_pö
 !
OPEN
)

1043 if(
block
[
iblk
].
√ts
[
to_pö
] !
OPEN
)

1045 
to_node
 = 
node_block_pö_to_äode
[
to_pö
];

1046 
öode
 = 
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
]

1047 [
›ö
];

1048 
ãdge
 = 
äode
[
öode
].
out_edges
;

1049 
õdge
 = 
√xt_sblk_›ö_edge
[
isub
][
›ö
]++;

1050 
ãdge
[
õdge
].
to_node
 =Åo_node;

1051 
ãdge
[
õdge
].
Tdñ
 =

1052 
ty≥
->
ty≥_timög_öf
.

1053 
T_sblk_›ö_to_fb_›ö
;

1056 
u£d_›ö_cou¡
++;

1062 
isub
 = 0; isub < 
num_subs
; isub++)

1064 
u£d_›ö_cou¡
 = 0;

1065 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

1068 if(
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
] =
OPEN
)

1071 if(
sub_öf
[
isub
].
˛ock
 =
OPEN
)

1073 
to_node
 =

1074 
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
];

1075 
sök_dñay
 = 0;

1079 
öode
 =

1080 
sub_pö_to_äode
[
isub
][
SUB_CLOCK
][
˛k_pö
] +

1081 2 * 
u£d_›ö_cou¡
;

1084 
ãdge
 = 
äode
[
öode
].
out_edges
;

1085 
ãdge
[0].
to_node
 =

1086 
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
];

1087 
ãdge
[0].
Tdñ
 =

1088 
ty≥
->
ty≥_timög_öf
.
T_subblock
[
isub
].

1089 
T_£q_out
[
›ö
];

1093 
öode
++;

1094 
to_node
 = 
öode
;

1095 
sök_dñay
 =

1096 
ty≥
->
ty≥_timög_öf
.
T_subblock
[
isub
].

1097 
T_£q_ö
[
›ö
];

1102 
has_öputs
 = 
FALSE
;

1103 
ùö
 = 0; ipö < 
ty≥
->
max_subblock_öputs
; ipin++)

1105 
öode
 = 
sub_pö_to_äode
[
isub
][
SUB_INPUT
][
ùö
];

1107 if(
öode
 !
OPEN
)

1109 
has_öputs
 = 
TRUE
;

1110 
ãdge
 = 
äode
[
öode
].
out_edges
;

1111 
ãdge
[
u£d_›ö_cou¡
].
to_node
 =Åo_node;

1112 
ãdge
[
u£d_›ö_cou¡
].
Tdñ
 =

1113 
sök_dñay
 +

1114 
ty≥
->
ty≥_timög_öf
.

1115 
T_subblock
[
isub
].
T_comb
[
ùö
][
›ö
];

1119 if(!
has_öputs
 && 
ty≥
 !
IO_TYPE
)

1122 
öode
 =

1123 
sub_pö_to_äode
[
isub
][
SUB_OUTPUT
][
›ö
] + 1;

1124 
äode
[
öode
].
num_edges
 = 1;

1125 
äode
[
öode
].
out_edges
 =

1126 (
t_ãdge
 *Ë
	`my_chunk_mÆloc
((t_tedge),

1127 &
ãdge_ch_li°_hód
,

1128 &
ãdge_ch_byãs_avaû
,

1129 &
ãdge_ch_√xt_avaû
);

1130 
ãdge
 = 
äode
[
öode
].
out_edges
;

1131 
ãdge
[
u£d_›ö_cou¡
].
to_node
 =Åo_node;

1135 
ãdge
[
u£d_›ö_cou¡
].
Tdñ
 =

1136 
T_CONSTANT_GENERATOR
;

1138 
äode_des¸ùt
[
öode
].
ty≥
 = 
CONSTANT_GEN_SOURCE
;

1139 
äode_des¸ùt
[
öode
].
ùö
 = 
OPEN
;

1140 
äode_des¸ùt
[
öode
].
isubblk
 = 
isub
;

1141 
äode_des¸ùt
[
öode
].
iblk
 = iblk;

1143 
u£d_›ö_cou¡
++;

1146 
	`‰ì_m©rix
(
√xt_sblk_›ö_edge
, 0, 
ty≥
->
max_subblocks
 - 1, 0,

1148 
	`‰ì
(
num_›ö_u£d_ö_sblk
);

1149 
	}
}

1151 
boﬁón


1152 
	$is_globÆ_˛ock
(
iblk
,

1153 
sub
,

1154 
subpö
,

1155 *
num_subblocks_≥r_block
,

1156 
t_subblock
 ** 
subblock_öf
)

1164 
öë
, 
ùö
, 
to_blk
, 
to_pö
, 
isub
;

1165 
t_ty≥_±r
 
ty≥
 = 
block
[
iblk
].type;

1167 
	`as£π
(
ty≥
 =
IO_TYPE
);

1169 
öë
 = 
block
[
iblk
].
√ts
[
subblock_öf
[iblk][
sub
].
ouçuts
[
subpö
]];

1170 
	`as£π
(
öë
 !
OPEN
);

1172 if(!
√t
[
öë
].
is_globÆ
)

1173  (
FALSE
);

1175 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

1177 
to_blk
 = 
√t
[
öë
].
node_block
[
ùö
];

1178 
to_pö
 = 
√t
[
öë
].
node_block_pö
[
ùö
];

1180 
isub
 = 0; isub < 
num_subblocks_≥r_block
[
to_blk
]; isub++)

1182 if(
subblock_öf
[
to_blk
][
isub
].
˛ock
 =
to_pö
)

1183  (
TRUE
);

1187  (
FALSE
);

1188 
	}
}

1191 
	$lﬂd_timög_gøph_√t_dñays
(**
√t_dñay
)

1199 
öë
, 
ùö
, 
öode
;

1200 
t_ãdge
 *
ãdge
;

1202 
öë
 = 0; i√à< 
num_√ts
; inet++)

1204 
öode
 = 
√t_to_drivî_äode
[
öë
];

1205 
ãdge
 = 
äode
[
öode
].
out_edges
;

1210 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

1211 
ãdge
[
ùö
 - 1].
Tdñ
 = 
√t_dñay
[
öë
][ipin];

1213 
	}
}

1217 
	$‰ì_timög_gøph
(**
√t_¶ack
)

1222 if(
ãdge_ch_li°_hód
 =
NULL
)

1224 
	`¥ötf
("Error in free_timing_graph: NoÅiming graphÅo free.\n");

1225 
	`exô
(1);

1228 
	`‰ì_chunk_mem‹y
(
ãdge_ch_li°_hód
);

1229 
	`‰ì
(
äode
);

1230 
	`‰ì
(
äode_des¸ùt
);

1231 
	`‰ì
(
√t_to_drivî_äode
);

1232 
	`‰ì_ivec_ve˘‹
(
äodes_©_Àvñ
, 0, 
num_äode_Àvñs
 - 1);

1233 
	`‰ì
(
√t_¶ack
);

1235 
ãdge_ch_li°_hód
 = 
NULL
;

1236 
ãdge_ch_byãs_avaû
 = 0;

1237 
ãdge_ch_√xt_avaû
 = 
NULL
;

1239 
äode
 = 
NULL
;

1240 
äode_des¸ùt
 = 
NULL
;

1241 
num_äodes
 = 0;

1242 
√t_to_drivî_äode
 = 
NULL
;

1243 
äodes_©_Àvñ
 = 
NULL
;

1244 
num_äode_Àvñs
 = 0;

1245 
	}
}

1249 
	$¥öt_√t_¶ack
(*
‚ame
,

1250 **
√t_¶ack
)

1255 
öë
, 
ùö
;

1256 
FILE
 *
Â
;

1258 
Â
 = 
	`my_f›í
(
‚ame
, "w");

1260 
	`Ârötf
(
Â
, "Net #\tSlacks\n\n");

1262 
öë
 = 0; i√à< 
num_√ts
; inet++)

1264 
	`Ârötf
(
Â
, "%5d", 
öë
);

1265 
ùö
 = 1; ipö < (
√t
[
öë
].
num_söks
 + 1); ipin++)

1267 
	`Ârötf
(
Â
, "\t%g", 
√t_¶ack
[
öë
][
ùö
]);

1269 
	`Ârötf
(
Â
, "\n");

1271 
	}
}

1275 
	$¥öt_timög_gøph
(*
‚ame
)

1280 
FILE
 *
Â
;

1281 
öode
, 
õdge
, 
ûevñ
, 
i
;

1282 
t_ãdge
 *
ãdge
;

1283 
t_äode_ty≥
 
ôy≥
;

1284 *
äode_ty≥_«mes
[] = { "INPAD_SOURCE", "INPAD_OPIN",

1291 
Â
 = 
	`my_f›í
(
‚ame
, "w");

1293 
	`Ârötf
(
Â
, "num_äodes: %d\n", 
num_äodes
);

1294 
	`Ârötf
(
Â
, "Node #\tType\t\tipin\tisubblk\tiblk\t#Édges\t"

1297 
öode
 = 0; inodê< 
num_äodes
; inode++)

1299 
	`Ârötf
(
Â
, "%d\t", 
öode
);

1301 
ôy≥
 = 
äode_des¸ùt
[
öode
].
ty≥
;

1302 
	`Ârötf
(
Â
, "%-15.15s\t", 
äode_ty≥_«mes
[
ôy≥
]);

1304 
	`Ârötf
(
Â
, "%d\t%d\t%d\t", 
äode_des¸ùt
[
öode
].
ùö
,

1305 
äode_des¸ùt
[
öode
].
isubblk
,

1306 
äode_des¸ùt
[
öode
].
iblk
);

1308 
	`Ârötf
(
Â
, "%d\t", 
äode
[
öode
].
num_edges
);

1309 
ãdge
 = 
äode
[
öode
].
out_edges
;

1310 
õdge
 = 0; iedgê< 
äode
[
öode
].
num_edges
; iedge++)

1312 
	`Ârötf
(
Â
, "\t(%4d,%7.3g)", 
ãdge
[
õdge
].
to_node
,

1313 
ãdge
[
õdge
].
Tdñ
);

1315 
	`Ârötf
(
Â
, "\n");

1318 
	`Ârötf
(
Â
, "\n\¬um_äode_Àvñs: %d\n", 
num_äode_Àvñs
);

1320 
ûevñ
 = 0; iÀvñ < 
num_äode_Àvñs
; ilevel++)

1322 
	`Ârötf
(
Â
, "\n\nLevñ: %d Num_nodes: %d\nNodes:", 
ûevñ
,

1323 
äodes_©_Àvñ
[
ûevñ
].
√Àm
);

1324 
i
 = 0; i < 
äodes_©_Àvñ
[
ûevñ
].
√Àm
; i++)

1325 
	`Ârötf
(
Â
, "\t%d", 
äodes_©_Àvñ
[
ûevñ
].
li°
[
i
]);

1328 
	`Ârötf
(
Â
, "\n");

1329 
	`Ârötf
(
Â
, "\n\nNet #\tNet_to_driver_tnode\n");

1331 
i
 = 0; i < 
num_√ts
; i++)

1332 
	`Ârötf
(
Â
, "%4d\t%6d\n", 
i
, 
√t_to_drivî_äode
[i]);

1334 
	`Ârötf
(
Â
, "\n\nNode #\t\tT_arr\t\tT_req\n\n");

1336 
öode
 = 0; inodê< 
num_äodes
; inode++)

1337 
	`Ârötf
(
Â
, "%d\t%12g\t%12g\n", 
öode
, 
äode
[öode].
T_¨r
,

1338 
äode
[
öode
].
T_ªq
);

1340 
	`f˛o£
(
Â
);

1341 
	}
}

1345 
	$lﬂd_√t_¶ack
(**
√t_¶ack
,

1346 
èrgë_cy˛e_time
)

1355 
T_¸ô
, 
T_¨r
, 
Tdñ
, 
T_cy˛e
, 
T_ªq
;

1356 
öode
, 
ûevñ
, 
num_©_Àvñ
, 
i
, 
num_edges
, 
õdge
, 
to_node
;

1357 
t_ãdge
 *
ãdge
;

1363 
öode
 = 0; inodê< 
num_äodes
; inode++)

1364 
äode
[
öode
].
T_¨r
 = 
T_CONSTANT_GENERATOR
;

1369 
T_¸ô
 = 0.;

1373 
num_©_Àvñ
 = 
äodes_©_Àvñ
[0].
√Àm
;

1374 
i
 = 0; i < 
num_©_Àvñ
; i++)

1376 
öode
 = 
äodes_©_Àvñ
[0].
li°
[
i
];

1377 
äode
[
öode
].
T_¨r
 = 0.;

1380 
ûevñ
 = 0; iÀvñ < 
num_äode_Àvñs
; ilevel++)

1382 
num_©_Àvñ
 = 
äodes_©_Àvñ
[
ûevñ
].
√Àm
;

1384 
i
 = 0; i < 
num_©_Àvñ
; i++)

1386 
öode
 = 
äodes_©_Àvñ
[
ûevñ
].
li°
[
i
];

1387 
T_¨r
 = 
äode
[
öode
].T_arr;

1388 
num_edges
 = 
äode
[
öode
].num_edges;

1389 
ãdge
 = 
äode
[
öode
].
out_edges
;

1390 
T_¸ô
 = 
	`max
(T_¸ô, 
T_¨r
);

1392 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

1394 
to_node
 = 
ãdge
[
õdge
].to_node;

1395 
Tdñ
 = 
ãdge
[
õdge
].Tdel;

1396 
äode
[
to_node
].
T_¨r
 =

1397 
	`max
(
äode
[
to_node
].
T_¨r
, T_¨∏+ 
Tdñ
);

1403 if(
èrgë_cy˛e_time
 > 0.)

1404 
T_cy˛e
 = 
èrgë_cy˛e_time
;

1406 
T_cy˛e
 = 
T_¸ô
;

1411 
ûevñ
 = 
num_äode_Àvñs
 - 1; ilevel >= 0; ilevel--)

1413 
num_©_Àvñ
 = 
äodes_©_Àvñ
[
ûevñ
].
√Àm
;

1415 
i
 = 0; i < 
num_©_Àvñ
; i++)

1417 
öode
 = 
äodes_©_Àvñ
[
ûevñ
].
li°
[
i
];

1418 
num_edges
 = 
äode
[
öode
].num_edges;

1420 if(
num_edges
 == 0)

1422 
äode
[
öode
].
T_ªq
 = 
T_cy˛e
;

1426 
ãdge
 = 
äode
[
öode
].
out_edges
;

1427 
to_node
 = 
ãdge
[0].to_node;

1428 
Tdñ
 = 
ãdge
[0].Tdel;

1429 
T_ªq
 = 
äode
[
to_node
].T_ªq - 
Tdñ
;

1431 
õdge
 = 1; iedgê< 
num_edges
; iedge++)

1433 
to_node
 = 
ãdge
[
õdge
].to_node;

1434 
Tdñ
 = 
ãdge
[
õdge
].Tdel;

1435 
T_ªq
 =

1436 
	`mö
(
T_ªq
,

1437 
äode
[
to_node
].
T_ªq
 - 
Tdñ
);

1440 
äode
[
öode
].
T_ªq
 = T_req;

1445 
	`compuã_√t_¶acks
(
√t_¶ack
);

1447  (
T_¸ô
);

1448 
	}
}

1452 
	$compuã_√t_¶acks
(**
√t_¶ack
)

1457 
öë
, 
õdge
, 
öode
, 
to_node
, 
num_edges
;

1458 
t_ãdge
 *
ãdge
;

1459 
T_¨r
, 
Tdñ
, 
T_ªq
;

1461 
öë
 = 0; i√à< 
num_√ts
; inet++)

1463 
öode
 = 
√t_to_drivî_äode
[
öë
];

1464 
T_¨r
 = 
äode
[
öode
].T_arr;

1465 
num_edges
 = 
äode
[
öode
].num_edges;

1466 
ãdge
 = 
äode
[
öode
].
out_edges
;

1468 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

1470 
to_node
 = 
ãdge
[
õdge
].to_node;

1471 
Tdñ
 = 
ãdge
[
õdge
].Tdel;

1472 
T_ªq
 = 
äode
[
to_node
].T_req;

1473 
√t_¶ack
[
öë
][
õdge
 + 1] = 
T_ªq
 - 
T_¨r
 - 
Tdñ
;

1476 
	}
}

1480 
	$¥öt_¸ôiˇl_∑th
(*
‚ame
,

1481 
t_subblock_d©a
 
subblock_d©a
)

1486 
t_löked_öt
 *
¸ôiˇl_∑th_hód
, *
¸ôiˇl_∑th_node
;

1487 
FILE
 *
Â
;

1488 
n⁄_globÆ_√ts_⁄_¸ô_∑th
, 
globÆ_√ts_⁄_¸ô_∑th
;

1489 
äodes_⁄_¸ô_∑th
, 
öode
, 
iblk
, 
öë
;

1490 
t_äode_ty≥
 
ty≥
;

1491 
tŸÆ_√t_dñay
, 
tŸÆ_logic_dñay
, 
Tdñ
;

1493 
¸ôiˇl_∑th_hód
 = 
	`Æloˇã_™d_lﬂd_¸ôiˇl_∑th
();

1494 
¸ôiˇl_∑th_node
 = 
¸ôiˇl_∑th_hód
;

1496 
Â
 = 
	`my_f›í
(
‚ame
, "w");

1498 
n⁄_globÆ_√ts_⁄_¸ô_∑th
 = 0;

1499 
globÆ_√ts_⁄_¸ô_∑th
 = 0;

1500 
äodes_⁄_¸ô_∑th
 = 0;

1501 
tŸÆ_√t_dñay
 = 0.;

1502 
tŸÆ_logic_dñay
 = 0.;

1504 
¸ôiˇl_∑th_node
 !
NULL
)

1506 
Tdñ
 =

1507 
	`¥öt_¸ôiˇl_∑th_node
(
Â
, 
¸ôiˇl_∑th_node
,

1508 
subblock_d©a
);

1509 
öode
 = 
¸ôiˇl_∑th_node
->
d©a
;

1510 
ty≥
 = 
äode_des¸ùt
[
öode
].type;

1511 
äodes_⁄_¸ô_∑th
++;

1513 if(
ty≥
 =
INPAD_OPIN
 ||Åy≥ =
FB_OPIN
)

1515 
	`gë_äode_block_™d_ouçut_√t
(
öode
, &
iblk
, &
öë
);

1517 if(!
√t
[
öë
].
is_globÆ
)

1518 
n⁄_globÆ_√ts_⁄_¸ô_∑th
++;

1520 
globÆ_√ts_⁄_¸ô_∑th
++;

1522 
tŸÆ_√t_dñay
 +
Tdñ
;

1526 
tŸÆ_logic_dñay
 +
Tdñ
;

1529 
¸ôiˇl_∑th_node
 = crôiˇl_∑th_node->
√xt
;

1532 
	`Ârötf
(
Â
,

1534 "\n", 
äodes_⁄_¸ô_∑th
, 
n⁄_globÆ_√ts_⁄_¸ô_∑th
);

1535 
	`Ârötf
(
Â
, "GlobÆÇë†⁄ crô.Ö©h: %d.\n", 
globÆ_√ts_⁄_¸ô_∑th
);

1536 
	`Ârötf
(
Â
, "TotalÜogic delay: %g (s) TotalÇet delay: %g (s)\n",

1537 
tŸÆ_logic_dñay
, 
tŸÆ_√t_dñay
);

1539 
	`¥ötf
("Nets on crit.Öath: %dÇormal, %d global.\n",

1540 
n⁄_globÆ_√ts_⁄_¸ô_∑th
, 
globÆ_√ts_⁄_¸ô_∑th
);

1542 
	`¥ötf
("TotalÜogic delay: %g (s) TotalÇet delay: %g (s)\n",

1543 
tŸÆ_logic_dñay
, 
tŸÆ_√t_dñay
);

1545 
	`f˛o£
(
Â
);

1546 
	`‰ì_öt_li°
(&
¸ôiˇl_∑th_hód
);

1547 
	}
}

1550 
t_löked_öt
 *

1551 
	$Æloˇã_™d_lﬂd_¸ôiˇl_∑th
()

1557 
t_löked_öt
 *
¸ôiˇl_∑th_hód
, *
cuº_¸ô_node
, *
¥ev_¸ô_node
;

1558 
öode
, 
õdge
, 
to_node
, 
num_©_Àvñ
, 
i
, 
¸ô_node
, 
num_edges
;

1559 
mö_¶ack
, 
¶ack
;

1560 
t_ãdge
 *
ãdge
;

1562 
num_©_Àvñ
 = 
äodes_©_Àvñ
[0].
√Àm
;

1563 
mö_¶ack
 = 
HUGE_FLOAT
;

1564 
¸ô_node
 = 
OPEN
;

1566 
i
 = 0; i < 
num_©_Àvñ
; i++)

1568 
öode
 = 
äodes_©_Àvñ
[0].
li°
[
i
];

1569 
¶ack
 = 
äode
[
öode
].
T_ªq
 -Ånode[öode].
T_¨r
;

1571 if(
¶ack
 < 
mö_¶ack
)

1573 
¸ô_node
 = 
öode
;

1574 
mö_¶ack
 = 
¶ack
;

1578 
¸ôiˇl_∑th_hód
 = (
t_löked_öt
 *Ë
	`my_mÆloc
((t_linked_int));

1579 
¸ôiˇl_∑th_hód
->
d©a
 = 
¸ô_node
;

1580 
¥ev_¸ô_node
 = 
¸ôiˇl_∑th_hód
;

1581 
num_edges
 = 
äode
[
¸ô_node
].num_edges;

1583 
num_edges
 != 0)

1585 
cuº_¸ô_node
 = (
t_löked_öt
 *Ë
	`my_mÆloc
((t_linked_int));

1586 
¥ev_¸ô_node
->
√xt
 = 
cuº_¸ô_node
;

1587 
ãdge
 = 
äode
[
¸ô_node
].
out_edges
;

1588 
mö_¶ack
 = 
HUGE_FLOAT
;

1590 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

1592 
to_node
 = 
ãdge
[
õdge
].to_node;

1593 
¶ack
 = 
äode
[
to_node
].
T_ªq
 -Ånode[to_node].
T_¨r
;

1595 if(
¶ack
 < 
mö_¶ack
)

1597 
¸ô_node
 = 
to_node
;

1598 
mö_¶ack
 = 
¶ack
;

1602 
cuº_¸ô_node
->
d©a
 = 
¸ô_node
;

1603 
¥ev_¸ô_node
 = 
cuº_¸ô_node
;

1604 
num_edges
 = 
äode
[
¸ô_node
].num_edges;

1607 
¥ev_¸ô_node
->
√xt
 = 
NULL
;

1608  (
¸ôiˇl_∑th_hód
);

1609 
	}
}

1613 
	$gë_äode_block_™d_ouçut_√t
(
öode
,

1614 *
iblk_±r
,

1615 *
öë_±r
)

1622 
öë
, 
ùö
, 
iblk
;

1623 
t_äode_ty≥
 
äode_ty≥
;

1625 
iblk
 = 
äode_des¸ùt
[
öode
].iblk;

1626 
äode_ty≥
 = 
äode_des¸ùt
[
öode
].
ty≥
;

1628 if(
äode_ty≥
 =
FB_OPIN
 ||Ånode_ty≥ =
INPAD_OPIN
)

1630 
ùö
 = 
äode_des¸ùt
[
öode
].ipin;

1631 
öë
 = 
block
[
iblk
].
√ts
[
ùö
];

1635 
öë
 = 
OPEN
;

1638 *
iblk_±r
 = 
iblk
;

1639 *
öë_±r
 = 
öë
;

1640 
	}
}

1644 
	$do_c⁄°™t_√t_dñay_timög_™Æysis
(
t_timög_öf
 
timög_öf
,

1645 
t_subblock_d©a
 
subblock_d©a
,

1646 
c⁄°™t_√t_dñay_vÆue
)

1652 
s_löked_v±r
 *
√t_dñay_chunk_li°_hód
;

1653 **
√t_dñay
, **
√t_¶ack
;

1655 
T_¸ô
;

1657 
√t_¶ack
 = 
	`Æloc_™d_lﬂd_timög_gøph
(
timög_öf
, 
subblock_d©a
);

1658 
√t_dñay
 = 
	`Æloc_√t_dñay
(&
√t_dñay_chunk_li°_hód
);

1660 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
, 
c⁄°™t_√t_dñay_vÆue
);

1661 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

1662 
T_¸ô
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

1664 
	`¥ötf
("\n");

1665 
	`¥ötf
("\nCrôiˇ»P©h: %g (s)\n", 
T_¸ô
);

1667 #ifde‡
CREATE_ECHO_FILES


1668 
	`¥öt_¸ôiˇl_∑th
("¸ôiˇl_∑th.echo", 
subblock_d©a
);

1669 
	`¥öt_timög_gøph
("timing_graph.echo");

1670 
	`¥öt_√t_¶ack
("√t_¶ack.echo", 
√t_¶ack
);

1671 
	`¥öt_√t_dñay
(
√t_dñay
, "net_delay.echo");

1674 
	`‰ì_timög_gøph
(
√t_¶ack
);

1675 
	`‰ì_√t_dñay
(
√t_dñay
, &
√t_dñay_chunk_li°_hód
);

1676 
	}
}

	@path_delay.h

1 **
Æloc_™d_lﬂd_timög_gøph
(
t_timög_öf
 
timög_öf
,

2 
t_subblock_d©a
 
subblock_d©a
);

4 
t_löked_öt
 *
Æloˇã_™d_lﬂd_¸ôiˇl_∑th
();

6 
lﬂd_timög_gøph_√t_dñays
(**
√t_dñay
);

8 
lﬂd_√t_¶ack
(**
√t_¶ack
,

9 
èrgë_cy˛e_time
);

11 
‰ì_timög_gøph
(**
√t_¶ack
);

13 
¥öt_timög_gøph
(*
‚ame
);

15 
¥öt_√t_¶ack
(*
‚ame
,

16 **
√t_¶ack
);

18 
¥öt_¸ôiˇl_∑th
(*
‚ame
,

19 
t_subblock_d©a
 
subblock_d©a
);

21 
gë_äode_block_™d_ouçut_√t
(
öode
,

22 *
iblk_±r
,

23 *
öë_±r
);

25 
do_c⁄°™t_√t_dñay_timög_™Æysis
(
t_timög_öf
 
timög_öf
,

26 
t_subblock_d©a
 
subblock_d©a
,

27 
c⁄°™t_√t_dñay_vÆue
);

	@path_delay2.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"∑th_dñay2.h
"

10 
t_äode
 *
	gäode
;

11 
t_äode_des¸ùt
 *
	gäode_des¸ùt
;

12 
	gnum_äodes
;

16 *
	g√t_to_drivî_äode
;

22 
s_ivec
 *
	gäodes_©_Àvñ
;

23 
	gnum_äode_Àvñs
;

29 *
Æloc_™d_lﬂd_äode_Ánö_™d_check_edges
(*
num_söks_±r
);

37 
	$Æloc_™d_lﬂd_äode_Ánö_™d_check_edges
(*
num_söks_±r
)

44 
öode
, 
õdge
, 
to_node
, 
num_edges
, 
îr‹
, 
num_söks
;

45 *
äode_num_Ánö
;

46 
t_ãdge
 *
ãdge
;

48 
äode_num_Ánö
 = (*)
	`my_ˇŒoc
(
num_äodes
, ());

49 
îr‹
 = 0;

50 
num_söks
 = 0;

52 
öode
 = 0; inodê< 
num_äodes
; inode++)

54 
num_edges
 = 
äode
[
öode
].num_edges;

56 if(
num_edges
 > 0)

58 
ãdge
 = 
äode
[
öode
].
out_edges
;

59 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

61 
to_node
 = 
ãdge
[
õdge
].to_node;

63 if(
to_node
 < 0 ||Åo_nodê>
num_äodes
)

65 
¥ötf


68 
öode
, 
õdge
, 
to_node
);

69 
îr‹
++;

72 
äode_num_Ánö
[
to_node
]++;

76 if(
num_edges
 == 0)

78 
num_söks
++;

83 
¥ötf


85 "äodê#%d ha†%dÉdges.\n", 
öode
, 
num_edges
);

86 
îr‹
++;

91 if(
îr‹
 != 0)

93 
	`¥ötf
("Found %d Errors inÅheÅiming graph. Aborting.\n",

94 
îr‹
);

95 
	`exô
(1);

98 *
num_söks_±r
 = 
num_söks
;

99  (
äode_num_Ánö
);

100 
	}
}

104 
	$Æloc_™d_lﬂd_timög_gøph_Àvñs
()

111 
t_löked_öt
 *
‰ì_li°_hód
, *
nodes_©_Àvñ_hód
;

112 
öode
, 
num_©_Àvñ
, 
õdge
, 
to_node
, 
num_edges
, 
num_söks
,

113 
num_Àvñs
, 
i
;

114 
t_ãdge
 *
ãdge
;

119 *
äode_Ánö_À·
;

122 
äode_Ánö_À·
 = 
	`Æloc_™d_lﬂd_äode_Ánö_™d_check_edges
(&
num_söks
);

124 
‰ì_li°_hód
 = 
NULL
;

125 
nodes_©_Àvñ_hód
 = 
NULL
;

131 
äodes_©_Àvñ
 = (
s_ivec
 *)
	`my_mÆloc
((
num_äodes
 + 1) *

132 (
s_ivec
));

137 
num_©_Àvñ
 = 0;

139 
öode
 = 0; inodê< 
num_äodes
; inode++)

141 if(
äode_Ánö_À·
[
öode
] == 0)

143 
num_©_Àvñ
++;

144 
nodes_©_Àvñ_hód
 =

145 
	`ö£π_ö_öt_li°
(
nodes_©_Àvñ_hód
, 
öode
,

146 &
‰ì_li°_hód
);

150 
	`Æloc_ive˘‹_™d_c›y_öt_li°
(&
nodes_©_Àvñ_hód
, 
num_©_Àvñ
,

151 &
äodes_©_Àvñ
[0], &
‰ì_li°_hód
);

153 
num_Àvñs
 = 0;

155 
num_©_Àvñ
 != 0)

157 
num_Àvñs
++;

158 
num_©_Àvñ
 = 0;

160 
i
 = 0; i < 
äodes_©_Àvñ
[
num_Àvñs
 - 1].
√Àm
; i++)

162 
öode
 = 
äodes_©_Àvñ
[
num_Àvñs
 - 1].
li°
[
i
];

163 
ãdge
 = 
äode
[
öode
].
out_edges
;

164 
num_edges
 = 
äode
[
öode
].num_edges;

166 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

168 
to_node
 = 
ãdge
[
õdge
].to_node;

169 
äode_Ánö_À·
[
to_node
]--;

171 if(
äode_Ánö_À·
[
to_node
] == 0)

173 
num_©_Àvñ
++;

174 
nodes_©_Àvñ_hód
 =

175 
ö£π_ö_öt_li°


176 (
nodes_©_Àvñ_hód
, 
to_node
,

177 &
‰ì_li°_hód
);

182 
	`Æloc_ive˘‹_™d_c›y_öt_li°
(&
nodes_©_Àvñ_hód
,

183 
num_©_Àvñ
,

184 &
äodes_©_Àvñ
[
num_Àvñs
],

185 &
‰ì_li°_hód
);

188 
äodes_©_Àvñ
 =

189 (
s_ivec
 *)
	`my_ªÆloc
(
äodes_©_Àvñ
,

190 
num_Àvñs
 * (
s_ivec
));

191 
num_äode_Àvñs
 = 
num_Àvñs
;

193 
	`‰ì
(
äode_Ánö_À·
);

194 
	`‰ì_öt_li°
(&
‰ì_li°_hód
);

195  (
num_söks
);

196 
	}
}

200 
	$check_timög_gøph
(
num_c⁄°_gí
,

201 
num_ff
,

202 
num_söks
)

211 
i
, 
j
, 
num_äodes_check
, 
ûevñ
, 
öë
, 
öode
, 
îr‹
, 
num_p_öputs
,

212 
num_p_ouçuts
;

214 
îr‹
 = 0;

215 
num_äodes_check
 = 0;

216 
num_p_öputs
 = 0;

217 
num_p_ouçuts
 = 0;

220 
i
 = 0; i < 
num_blocks
; i++)

222 if(
block
[
i
].
ty≥
 =
IO_TYPE
)

224 
j
 = 0; j < 
IO_TYPE
->
num_pös
; j++)

226 if(
block
[
i
].
√ts
[
j
] !
OPEN
)

228 if(
IO_TYPE
->

229 
˛ass_öf
[
IO_TYPE
->
pö_˛ass
[
j
]].

230 
ty≥
 =
DRIVER
)

232 
num_p_öputs
++;

236 
	`as£π
(
IO_TYPE
->

237 
˛ass_öf
[
IO_TYPE
->

238 
pö_˛ass
[
j
]].

239 
ty≥
 =
RECEIVER
);

240 
num_p_ouçuts
++;

247 
ûevñ
 = 0; iÀvñ < 
num_äode_Àvñs
; ilevel++)

248 
num_äodes_check
 +
äodes_©_Àvñ
[
ûevñ
].
√Àm
;

250 if(
num_äodes_check
 !
num_äodes
)

252 
¥ötf


254 "°ru˘uª. Ex≥˘ed %d.\n", 
num_äodes_check
, 
num_äodes
);

255 
	`¥ötf
("CheckÅheÇetlist for combinational cycles.\n");

256 
îr‹
++;

259 if(
num_c⁄°_gí
 + 
num_p_öputs
 !
äodes_©_Àvñ
[0].
√Àm
)

261 
¥ötf


263 "öput†--Éx≥˘ed %d.\n", 
äodes_©_Àvñ
[0].
√Àm
,

264 
num_c⁄°_gí
 + 
num_p_öputs
);

265 
îr‹
++;

268 if(
num_söks
 !
num_p_ouçuts
 + 
num_ff
)

270 
¥ötf


272 "ouçut†--Éx≥˘ed %d.\n", 
num_söks
,

273 
num_ff
 + 
num_p_ouçuts
);

274 
îr‹
++;

277 
öë
 = 0; i√à< 
num_√ts
; inet++)

279 
öode
 = 
√t_to_drivî_äode
[
öë
];

280 if(
öode
 < 0 || inodê>
num_äodes
)

282 
	`¥ötf
("Error in check_timing_graph:\n"

284 
öë
, 
öode
);

285 
îr‹
++;

289 if(
îr‹
 != 0)

291 
	`¥ötf
("Found %d Errors inÅheÅiming graph. Aborting.\n",

292 
îr‹
);

293 
	`exô
(1);

295 
	}
}

299 
	$¥öt_¸ôiˇl_∑th_node
(
FILE
 * 
Â
,

300 
t_löked_öt
 * 
¸ôiˇl_∑th_node
,

301 
t_subblock_d©a
 
subblock_d©a
)

307 
öode
, 
iblk
, 
ùö
, 
öë
, 
down°ªam_node
;

308 
t_äode_ty≥
 
ty≥
;

309 *
äode_ty≥_«mes
[] = { "INPAD_SOURCE", "INPAD_OPIN",

314 
t_löked_öt
 *
√xt_¸ô_node
;

315 
Tdñ
;

317 
öode
 = 
¸ôiˇl_∑th_node
->
d©a
;

318 
ty≥
 = 
äode_des¸ùt
[
öode
].type;

319 
iblk
 = 
äode_des¸ùt
[
öode
].iblk;

320 
ùö
 = 
äode_des¸ùt
[
öode
].ipin;

322 
	`Ârötf
(
Â
, "Node: %d %†Block #%d (%s)\n", 
öode
,

323 
äode_ty≥_«mes
[
ty≥
], 
iblk
, 
block
[iblk].
«me
);

325 if(
ty≥
 !
INPAD_SOURCE
 &&Åy≥ !
OUTPAD_SINK
 &&Åy≥ !
FF_SINK
 &&

326 
ty≥
 !
FF_SOURCE
 &&Åy≥ !
CONSTANT_GEN_SOURCE
)

328 
	`Ârötf
(
Â
, "Pö: %d ", 
ùö
);

331 if(
ty≥
 =
SUBBLK_IPIN
 ||Åy≥ =
SUBBLK_OPIN
 ||Åy≥ =
FF_SINK


332 || 
ty≥
 =
FF_SOURCE
 ||Åy≥ =
CONSTANT_GEN_SOURCE
)

334 
	`Ârötf
(
Â
, "Subblock #%d subpin #%d",

335 
äode_des¸ùt
[
öode
].
isubblk
,

336 
äode_des¸ùt
[
öode
].
ùö
);

339 if(
ty≥
 !
INPAD_SOURCE
 &&Åy≥ !
OUTPAD_SINK
)

341 
	`Ârötf
(
Â
, "\n");

344 
	`Ârötf
(
Â
, "T_¨r: %g T_ªq: %g ", 
äode
[
öode
].
T_¨r
,

345 
äode
[
öode
].
T_ªq
);

347 
√xt_¸ô_node
 = 
¸ôiˇl_∑th_node
->
√xt
;

348 if(
√xt_¸ô_node
 !
NULL
)

350 
down°ªam_node
 = 
√xt_¸ô_node
->
d©a
;

351 
Tdñ
 = 
äode
[
down°ªam_node
].
T_¨r
 -Ånode[
öode
].T_arr;

352 
	`Ârötf
(
Â
, "Tdñ: %g\n", 
Tdñ
);

356 
Tdñ
 = 0.;

357 
	`Ârötf
(
Â
, "\n");

360 if(
ty≥
 =
FB_OPIN
)

362 
öë
 = 
block
[
iblk
].
√ts
[
ùö
];

363 
	`Ârötf
(
Â
, "NetÅoÇextÇode: #%d (%s). Pins onÇet: %d.\n",

364 
öë
, 
√t
[öë].
«me
, (√t[öë].
num_söks
 + 1));

367 if(
ty≥
 =
INPAD_OPIN
)

369 
ùö
 =

370 
subblock_d©a
.
subblock_öf
[
iblk
][
äode_des¸ùt
[
öode
].

371 
isubblk
].
ouçuts
[
ùö
];

372 
öë
 = 
block
[
iblk
].
√ts
[
ùö
];

373 
	`Ârötf
(
Â
, "NetÅoÇextÇode: #%d (%s). Pins onÇet: %d.\n",

374 
öë
, 
√t
[öë].
«me
, (√t[öë].
num_söks
 + 1));

377 
	`Ârötf
(
Â
, "\n");

378  (
Tdñ
);

379 
	}
}

	@path_delay2.h

5 
	mto_node
;

6 
	mTdñ
;

8 
	tt_ãdge
;

16 
t_ãdge
 *
	mout_edges
;

17 
	mnum_edges
;

18 
	mT_¨r
;

19 
	mT_ªq
;

21 
	tt_äode
;

36 { 
	mINPAD_SOURCE
, 
	mINPAD_OPIN
, 
	mOUTPAD_IPIN
, 
	mOUTPAD_SINK
,

37 
	mFB_IPIN
, 
	mFB_OPIN
, 
	mSUBBLK_IPIN
, 
	mSUBBLK_OPIN
, 
	mFF_SINK
, 
	mFF_SOURCE
,

38 
	mCONSTANT_GEN_SOURCE


40 
	tt_äode_ty≥
;

44 
t_äode_ty≥
 
	mty≥
;

45 
	mùö
;

46 
	misubblk
;

47 
	miblk
;

49 
	tt_äode_des¸ùt
;

61 
t_äode
 *
äode
;

62 
t_äode_des¸ùt
 *
äode_des¸ùt
;

63 
num_äodes
;

68 *
√t_to_drivî_äode
;

74 
s_ivec
 *
äodes_©_Àvñ
;

75 
num_äode_Àvñs
;

81 
Æloc_™d_lﬂd_timög_gøph_Àvñs
();

83 
check_timög_gøph
(
num_c⁄°_gí
,

84 
num_ff
,

85 
num_söks
);

87 
¥öt_¸ôiˇl_∑th_node
(
FILE
 * 
Â
,

88 
t_löked_öt
 * 
¸ôiˇl_∑th_node
,

89 
t_subblock_d©a
 
subblock_d©a
);

	@place.c

2 
	~<°dio.h
>

3 
	~<m©h.h
>

4 
	~<as£π.h
>

5 
	~"utû.h
"

6 
	~"v¥_ty≥s.h
"

7 
	~"globÆs.h
"

8 
	~"m°.h
"

9 
	~"∂a˚.h
"

10 
	~"ªad_∂a˚.h
"

11 
	~"døw.h
"

12 
	~"∂a˚_™d_rouã.h
"

13 
	~"√t_dñay.h
"

14 
	~"∑th_dñay.h
"

15 
	~"timög_∂a˚_lookup.h
"

16 
	~"timög_∂a˚.h
"

17 
	~"∂a˚_°©s.h
"

21 
	#SMALL_NET
 4

	)

30 
	eco°_mëhods


31 { 
	mNORMAL
, 
	mCHECK
 };

33 
	#FROM
 0

	)

34 
	#TO
 1

	)

35 
	#FROM_AND_TO
 2

	)

37 
	#ERROR_TOL
 .0025

	)

38 
	#MAX_MOVES_BEFORE_RECOMPUTE
 50000

	)

45 *
	gdu∂iˇã_pös
;

50 **
	gunique_pö_li°
;

54 *
	g√t_co°
 = 
NULL
, *
	gãmp_√t_co°
 = NULL;

59 **
	gpoöt_to_poöt_timög_co°
 = 
NULL
;

60 **
	gãmp_poöt_to_poöt_timög_co°
 = 
NULL
;

66 **
	gpoöt_to_poöt_dñay_co°
 = 
NULL
;

67 **
	gãmp_poöt_to_poöt_dñay_co°
 = 
NULL
;

74 **
	g√t_pö_ödex
 = 
NULL
;

81 
s_bb
 *
	gbb_co‹ds
 = 
NULL
, *
	gbb_num_⁄_edges
 = NULL;

88 
s_∂a˚_ªgi⁄
 **
	g∂a˚_ªgi⁄_x
, **
	g∂a˚_ªgi⁄_y
;

92 *
	g∂a˚_ªgi⁄_bounds_x
, *
	g∂a˚_ªgi⁄_bounds_y
;

102 **
	gch™x_∂a˚_co°_Ác
, **
	gch™y_∂a˚_co°_Ác
;

108 c⁄° 
	g¸oss_cou¡
[50] = {

123 
Æloc_™d_lﬂd_unique_pö_li°
();

125 
‰ì_unique_pö_li°
();

127 
Æloc_∂a˚_ªgi⁄s
(
num_ªgi⁄s
);

129 
lﬂd_∂a˚_ªgi⁄s
(
num_ªgi⁄s
);

131 
‰ì_∂a˚_ªgi⁄s
(
num_ªgi⁄s
);

133 
Æloc_™d_lﬂd_∂a˚mít_°ru˘s
(
∂a˚_co°_ty≥
,

134 
num_ªgi⁄s
,

135 
∂a˚_co°_exp
,

136 ***
ﬁd_ªgi⁄_occ_x
,

137 ***
ﬁd_ªgi⁄_occ_y
,

138 
s_∂a˚r_›ts


139 
∂a˚r_›ts
);

141 
‰ì_∂a˚mít_°ru˘s
(
∂a˚_co°_ty≥
,

142 
num_ªgi⁄s
,

143 **
ﬁd_ªgi⁄_occ_x
,

144 **
ﬁd_ªgi⁄_occ_y
,

145 
s_∂a˚r_›ts
 
∂a˚r_›ts
);

147 
Æloc_™d_lﬂd_f‹_Á°_co°_upd©e
(
∂a˚_co°_exp
);

149 
öôül_∂a˚mít
(
e_∑d_loc_ty≥
 
∑d_loc_ty≥
,

150 *
∑d_loc_fûe
);

152 
comp_bb_co°
(
mëhod
,

153 
∂a˚_co°_ty≥
,

154 
num_ªgi⁄s
);

156 
åy_sw≠
(
t
,

157 *
co°
,

158 *
bb_co°
,

159 *
timög_co°
,

160 
æim
,

161 
∂a˚_co°_ty≥
,

162 **
ﬁd_ªgi⁄_occ_x
,

163 **
ﬁd_ªgi⁄_occ_y
,

164 
num_ªgi⁄s
,

165 
boﬁón
 
fixed_pös
,

166 
e_∂a˚_Æg‹ôhm
 
∂a˚_Æg‹ôhm
,

167 
timög_åadeoff
,

168 
övî£_¥ev_bb_co°
,

169 
övî£_¥ev_timög_co°
,

170 *
dñay_co°
,

171 *
x_lookup
);

173 
check_∂a˚
(
bb_co°
,

174 
timög_co°
,

175 
∂a˚_co°_ty≥
,

176 
num_ªgi⁄s
,

177 
e_∂a˚_Æg‹ôhm
 
∂a˚_Æg‹ôhm
,

178 
dñay_co°
);

180 
°¨tög_t
(*
co°_±r
,

181 *
bb_co°_±r
,

182 *
timög_co°_±r
,

183 
∂a˚_co°_ty≥
,

184 **
ﬁd_ªgi⁄_occ_x
,

185 **
ﬁd_ªgi⁄_occ_y
,

186 
num_ªgi⁄s
,

187 
boﬁón
 
fixed_pös
,

188 
s_™√Æög_sched
 
™√Æög_sched
,

189 
max_moves
,

190 
æim
,

191 
e_∂a˚_Æg‹ôhm
 
∂a˚_Æg‹ôhm
,

192 
timög_åadeoff
,

193 
övî£_¥ev_bb_co°
,

194 
övî£_¥ev_timög_co°
,

195 *
dñay_co°_±r
);

198 
upd©e_t
(*
t
,

199 
°d_dev
,

200 
æim
,

201 
suc˚ss_øt
,

202 
s_™√Æög_sched
 
™√Æög_sched
);

204 
upd©e_æim
(*
æim
,

205 
suc˚ss_øt
);

207 
exô_¸ô
(
t
,

208 
co°
,

209 
s_™√Æög_sched
 
™√Æög_sched
);

211 
cou¡_c⁄√˘i⁄s
();

213 
compuã_√t_pö_ödex_vÆues
();

215 
gë_°d_dev
(
n
,

216 
sum_x_squ¨ed
,

217 
av_x
);

219 
‰ì_Á°_co°_upd©e_°ru˘s
();

221 
ªcompuã_bb_co°
(
∂a˚_co°_ty≥
,

222 
num_ªgi⁄s
);

224 
comp_td_poöt_to_poöt_dñay
(
öë
,

225 
ùö
);

227 
upd©e_td_co°
(
b_‰om
,

228 
b_to
,

229 
num_of_pös
);

231 
comp_dñè_td_co°
(
b_‰om
,

232 
b_to
,

233 
num_of_pös
,

234 *
dñè_timög
,

235 *
dñè_dñay
);

237 
comp_td_co°s
(*
timög_co°
,

238 *
c⁄√˘i⁄_dñay_sum
);

240 
as£ss_sw≠
(
dñè_c
,

241 
t
);

243 
boﬁón
 
föd_to
(
x_‰om
,

244 
y_‰om
,

245 
t_ty≥_±r
 
ty≥
,

246 
æim
,

247 *
x_lookup
,

248 *
x_to
,

249 *
y_to
);

251 
gë_n⁄_upd©óbÀ_bb
(
öë
,

252 
s_bb
 *
bb_co‹d_√w
);

254 
upd©e_bb
(
öë
,

255 
s_bb
 *
bb_co‹d_√w
,

256 
s_bb
 *
bb_edge_√w
,

257 
xﬁd
,

258 
yﬁd
,

259 
x√w
,

260 
y√w
);

262 
föd_af„˘ed_√ts
(*
√ts_to_upd©e
,

263 *
√t_block_moved
,

264 
b_‰om
,

265 
b_to
,

266 
num_of_pös
);

268 
gë_√t_co°
(
öë
,

269 
s_bb
 *
bb_±r
);

271 
n⁄löór_c⁄g_co°
(
num_ªgi⁄s
);

273 
upd©e_ªgi⁄_occ
(
öë
,

274 
s_bb
 *
co‹ds
,

275 
add_‹_sub
,

276 
num_ªgi⁄s
);

278 
ßve_ªgi⁄_occ
(**
ﬁd_ªgi⁄_occ_x
,

279 **
ﬁd_ªgi⁄_occ_y
,

280 
num_ªgi⁄s
);

282 
ª°‹e_ªgi⁄_occ
(**
ﬁd_ªgi⁄_occ_x
,

283 **
ﬁd_ªgi⁄_occ_y
,

284 
num_ªgi⁄s
);

286 
gë_bb_‰om_s¸©ch
(
öë
,

287 
s_bb
 *
co‹ds
,

288 
s_bb
 *
num_⁄_edges
);

290 
gë_√t_wúñígth_e°im©e
(
öë
,

291 
s_bb
 *
bb±r
);

296 
	$åy_∂a˚
(
s_∂a˚r_›ts
 
∂a˚r_›ts
,

297 
s_™√Æög_sched
 
™√Æög_sched
,

298 
t_ch™_width_di°
 
ch™_width_di°
,

299 
s_rouãr_›ts
 
rouãr_›ts
,

300 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

301 
t_£gmít_öf
 * 
£gmít_öf
,

302 
t_timög_öf
 
timög_öf
,

303 
t_subblock_d©a
 * 
subblock_d©a_±r
,

304 
t_m°_edge
 *** 
m°
)

315 
tŸ_ôî
, 
ö√r_ôî
, 
suc˚ss_sum
;

316 
move_lim
, 
moves_sö˚_co°_ªcompuã
, 
width_Ác
;

317 
t
, 
suc˚ss_øt
, 
æim
, 
d_max
, 
e°_¸ô
;

318 
co°
, 
timög_co°
, 
bb_co°
, 
√w_bb_co°
, 
√w_timög_co°
;

319 
dñay_co°
, 
√w_dñay_co°
, 
∂a˚_dñay_vÆue
;

320 
övî£_¥ev_bb_co°
, 
övî£_¥ev_timög_co°
;

321 
ﬁdt
;

322 
av_co°
, 
av_bb_co°
, 
av_timög_co°
, 
av_dñay_co°
,

323 
sum_of_squ¨es
, 
°d_dev
;

324 **
ﬁd_ªgi⁄_occ_x
, **
ﬁd_ªgi⁄_occ_y
;

325 
msg
[
BUFSIZE
];

326 
boﬁón
 
fixed_pös
;

327 
num_c⁄√˘i⁄s
;

328 
öë
, 
ùö
, 
ouãr_¸ô_ôî_cou¡
, 
ö√r_¸ô_ôî_cou¡
,

329 
ö√r_ªcompuã_limô
;

330 **
√t_¶ack
, **
√t_dñay
;

331 
¸ô_exp⁄ít
;

332 
fú°_æim
, 
föÆ_æim
, 
övî£_dñè_æim
;

333 **
ªmembî_√t_dñay_‹igöÆ_±r
;

335 *
x_lookup
;

338 
x_lookup
 = 
	`my_mÆloc
(
nx
 * ());

340 
ªmembî_√t_dñay_‹igöÆ_±r
 = 
NULL
;

342 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

343 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
 ||

344 
∂a˚r_›ts
.
íabÀ_timög_compuèti⁄s
)

347 
	`Æloc_lookups_™d_¸ôiˇlôõs
(
ch™_width_di°
,

348 
rouãr_›ts
,

349 
dë_routög_¨ch
,

350 
£gmít_öf
,

351 
timög_öf
,

352 *
subblock_d©a_±r
,

353 &
√t_dñay
, &
√t_¶ack
);

355 
ªmembî_√t_dñay_‹igöÆ_±r
 = 
√t_dñay
;

358 #ifde‡
PRINT_LOWER_BOUND


362 if(
∂a˚r_›ts
.
block_di°
 <
nx
)

363 
∂a˚_dñay_vÆue
 =

364 
dñè_˛b_to_˛b
[
∂a˚r_›ts
.
block_di°
][0];

365 if(
∂a˚r_›ts
.
block_di°
 <
ny
)

366 
∂a˚_dñay_vÆue
 =

367 
dñè_˛b_to_˛b
[0][
∂a˚r_›ts
.
block_di°
];

369 
∂a˚_dñay_vÆue
 = 
dñè_˛b_to_˛b
[
nx
][
ny
];

371 
	`¥ötf
("\nLowî boundássumög dñay o‡%g\n", 
∂a˚_dñay_vÆue
);

373 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
, 
∂a˚_dñay_vÆue
);

374 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

375 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

377 #ifde‡
CREATE_ECHO_FILES


378 
	`¥öt_¸ôiˇl_∑th
("Placement_Lower_Bound.echo");

379 
	`¥öt_sök_dñays
("Placement_Lower_Bound_Sink_Delays.echo");

385 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
, 0);

386 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

387 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

389 #ifde‡
CREATE_ECHO_FILES


390 
	`¥öt_sök_dñays
("Placement_Logic_Sink_Delays.echo");

396 
width_Ác
 = 
∂a˚r_›ts
.
∂a˚_ch™_width
;

397 if(
∂a˚r_›ts
.
∑d_loc_ty≥
 =
FREE
)

398 
fixed_pös
 = 
FALSE
;

400 
fixed_pös
 = 
TRUE
;

402 
	`öô_ch™
(
width_Ác
, 
ch™_width_di°
);

404 
	`Æloc_™d_lﬂd_∂a˚mít_°ru˘s
(
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

405 
∂a˚r_›ts
.
num_ªgi⁄s
,

406 
∂a˚r_›ts
.
∂a˚_co°_exp
,

407 &
ﬁd_ªgi⁄_occ_x
, &
ﬁd_ªgi⁄_occ_y
,

408 
∂a˚r_›ts
);

410 
	`öôül_∂a˚mít
(
∂a˚r_›ts
.
∑d_loc_ty≥
,Öœ˚r_›ts.
∑d_loc_fûe
);

411 
	`öô_døw_co‹ds
(()
width_Ác
);

418 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

419 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

421 
bb_co°
 = 
	`comp_bb_co°
(
NORMAL
, 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

422 
∂a˚r_›ts
.
num_ªgi⁄s
);

424 
¸ô_exp⁄ít
 = 
∂a˚r_›ts
.
td_∂a˚_exp_fú°
;

426 
	`compuã_√t_pö_ödex_vÆues
();

428 
num_c⁄√˘i⁄s
 = 
	`cou¡_c⁄√˘i⁄s
();

429 
¥ötf


431 
num_c⁄√˘i⁄s
);

433 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
)

435 
öë
 = 0; i√à< 
num_√ts
; inet++)

436 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

437 
timög_∂a˚_¸ô
[
öë
][
ùö
] = 0;

439 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

442 
∂a˚_dñay_vÆue
 = 
dñay_co°
 / 
num_c⁄√˘i⁄s
;

443 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
, 
∂a˚_dñay_vÆue
);

447 
∂a˚_dñay_vÆue
 = 0;

450 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

452 
√t_dñay
 = 
poöt_to_poöt_dñay_co°
;

460 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

461 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

462 
	`lﬂd_¸ôiˇlôõs
(
∂a˚r_›ts
, 
√t_¶ack
, 
d_max
, 
¸ô_exp⁄ít
);

463 
ouãr_¸ô_ôî_cou¡
 = 1;

466 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

468 
övî£_¥ev_timög_co°
 = 1 / 
timög_co°
;

469 
övî£_¥ev_bb_co°
 = 1 / 
bb_co°
;

470 
co°
 = 1;

476 
co°
 = 
bb_co°
 = 
	`comp_bb_co°
(
NORMAL
, 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

477 
∂a˚r_›ts
.
num_ªgi⁄s
);

478 
timög_co°
 = 0;

479 
dñay_co°
 = 0;

480 
∂a˚_dñay_vÆue
 = 0;

481 
ouãr_¸ô_ôî_cou¡
 = 0;

482 
num_c⁄√˘i⁄s
 = 0;

483 
d_max
 = 0;

484 
¸ô_exp⁄ít
 = 0;

486 
övî£_¥ev_timög_co°
 = 0;

487 
övî£_¥ev_bb_co°
 = 0;

490 
move_lim
 = ()(
™√Æög_sched
.
ö√r_num
 * 
	`pow
(
num_blocks
, 1.3333));

492 if(
∂a˚r_›ts
.
ö√r_lo›_ªcompuã_dividî
 != 0)

493 
ö√r_ªcompuã_limô
 = ()(0.5 + ()
move_lim
 /

494 ()
∂a˚r_›ts
.

495 
ö√r_lo›_ªcompuã_dividî
);

497 
ö√r_ªcompuã_limô
 = 
move_lim
 + 1;

505 if(
move_lim
 <= 0)

506 
move_lim
 = 1;

508 
æim
 = ()
	`max
(
nx
, 
ny
);

510 
fú°_æim
 = 
æim
;

511 
föÆ_æim
 = 1;

512 
övî£_dñè_æim
 = 1 / (
fú°_æim
 - 
föÆ_æim
);

514 
t
 = 
	`°¨tög_t
(&
co°
, &
bb_co°
, &
timög_co°
,

515 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

516 
ﬁd_ªgi⁄_occ_x
, 
ﬁd_ªgi⁄_occ_y
,

517 
∂a˚r_›ts
.
num_ªgi⁄s
, 
fixed_pös
, 
™√Æög_sched
,

518 
move_lim
, 
æim
, 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
,

519 
∂a˚r_›ts
.
timög_åadeoff
, 
övî£_¥ev_bb_co°
,

520 
övî£_¥ev_timög_co°
, &
dñay_co°
);

521 
tŸ_ôî
 = 0;

522 
moves_sö˚_co°_ªcompuã
 = 0;

523 
¥ötf


525 
co°
, 
bb_co°
, 
timög_co°
, 
dñay_co°
);

527 #i‚de‡
SPEC


528 
¥ötf


533 
¥ötf


540 
	`•rötf
(
msg
,

542 "\àd_max %g Ch™√»Fa˘‹: %d", 
co°
, 
bb_co°
, 
timög_co°
,

543 
dñay_co°
, 
d_max
, 
width_Ác
);

544 
	`upd©e_s¸ìn
(
MAJOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

546 
	`exô_¸ô
(
t
, 
co°
, 
™√Æög_sched
) == 0)

549 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

550 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

552 
co°
 = 1;

555 
av_co°
 = 0.;

556 
av_bb_co°
 = 0.;

557 
av_dñay_co°
 = 0.;

558 
av_timög_co°
 = 0.;

559 
sum_of_squ¨es
 = 0.;

560 
suc˚ss_sum
 = 0;

562 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

563 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

566 if(
ouãr_¸ô_ôî_cou¡
 >=

567 
∂a˚r_›ts
.
ªcompuã_¸ô_ôî


568 || 
∂a˚r_›ts
.
ö√r_lo›_ªcompuã_dividî
 != 0)

570 #ifde‡
VERBOSE


571 
	`¥ötf
("Outer Loop Recompute Criticalities\n");

573 
∂a˚_dñay_vÆue
 = 
dñay_co°
 / 
num_c⁄√˘i⁄s
;

575 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 ==

576 
NET_TIMING_DRIVEN_PLACE
)

577 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
,

578 
∂a˚_dñay_vÆue
);

582 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

583 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

584 
	`lﬂd_¸ôiˇlôõs
(
∂a˚r_›ts
, 
√t_¶ack
, 
d_max
,

585 
¸ô_exp⁄ít
);

587 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

588 
ouãr_¸ô_ôî_cou¡
 = 0;

590 
ouãr_¸ô_ôî_cou¡
++;

594 
övî£_¥ev_bb_co°
 = 1 / 
bb_co°
;

595 
övî£_¥ev_timög_co°
 = 1 / 
timög_co°
;

598 
ö√r_¸ô_ôî_cou¡
 = 1;

600 
ö√r_ôî
 = 0; i¬î_ôî < 
move_lim
; inner_iter++)

602 if(
	`åy_sw≠
(
t
, &
co°
, &
bb_co°
, &
timög_co°
,

603 
æim
, 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

604 
ﬁd_ªgi⁄_occ_x
, 
ﬁd_ªgi⁄_occ_y
,

605 
∂a˚r_›ts
.
num_ªgi⁄s
, 
fixed_pös
,

606 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
,

607 
∂a˚r_›ts
.
timög_åadeoff
,

608 
övî£_¥ev_bb_co°
,

609 
övî£_¥ev_timög_co°
, &
dñay_co°
,

610 
x_lookup
) == 1)

612 
suc˚ss_sum
++;

613 
av_co°
 +
co°
;

614 
av_bb_co°
 +
bb_co°
;

615 
av_timög_co°
 +
timög_co°
;

616 
av_dñay_co°
 +
dñay_co°
;

617 
sum_of_squ¨es
 +
co°
 * cost;

620 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE


621 || 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 ==

622 
PATH_TIMING_DRIVEN_PLACE
)

625 if(
ö√r_¸ô_ôî_cou¡
 >
ö√r_ªcompuã_limô


626 && 
ö√r_ôî
 !
move_lim
 - 1)

629 
ö√r_¸ô_ôî_cou¡
 = 0;

630 #ifde‡
VERBOSE


631 
¥ötf


634 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 ==

635 
NET_TIMING_DRIVEN_PLACE
)

637 
∂a˚_dñay_vÆue
 =

638 
dñay_co°
 / 
num_c⁄√˘i⁄s
;

639 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
,

640 
∂a˚_dñay_vÆue
);

643 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

644 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

645 
	`lﬂd_¸ôiˇlôõs
(
∂a˚r_›ts
, 
√t_¶ack
,

646 
d_max
, 
¸ô_exp⁄ít
);

647 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

649 
ö√r_¸ô_ôî_cou¡
++;

651 #ifde‡
VERBOSE


652 
¥ötf


654 
t
, 
co°
, 
bb_co°
, 
timög_co°
, 
ö√r_ôî
, 
d_max
);

655 if(
Ábs


656 (
bb_co°
 -

657 
	`comp_bb_co°
(
CHECK
, 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

658 
∂a˚r_›ts
.
num_ªgi⁄s
)) >

659 
bb_co°
 * 
ERROR_TOL
)

660 
	`exô
(1);

669 
moves_sö˚_co°_ªcompuã
 +
move_lim
;

670 if(
moves_sö˚_co°_ªcompuã
 > 
MAX_MOVES_BEFORE_RECOMPUTE
)

672 
√w_bb_co°
 =

673 
	`ªcompuã_bb_co°
(
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

674 
∂a˚r_›ts
.
num_ªgi⁄s
);

675 if(
	`Ábs
(
√w_bb_co°
 - 
bb_co°
Ë> bb_co° * 
ERROR_TOL
)

677 
¥ötf


679 
√w_bb_co°
, 
bb_co°
);

680 
	`exô
(1);

682 
bb_co°
 = 
√w_bb_co°
;

684 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE


685 || 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 ==

686 
PATH_TIMING_DRIVEN_PLACE
)

688 
	`comp_td_co°s
(&
√w_timög_co°
, &
√w_dñay_co°
);

689 if(
	`Ábs
(
√w_timög_co°
 - 
timög_co°
) >

690 
timög_co°
 * 
ERROR_TOL
)

692 
¥ötf


694 
√w_timög_co°
, 
timög_co°
);

695 
	`exô
(1);

697 if(
	`Ábs
(
√w_dñay_co°
 - 
dñay_co°
) >

698 
dñay_co°
 * 
ERROR_TOL
)

700 
¥ötf


702 
√w_dñay_co°
, 
dñay_co°
);

703 
	`exô
(1);

705 
timög_co°
 = 
√w_timög_co°
;

708 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
BOUNDING_BOX_PLACE
)

710 
co°
 = 
√w_bb_co°
;

712 
moves_sö˚_co°_ªcompuã
 = 0;

715 
tŸ_ôî
 +
move_lim
;

716 
suc˚ss_øt
 = (()
suc˚ss_sum
Ë/ 
move_lim
;

717 if(
suc˚ss_sum
 == 0)

719 
av_co°
 = 
co°
;

720 
av_bb_co°
 = 
bb_co°
;

721 
av_timög_co°
 = 
timög_co°
;

722 
av_dñay_co°
 = 
dñay_co°
;

726 
av_co°
 /
suc˚ss_sum
;

727 
av_bb_co°
 /
suc˚ss_sum
;

728 
av_timög_co°
 /
suc˚ss_sum
;

729 
av_dñay_co°
 /
suc˚ss_sum
;

731 
°d_dev
 = 
	`gë_°d_dev
(
suc˚ss_sum
, 
sum_of_squ¨es
, 
av_co°
);

733 #i‚de‡
SPEC


734 
¥ötf


736 
t
, 
av_co°
, 
av_bb_co°
, 
av_timög_co°
, 
av_dñay_co°
,

737 
∂a˚_dñay_vÆue
, 
d_max
, 
suc˚ss_øt
, 
°d_dev
, 
æim
,

738 
¸ô_exp⁄ít
, 
tŸ_ôî
);

741 
ﬁdt
 = 
t
;

742 
	`upd©e_t
(&
t
, 
°d_dev
, 
æim
, 
suc˚ss_øt
, 
™√Æög_sched
);

744 #i‚de‡
SPEC


745 
	`¥ötf
("%7.4g\n", 
t
 / 
ﬁdt
);

748 
	`•rötf
(
msg
,

750 
co°
, 
bb_co°
, 
timög_co°
, 
t
, 
d_max
);

751 
	`upd©e_s¸ìn
(
MINOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

752 
	`upd©e_æim
(&
æim
, 
suc˚ss_øt
);

754 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

755 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

757 
¸ô_exp⁄ít
 =

759 (
æim
 -

760 
föÆ_æim
Ë* 
övî£_dñè_æim
) *

761 (
∂a˚r_›ts
.
td_∂a˚_exp_œ°
 -

762 
∂a˚r_›ts
.
td_∂a˚_exp_fú°
) +

763 
∂a˚r_›ts
.
td_∂a˚_exp_fú°
;

765 #ifde‡
VERBOSE


766 
	`dump_˛bs
();

770 
t
 = 0;

771 
av_co°
 = 0.;

772 
av_bb_co°
 = 0.;

773 
av_timög_co°
 = 0.;

774 
sum_of_squ¨es
 = 0.;

775 
av_dñay_co°
 = 0.;

776 
suc˚ss_sum
 = 0;

778 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

779 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

783 if(
ouãr_¸ô_ôî_cou¡
 >
∂a˚r_›ts
.
ªcompuã_¸ô_ôî
 ||

784 
∂a˚r_›ts
.
ö√r_lo›_ªcompuã_dividî
 != 0)

787 #ifde‡
VERBOSE


788 
	`¥ötf
("Outer Loop Recompute Criticalities\n");

790 
∂a˚_dñay_vÆue
 = 
dñay_co°
 / 
num_c⁄√˘i⁄s
;

792 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
)

793 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
, 
∂a˚_dñay_vÆue
);

795 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

796 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

797 
	`lﬂd_¸ôiˇlôõs
(
∂a˚r_›ts
, 
√t_¶ack
, 
d_max
,

798 
¸ô_exp⁄ít
);

800 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

801 
ouãr_¸ô_ôî_cou¡
 = 0;

803 
ouãr_¸ô_ôî_cou¡
++;

805 
övî£_¥ev_bb_co°
 = 1 / (
bb_co°
);

806 
övî£_¥ev_timög_co°
 = 1 / (
timög_co°
);

809 
ö√r_¸ô_ôî_cou¡
 = 1;

811 
ö√r_ôî
 = 0; i¬î_ôî < 
move_lim
; inner_iter++)

813 if(
	`åy_sw≠
(
t
, &
co°
, &
bb_co°
, &
timög_co°
,

814 
æim
, 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

815 
ﬁd_ªgi⁄_occ_x
, 
ﬁd_ªgi⁄_occ_y
,

816 
∂a˚r_›ts
.
num_ªgi⁄s
, 
fixed_pös
,

817 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
,

818 
∂a˚r_›ts
.
timög_åadeoff
, 
övî£_¥ev_bb_co°
,

819 
övî£_¥ev_timög_co°
, &
dñay_co°
, 
x_lookup
) == 1)

821 
suc˚ss_sum
++;

822 
av_co°
 +
co°
;

823 
av_bb_co°
 +
bb_co°
;

824 
av_dñay_co°
 +
dñay_co°
;

825 
av_timög_co°
 +
timög_co°
;

826 
sum_of_squ¨es
 +
co°
 * cost;

828 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE


829 || 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 ==

830 
PATH_TIMING_DRIVEN_PLACE
)

833 if(
ö√r_¸ô_ôî_cou¡
 >
ö√r_ªcompuã_limô


834 && 
ö√r_ôî
 !
move_lim
 - 1)

837 
ö√r_¸ô_ôî_cou¡
 = 0;

838 #ifde‡
VERBOSE


839 
¥ötf


842 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 ==

843 
NET_TIMING_DRIVEN_PLACE
)

845 
∂a˚_dñay_vÆue
 =

846 
dñay_co°
 / 
num_c⁄√˘i⁄s
;

847 
	`lﬂd_c⁄°™t_√t_dñay
(
√t_dñay
,

848 
∂a˚_dñay_vÆue
);

851 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

852 
d_max
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

853 
	`lﬂd_¸ôiˇlôõs
(
∂a˚r_›ts
, 
√t_¶ack
,

854 
d_max
, 
¸ô_exp⁄ít
);

855 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

857 
ö√r_¸ô_ôî_cou¡
++;

860 #ifde‡
VERBOSE


861 
	`¥ötf
("à%g co° = %g movê%d\n", 
t
, 
co°
, 
tŸ_ôî
);

864 
tŸ_ôî
 +
move_lim
;

865 
suc˚ss_øt
 = (()
suc˚ss_sum
Ë/ 
move_lim
;

866 if(
suc˚ss_sum
 == 0)

868 
av_co°
 = 
co°
;

869 
av_bb_co°
 = 
bb_co°
;

870 
av_dñay_co°
 = 
dñay_co°
;

871 
av_timög_co°
 = 
timög_co°
;

875 
av_co°
 /
suc˚ss_sum
;

876 
av_bb_co°
 /
suc˚ss_sum
;

877 
av_dñay_co°
 /
suc˚ss_sum
;

878 
av_timög_co°
 /
suc˚ss_sum
;

881 
°d_dev
 = 
	`gë_°d_dev
(
suc˚ss_sum
, 
sum_of_squ¨es
, 
av_co°
);

884 #i‚de‡
SPEC


885 
¥ötf


887 
t
, 
av_co°
, 
av_bb_co°
, 
av_timög_co°
, 
av_dñay_co°
,

888 
∂a˚_dñay_vÆue
, 
d_max
, 
suc˚ss_øt
, 
°d_dev
, 
æim
,

889 
¸ô_exp⁄ít
, 
tŸ_ôî
);

893 #ifde‡
VERBOSE


894 
	`dump_˛bs
();

897 
	`check_∂a˚
(
bb_co°
, 
timög_co°
, 
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

898 
∂a˚r_›ts
.
num_ªgi⁄s
,Öœ˚r_›ts.
∂a˚_Æg‹ôhm
,

899 
dñay_co°
);

901 if(
∂a˚r_›ts
.
íabÀ_timög_compuèti⁄s
 &&

902 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
BOUNDING_BOX_PLACE
)

906 
öë
 = 0; i√à< 
num_√ts
; inet++)

907 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

908 
timög_∂a˚_¸ô
[
öë
][
ùö
] = 0;

909 
	`comp_td_co°s
(&
timög_co°
, &
dñay_co°
);

912 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

913 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
 ||

914 
∂a˚r_›ts
.
íabÀ_timög_compuèti⁄s
)

916 
√t_dñay
 = 
poöt_to_poöt_dñay_co°
;

918 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

919 
e°_¸ô
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

920 #ifde‡
CREATE_ECHO_FILES


922 
	`¥öt_√t_¶ack
("∂a˚mít_√t_¶acks.echo", 
√t_¶ack
);

923 
	`¥öt_¸ôiˇl_∑th
("placement_crit_path.echo",

924 *
subblock_d©a_±r
);

926 
	`¥ötf
("Pœ˚míàE°im©ed Crô P©h Dñay: %g\n\n", 
e°_¸ô
);

930 
	`•rötf
(
msg
,

932 
co°
, 
bb_co°
, 
timög_co°
, 
width_Ác
, 
d_max
);

933 
¥ötf


935 
co°
, 
bb_co°
, 
timög_co°
, 
dñay_co°
);

936 
	`upd©e_s¸ìn
(
MAJOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

938 #ifde‡
SPEC


939 
	`¥ötf
("TŸÆ move†©ãm±ed: %d.0\n", 
tŸ_ôî
);

942 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

943 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
 ||

944 
∂a˚r_›ts
.
íabÀ_timög_compuèti⁄s
)

947 
√t_dñay
 = 
ªmembî_√t_dñay_‹igöÆ_±r
;

949 
	`‰ì_∂a˚mít_°ru˘s
(
∂a˚r_›ts
.
∂a˚_co°_ty≥
,

950 
∂a˚r_›ts
.
num_ªgi⁄s
, 
ﬁd_ªgi⁄_occ_x
,

951 
ﬁd_ªgi⁄_occ_y
, 
∂a˚r_›ts
);

952 
	`‰ì_lookups_™d_¸ôiˇlôõs
(&
√t_dñay
, &
√t_¶ack
);

958 if(*
m°
)

960 
öë
 = 0; i√à< 
num_√ts
; inet++)

962 
	`as£π
((*
m°
)[
öë
]);

963 
	`‰ì
((*
m°
)[
öë
]);

965 
	`‰ì
(*
m°
);

967 *
m°
 = (
t_m°_edge
 **Ë
	`my_mÆloc
(—_m°_edgê*Ë* 
num_√ts
);

968 
öë
 = 0; i√à< 
num_√ts
; inet++)

970 (*
m°
)[
öë
] = 
	`gë_m°_of_√t
(inet);

972 
	`‰ì
(
x_lookup
);

973 
	}
}

976 
	$cou¡_c⁄√˘i⁄s
()

980 
cou¡
, 
öë
;

982 
cou¡
 = 0;

984 
öë
 = 0; i√à< 
num_√ts
; inet++)

987 if(
√t
[
öë
].
is_globÆ
)

990 
cou¡
 +
√t
[
öë
].
num_söks
;

992  (
cou¡
);

993 
	}
}

996 
	$compuã_√t_pö_ödex_vÆues
()

1001 
öë
, 
√çö
, 
blk
, 
iblk
, 
ùö
;

1002 
t_ty≥_±r
 
ty≥
;

1005 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

1007 
ty≥
 = 
block
[
iblk
].type;

1008 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ipin++)

1010 
√t_pö_ödex
[
iblk
][
ùö
] = 
OPEN
;

1014 
öë
 = 0; i√à< 
num_√ts
; inet++)

1017 if(
√t
[
öë
].
is_globÆ
)

1020 
√çö
 = 0;Çëpö <
√t
[
öë
].
num_söks
;Çetpin++)

1022 
blk
 = 
√t
[
öë
].
node_block
[
√çö
];

1023 
√t_pö_ödex
[
blk
][
√t
[
öë
].
node_block_pö
[
√çö
]] =

1024 
√çö
;

1027 
	}
}

1031 
	$gë_°d_dev
(
n
,

1032 
sum_x_squ¨ed
,

1033 
av_x
)

1041 
°d_dev
;

1043 if(
n
 <= 1)

1044 
°d_dev
 = 0.;

1046 
°d_dev
 = (
sum_x_squ¨ed
 - 
n
 * 
av_x
 *áv_x) / ()(n - 1);

1048 if(
°d_dev
 > 0.)

1049 
°d_dev
 = 
	`sqπ
(std_dev);

1051 
°d_dev
 = 0.;

1053  (
°d_dev
);

1054 
	}
}

1058 
	$upd©e_æim
(*
æim
,

1059 
suc˚ss_øt
)

1065 
uµî_lim
;

1067 *
æim
 = (*æimË* (1. - 0.44 + 
suc˚ss_øt
);

1068 
uµî_lim
 = 
	`max
(
nx
, 
ny
);

1069 *
æim
 = 
	`mö
(*æim, 
uµî_lim
);

1070 *
æim
 = 
	`max
(*rlim, 1.);

1071 
	}
}

1076 
	$upd©e_t
(*
t
,

1077 
°d_dev
,

1078 
æim
,

1079 
suc˚ss_øt
,

1080 
s_™√Æög_sched
 
™√Æög_sched
)

1085 if(
™√Æög_sched
.
ty≥
 =
USER_SCHED
)

1087 *
t
 = 
™√Æög_sched
.
Æpha_t
 * (*t);

1095 if(
°d_dev
 == 0.)

1097 *
t
 = 0.;

1101 
Ác
 = 
	`exp
(-
LAMBDA
 * (*
t
Ë/ 
°d_dev
);

1102 
Ác
 = 
	`max
(0.5, fac);

1103 *
t
 = (*tË* 
Ác
;

1110 if(
suc˚ss_øt
 > 0.96)

1112 *
t
 = (*t) * 0.5;

1114 if(
suc˚ss_øt
 > 0.8)

1116 *
t
 = (*t) * 0.9;

1118 if(
suc˚ss_øt
 > 0.15 || 
æim
 > 1.)

1120 *
t
 = (*t) * 0.95;

1124 *
t
 = (*t) * 0.8;

1127 
	}
}

1131 
	$exô_¸ô
(
t
,

1132 
co°
,

1133 
s_™√Æög_sched
 
™√Æög_sched
)

1138 if(
™√Æög_sched
.
ty≥
 =
USER_SCHED
)

1140 if(
t
 < 
™√Æög_sched
.
exô_t
)

1152 if(
t
 < 0.005 * 
co°
 / 
num_√ts
)

1160 
	}
}

1164 
	$°¨tög_t
(*
co°_±r
,

1165 *
bb_co°_±r
,

1166 *
timög_co°_±r
,

1167 
∂a˚_co°_ty≥
,

1168 **
ﬁd_ªgi⁄_occ_x
,

1169 **
ﬁd_ªgi⁄_occ_y
,

1170 
num_ªgi⁄s
,

1171 
boﬁón
 
fixed_pös
,

1172 
s_™√Æög_sched
 
™√Æög_sched
,

1173 
max_moves
,

1174 
æim
,

1175 
e_∂a˚_Æg‹ôhm
 
∂a˚_Æg‹ôhm
,

1176 
timög_åadeoff
,

1177 
övî£_¥ev_bb_co°
,

1178 
övî£_¥ev_timög_co°
,

1179 *
dñay_co°_±r
)

1184 
i
, 
num_ac˚±ed
, 
move_lim
;

1185 
°d_dev
, 
av
, 
sum_of_squ¨es
;

1186 *
x_lookup
;

1188 
x_lookup
 = (*)
	`my_mÆloc
(
nx
 * ());

1190 if(
™√Æög_sched
.
ty≥
 =
USER_SCHED
)

1191  (
™√Æög_sched
.
öô_t
);

1193 
move_lim
 = 
	`mö
(
max_moves
, 
num_blocks
);

1195 
num_ac˚±ed
 = 0;

1196 
av
 = 0.;

1197 
sum_of_squ¨es
 = 0.;

1201 
i
 = 0; i < 
move_lim
; i++)

1203 if(
	`åy_sw≠
(1.e30, 
co°_±r
, 
bb_co°_±r
, 
timög_co°_±r
, 
æim
,

1204 
∂a˚_co°_ty≥
,

1205 
ﬁd_ªgi⁄_occ_x
, 
ﬁd_ªgi⁄_occ_y
, 
num_ªgi⁄s
,

1206 
fixed_pös
, 
∂a˚_Æg‹ôhm
, 
timög_åadeoff
,

1207 
övî£_¥ev_bb_co°
, 
övî£_¥ev_timög_co°
,

1208 
dñay_co°_±r
, 
x_lookup
) == 1)

1210 
num_ac˚±ed
++;

1211 
av
 +*
co°_±r
;

1212 
sum_of_squ¨es
 +*
co°_±r
 * (*cost_ptr);

1216 if(
num_ac˚±ed
 != 0)

1217 
av
 /
num_ac˚±ed
;

1219 
av
 = 0.;

1221 
°d_dev
 = 
	`gë_°d_dev
(
num_ac˚±ed
, 
sum_of_squ¨es
, 
av
);

1223 #ifde‡
DEBUG


1224 if(
num_ac˚±ed
 !
move_lim
)

1226 
¥ötf


1228 
num_ac˚±ed
, 
move_lim
);

1232 #ifde‡
VERBOSE


1233 
	`¥ötf
("std_dev: %g,áverage cost: %g, startingÅemp: %g\n",

1234 
°d_dev
, 
av
, 20. * std_dev);

1237 
	`‰ì
(
x_lookup
);

1241  (20. * 
°d_dev
);

1242 
	}
}

1246 
	$åy_sw≠
(
t
,

1247 *
co°
,

1248 *
bb_co°
,

1249 *
timög_co°
,

1250 
æim
,

1251 
∂a˚_co°_ty≥
,

1252 **
ﬁd_ªgi⁄_occ_x
,

1253 **
ﬁd_ªgi⁄_occ_y
,

1254 
num_ªgi⁄s
,

1255 
boﬁón
 
fixed_pös
,

1256 
e_∂a˚_Æg‹ôhm
 
∂a˚_Æg‹ôhm
,

1257 
timög_åadeoff
,

1258 
övî£_¥ev_bb_co°
,

1259 
övî£_¥ev_timög_co°
,

1260 *
dñay_co°
,

1261 *
x_lookup
)

1270 
b_‰om
, 
x_to
, 
y_to
, 
z_to
, 
x_‰om
, 
y_‰om
, 
z_‰om
, 
b_to
;

1271 
i
, 
k
, 
öë
, 
kìp_swôch
, 
num_of_pös
, 
max_pös_≥r_fb
;

1272 
num_√ts_af„˘ed
, 
bb_ödex
;

1273 
dñè_c
, 
bb_dñè_c
, 
timög_dñè_c
, 
dñay_dñè_c
, 
√wco°
;

1274 
s_bb
 *
bb_co‹d_√w
 = 
NULL
;

1275 
s_bb
 *
bb_edge_√w
 = 
NULL
;

1276 *
√ts_to_upd©e
 = 
NULL
, *
√t_block_moved
 = NULL;

1278 
max_pös_≥r_fb
 = 0;

1279 
i
 = 0; i < 
num_ty≥s
; i++)

1281 
max_pös_≥r_fb
 =

1282 
	`max
(
max_pös_≥r_fb
, 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

1287 if(
bb_co‹d_√w
 =
NULL
)

1289 
bb_co‹d_√w
 = (
s_bb
 *)
	`my_mÆloc
(2 * 
max_pös_≥r_fb
 *

1290 (
s_bb
));

1291 
bb_edge_√w
 = (
s_bb
 *)
	`my_mÆloc
(2 * 
max_pös_≥r_fb
 *

1292 (
s_bb
));

1293 
√ts_to_upd©e
 =

1294 (*)
	`my_mÆloc
(2 * 
max_pös_≥r_fb
 * ());

1295 
√t_block_moved
 =

1296 (*)
	`my_mÆloc
(2 * 
max_pös_≥r_fb
 * ());

1300 
dñay_dñè_c
 = 0.0;

1301 
b_‰om
 = 
	`my_ú™d
(
num_blocks
 - 1);

1310 if(
fixed_pös
 =
TRUE
)

1312 
block
[
b_‰om
].
ty≥
 =
IO_TYPE
)

1314 
b_‰om
 = 
	`my_ú™d
(
num_blocks
 - 1);

1318 
x_‰om
 = 
block
[
b_‰om
].
x
;

1319 
y_‰om
 = 
block
[
b_‰om
].
y
;

1320 
z_‰om
 = 
block
[
b_‰om
].
z
;

1322 if(!
föd_to


1323 (
x_‰om
, 
y_‰om
, 
block
[
b_‰om
].
ty≥
, 
æim
, 
x_lookup
, &
x_to
, &
y_to
))

1324  
FALSE
;

1331 
z_to
 = 0;

1332 if(
grid
[
x_to
][
y_to
].
ty≥
->
ˇ∑côy
 > 1)

1334 
z_to
 = 
	`my_ú™d
(
grid
[
x_to
][
y_to
].
ty≥
->
ˇ∑côy
 - 1);

1336 if(
grid
[
x_to
][
y_to
].
blocks
[
z_to
] =
EMPTY
)

1338 
b_to
 = 
EMPTY
;

1339 
block
[
b_‰om
].
x
 = 
x_to
;

1340 
block
[
b_‰om
].
y
 = 
y_to
;

1341 
block
[
b_‰om
].
z
 = 
z_to
;

1345 
b_to
 = 
grid
[
x_to
][
y_to
].
blocks
[
z_to
];

1346 
block
[
b_to
].
x
 = 
x_‰om
;

1347 
block
[
b_to
].
y
 = 
y_‰om
;

1348 
block
[
b_to
].
z
 = 
z_‰om
;

1350 
block
[
b_‰om
].
x
 = 
x_to
;

1351 
block
[
b_‰om
].
y
 = 
y_to
;

1352 
block
[
b_‰om
].
z
 = 
z_to
;

1361 
dñè_c
 = 0;

1362 
bb_dñè_c
 = 0;

1363 
timög_dñè_c
 = 0;

1365 
num_of_pös
 = 
block
[
b_‰om
].
ty≥
->
num_pös
;

1367 
num_√ts_af„˘ed
 = 
	`föd_af„˘ed_√ts
(
√ts_to_upd©e
, 
√t_block_moved
,

1368 
b_‰om
, 
b_to
, 
num_of_pös
);

1370 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

1372 
	`ßve_ªgi⁄_occ
(
ﬁd_ªgi⁄_occ_x
, 
ﬁd_ªgi⁄_occ_y
, 
num_ªgi⁄s
);

1375 
bb_ödex
 = 0;

1377 
k
 = 0; k < 
num_√ts_af„˘ed
; k++)

1379 
öë
 = 
√ts_to_upd©e
[
k
];

1384 if(
√t_block_moved
[
k
] =
FROM_AND_TO
)

1387 if(
√t
[
öë
].
num_söks
 < 
SMALL_NET
)

1389 
	`gë_n⁄_upd©óbÀ_bb
(
öë
, &
bb_co‹d_√w
[
bb_ödex
]);

1393 if(
√t_block_moved
[
k
] =
FROM
)

1394 
	`upd©e_bb
(
öë
, &
bb_co‹d_√w
[
bb_ödex
],

1395 &
bb_edge_√w
[
bb_ödex
], 
x_‰om
, 
y_‰om
,

1396 
x_to
, 
y_to
);

1398 
	`upd©e_bb
(
öë
, &
bb_co‹d_√w
[
bb_ödex
],

1399 &
bb_edge_√w
[
bb_ödex
], 
x_to
, 
y_to
, 
x_‰om
,

1400 
y_‰om
);

1403 if(
∂a˚_co°_ty≥
 !
NONLINEAR_CONG
)

1405 
ãmp_√t_co°
[
öë
] =

1406 
	`gë_√t_co°
(
öë
, &
bb_co‹d_√w
[
bb_ödex
]);

1407 
bb_dñè_c
 +
ãmp_√t_co°
[
öë
] - 
√t_co°
[inet];

1412 
	`upd©e_ªgi⁄_occ
(
öë
, &
bb_co‹ds
[inet], -1,

1413 
num_ªgi⁄s
);

1414 
	`upd©e_ªgi⁄_occ
(
öë
, &
bb_co‹d_√w
[
bb_ödex
], 1,

1415 
num_ªgi⁄s
);

1418 
bb_ödex
++;

1421 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

1423 
√wco°
 = 
	`n⁄löór_c⁄g_co°
(
num_ªgi⁄s
);

1424 
bb_dñè_c
 = 
√wco°
 - *
bb_co°
;

1428 if(
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

1429 
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

1435 
	`comp_dñè_td_co°
(
b_‰om
, 
b_to
, 
num_of_pös
, &
timög_dñè_c
,

1436 &
dñay_dñè_c
);

1438 
dñè_c
 =

1439 (1 - 
timög_åadeoff
Ë* 
bb_dñè_c
 * 
övî£_¥ev_bb_co°
 +

1440 
timög_åadeoff
 * 
timög_dñè_c
 * 
övî£_¥ev_timög_co°
;

1444 
dñè_c
 = 
bb_dñè_c
;

1448 
kìp_swôch
 = 
	`as£ss_sw≠
(
dñè_c
, 
t
);

1452 if(
kìp_swôch
)

1454 *
co°
 = *co° + 
dñè_c
;

1455 *
bb_co°
 = *bb_co° + 
bb_dñè_c
;

1458 if(
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

1459 
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

1463 *
timög_co°
 = *timög_co° + 
timög_dñè_c
;

1464 *
dñay_co°
 = *dñay_co° + 
dñay_dñè_c
;

1466 
	`upd©e_td_co°
(
b_‰om
, 
b_to
, 
num_of_pös
);

1471 
bb_ödex
 = 0;

1473 
k
 = 0; k < 
num_√ts_af„˘ed
; k++)

1475 
öë
 = 
√ts_to_upd©e
[
k
];

1480 if(
√t_block_moved
[
k
] =
FROM_AND_TO
)

1482 
ãmp_√t_co°
[
öë
] = -1;

1486 
bb_co‹ds
[
öë
] = 
bb_co‹d_√w
[
bb_ödex
];

1487 if(
√t
[
öë
].
num_söks
 >
SMALL_NET
)

1488 
bb_num_⁄_edges
[
öë
] = 
bb_edge_√w
[
bb_ödex
];

1490 
bb_ödex
++;

1492 
√t_co°
[
öë
] = 
ãmp_√t_co°
[inet];

1493 
ãmp_√t_co°
[
öë
] = -1;

1498 
grid
[
x_to
][
y_to
].
blocks
[
z_to
] = 
b_‰om
;

1499 
grid
[
x_‰om
][
y_‰om
].
blocks
[
z_‰om
] = 
b_to
;

1501 if(
EMPTY
 =
b_to
)

1503 
grid
[
x_to
][
y_to
].
ußge
++;

1504 
grid
[
x_‰om
][
y_‰om
].
ußge
--;

1512 
k
 = 0; k < 
num_√ts_af„˘ed
; k++)

1514 
öë
 = 
√ts_to_upd©e
[
k
];

1515 
ãmp_√t_co°
[
öë
] = -1;

1519 
block
[
b_‰om
].
x
 = 
x_‰om
;

1520 
block
[
b_‰om
].
y
 = 
y_‰om
;

1521 
block
[
b_‰om
].
z
 = 
z_‰om
;

1522 if(
b_to
 !
EMPTY
)

1524 
block
[
b_to
].
x
 = 
x_to
;

1525 
block
[
b_to
].
y
 = 
y_to
;

1526 
block
[
b_to
].
z
 = 
z_to
;

1530 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

1532 
	`ª°‹e_ªgi⁄_occ
(
ﬁd_ªgi⁄_occ_x
, 
ﬁd_ªgi⁄_occ_y
,

1533 
num_ªgi⁄s
);

1537  (
kìp_swôch
);

1538 
	}
}

1542 
	$ßve_ªgi⁄_occ
(**
ﬁd_ªgi⁄_occ_x
,

1543 **
ﬁd_ªgi⁄_occ_y
,

1544 
num_ªgi⁄s
)

1550 
i
, 
j
;

1552 
i
 = 0; i < 
num_ªgi⁄s
; i++)

1554 
j
 = 0; j < 
num_ªgi⁄s
; j++)

1556 
ﬁd_ªgi⁄_occ_x
[
i
][
j
] = 
∂a˚_ªgi⁄_x
[i][j].
occu∑ncy
;

1557 
ﬁd_ªgi⁄_occ_y
[
i
][
j
] = 
∂a˚_ªgi⁄_y
[i][j].
occu∑ncy
;

1560 
	}
}

1564 
	$ª°‹e_ªgi⁄_occ
(**
ﬁd_ªgi⁄_occ_x
,

1565 **
ﬁd_ªgi⁄_occ_y
,

1566 
num_ªgi⁄s
)

1572 
i
, 
j
;

1574 
i
 = 0; i < 
num_ªgi⁄s
; i++)

1576 
j
 = 0; j < 
num_ªgi⁄s
; j++)

1578 
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 = 
ﬁd_ªgi⁄_occ_x
[i][j];

1579 
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 = 
ﬁd_ªgi⁄_occ_y
[i][j];

1582 
	}
}

1586 
	$föd_af„˘ed_√ts
(*
√ts_to_upd©e
,

1587 *
√t_block_moved
,

1588 
b_‰om
,

1589 
b_to
,

1590 
num_of_pös
)

1598 
k
, 
öë
, 
af„˘ed_ödex
, 
cou¡
;

1600 
af„˘ed_ödex
 = 0;

1602 
k
 = 0; k < 
num_of_pös
; k++)

1604 
öë
 = 
block
[
b_‰om
].
√ts
[
k
];

1606 if(
öë
 =
OPEN
)

1609 if(
√t
[
öë
].
is_globÆ
)

1614 if(
ãmp_√t_co°
[
öë
] > 0.)

1617 
√ts_to_upd©e
[
af„˘ed_ödex
] = 
öë
;

1618 
√t_block_moved
[
af„˘ed_ödex
] = 
FROM
;

1619 
af„˘ed_ödex
++;

1620 
ãmp_√t_co°
[
öë
] = 1.;

1623 if(
b_to
 !
EMPTY
)

1625 
k
 = 0; k < 
num_of_pös
; k++)

1627 
öë
 = 
block
[
b_to
].
√ts
[
k
];

1629 if(
öë
 =
OPEN
)

1632 if(
√t
[
öë
].
is_globÆ
)

1635 if(
ãmp_√t_co°
[
öë
] > 0.)

1637 
cou¡
 = 0; cou¡ < 
af„˘ed_ödex
; count++)

1639 if(
√ts_to_upd©e
[
cou¡
] =
öë
)

1641 if(
√t_block_moved
[
cou¡
] =
FROM
)

1642 
√t_block_moved
[
cou¡
] =

1643 
FROM_AND_TO
;

1648 #ifde‡
DEBUG


1649 if(
cou¡
 > 
af„˘ed_ödex
)

1651 
¥ötf


1653 "áf„˘ed index = %d.\n", 
cou¡
,

1654 
af„˘ed_ödex
);

1655 
	`exô
(1);

1663 
√ts_to_upd©e
[
af„˘ed_ödex
] = 
öë
;

1664 
√t_block_moved
[
af„˘ed_ödex
] = 
TO
;

1665 
af„˘ed_ödex
++;

1666 
ãmp_√t_co°
[
öë
] = 1.;

1671  (
af„˘ed_ödex
);

1672 
	}
}

1675 
boﬁón


1676 
	$föd_to
(
x_‰om
,

1677 
y_‰om
,

1678 
t_ty≥_±r
 
ty≥
,

1679 
æim
,

1680 *
x_lookup
,

1681 *
x_to
,

1682 *
y_to
)

1690 
x_ªl
, 
y_ªl
, 
iside
, 
ùœ˚
, 
æx
, 
æy
, 
mö_x
, 
max_x
, 
mö_y
, 
max_y
;

1691 
num_cﬁ_ßme_ty≥
, 
i
, 
j
;

1693 
æx
 = 
	`mö
(
nx
, 
æim
);

1694 
æy
 = 
	`mö
(
ny
, 
æim
);

1696 
mö_x
 = 
	`max
(1, 
x_‰om
 - 
æx
);

1697 
max_x
 = 
	`mö
(
nx
, 
x_‰om
 + 
æx
);

1698 
mö_y
 = 
	`max
(1, 
y_‰om
 - 
æy
);

1699 
max_y
 = 
	`mö
(
ny
, 
y_‰om
 + 
æy
);

1701 
num_cﬁ_ßme_ty≥
 = 0;

1702 
j
 = 0;

1703 if(
ty≥
 !
IO_TYPE
)

1705 
i
 = 
mö_x
; i <
max_x
; i++)

1707 if(
grid
[
i
][1].
ty≥
 ==Åype)

1709 
num_cﬁ_ßme_ty≥
++;

1710 
x_lookup
[
j
] = 
i
;

1711 
j
++;

1714 
	`as£π
(
num_cﬁ_ßme_ty≥
 != 0);

1715 if(
num_cﬁ_ßme_ty≥
 == 1 &&

1716 ((((
max_y
 - 
mö_y
Ë/ 
ty≥
->
height
) - 1) <= 0

1717 || 
ty≥
->
height
 > (
ny
 / 2)))

1718  
FALSE
;

1721 #ifde‡
DEBUG


1722 if(
æx
 < 1 ||Ñlx > 
nx
)

1724 
	`¥ötf
("Eº‹ i¿föd_to:Ñlx = %d\n", 
æx
);

1725 
	`exô
(1);

1731 if(
ty≥
 =
IO_TYPE
)

1733 if(
æx
 >
nx
)

1735 
iside
 = 
	`my_ú™d
(3);

1745 
iside
)

1748 
ùœ˚
 = 
	`my_ú™d
(
ny
 - 1) + 1;

1749 *
x_to
 = 0;

1750 *
y_to
 = 
ùœ˚
;

1753 
ùœ˚
 = 
	`my_ú™d
(
nx
 - 1) + 1;

1754 *
x_to
 = 
ùœ˚
;

1755 *
y_to
 = 
ny
 + 1;

1758 
ùœ˚
 = 
	`my_ú™d
(
ny
 - 1) + 1;

1759 *
x_to
 = 
nx
 + 1;

1760 *
y_to
 = 
ùœ˚
;

1763 
ùœ˚
 = 
	`my_ú™d
(
nx
 - 1) + 1;

1764 *
x_to
 = 
ùœ˚
;

1765 *
y_to
 = 0;

1768 
¥ötf


1770 
	`exô
(1);

1775 if(
x_‰om
 == 0)

1777 
ùœ˚
 = 
	`my_ú™d
(2 * 
æy
);

1778 *
y_to
 = 
y_‰om
 - 
æy
 + 
ùœ˚
;

1779 *
x_to
 = 
x_‰om
;

1780 if(*
y_to
 > 
ny
)

1782 *
y_to
 = 
ny
 + 1;

1783 *
x_to
 = 
	`my_ú™d
(
æx
 - 1) + 1;

1785 if(*
y_to
 < 1)

1787 *
y_to
 = 0;

1788 *
x_to
 = 
	`my_ú™d
(
æx
 - 1) + 1;

1791 if(
x_‰om
 =
nx
 + 1)

1793 
ùœ˚
 = 
	`my_ú™d
(2 * 
æy
);

1794 *
y_to
 = 
y_‰om
 - 
æy
 + 
ùœ˚
;

1795 *
x_to
 = 
x_‰om
;

1796 if(*
y_to
 > 
ny
)

1798 *
y_to
 = 
ny
 + 1;

1799 *
x_to
 = 
nx
 - 
	`my_ú™d
(
æx
 - 1);

1801 if(*
y_to
 < 1)

1803 *
y_to
 = 0;

1804 *
x_to
 = 
nx
 - 
	`my_ú™d
(
æx
 - 1);

1807 if(
y_‰om
 == 0)

1809 
ùœ˚
 = 
	`my_ú™d
(2 * 
æx
);

1810 *
x_to
 = 
x_‰om
 - 
æx
 + 
ùœ˚
;

1811 *
y_to
 = 
y_‰om
;

1812 if(*
x_to
 > 
nx
)

1814 *
x_to
 = 
nx
 + 1;

1815 *
y_to
 = 
	`my_ú™d
(
æy
 - 1) + 1;

1817 if(*
x_to
 < 1)

1819 *
x_to
 = 0;

1820 *
y_to
 = 
	`my_ú™d
(
æy
 - 1) + 1;

1825 
ùœ˚
 = 
	`my_ú™d
(2 * 
æx
);

1826 *
x_to
 = 
x_‰om
 - 
æx
 + 
ùœ˚
;

1827 *
y_to
 = 
y_‰om
;

1828 if(*
x_to
 > 
nx
)

1830 *
x_to
 = 
nx
 + 1;

1831 *
y_to
 = 
ny
 - 
	`my_ú™d
(
æy
 - 1);

1833 if(*
x_to
 < 1)

1835 *
x_to
 = 0;

1836 *
y_to
 = 
ny
 - 
	`my_ú™d
(
æy
 - 1);

1843 
x_ªl
 = 
	`my_ú™d
(
num_cﬁ_ßme_ty≥
 - 1);

1844 
y_ªl
 =

1845 
	`my_ú™d
(
max


1846 (0, ((
max_y
 - 
mö_y
Ë/ 
ty≥
->
height
) - 1));

1847 *
x_to
 = 
x_lookup
[
x_ªl
];

1848 *
y_to
 = 
mö_y
 + 
y_ªl
 * 
ty≥
->
height
;

1849 *
y_to
 = (*y_toË- 
grid
[*
x_to
][*y_to].
off£t
;

1850 
	`as£π
(*
x_to
 >1 && *x_tÿ<
nx
);

1851 
	`as£π
(*
y_to
 >1 && *y_tÿ<
ny
);

1854 (
x_‰om
 =*
x_to
Ë&& (
y_‰om
 =*
y_to
));

1856 #ifde‡
DEBUG


1857 if(*
x_to
 < 0 || *x_tÿ> 
nx
 + 1 || *
y_to
 < 0 || *y_tÿ> 
ny
 + 1)

1859 
	`¥ötf
("Error inÑoutine find_to: (x_to,y_to) = (%d,%d)\n",

1860 *
x_to
, *
y_to
);

1861 
	`exô
(1);

1864 
	`as£π
(
ty≥
 =
grid
[*
x_to
][*
y_to
].type);

1865  
TRUE
;

1866 
	}
}

1870 
	$as£ss_sw≠
(
dñè_c
,

1871 
t
)

1876 
ac˚±
;

1877 
¥ob_Ác
, 
‚um
;

1879 if(
dñè_c
 <= 0)

1882 #ifde‡
SPEC


1883 
‚um
 = 
	`my_‰™d
();

1886 
ac˚±
 = 1;

1887  (
ac˚±
);

1890 if(
t
 == 0.)

1893 
‚um
 = 
	`my_‰™d
();

1894 
¥ob_Ác
 = 
	`exp
(-
dñè_c
 / 
t
);

1895 if(
¥ob_Ác
 > 
‚um
)

1897 
ac˚±
 = 1;

1901 
ac˚±
 = 0;

1903  (
ac˚±
);

1904 
	}
}

1908 
	$ªcompuã_bb_co°
(
∂a˚_co°_ty≥
,

1909 
num_ªgi⁄s
)

1916 
i
, 
j
, 
öë
;

1917 
co°
;

1919 
co°
 = 0;

1923 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

1925 
i
 = 0; i < 
num_ªgi⁄s
; i++)

1927 
j
 = 0; j < 
num_ªgi⁄s
; j++)

1929 
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 = 0.;

1930 
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 = 0.;

1935 
öë
 = 0; i√à< 
num_√ts
; inet++)

1938 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

1943 if(
∂a˚_co°_ty≥
 !
NONLINEAR_CONG
)

1945 
co°
 +
√t_co°
[
öë
];

1949 
	`upd©e_ªgi⁄_occ
(
öë
, &
bb_co‹ds
[inet], 1,

1950 
num_ªgi⁄s
);

1955 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

1957 
co°
 = 
	`n⁄löór_c⁄g_co°
(
num_ªgi⁄s
);

1960  (
co°
);

1961 
	}
}

1965 
	$comp_td_poöt_to_poöt_dñay
(
öë
,

1966 
ùö
)

1971 
sour˚_block
, 
sök_block
;

1972 
dñè_x
, 
dñè_y
;

1973 
t_ty≥_±r
 
sour˚_ty≥
, 
sök_ty≥
;

1974 
dñay_sour˚_to_sök
;

1976 
dñay_sour˚_to_sök
 = 0.;

1978 
sour˚_block
 = 
√t
[
öë
].
node_block
[0];

1979 
sour˚_ty≥
 = 
block
[
sour˚_block
].
ty≥
;

1981 
sök_block
 = 
√t
[
öë
].
node_block
[
ùö
];

1982 
sök_ty≥
 = 
block
[
sök_block
].
ty≥
;

1984 
	`as£π
(
sour˚_ty≥
 !
NULL
);

1985 
	`as£π
(
sök_ty≥
 !
NULL
);

1987 
dñè_x
 = 
	`abs
(
block
[
sök_block
].
x
 - block[
sour˚_block
].x);

1988 
dñè_y
 = 
	`abs
(
block
[
sök_block
].
y
 - block[
sour˚_block
].y);

1994 if(
sour˚_ty≥
 =
IO_TYPE
)

1996 if(
sök_ty≥
 =
IO_TYPE
)

1997 
dñay_sour˚_to_sök
 = 
dñè_io_to_io
[
dñè_x
][
dñè_y
];

1999 
dñay_sour˚_to_sök
 = 
dñè_io_to_fb
[
dñè_x
][
dñè_y
];

2003 if(
sök_ty≥
 =
IO_TYPE
)

2004 
dñay_sour˚_to_sök
 = 
dñè_fb_to_io
[
dñè_x
][
dñè_y
];

2006 
dñay_sour˚_to_sök
 = 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
];

2008 if(
dñay_sour˚_to_sök
 < 0)

2010 
¥ötf


2012 
	`exô
(1);

2015 if(
dñay_sour˚_to_sök
 < 0.)

2017 
¥ötf


2019 
	`exô
(1);

2022  (
dñay_sour˚_to_sök
);

2023 
	}
}

2028 
	$upd©e_td_co°
(
b_‰om
,

2029 
b_to
,

2030 
num_of_pös
)

2035 
blkpö
, 
√t_pö
, 
öë
, 
ùö
;

2037 
blkpö
 = 0; blkpö < 
num_of_pös
; blkpin++)

2040 
öë
 = 
block
[
b_‰om
].
√ts
[
blkpö
];

2042 if(
öë
 =
OPEN
)

2045 if(
√t
[
öë
].
is_globÆ
)

2048 
√t_pö
 = 
√t_pö_ödex
[
b_‰om
][
blkpö
];

2050 if(
√t_pö
 != 0)

2054 if(
√t
[
öë
].
node_block
[0] !
b_to


2055 && 
√t
[
öë
].
node_block
[0] !
b_‰om
)

2058 
poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
] =

2059 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
];

2060 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
] =

2063 
poöt_to_poöt_timög_co°
[
öë
][
√t_pö
] =

2064 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2065 [
√t_pö
];

2066 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
√t_pö
] =

2073 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

2076 
poöt_to_poöt_dñay_co°
[
öë
][
ùö
] =

2077 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
];

2078 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
] = -1;

2080 
poöt_to_poöt_timög_co°
[
öë
][
ùö
] =

2081 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
ùö
];

2082 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
ùö
] = -1;

2087 if(
b_to
 !
EMPTY
)

2089 
blkpö
 = 0; blkpö < 
num_of_pös
; blkpin++)

2092 
öë
 = 
block
[
b_to
].
√ts
[
blkpö
];

2094 if(
öë
 =
OPEN
)

2097 if(
√t
[
öë
].
is_globÆ
)

2100 
√t_pö
 = 
√t_pö_ödex
[
b_to
][
blkpö
];

2102 if(
√t_pö
 != 0)

2106 if(
√t
[
öë
].
node_block
[0] !
b_to


2107 && 
√t
[
öë
].
node_block
[0] !
b_‰om
)

2110 
poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
] =

2111 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]

2112 [
√t_pö
];

2113 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]

2114 [
√t_pö
] = -1;

2116 
poöt_to_poöt_timög_co°
[
öë
][
√t_pö
]

2118 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2119 [
√t_pö
];

2120 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2121 [
√t_pö
] = -1;

2127 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

2130 
poöt_to_poöt_dñay_co°
[
öë
][
ùö
] =

2131 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]

2132 [
ùö
];

2133 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
]

2136 
poöt_to_poöt_timög_co°
[
öë
][
ùö
] =

2137 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2138 [
ùö
];

2139 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2140 [
ùö
] = -1;

2145 
	}
}

2149 
	$comp_dñè_td_co°
(
b_‰om
,

2150 
b_to
,

2151 
num_of_pös
,

2152 *
dñè_timög
,

2153 *
dñè_dñay
)

2161 
öë
, 
k
, 
√t_pö
, 
ùö
;

2162 
dñè_timög_co°
, 
dñè_dñay_co°
, 
ãmp_dñay
;

2164 
dñè_timög_co°
 = 0.;

2165 
dñè_dñay_co°
 = 0.;

2168 
k
 = 0; k < 
num_of_pös
; k++)

2170 
öë
 = 
block
[
b_‰om
].
√ts
[
k
];

2172 if(
öë
 =
OPEN
)

2175 if(
√t
[
öë
].
is_globÆ
)

2178 
√t_pö
 = 
√t_pö_ödex
[
b_‰om
][
k
];

2180 if(
√t_pö
 != 0)

2188 if(
√t
[
öë
].
node_block
[0] !
b_to


2189 && 
√t
[
öë
].
node_block
[0] !
b_‰om
)

2191 
ãmp_dñay
 =

2192 
	`comp_td_poöt_to_poöt_dñay
(
öë
, 
√t_pö
);

2194 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
] =

2195 
ãmp_dñay
;

2196 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
√t_pö
] =

2197 
timög_∂a˚_¸ô
[
öë
][
√t_pö
] * 
ãmp_dñay
;

2199 
dñè_dñay_co°
 +=

2200 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
]

2201 - 
poöt_to_poöt_dñay_co°
[
öë
][
√t_pö
];

2203 
dñè_timög_co°
 +=

2204 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
√t_pö
]

2205 - 
poöt_to_poöt_timög_co°
[
öë
][
√t_pö
];

2211 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

2213 
ãmp_dñay
 =

2214 
	`comp_td_poöt_to_poöt_dñay
(
öë
, 
ùö
);

2216 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
] =

2217 
ãmp_dñay
;

2218 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
ùö
] =

2219 
timög_∂a˚_¸ô
[
öë
][
ùö
] * 
ãmp_dñay
;

2221 
dñè_dñay_co°
 +=

2222 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
] -

2223 
poöt_to_poöt_dñay_co°
[
öë
][
ùö
];

2225 
dñè_timög_co°
 +=

2226 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
ùö
] -

2227 
poöt_to_poöt_timög_co°
[
öë
][
ùö
];

2232 if(
b_to
 !
EMPTY
)

2234 
k
 = 0; k < 
num_of_pös
; k++)

2236 
öë
 = 
block
[
b_to
].
√ts
[
k
];

2238 if(
öë
 =
OPEN
)

2241 if(
√t
[
öë
].
is_globÆ
)

2244 
√t_pö
 = 
√t_pö_ödex
[
b_to
][
k
];

2246 if(
√t_pö
 != 0)

2254 if(
√t
[
öë
].
node_block
[0] !
b_to


2255 && 
√t
[
öë
].
node_block
[0] !
b_‰om
)

2257 
ãmp_dñay
 =

2258 
	`comp_td_poöt_to_poöt_dñay
(
öë
,

2259 
√t_pö
);

2261 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]

2262 [
√t_pö
] = 
ãmp_dñay
;

2263 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2264 [
√t_pö
] =

2265 
timög_∂a˚_¸ô
[
öë
][
√t_pö
] *

2266 
ãmp_dñay
;

2268 
dñè_dñay_co°
 +=

2269 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]

2270 [
√t_pö
] -

2271 
poöt_to_poöt_dñay_co°
[
öë
]

2272 [
√t_pö
];

2273 
dñè_timög_co°
 +=

2274 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2275 [
√t_pö
] -

2276 
poöt_to_poöt_timög_co°
[
öë
]

2277 [
√t_pö
];

2283 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

2286 
ãmp_dñay
 =

2287 
	`comp_td_poöt_to_poöt_dñay
(
öë
,

2288 
ùö
);

2290 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
]

2291 
ãmp_dñay
;

2292 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2293 [
ùö
] =

2294 
timög_∂a˚_¸ô
[
öë
][
ùö
] *

2295 
ãmp_dñay
;

2298 
dñè_dñay_co°
 +=

2299 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]

2300 [
ùö
] -

2301 
poöt_to_poöt_dñay_co°
[
öë
][
ùö
];

2302 
dñè_timög_co°
 +=

2303 
ãmp_poöt_to_poöt_timög_co°
[
öë
]

2304 [
ùö
] -

2305 
poöt_to_poöt_timög_co°
[
öë
]

2306 [
ùö
];

2312 *
dñè_timög
 = 
dñè_timög_co°
;

2313 *
dñè_dñay
 = 
dñè_dñay_co°
;

2314 
	}
}

2317 
	$comp_td_co°s
(*
timög_co°
,

2318 *
c⁄√˘i⁄_dñay_sum
)

2324 
öë
, 
ùö
;

2325 
loc_timög_co°
, 
loc_c⁄√˘i⁄_dñay_sum
, 
ãmp_dñay_co°
,

2326 
ãmp_timög_co°
;

2328 
loc_timög_co°
 = 0.;

2329 
loc_c⁄√˘i⁄_dñay_sum
 = 0.;

2331 
öë
 = 0; i√à< 
num_√ts
; inet++)

2333 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

2336 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

2339 
ãmp_dñay_co°
 =

2340 
	`comp_td_poöt_to_poöt_dñay
(
öë
, 
ùö
);

2341 
ãmp_timög_co°
 =

2342 
ãmp_dñay_co°
 *

2343 
timög_∂a˚_¸ô
[
öë
][
ùö
];

2345 
loc_c⁄√˘i⁄_dñay_sum
 +
ãmp_dñay_co°
;

2346 
poöt_to_poöt_dñay_co°
[
öë
][
ùö
] =

2347 
ãmp_dñay_co°
;

2348 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
] = -1;

2350 
poöt_to_poöt_timög_co°
[
öë
][
ùö
] =

2351 
ãmp_timög_co°
;

2352 
ãmp_poöt_to_poöt_timög_co°
[
öë
][
ùö
] = -1;

2353 
loc_timög_co°
 +
ãmp_timög_co°
;

2357 *
timög_co°
 = 
loc_timög_co°
;

2358 *
c⁄√˘i⁄_dñay_sum
 = 
loc_c⁄√˘i⁄_dñay_sum
;

2359 
	}
}

2363 
	$comp_bb_co°
(
mëhod
,

2364 
∂a˚_co°_ty≥
,

2365 
num_ªgi⁄s
)

2377 
i
, 
j
, 
k
;

2378 
co°
;

2379 
ex≥˘ed_wúñígth
;

2381 
co°
 = 0;

2382 
ex≥˘ed_wúñígth
 = 0.0;

2386 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

2388 
i
 = 0; i < 
num_ªgi⁄s
; i++)

2390 
j
 = 0; j < 
num_ªgi⁄s
; j++)

2392 
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 = 0.;

2393 
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 = 0.;

2398 
k
 = 0; k < 
num_√ts
; k++)

2401 if(
√t
[
k
].
is_globÆ
 =
FALSE
)

2407 if(
√t
[
k
].
num_söks
 >
SMALL_NET
 && 
mëhod
 =
NORMAL
)

2409 
	`gë_bb_‰om_s¸©ch
(
k
, &
bb_co‹ds
[k],

2410 &
bb_num_⁄_edges
[
k
]);

2414 
	`gë_n⁄_upd©óbÀ_bb
(
k
, &
bb_co‹ds
[k]);

2417 if(
∂a˚_co°_ty≥
 !
NONLINEAR_CONG
)

2419 
√t_co°
[
k
] = 
	`gë_√t_co°
(k, &
bb_co‹ds
[k]);

2420 
co°
 +
√t_co°
[
k
];

2421 if(
mëhod
 =
CHECK
)

2422 
ex≥˘ed_wúñígth
 +=

2423 
	`gë_√t_wúñígth_e°im©e
(
k
,

2424 &
bb_co‹ds


2425 [
k
]);

2429 
	`upd©e_ªgi⁄_occ
(
k
, &
bb_co‹ds
[k], 1,

2430 
num_ªgi⁄s
);

2435 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

2437 
co°
 = 
	`n⁄löór_c⁄g_co°
(
num_ªgi⁄s
);

2440 if(
mëhod
 =
CHECK
)

2441 
	`¥ötf
("BBÉstimate of min-dist (placement) wirelength is ;%.0f\n",

2442 
ex≥˘ed_wúñígth
);

2444  (
co°
);

2445 
	}
}

2449 
	$n⁄löór_c⁄g_co°
(
num_ªgi⁄s
)

2461 
co°
, 
tmp
;

2462 
i
, 
j
;

2464 
co°
 = 0.;

2466 
i
 = 0; i < 
num_ªgi⁄s
; i++)

2468 
j
 = 0; j < 
num_ªgi⁄s
; j++)

2473 if(
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 <

2474 
∂a˚_ªgi⁄_x
[
i
][
j
].
ˇ∑côy
)

2476 
co°
 +
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 *

2477 
∂a˚_ªgi⁄_x
[
i
][
j
].
öv_ˇ∑côy
;

2482 
tmp
 = 
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 *

2483 
∂a˚_ªgi⁄_x
[
i
][
j
].
öv_ˇ∑côy
;

2484 
co°
 +
tmp
 *Åmp;

2487 if(
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 <

2488 
∂a˚_ªgi⁄_y
[
i
][
j
].
ˇ∑côy
)

2490 
co°
 +
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 *

2491 
∂a˚_ªgi⁄_y
[
i
][
j
].
öv_ˇ∑côy
;

2496 
tmp
 = 
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 *

2497 
∂a˚_ªgi⁄_y
[
i
][
j
].
öv_ˇ∑côy
;

2498 
co°
 +
tmp
 *Åmp;

2504  (
co°
);

2505 
	}
}

2509 
	$upd©e_ªgi⁄_occ
(
öë
,

2510 
s_bb
 *
co‹ds
,

2511 
add_‹_sub
,

2512 
num_ªgi⁄s
)

2520 
√t_xmö
, 
√t_xmax
, 
√t_ymö
, 
√t_ymax
, 
¸ossög
;

2521 
öv_ªgi⁄_Àn
, 
öv_ªgi⁄_height
;

2522 
öv_bb_Àn
, 
öv_bb_height
;

2523 
ovîœp_xlow
, 
ovîœp_xhigh
, 
ovîœp_ylow
, 
ovîœp_yhigh
;

2524 
y_ovîœp
, 
x_ovîœp
, 
x_occu∑ncy
, 
y_occu∑ncy
;

2525 
imö
, 
imax
, 
jmö
, 
jmax
, 
i
, 
j
;

2527 if(
√t
[
öë
].
num_söks
 >= 50)

2529 
¸ossög
 = 2.7933 + 0.02616 * ((
√t
[
öë
].
num_söks
 + 1) - 50);

2533 
¸ossög
 = 
¸oss_cou¡
[
√t
[
öë
].
num_söks
];

2536 
√t_xmö
 = 
co‹ds
->
xmö
 - 0.5;

2537 
√t_xmax
 = 
co‹ds
->
xmax
 + 0.5;

2538 
√t_ymö
 = 
co‹ds
->
ymö
 - 0.5;

2539 
√t_ymax
 = 
co‹ds
->
ymax
 + 0.5;

2543 
öv_ªgi⁄_Àn
 = ()
num_ªgi⁄s
 / ()
nx
;

2544 
öv_ªgi⁄_height
 = ()
num_ªgi⁄s
 / ()
ny
;

2553 
imö
 = ()(
√t_xmö
 - 0.5Ë* 
öv_ªgi⁄_Àn
;

2554 
imax
 = ()(
√t_xmax
 - 0.5Ë* 
öv_ªgi⁄_Àn
;

2555 
imax
 = 
	`mö
(imax, 
num_ªgi⁄s
 - 1);

2557 
jmö
 = ()(
√t_ymö
 - 0.5Ë* 
öv_ªgi⁄_height
;

2558 
jmax
 = ()(
√t_ymax
 - 0.5Ë* 
öv_ªgi⁄_height
;

2559 
jmax
 = 
	`mö
(jmax, 
num_ªgi⁄s
 - 1);

2561 
öv_bb_Àn
 = 1. / (
√t_xmax
 - 
√t_xmö
);

2562 
öv_bb_height
 = 1. / (
√t_ymax
 - 
√t_ymö
);

2567 
i
 = 
imö
; i <
imax
; i++)

2569 
j
 = 
jmö
; j <
jmax
; j++)

2571 
ovîœp_xlow
 = 
	`max
(
∂a˚_ªgi⁄_bounds_x
[
i
], 
√t_xmö
);

2572 
ovîœp_xhigh
 =

2573 
	`mö
(
∂a˚_ªgi⁄_bounds_x
[
i
 + 1], 
√t_xmax
);

2574 
ovîœp_ylow
 = 
	`max
(
∂a˚_ªgi⁄_bounds_y
[
j
], 
√t_ymö
);

2575 
ovîœp_yhigh
 =

2576 
	`mö
(
∂a˚_ªgi⁄_bounds_y
[
j
 + 1], 
√t_ymax
);

2578 
x_ovîœp
 = 
ovîœp_xhigh
 - 
ovîœp_xlow
;

2579 
y_ovîœp
 = 
ovîœp_yhigh
 - 
ovîœp_ylow
;

2581 #ifde‡
DEBUG


2583 if(
x_ovîœp
 < -0.001)

2585 
¥ötf


2587 "\¿öë = %d, ovîœ∞%g\n", 
öë
,

2588 
x_ovîœp
);

2591 if(
y_ovîœp
 < -0.001)

2593 
¥ötf


2595 "\¿öë = %d, ovîœ∞%g\n", 
öë
,

2596 
y_ovîœp
);

2601 
x_occu∑ncy
 =

2602 
¸ossög
 * 
y_ovîœp
 * 
x_ovîœp
 * 
öv_bb_height
 *

2603 
öv_ªgi⁄_Àn
;

2604 
y_occu∑ncy
 =

2605 
¸ossög
 * 
x_ovîœp
 * 
y_ovîœp
 * 
öv_bb_Àn
 *

2606 
öv_ªgi⁄_height
;

2608 
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 +=

2609 
add_‹_sub
 * 
x_occu∑ncy
;

2610 
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 +=

2611 
add_‹_sub
 * 
y_occu∑ncy
;

2615 
	}
}

2619 
	$‰ì_∂a˚_ªgi⁄s
(
num_ªgi⁄s
)

2625 
	`‰ì_m©rix
(
∂a˚_ªgi⁄_x
, 0, 
num_ªgi⁄s
 - 1, 0, (

2626 
s_∂a˚_ªgi⁄
));

2628 
	`‰ì_m©rix
(
∂a˚_ªgi⁄_y
, 0, 
num_ªgi⁄s
 - 1, 0, (

2629 
s_∂a˚_ªgi⁄
));

2631 
	`‰ì
(
∂a˚_ªgi⁄_bounds_x
);

2632 
	`‰ì
(
∂a˚_ªgi⁄_bounds_y
);

2633 
	}
}

2637 
	$‰ì_∂a˚mít_°ru˘s
(
∂a˚_co°_ty≥
,

2638 
num_ªgi⁄s
,

2639 **
ﬁd_ªgi⁄_occ_x
,

2640 **
ﬁd_ªgi⁄_occ_y
,

2641 
s_∂a˚r_›ts
 
∂a˚r_›ts
)

2647 
öë
;

2649 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

2650 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
 ||

2651 
∂a˚r_›ts
.
íabÀ_timög_compuèti⁄s
)

2653 
öë
 = 0; i√à< 
num_√ts
; inet++)

2657 
poöt_to_poöt_dñay_co°
[
öë
]++;

2658 
	`‰ì
(
poöt_to_poöt_dñay_co°
[
öë
]);

2660 
poöt_to_poöt_timög_co°
[
öë
]++;

2661 
	`‰ì
(
poöt_to_poöt_timög_co°
[
öë
]);

2663 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]++;

2664 
	`‰ì
(
ãmp_poöt_to_poöt_dñay_co°
[
öë
]);

2666 
ãmp_poöt_to_poöt_timög_co°
[
öë
]++;

2667 
	`‰ì
(
ãmp_poöt_to_poöt_timög_co°
[
öë
]);

2669 
	`‰ì
(
poöt_to_poöt_dñay_co°
);

2670 
	`‰ì
(
ãmp_poöt_to_poöt_dñay_co°
);

2672 
	`‰ì
(
poöt_to_poöt_timög_co°
);

2673 
	`‰ì
(
ãmp_poöt_to_poöt_timög_co°
);

2675 
	`‰ì_m©rix
(
√t_pö_ödex
, 0, 
num_blocks
 - 1, 0, ());

2679 
	`‰ì
(
√t_co°
);

2680 
	`‰ì
(
ãmp_√t_co°
);

2681 
	`‰ì
(
bb_num_⁄_edges
);

2682 
	`‰ì
(
bb_co‹ds
);

2684 
√t_co°
 = 
NULL
;

2685 
ãmp_√t_co°
 = 
NULL
;

2686 
bb_num_⁄_edges
 = 
NULL
;

2687 
bb_co‹ds
 = 
NULL
;

2689 
	`‰ì_unique_pö_li°
();

2691 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

2693 
	`‰ì_∂a˚_ªgi⁄s
(
num_ªgi⁄s
);

2694 
	`‰ì_m©rix
(
ﬁd_ªgi⁄_occ_x
, 0, 
num_ªgi⁄s
 - 1, 0,

2696 
	`‰ì_m©rix
(
ﬁd_ªgi⁄_occ_y
, 0, 
num_ªgi⁄s
 - 1, 0,

2700 if(
∂a˚_co°_ty≥
 =
LINEAR_CONG
)

2702 
	`‰ì_Á°_co°_upd©e_°ru˘s
();

2704 
	}
}

2708 
	$Æloc_™d_lﬂd_∂a˚mít_°ru˘s
(
∂a˚_co°_ty≥
,

2709 
num_ªgi⁄s
,

2710 
∂a˚_co°_exp
,

2711 ***
ﬁd_ªgi⁄_occ_x
,

2712 ***
ﬁd_ªgi⁄_occ_y
,

2713 
s_∂a˚r_›ts
 
∂a˚r_›ts
)

2719 
öë
, 
ùö
, 
max_pös_≥r_fb
, 
i
;

2721 
max_pös_≥r_fb
 = 0;

2722 
i
 = 0; i < 
num_ty≥s
; i++)

2724 
max_pös_≥r_fb
 =

2725 
	`max
(
max_pös_≥r_fb
, 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

2728 if(
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

2729 
∂a˚r_›ts
.
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
 ||

2730 
∂a˚r_›ts
.
íabÀ_timög_compuèti⁄s
)

2734 
poöt_to_poöt_dñay_co°
 =

2735 (**)
	`my_mÆloc
(
num_√ts
 * (*));

2736 
ãmp_poöt_to_poöt_dñay_co°
 =

2737 (**)
	`my_mÆloc
(
num_√ts
 * (*));

2739 
poöt_to_poöt_timög_co°
 =

2740 (**)
	`my_mÆloc
(
num_√ts
 * (*));

2741 
ãmp_poöt_to_poöt_timög_co°
 =

2742 (**)
	`my_mÆloc
(
num_√ts
 * (*));

2744 
√t_pö_ödex
 =

2745 (**)
	`Æloc_m©rix
(0, 
num_blocks
 - 1, 0,

2746 
max_pös_≥r_fb
 - 1, ());

2748 
öë
 = 0; i√à< 
num_√ts
; inet++)

2753 
poöt_to_poöt_dñay_co°
[
öë
] =

2754 (*)
	`my_mÆloc
(
√t
[
öë
].
num_söks
 *

2756 
poöt_to_poöt_dñay_co°
[
öë
]--;

2758 
ãmp_poöt_to_poöt_dñay_co°
[
öë
] =

2759 (*)
	`my_mÆloc
(
√t
[
öë
].
num_söks
 *

2761 
ãmp_poöt_to_poöt_dñay_co°
[
öë
]--;

2763 
poöt_to_poöt_timög_co°
[
öë
] =

2764 (*)
	`my_mÆloc
(
√t
[
öë
].
num_söks
 *

2766 
poöt_to_poöt_timög_co°
[
öë
]--;

2768 
ãmp_poöt_to_poöt_timög_co°
[
öë
] =

2769 (*)
	`my_mÆloc
(
√t
[
öë
].
num_söks
 *

2771 
ãmp_poöt_to_poöt_timög_co°
[
öë
]--;

2773 
öë
 = 0; i√à< 
num_√ts
; inet++)

2775 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

2777 
poöt_to_poöt_dñay_co°
[
öë
][
ùö
] = 0;

2778 
ãmp_poöt_to_poöt_dñay_co°
[
öë
][
ùö
] = 0;

2787 
√t_co°
 = (*)
	`my_mÆloc
(
num_√ts
 * ());

2788 
ãmp_√t_co°
 = (*)
	`my_mÆloc
(
num_√ts
 * ());

2794 
öë
 = 0; i√à< 
num_√ts
; inet++)

2795 
ãmp_√t_co°
[
öë
] = -1.;

2797 
bb_co‹ds
 = (
s_bb
 *)
	`my_mÆloc
(
num_√ts
 * (s_bb));

2798 
bb_num_⁄_edges
 =

2799 (
s_bb
 *)
	`my_mÆloc
(
num_√ts
 * (s_bb));

2803 
	`Æloc_™d_lﬂd_unique_pö_li°
();

2807 if(
∂a˚_co°_ty≥
 =
NONLINEAR_CONG
)

2809 
	`Æloc_∂a˚_ªgi⁄s
(
num_ªgi⁄s
);

2810 
	`lﬂd_∂a˚_ªgi⁄s
(
num_ªgi⁄s
);

2811 *
ﬁd_ªgi⁄_occ_x
 = (**)
	`Æloc_m©rix
(0, 
num_ªgi⁄s
 - 1, 0,

2812 
num_ªgi⁄s
 - 1,

2814 *
ﬁd_ªgi⁄_occ_y
 =

2815 (**)
	`Æloc_m©rix
(0, 
num_ªgi⁄s
 - 1, 0,Çum_regions - 1,

2820 *
ﬁd_ªgi⁄_occ_x
 = 
NULL
;

2821 *
ﬁd_ªgi⁄_occ_y
 = 
NULL
;

2824 if(
∂a˚_co°_ty≥
 =
LINEAR_CONG
)

2826 
	`Æloc_™d_lﬂd_f‹_Á°_co°_upd©e
(
∂a˚_co°_exp
);

2828 
	}
}

2832 
	$Æloc_∂a˚_ªgi⁄s
(
num_ªgi⁄s
)

2839 
∂a˚_ªgi⁄_x
 =

2840 (
s_∂a˚_ªgi⁄
 **)
	`Æloc_m©rix
(0, 
num_ªgi⁄s
 - 1, 0,

2841 
num_ªgi⁄s
 - 1,

2842 (
s_∂a˚_ªgi⁄
));

2844 
∂a˚_ªgi⁄_y
 =

2845 (
s_∂a˚_ªgi⁄
 **)
	`Æloc_m©rix
(0, 
num_ªgi⁄s
 - 1, 0,

2846 
num_ªgi⁄s
 - 1,

2847 (
s_∂a˚_ªgi⁄
));

2849 
∂a˚_ªgi⁄_bounds_x
 = (*)
	`my_mÆloc
((
num_ªgi⁄s
 + 1) *

2852 
∂a˚_ªgi⁄_bounds_y
 = (*)
	`my_mÆloc
((
num_ªgi⁄s
 + 1) *

2854 
	}
}

2858 
	$lﬂd_∂a˚_ªgi⁄s
(
num_ªgi⁄s
)

2864 
i
, 
j
, 
low_block
, 
high_block
, 
∫um
;

2865 
low_lim
, 
high_lim
, 
ˇ∑côy
, 
Ác
, 
block_ˇ∑côy
;

2866 
Àn_Ác
, 
height_Ác
;

2870 
j
 = 0; j < 
num_ªgi⁄s
; j++)

2872 
ˇ∑côy
 = 0.;

2873 
low_lim
 = ()
j
 / ()
num_ªgi⁄s
 *
ny
 + 1.;

2874 
high_lim
 = ()(
j
 + 1Ë/ ()
num_ªgi⁄s
 *
ny
;

2876 
low_block
 = 
	`Êo‹
(
low_lim
);

2877 
low_block
 = 
	`max
(1,Üow_block);

2878 
high_block
 = 
	`˚û
(
high_lim
);

2879 
high_block
 = 
	`mö
(high_block, 
ny
);

2881 
block_ˇ∑côy
 = (
ch™_width_x
[
low_block
 - 1] +

2882 
ch™_width_x
[
low_block
]) / 2.;

2883 if(
low_block
 == 1)

2884 
block_ˇ∑côy
 +
ch™_width_x
[0] / 2.;

2886 
Ác
 = 1. - (
low_lim
 - 
low_block
);

2887 
ˇ∑côy
 +
Ác
 * 
block_ˇ∑côy
;

2889 
∫um
 = 
low_block
 + 1;Ñnum < 
high_block
;Ñnum++)

2891 
block_ˇ∑côy
 =

2892 (
ch™_width_x
[
∫um
 - 1] + chan_width_x[rnum]) / 2.;

2893 
ˇ∑côy
 +
block_ˇ∑côy
;

2896 
block_ˇ∑côy
 = (
ch™_width_x
[
high_block
 - 1] +

2897 
ch™_width_x
[
high_block
]) / 2.;

2898 if(
high_block
 =
ny
)

2899 
block_ˇ∑côy
 +
ch™_width_x
[
ny
] / 2.;

2901 
Ác
 = 1. - (
high_block
 - 
high_lim
);

2902 
ˇ∑côy
 +
Ác
 * 
block_ˇ∑côy
;

2904 
i
 = 0; i < 
num_ªgi⁄s
; i++)

2906 
∂a˚_ªgi⁄_x
[
i
][
j
].
ˇ∑côy
 = capacity;

2907 
∂a˚_ªgi⁄_x
[
i
][
j
].
öv_ˇ∑côy
 = 1. / 
ˇ∑côy
;

2908 
∂a˚_ªgi⁄_x
[
i
][
j
].
occu∑ncy
 = 0.;

2909 
∂a˚_ªgi⁄_x
[
i
][
j
].
co°
 = 0.;

2915 
i
 = 0; i < 
num_ªgi⁄s
; i++)

2917 
ˇ∑côy
 = 0.;

2918 
low_lim
 = ()
i
 / ()
num_ªgi⁄s
 *
nx
 + 1.;

2919 
high_lim
 = ()(
i
 + 1Ë/ ()
num_ªgi⁄s
 *
nx
;

2921 
low_block
 = 
	`Êo‹
(
low_lim
);

2922 
low_block
 = 
	`max
(1,Üow_block);

2923 
high_block
 = 
	`˚û
(
high_lim
);

2924 
high_block
 = 
	`mö
(high_block, 
nx
);

2926 
block_ˇ∑côy
 = (
ch™_width_y
[
low_block
 - 1] +

2927 
ch™_width_y
[
low_block
]) / 2.;

2928 if(
low_block
 == 1)

2929 
block_ˇ∑côy
 +
ch™_width_y
[0] / 2.;

2931 
Ác
 = 1. - (
low_lim
 - 
low_block
);

2932 
ˇ∑côy
 +
Ác
 * 
block_ˇ∑côy
;

2934 
∫um
 = 
low_block
 + 1;Ñnum < 
high_block
;Ñnum++)

2936 
block_ˇ∑côy
 =

2937 (
ch™_width_y
[
∫um
 - 1] + chan_width_y[rnum]) / 2.;

2938 
ˇ∑côy
 +
block_ˇ∑côy
;

2941 
block_ˇ∑côy
 = (
ch™_width_y
[
high_block
 - 1] +

2942 
ch™_width_y
[
high_block
]) / 2.;

2943 if(
high_block
 =
nx
)

2944 
block_ˇ∑côy
 +
ch™_width_y
[
nx
] / 2.;

2946 
Ác
 = 1. - (
high_block
 - 
high_lim
);

2947 
ˇ∑côy
 +
Ác
 * 
block_ˇ∑côy
;

2949 
j
 = 0; j < 
num_ªgi⁄s
; j++)

2951 
∂a˚_ªgi⁄_y
[
i
][
j
].
ˇ∑côy
 = capacity;

2952 
∂a˚_ªgi⁄_y
[
i
][
j
].
öv_ˇ∑côy
 = 1. / 
ˇ∑côy
;

2953 
∂a˚_ªgi⁄_y
[
i
][
j
].
occu∑ncy
 = 0.;

2954 
∂a˚_ªgi⁄_y
[
i
][
j
].
co°
 = 0.;

2961 
Àn_Ác
 = ()
nx
 / ()
num_ªgi⁄s
;

2962 
height_Ác
 = ()
ny
 / ()
num_ªgi⁄s
;

2964 
∂a˚_ªgi⁄_bounds_x
[0] = 0.5;

2965 
∂a˚_ªgi⁄_bounds_y
[0] = 0.5;

2967 
i
 = 1; i <
num_ªgi⁄s
; i++)

2969 
∂a˚_ªgi⁄_bounds_x
[
i
] =Öœ˚_ªgi⁄_bounds_x[ò- 1] + 
Àn_Ác
;

2970 
∂a˚_ªgi⁄_bounds_y
[
i
] =

2971 
∂a˚_ªgi⁄_bounds_y
[
i
 - 1] + 
height_Ác
;

2973 
	}
}

2977 
	$‰ì_unique_pö_li°
()

2982 
™y_dup
, 
öë
;

2984 
™y_dup
 = 0;

2986 
öë
 = 0; i√à< 
num_√ts
; inet++)

2988 if(
du∂iˇã_pös
[
öë
] != 0)

2990 
	`‰ì
(
unique_pö_li°
[
öë
]);

2991 
™y_dup
 = 1;

2995 if(
™y_dup
 != 0)

2996 
	`‰ì
(
unique_pö_li°
);

2998 
	`‰ì
(
du∂iˇã_pös
);

2999 
	}
}

3003 
	$Æloc_™d_lﬂd_unique_pö_li°
()

3012 
öë
, 
ùö
, 
bnum
, 
num_dup
, 
™y_dups
, 
off£t
;

3013 *
times_li°ed
;

3016 
du∂iˇã_pös
 = 
	`my_ˇŒoc
(
num_√ts
, ());

3017 
times_li°ed
 = 
	`my_ˇŒoc
(
num_blocks
, ());

3018 
™y_dups
 = 0;

3020 
öë
 = 0; i√à< 
num_√ts
; inet++)

3023 
num_dup
 = 0;

3025 
ùö
 = 0; ipö <
√t
[
öë
].
num_söks
; ipin++)

3027 
bnum
 = 
√t
[
öë
].
node_block
[
ùö
];

3028 
times_li°ed
[
bnum
]++;

3029 if(
times_li°ed
[
bnum
] > 1)

3030 
num_dup
++;

3033 if(
num_dup
 > 0)

3035 
du∂iˇã_pös
[
öë
] = 
num_dup
;

3037 if(
™y_dups
 == 0)

3039 
unique_pö_li°
 =

3040 (**)
	`my_ˇŒoc
(
num_√ts
, (*));

3041 
™y_dups
 = 1;

3044 
unique_pö_li°
[
öë
] =

3045 
	`my_mÆloc
((
√t
[
öë
].
num_söks
 + 1 -

3046 
num_dup
) * ());

3048 
off£t
 = 0;

3049 
ùö
 = 0; ipö <
√t
[
öë
].
num_söks
; ipin++)

3051 
bnum
 = 
√t
[
öë
].
node_block
[
ùö
];

3052 if(
times_li°ed
[
bnum
] != 0)

3054 
times_li°ed
[
bnum
] = 0;

3055 
unique_pö_li°
[
öë
][
off£t
] = 
bnum
;

3056 
off£t
++;

3063 
ùö
 = 0; ipö <
√t
[
öë
].
num_söks
; ipin++)

3065 
bnum
 = 
√t
[
öë
].
node_block
[
ùö
];

3066 
times_li°ed
[
bnum
] = 0;

3071 
	`‰ì
((*)
times_li°ed
);

3072 
	}
}

3076 
	$gë_bb_‰om_s¸©ch
(
öë
,

3077 
s_bb
 *
co‹ds
,

3078 
s_bb
 *
num_⁄_edges
)

3086 
ùö
, 
bnum
, 
x
, 
y
, 
xmö
, 
xmax
, 
ymö
, 
ymax
;

3087 
xmö_edge
, 
xmax_edge
, 
ymö_edge
, 
ymax_edge
;

3088 
n_pös
;

3089 *
∂i°
;

3095 if(
du∂iˇã_pös
[
öë
] == 0)

3097 
∂i°
 = 
√t
[
öë
].
node_block
;

3098 
n_pös
 = 
√t
[
öë
].
num_söks
 + 1;

3102 
∂i°
 = 
unique_pö_li°
[
öë
];

3103 
n_pös
 = (
√t
[
öë
].
num_söks
 + 1Ë- 
du∂iˇã_pös
[inet];

3106 
x
 = 
block
[
∂i°
[0]].x;

3107 
y
 = 
block
[
∂i°
[0]].y;

3109 
x
 = 
	`max
(
	`mö
(x, 
nx
), 1);

3110 
y
 = 
	`max
(
	`mö
(y, 
ny
), 1);

3112 
xmö
 = 
x
;

3113 
ymö
 = 
y
;

3114 
xmax
 = 
x
;

3115 
ymax
 = 
y
;

3116 
xmö_edge
 = 1;

3117 
ymö_edge
 = 1;

3118 
xmax_edge
 = 1;

3119 
ymax_edge
 = 1;

3121 
ùö
 = 1; ipö < 
n_pös
; ipin++)

3124 
bnum
 = 
∂i°
[
ùö
];

3125 
x
 = 
block
[
bnum
].x;

3126 
y
 = 
block
[
bnum
].y;

3135 
x
 = 
	`max
(
	`mö
(x, 
nx
), 1);

3136 
y
 = 
	`max
(
	`mö
(y, 
ny
), 1);

3138 if(
x
 =
xmö
)

3140 
xmö_edge
++;

3142 if(
x
 =
xmax
)

3144 
xmax_edge
++;

3146 if(
x
 < 
xmö
)

3148 
xmö
 = 
x
;

3149 
xmö_edge
 = 1;

3151 if(
x
 > 
xmax
)

3153 
xmax
 = 
x
;

3154 
xmax_edge
 = 1;

3157 if(
y
 =
ymö
)

3159 
ymö_edge
++;

3161 if(
y
 =
ymax
)

3163 
ymax_edge
++;

3165 if(
y
 < 
ymö
)

3167 
ymö
 = 
y
;

3168 
ymö_edge
 = 1;

3170 if(
y
 > 
ymax
)

3172 
ymax
 = 
y
;

3173 
ymax_edge
 = 1;

3180 
co‹ds
->
xmö
 = xmin;

3181 
co‹ds
->
xmax
 = xmax;

3182 
co‹ds
->
ymö
 = ymin;

3183 
co‹ds
->
ymax
 = ymax;

3185 
num_⁄_edges
->
xmö
 = 
xmö_edge
;

3186 
num_⁄_edges
->
xmax
 = 
xmax_edge
;

3187 
num_⁄_edges
->
ymö
 = 
ymö_edge
;

3188 
num_⁄_edges
->
ymax
 = 
ymax_edge
;

3189 
	}
}

3193 
	$gë_√t_wúñígth_e°im©e
(
öë
,

3194 
s_bb
 *
bb±r
)

3200 
nco°
, 
¸ossög
;

3205 if(((
√t
[
öë
].
num_söks
 + 1) > 50) && ((net[inet].num_sinks + 1) < 85))

3207 
¸ossög
 = 2.7933 + 0.02616 * ((
√t
[
öë
].
num_söks
 + 1) - 50);

3209 if((
√t
[
öë
].
num_söks
 + 1) >= 85)

3211 
¸ossög
 =

3212 2.7933 + 0.011 * (
√t
[
öë
].
num_söks
 + 1) -

3213 0.0000018 * (
√t
[
öë
].
num_söks
 + 1) * (net[inet].num_sinks +

3218 
¸ossög
 = 
¸oss_cou¡
[(
√t
[
öë
].
num_söks
 + 1) - 1];

3228 
nco°
 = (
bb±r
->
xmax
 - bb±r->
xmö
 + 1Ë* 
¸ossög
;

3230 
nco°
 +(
bb±r
->
ymax
 - bb±r->
ymö
 + 1Ë* 
¸ossög
;

3232  (
nco°
);

3233 
	}
}

3237 
	$gë_√t_co°
(
öë
,

3238 
s_bb
 *
bb±r
)

3244 
nco°
, 
¸ossög
;

3249 if((
√t
[
öë
].
num_söks
 + 1) > 50)

3251 
¸ossög
 = 2.7933 + 0.02616 * ((
√t
[
öë
].
num_söks
 + 1) - 50);

3256 
¸ossög
 = 
¸oss_cou¡
[(
√t
[
öë
].
num_söks
 + 1) - 1];

3266 
nco°
 = (
bb±r
->
xmax
 - bb±r->
xmö
 + 1Ë* 
¸ossög
 *

3267 
ch™x_∂a˚_co°_Ác
[
bb±r
->
ymax
][bb±r->
ymö
 - 1];

3269 
nco°
 +(
bb±r
->
ymax
 - bb±r->
ymö
 + 1Ë* 
¸ossög
 *

3270 
ch™y_∂a˚_co°_Ác
[
bb±r
->
xmax
][bb±r->
xmö
 - 1];

3272  (
nco°
);

3273 
	}
}

3277 
	$gë_n⁄_upd©óbÀ_bb
(
öë
,

3278 
s_bb
 *
bb_co‹d_√w
)

3290 
k
, 
xmax
, 
ymax
, 
xmö
, 
ymö
, 
x
, 
y
;

3292 
x
 = 
block
[
√t
[
öë
].
node_block
[0]].x;

3293 
y
 = 
block
[
√t
[
öë
].
node_block
[0]].y;

3295 
xmö
 = 
x
;

3296 
ymö
 = 
y
;

3297 
xmax
 = 
x
;

3298 
ymax
 = 
y
;

3300 
k
 = 1; k < (
√t
[
öë
].
num_söks
 + 1); k++)

3302 
x
 = 
block
[
√t
[
öë
].
node_block
[
k
]].x;

3303 
y
 = 
block
[
√t
[
öë
].
node_block
[
k
]].y;

3305 if(
x
 < 
xmö
)

3307 
xmö
 = 
x
;

3309 if(
x
 > 
xmax
)

3311 
xmax
 = 
x
;

3314 if(
y
 < 
ymö
)

3316 
ymö
 = 
y
;

3318 if(
y
 > 
ymax
)

3320 
ymax
 = 
y
;

3331 
bb_co‹d_√w
->
xmö
 = 
	`max
(
	`mö
(xmö, 
nx
), 1);

3332 
bb_co‹d_√w
->
ymö
 = 
	`max
(
	`mö
(ymö, 
ny
), 1);

3333 
bb_co‹d_√w
->
xmax
 = 
	`max
(
	`mö
(xmax, 
nx
), 1);

3334 
bb_co‹d_√w
->
ymax
 = 
	`max
(
	`mö
(ymax, 
ny
), 1);

3335 
	}
}

3339 
	$upd©e_bb
(
öë
,

3340 
s_bb
 *
bb_co‹d_√w
,

3341 
s_bb
 *
bb_edge_√w
,

3342 
xﬁd
,

3343 
yﬁd
,

3344 
x√w
,

3345 
y√w
)

3361 
x√w
 = 
	`max
(
	`mö
(x√w, 
nx
), 1);

3362 
y√w
 = 
	`max
(
	`mö
(y√w, 
ny
), 1);

3363 
xﬁd
 = 
	`max
(
	`mö
(xﬁd, 
nx
), 1);

3364 
yﬁd
 = 
	`max
(
	`mö
(yﬁd, 
ny
), 1);

3368 if(
x√w
 < 
xﬁd
)

3373 if(
xﬁd
 =
bb_co‹ds
[
öë
].
xmax
)

3375 if(
bb_num_⁄_edges
[
öë
].
xmax
 == 1)

3377 
	`gë_bb_‰om_s¸©ch
(
öë
, 
bb_co‹d_√w
,

3378 
bb_edge_√w
);

3383 
bb_edge_√w
->
xmax
 =

3384 
bb_num_⁄_edges
[
öë
].
xmax
 - 1;

3385 
bb_co‹d_√w
->
xmax
 = 
bb_co‹ds
[
öë
].xmax;

3391 
bb_co‹d_√w
->
xmax
 = 
bb_co‹ds
[
öë
].xmax;

3392 
bb_edge_√w
->
xmax
 = 
bb_num_⁄_edges
[
öë
].xmax;

3397 if(
x√w
 < 
bb_co‹ds
[
öë
].
xmö
)

3399 
bb_co‹d_√w
->
xmö
 = 
x√w
;

3400 
bb_edge_√w
->
xmö
 = 1;

3403 if(
x√w
 =
bb_co‹ds
[
öë
].
xmö
)

3405 
bb_co‹d_√w
->
xmö
 = 
x√w
;

3406 
bb_edge_√w
->
xmö
 = 
bb_num_⁄_edges
[
öë
].xmin + 1;

3411 
bb_co‹d_√w
->
xmö
 = 
bb_co‹ds
[
öë
].xmin;

3412 
bb_edge_√w
->
xmö
 = 
bb_num_⁄_edges
[
öë
].xmin;

3417 if(
x√w
 > 
xﬁd
)

3422 if(
xﬁd
 =
bb_co‹ds
[
öë
].
xmö
)

3424 if(
bb_num_⁄_edges
[
öë
].
xmö
 == 1)

3426 
	`gë_bb_‰om_s¸©ch
(
öë
, 
bb_co‹d_√w
,

3427 
bb_edge_√w
);

3432 
bb_edge_√w
->
xmö
 =

3433 
bb_num_⁄_edges
[
öë
].
xmö
 - 1;

3434 
bb_co‹d_√w
->
xmö
 = 
bb_co‹ds
[
öë
].xmin;

3440 
bb_co‹d_√w
->
xmö
 = 
bb_co‹ds
[
öë
].xmin;

3441 
bb_edge_√w
->
xmö
 = 
bb_num_⁄_edges
[
öë
].xmin;

3446 if(
x√w
 > 
bb_co‹ds
[
öë
].
xmax
)

3448 
bb_co‹d_√w
->
xmax
 = 
x√w
;

3449 
bb_edge_√w
->
xmax
 = 1;

3452 if(
x√w
 =
bb_co‹ds
[
öë
].
xmax
)

3454 
bb_co‹d_√w
->
xmax
 = 
x√w
;

3455 
bb_edge_√w
->
xmax
 = 
bb_num_⁄_edges
[
öë
].xmax + 1;

3460 
bb_co‹d_√w
->
xmax
 = 
bb_co‹ds
[
öë
].xmax;

3461 
bb_edge_√w
->
xmax
 = 
bb_num_⁄_edges
[
öë
].xmax;

3467 
bb_co‹d_√w
->
xmö
 = 
bb_co‹ds
[
öë
].xmin;

3468 
bb_co‹d_√w
->
xmax
 = 
bb_co‹ds
[
öë
].xmax;

3469 
bb_edge_√w
->
xmö
 = 
bb_num_⁄_edges
[
öë
].xmin;

3470 
bb_edge_√w
->
xmax
 = 
bb_num_⁄_edges
[
öë
].xmax;

3475 if(
y√w
 < 
yﬁd
)

3480 if(
yﬁd
 =
bb_co‹ds
[
öë
].
ymax
)

3482 if(
bb_num_⁄_edges
[
öë
].
ymax
 == 1)

3484 
	`gë_bb_‰om_s¸©ch
(
öë
, 
bb_co‹d_√w
,

3485 
bb_edge_√w
);

3490 
bb_edge_√w
->
ymax
 =

3491 
bb_num_⁄_edges
[
öë
].
ymax
 - 1;

3492 
bb_co‹d_√w
->
ymax
 = 
bb_co‹ds
[
öë
].ymax;

3498 
bb_co‹d_√w
->
ymax
 = 
bb_co‹ds
[
öë
].ymax;

3499 
bb_edge_√w
->
ymax
 = 
bb_num_⁄_edges
[
öë
].ymax;

3504 if(
y√w
 < 
bb_co‹ds
[
öë
].
ymö
)

3506 
bb_co‹d_√w
->
ymö
 = 
y√w
;

3507 
bb_edge_√w
->
ymö
 = 1;

3510 if(
y√w
 =
bb_co‹ds
[
öë
].
ymö
)

3512 
bb_co‹d_√w
->
ymö
 = 
y√w
;

3513 
bb_edge_√w
->
ymö
 = 
bb_num_⁄_edges
[
öë
].ymin + 1;

3518 
bb_co‹d_√w
->
ymö
 = 
bb_co‹ds
[
öë
].ymin;

3519 
bb_edge_√w
->
ymö
 = 
bb_num_⁄_edges
[
öë
].ymin;

3523 if(
y√w
 > 
yﬁd
)

3528 if(
yﬁd
 =
bb_co‹ds
[
öë
].
ymö
)

3530 if(
bb_num_⁄_edges
[
öë
].
ymö
 == 1)

3532 
	`gë_bb_‰om_s¸©ch
(
öë
, 
bb_co‹d_√w
,

3533 
bb_edge_√w
);

3538 
bb_edge_√w
->
ymö
 =

3539 
bb_num_⁄_edges
[
öë
].
ymö
 - 1;

3540 
bb_co‹d_√w
->
ymö
 = 
bb_co‹ds
[
öë
].ymin;

3546 
bb_co‹d_√w
->
ymö
 = 
bb_co‹ds
[
öë
].ymin;

3547 
bb_edge_√w
->
ymö
 = 
bb_num_⁄_edges
[
öë
].ymin;

3552 if(
y√w
 > 
bb_co‹ds
[
öë
].
ymax
)

3554 
bb_co‹d_√w
->
ymax
 = 
y√w
;

3555 
bb_edge_√w
->
ymax
 = 1;

3558 if(
y√w
 =
bb_co‹ds
[
öë
].
ymax
)

3560 
bb_co‹d_√w
->
ymax
 = 
y√w
;

3561 
bb_edge_√w
->
ymax
 = 
bb_num_⁄_edges
[
öë
].ymax + 1;

3566 
bb_co‹d_√w
->
ymax
 = 
bb_co‹ds
[
öë
].ymax;

3567 
bb_edge_√w
->
ymax
 = 
bb_num_⁄_edges
[
öë
].ymax;

3573 
bb_co‹d_√w
->
ymö
 = 
bb_co‹ds
[
öë
].ymin;

3574 
bb_co‹d_√w
->
ymax
 = 
bb_co‹ds
[
öë
].ymax;

3575 
bb_edge_√w
->
ymö
 = 
bb_num_⁄_edges
[
öë
].ymin;

3576 
bb_edge_√w
->
ymax
 = 
bb_num_⁄_edges
[
öë
].ymax;

3578 
	}
}

3582 
	$öôül_∂a˚mít
(
e_∑d_loc_ty≥
 
∑d_loc_ty≥
,

3583 *
∑d_loc_fûe
)

3587 
	ss_pos


3589 
x
;

3590 
y
;

3591 
z
;

3593 **
pos
;

3594 
i
, 
j
, 
k
, 
iblk
, 
choi˚
, 
ty≥_ödex
, 
x
, 
y
, 
z
;

3595 *
cou¡
, *
ödex
;

3597 
pos
 = (
s_pos
 **)
	`my_mÆloc
(
num_ty≥s
 * (s_pos *));

3598 
cou¡
 = (*)
	`my_ˇŒoc
(
num_ty≥s
, ());

3599 
ödex
 = (*)
	`my_ˇŒoc
(
num_ty≥s
, ());

3603 
i
 = 0; i <
nx
 + 1; i++)

3605 
j
 = 0; j <
ny
 + 1; j++)

3607 
grid
[
i
][
j
].
ußge
 = 0;

3608 
k
 = 0; k < 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
; k++)

3610 
grid
[
i
][
j
].
blocks
[
k
] = 
EMPTY
;

3611 if(
grid
[
i
][
j
].
off£t
 == 0)

3613 
cou¡
[
grid
[
i
][
j
].
ty≥
->
ödex
]++;

3619 
i
 = 0; i < 
num_ty≥s
; i++)

3621 
pos
[
i
] =

3622 (
s_pos
 *)
	`my_mÆloc
(
cou¡
[
i
] * (s_pos));

3625 
i
 = 0; i <
nx
 + 1; i++)

3627 
j
 = 0; j <
ny
 + 1; j++)

3629 
k
 = 0; k < 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
; k++)

3631 if(
grid
[
i
][
j
].
off£t
 == 0)

3633 
ty≥_ödex
 = 
grid
[
i
][
j
].
ty≥
->
ödex
;

3634 
pos
[
ty≥_ödex
][
ödex
[ty≥_ödex]].
x
 = 
i
;

3635 
pos
[
ty≥_ödex
][
ödex
[ty≥_ödex]].
y
 = 
j
;

3636 
pos
[
ty≥_ödex
][
ödex
[ty≥_ödex]].
z
 = 
k
;

3637 
ödex
[
ty≥_ödex
]++;

3643 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

3646 if(!(
block
[
iblk
].
ty≥
 =
IO_TYPE
 && 
∑d_loc_ty≥
 =
USER
))

3648 
ty≥_ödex
 = 
block
[
iblk
].
ty≥
->
ödex
;

3649 
	`as£π
(
cou¡
[
ty≥_ödex
] > 0);

3650 
choi˚
 = 
	`my_ú™d
(
cou¡
[
ty≥_ödex
] - 1);

3651 
x
 = 
pos
[
ty≥_ödex
][
choi˚
].x;

3652 
y
 = 
pos
[
ty≥_ödex
][
choi˚
].y;

3653 
z
 = 
pos
[
ty≥_ödex
][
choi˚
].z;

3654 
grid
[
x
][
y
].
blocks
[
z
] = 
iblk
;

3655 
grid
[
x
][
y
].
ußge
++;

3658 
pos
[
ty≥_ödex
][
choi˚
] =Öos[ty≥_ödex][
cou¡
[type_index] - 1];

3659 
cou¡
[
ty≥_ödex
]--;

3663 if(
∑d_loc_ty≥
 =
USER
)

3665 
	`ªad_u£r_∑d_loc
(
∑d_loc_fûe
);

3671 
i
 = 0; i <(
nx
 + 1); i++)

3673 
j
 = 0; j <(
ny
 + 1); j++)

3675 
k
 = 0; k < 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
; k++)

3677 
	`as£π
(
grid
[
i
][
j
].
blocks
 !
NULL
);

3678 
iblk
 = 
grid
[
i
][
j
].
blocks
[
k
];

3680 if(
iblk
 !
EMPTY
)

3682 
block
[
iblk
].
x
 = 
i
;

3683 
block
[
iblk
].
y
 = 
j
;

3684 
block
[
iblk
].
z
 = 
k
;

3690 #ifde‡
VERBOSE


3691 
	`¥ötf
("AtÉnd of initial_placement.\n");

3692 
	`dump_˛bs
();

3694 
i
 = 0; i < 
num_ty≥s
; i++)

3696 
	`‰ì
(
pos
[
i
]);

3698 
	`‰ì
(
pos
);

3699 
	`‰ì
(
ödex
);

3700 
	`‰ì
(
cou¡
);

3701 
	}
}

3705 
	$‰ì_Á°_co°_upd©e_°ru˘s
()

3711 
i
;

3713 
i
 = 0; i <
ny
; i++)

3714 
	`‰ì
(
ch™x_∂a˚_co°_Ác
[
i
]);

3716 
	`‰ì
(
ch™x_∂a˚_co°_Ác
);

3718 
i
 = 0; i <
nx
; i++)

3719 
	`‰ì
(
ch™y_∂a˚_co°_Ác
[
i
]);

3721 
	`‰ì
(
ch™y_∂a˚_co°_Ác
);

3722 
	}
}

3726 
	$Æloc_™d_lﬂd_f‹_Á°_co°_upd©e
(
∂a˚_co°_exp
)

3741 
low
, 
high
, 
i
;

3747 
ch™x_∂a˚_co°_Ác
 = (**)
	`my_mÆloc
((
ny
 + 1) * (*));

3748 
i
 = 0; i <
ny
; i++)

3749 
ch™x_∂a˚_co°_Ác
[
i
] = (*)
	`my_mÆloc
((i + 1) * ());

3751 
ch™y_∂a˚_co°_Ác
 = (**)
	`my_mÆloc
((
nx
 + 1) * (*));

3752 
i
 = 0; i <
nx
; i++)

3753 
ch™y_∂a˚_co°_Ác
[
i
] = (*)
	`my_mÆloc
((i + 1) * ());

3759 
ch™x_∂a˚_co°_Ác
[0][0] = 
ch™_width_x
[0];

3761 
high
 = 1; high <
ny
; high++)

3763 
ch™x_∂a˚_co°_Ác
[
high
][high] = 
ch™_width_x
[high];

3764 
low
 = 0;Üow < 
high
;Üow++)

3766 
ch™x_∂a˚_co°_Ác
[
high
][
low
] =

3767 
ch™x_∂a˚_co°_Ác
[
high
 - 1][
low
] +

3768 
ch™_width_x
[
high
];

3780 
high
 = 0; high <
ny
; high++)

3781 
low
 = 0;Üow <
high
;Üow++)

3783 
ch™x_∂a˚_co°_Ác
[
high
][
low
] = (high -Üow + 1.) /

3784 
ch™x_∂a˚_co°_Ác
[
high
][
low
];

3785 
ch™x_∂a˚_co°_Ác
[
high
][
low
] =

3786 
	`pow
(()
ch™x_∂a˚_co°_Ác
[
high
][
low
],

3787 ()
∂a˚_co°_exp
);

3794 
ch™y_∂a˚_co°_Ác
[0][0] = 
ch™_width_y
[0];

3796 
high
 = 1; high <
nx
; high++)

3798 
ch™y_∂a˚_co°_Ác
[
high
][high] = 
ch™_width_y
[high];

3799 
low
 = 0;Üow < 
high
;Üow++)

3801 
ch™y_∂a˚_co°_Ác
[
high
][
low
] =

3802 
ch™y_∂a˚_co°_Ác
[
high
 - 1][
low
] +

3803 
ch™_width_y
[
high
];

3810 
high
 = 0; high <
nx
; high++)

3811 
low
 = 0;Üow <
high
;Üow++)

3813 
ch™y_∂a˚_co°_Ác
[
high
][
low
] = (high -Üow + 1.) /

3814 
ch™y_∂a˚_co°_Ác
[
high
][
low
];

3815 
ch™y_∂a˚_co°_Ác
[
high
][
low
] =

3816 
	`pow
(()
ch™y_∂a˚_co°_Ác
[
high
][
low
],

3817 ()
∂a˚_co°_exp
);

3819 
	}
}

3823 
	$check_∂a˚
(
bb_co°
,

3824 
timög_co°
,

3825 
∂a˚_co°_ty≥
,

3826 
num_ªgi⁄s
,

3827 
e_∂a˚_Æg‹ôhm
 
∂a˚_Æg‹ôhm
,

3828 
dñay_co°
)

3837 *
bd⁄e
;

3838 
i
, 
j
, 
k
, 
îr‹
 = 0, 
bnum
;

3839 
bb_co°_check
;

3840 
ußge_check
;

3841 
timög_co°_check
, 
dñay_co°_check
;

3843 
bb_co°_check
 = 
	`comp_bb_co°
(
CHECK
, 
∂a˚_co°_ty≥
, 
num_ªgi⁄s
);

3844 
	`¥ötf
("bb_co°Ñecompuãd from s¸©ch i†%g.\n", 
bb_co°_check
);

3845 if(
	`Ábs
(
bb_co°_check
 - 
bb_co°
Ë> bb_co° * 
ERROR_TOL
)

3847 
¥ötf


3849 
bb_co°_check
, 
bb_co°
);

3850 
îr‹
++;

3853 if(
∂a˚_Æg‹ôhm
 =
NET_TIMING_DRIVEN_PLACE
 ||

3854 
∂a˚_Æg‹ôhm
 =
PATH_TIMING_DRIVEN_PLACE
)

3856 
	`comp_td_co°s
(&
timög_co°_check
, &
dñay_co°_check
);

3857 
	`¥ötf
("timing_costÑecomputed from scratch is %g. \n",

3858 
timög_co°_check
);

3859 if(
	`Ábs
(
timög_co°_check
 - 
timög_co°
) >

3860 
timög_co°
 * 
ERROR_TOL
)

3862 
	`¥ötf
("Error:Åiming_cost_check: %gándÅiming_cost: "

3864 
timög_co°_check
, 
timög_co°
);

3865 
îr‹
++;

3867 
	`¥ötf
("delay_costÑecomputed from scratch is %g. \n",

3868 
dñay_co°_check
);

3869 if(
	`Ábs
(
dñay_co°_check
 - 
dñay_co°
Ë> dñay_co° * 
ERROR_TOL
)

3871 
	`¥ötf
("Error: delay_cost_check: %gánd delay_cost: "

3873 
dñay_co°_check
, 
dñay_co°
);

3874 
îr‹
++;

3878 
bd⁄e
 = (*)
	`my_mÆloc
(
num_blocks
 * ());

3879 
i
 = 0; i < 
num_blocks
; i++)

3880 
bd⁄e
[
i
] = 0;

3883 
i
 = 0; i <(
nx
 + 1); i++)

3884 
j
 = 0; j <(
ny
 + 1); j++)

3886 if(
grid
[
i
][
j
].
ußge
 > grid[i][j].
ty≥
->
ˇ∑côy
)

3888 
¥ötf


3890 "Ußgêi†%d\n", 
i
, 
j
, 
grid
[i][j].
ußge
);

3891 
îr‹
++;

3893 
ußge_check
 = 0;

3894 
k
 = 0; k < 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
; k++)

3896 
bnum
 = 
grid
[
i
][
j
].
blocks
[
k
];

3897 if(
EMPTY
 =
bnum
)

3900 if(
block
[
bnum
].
ty≥
 !
grid
[
i
][
j
].type)

3902 
¥ötf


3904 
bnum
, 
i
, 
j
);

3905 
îr‹
++;

3907 if((
block
[
bnum
].
x
 !
i
Ë|| (block[bnum].
y
 !
j
))

3909 
¥ötf


3911 "d©a.\n", 
bnum
, 
i
, 
j
);

3912 
îr‹
++;

3914 ++
ußge_check
;

3915 
bd⁄e
[
bnum
]++;

3917 if(
ußge_check
 !
grid
[
i
][
j
].
ußge
)

3919 
¥ötf


3921 
i
, 
j
, 
grid
[i][j].
ußge
, 
ußge_check
);

3926 
i
 = 0; i < 
num_blocks
; i++)

3927 if(
bd⁄e
[
i
] != 1)

3929 
¥ötf


3931 
i
, 
bd⁄e
[i]);

3932 
îr‹
++;

3934 
	`‰ì
(
bd⁄e
);

3936 if(
îr‹
 == 0)

3938 
¥ötf


3940 #ifde‡
PRINT_REL_POS_DISTR


3941 
	`¥öt_ªœtive_pos_di°r
();

3946 
¥ötf


3948 
îr‹
);

3949 
	`¥ötf
("AbortingÖrogram.\n");

3950 
	`exô
(1);

3952 
	}
}

	@place.h

1 
åy_∂a˚
(
s_∂a˚r_›ts
 
∂a˚r_›ts
,

2 
s_™√Æög_sched
 
™√Æög_sched
,

3 
t_ch™_width_di°
 
ch™_width_di°
,

4 
s_rouãr_›ts
 
rouãr_›ts
,

5 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

6 
t_£gmít_öf
 * 
£gmít_öf
,

7 
t_timög_öf
 
timög_öf
,

8 
t_subblock_d©a
 * 
subblock_d©a_±r
,

9 
t_m°_edge
 *** 
m°
);

13 
ªad_∂a˚
(*
∂a˚_fûe
,

14 *
√t_fûe
,

15 *
¨ch_fûe
,

16 
s_∂a˚r_›ts
 
∂a˚r_›ts
,

17 
s_rouãr_›ts
 
rouãr_›ts
,

18 
t_ch™_width_di°
 
ch™_width_di°
,

19 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

20 
t_£gmít_öf
 * 
£gmít_öf
,

21 
t_timög_öf
 
timög_öf
,

22 
t_subblock_d©a
 * 
subblock_d©a_±r
,

23 
t_m°_edge
 *** 
m°
);

	@place_and_route.c

1 
	~<°dio.h
>

2 
	~<sys/ty≥s.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"v¥_utûs.h
"

6 
	~"globÆs.h
"

7 
	~"∂a˚_™d_rouã.h
"

8 
	~"m°.h
"

9 
	~"∂a˚.h
"

10 
	~"ªad_∂a˚.h
"

11 
	~"rouã_exp‹t.h
"

12 
	~"døw.h
"

13 
	~"°©s.h
"

14 
	~"check_rouã.h
"

15 
	~"º_gøph.h
"

16 
	~"∑th_dñay.h
"

17 
	~"√t_dñay.h
"

18 
	~"timög_∂a˚.h
"

19 
	~<as£π.h
>

23 
bö¨y_£¨ch_∂a˚_™d_rouã
(
s_∂a˚r_›ts
 
∂a˚r_›ts
,

24 *
∂a˚_fûe
,

25 *
√t_fûe
,

26 *
¨ch_fûe
,

27 *
rouã_fûe
,

28 
boﬁón
 
fuŒ_°©s
,

29 
boﬁón
 
vîify_bö¨y_£¨ch
,

30 
s_™√Æög_sched


31 
™√Æög_sched
,

32 
s_rouãr_›ts
 
rouãr_›ts
,

33 
s_dë_routög_¨ch


34 
dë_routög_¨ch
,

35 
t_£gmít_öf
 * 
£gmít_öf
,

36 
t_timög_öf
 
timög_öf
,

37 
t_subblock_d©a
 * 
subblock_d©a_±r
,

38 
t_ch™_width_di°
 
ch™_width_di°
,

39 
t_m°_edge
 ** 
m°
);

41 
comp_width
(
t_ch™
 * 
ch™
,

42 
x
,

43 
£∑øti⁄
);

46 
po°_∂a˚_sync
(
IN
 
num_blocks
,

47 
INOUT
 c⁄° 
s_block
 
block_li°
[],

48 
INOUT
 
t_subblock_d©a
 * 
subblock_d©a_±r
);

50 
‰ì_subblock_d©a
(
t_subblock_d©a
 * 
subblock_d©a_±r
);

56 
	$∂a˚_™d_rouã
(
e_›î©i⁄
 
›î©i⁄
,

57 
s_∂a˚r_›ts
 
∂a˚r_›ts
,

58 *
∂a˚_fûe
,

59 *
√t_fûe
,

60 *
¨ch_fûe
,

61 *
rouã_fûe
,

62 
s_™√Æög_sched
 
™√Æög_sched
,

63 
s_rouãr_›ts
 
rouãr_›ts
,

64 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

65 
t_£gmít_öf
 * 
£gmít_öf
,

66 
t_timög_öf
 
timög_öf
,

67 
t_subblock_d©a
 * 
subblock_d©a_±r
,

68 
t_ch™_width_di°
 
ch™_width_di°
)

73 
msg
[
BUFSIZE
];

74 
width_Ác
, 
öë
, 
i
;

75 
boﬁón
 
suc˚ss
, 
Fc_˛ù≥d
;

76 **
√t_dñay
, **
√t_¶ack
;

77 
s_löked_v±r
 *
√t_dñay_chunk_li°_hód
;

78 
t_ivec
 **
fb_›ös_u£d_loˇŒy
;

79 
t_m°_edge
 **
m°
 = 
NULL
;

80 
max_pös_≥r_fb
;

82 
Fc_˛ù≥d
 = 
FALSE
;

84 
max_pös_≥r_fb
 = 0;

85 
i
 = 0; i < 
num_ty≥s
; i++)

87 if(
ty≥_des¸ùt‹s
[
i
].
num_pös
 > 
max_pös_≥r_fb
)

89 
max_pös_≥r_fb
 = 
ty≥_des¸ùt‹s
[
i
].
num_pös
;

93 if(
∂a˚r_›ts
.
∂a˚_‰eq
 =
PLACE_NEVER
)

96 
	`ªad_∂a˚
(
∂a˚_fûe
, 
√t_fûe
, 
¨ch_fûe
, 
nx
, 
ny
, 
num_blocks
,

97 
block
);

98 
	`sync_grid_to_blocks
(
num_blocks
, 
block
, 
nx
, 
ny
, 
grid
);

102 
	`as£π
((
PLACE_ONCE
 =
∂a˚r_›ts
.
∂a˚_‰eq
) ||

103 (
PLACE_ALWAYS
 =
∂a˚r_›ts
.
∂a˚_‰eq
));

105 
	`åy_∂a˚
(
∂a˚r_›ts
, 
™√Æög_sched
, 
ch™_width_di°
,

106 
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

107 
timög_öf
, 
subblock_d©a_±r
, &
m°
);

108 
	`¥öt_∂a˚
(
∂a˚_fûe
, 
√t_fûe
, 
¨ch_fûe
);

110 
	`po°_∂a˚_sync
(
num_blocks
, 
block
, 
subblock_d©a_±r
);

113 
	`fÊush
(
°dout
);

114 if(
›î©i⁄
 =
PLACE_ONLY
)

117 
width_Ác
 = 
rouãr_›ts
.
fixed_ch™√l_width
;

120 if(
NO_FIXED_CHANNEL_WIDTH
 =
width_Ác
)

122 
	`bö¨y_£¨ch_∂a˚_™d_rouã
(
∂a˚r_›ts
, 
∂a˚_fûe
,

123 
√t_fûe
, 
¨ch_fûe
, 
rouã_fûe
,

124 
rouãr_›ts
.
fuŒ_°©s
,Ñouãr_›ts.
vîify_bö¨y_£¨ch
,

125 
™√Æög_sched
, 
rouãr_›ts
,

126 
dë_routög_¨ch
, 
£gmít_öf
,

127 
timög_öf
, 
subblock_d©a_±r
,

128 
ch™_width_di°
, 
m°
);

132 if(
dë_routög_¨ch
.
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
)

134 if(
width_Ác
 % 2 != 0)

136 
¥ötf


138 
width_Ác
);

139 
	`exô
(1);

147 
fb_›ös_u£d_loˇŒy
 = 
	`Æloc_rouã_°ru˘s
(*
subblock_d©a_±r
);

149 if(
timög_öf
.
timög_™Æysis_íabÀd
)

151 
√t_¶ack
 =

152 
	`Æloc_™d_lﬂd_timög_gøph
(
timög_öf
,

153 *
subblock_d©a_±r
);

154 
√t_dñay
 = 
	`Æloc_√t_dñay
(&
√t_dñay_chunk_li°_hód
);

158 
√t_dñay
 = 
NULL
;

159 
√t_¶ack
 = 
NULL
;

162 
suc˚ss
 =

163 
	`åy_rouã
(
width_Ác
, 
rouãr_›ts
, 
dë_routög_¨ch
,

164 
£gmít_öf
, 
timög_öf
, 
√t_¶ack
, 
√t_dñay
,

165 
ch™_width_di°
, 
fb_›ös_u£d_loˇŒy
, 
m°
,

166 &
Fc_˛ù≥d
);

168 if(
Fc_˛ù≥d
)

170 
¥ötf


174 if(
suc˚ss
 =
FALSE
)

176 
¥ötf


178 
width_Ác
);

179 
	`•rötf
(
msg
,

181 
width_Ác
);

186 
	`check_rouã
(
rouãr_›ts
.
rouã_ty≥
,

187 
dë_routög_¨ch
.
num_swôch
,

188 
fb_›ös_u£d_loˇŒy
);

189 
	`gë_£rül_num
();

191 
¥ötf


193 
width_Ác
);

195 
	`routög_°©s
(
rouãr_›ts
.
fuŒ_°©s
,Ñouãr_›ts.
rouã_ty≥
,

196 
dë_routög_¨ch
.
num_swôch
, 
£gmít_öf
,

197 
dë_routög_¨ch
.
num_£gmít
,

198 
dë_routög_¨ch
.
R_möW_nmos
,

199 
dë_routög_¨ch
.
R_möW_pmos
,

200 
dë_routög_¨ch
.
dúe˘i⁄Æôy
,

201 
timög_öf
.
timög_™Æysis_íabÀd
,

202 
√t_¶ack
, 
√t_dñay
, *
subblock_d©a_±r
);

204 
	`¥öt_rouã
(
rouã_fûe
);

206 #ifde‡
CREATE_ECHO_FILES


210 
	`•rötf
(
msg
,

212 
width_Ác
);

214 
	`‰ì_subblock_d©a
(
subblock_d©a_±r
);

216 
	`öô_døw_co‹ds
(
max_pös_≥r_fb
);

217 
	`upd©e_s¸ìn
(
MAJOR
, 
msg
, 
ROUTING
,

218 
timög_öf
.
timög_™Æysis_íabÀd
);

220 if(
timög_öf
.
timög_™Æysis_íabÀd
)

222 
	`as£π
(
√t_¶ack
);

223 
	`‰ì_timög_gøph
(
√t_¶ack
);

225 
	`as£π
(
√t_dñay
);

226 
	`‰ì_√t_dñay
(
√t_dñay
, &
√t_dñay_chunk_li°_hód
);

229 
	`‰ì_rouã_°ru˘s
(
fb_›ös_u£d_loˇŒy
);

230 
	`fÊush
(
°dout
);

234 if(
m°
)

236 
öë
 = 0; i√à< 
num_√ts
; inet++)

238 
	`as£π
(
m°
[
öë
]);

239 
	`‰ì
(
m°
[
öë
]);

241 
	`‰ì
(
m°
);

242 
m°
 = 
NULL
;

245 
	}
}

250 
	$bö¨y_£¨ch_∂a˚_™d_rouã
(
s_∂a˚r_›ts
 
∂a˚r_›ts
,

251 *
∂a˚_fûe
,

252 *
√t_fûe
,

253 *
¨ch_fûe
,

254 *
rouã_fûe
,

255 
boﬁón
 
fuŒ_°©s
,

256 
boﬁón
 
vîify_bö¨y_£¨ch
,

257 
s_™√Æög_sched
 
™√Æög_sched
,

258 
s_rouãr_›ts
 
rouãr_›ts
,

259 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

260 
t_£gmít_öf
 * 
£gmít_öf
,

261 
t_timög_öf
 
timög_öf
,

262 
t_subblock_d©a
 * 
subblock_d©a_±r
,

263 
t_ch™_width_di°
 
ch™_width_di°
,

264 
t_m°_edge
 ** 
m°
)

271 
s_åa˚
 **
be°_routög
;

272 
cuºít
, 
low
, 
high
, 
föÆ
;

273 
max_pös_≥r_fb
, 
i
;

274 
boﬁón
 
suc˚ss
, 
¥ev_suc˚ss
, 
¥ev2_suc˚ss
, 
Fc_˛ù≥d
 = 
FALSE
;

275 
msg
[
BUFSIZE
];

276 **
√t_dñay
, **
√t_¶ack
;

277 
s_löked_v±r
 *
√t_dñay_chunk_li°_hód
;

278 
åy_w_limô
;

279 
t_ivec
 **
fb_›ös_u£d_loˇŒy
, **
ßved_˛b_›ös_u£d_loˇŒy
;

282 
©ãm±_cou¡
;

283 
udsd_mu…ùlõr
;

284 
w¨nögs
;

286 
t_gøph_ty≥
 
gøph_ty≥
;

290 if(
rouãr_›ts
.
rouã_ty≥
 =
GLOBAL
) {

291 
gøph_ty≥
 = 
GRAPH_GLOBAL
;

293 
gøph_ty≥
 = (
dë_routög_¨ch
.
dúe˘i⁄Æôy
 ==

294 
BI_DIRECTIONAL
 ? 
GRAPH_BIDIR
 : 
GRAPH_UNIDIR
);

297 
max_pös_≥r_fb
 = 0;

298 
i
 = 0; i < 
num_ty≥s
; i++)

300 
max_pös_≥r_fb
 =

301 
	`max
(
max_pös_≥r_fb
, 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

304 
fb_›ös_u£d_loˇŒy
 = 
	`Æloc_rouã_°ru˘s
(*
subblock_d©a_±r
);

305 
be°_routög
 = 
	`Æloc_ßved_routög
(
fb_›ös_u£d_loˇŒy
,

306 &
ßved_˛b_›ös_u£d_loˇŒy
);

308 if(
timög_öf
.
timög_™Æysis_íabÀd
)

310 
√t_¶ack
 =

311 
	`Æloc_™d_lﬂd_timög_gøph
(
timög_öf
, *
subblock_d©a_±r
);

312 
√t_dñay
 = 
	`Æloc_√t_dñay
(&
√t_dñay_chunk_li°_hód
);

316 
√t_dñay
 = 
NULL
;

317 
√t_¶ack
 = 
NULL
;

321 if(
dë_routög_¨ch
.
dúe˘i⁄Æôy
 =
BI_DIRECTIONAL
)

322 
udsd_mu…ùlõr
 = 1;

324 
udsd_mu…ùlõr
 = 2;

327 if(
rouãr_›ts
.
fixed_ch™√l_width
 !
NO_FIXED_CHANNEL_WIDTH
)

329 
cuºít
 = 
rouãr_›ts
.
fixed_ch™√l_width
 + 5 * 
udsd_mu…ùlõr
;

330 
low
 = 
rouãr_›ts
.
fixed_ch™√l_width
 - 1 * 
udsd_mu…ùlõr
;

334 
cuºít
 = 
max_pös_≥r_fb
 + max_pins_per_fb % 2;

335 
low
 = -1;

339 if(
dë_routög_¨ch
.
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
)

341 if(
cuºít
 % 2 != 0)

343 
¥ötf


345 
cuºít
);

346 
	`exô
(1);

352 if(
dë_routög_¨ch
.
Fs
 % 3)

354 
	`¥ötf
("Fs must beÅhree in bidirectional mode\n");

355 
	`exô
(1);

359 
high
 = -1;

360 
föÆ
 = -1;

361 
åy_w_limô
 = 0;

363 
©ãm±_cou¡
 = 0;

365 
föÆ
 == -1)

368 
	`¥ötf
("low, high, cuºíà%d %d %d\n", 
low
, 
high
, 
cuºít
);

369 
	`fÊush
(
°dout
);

374 if(
rouãr_›ts
.
fixed_ch™√l_width
 !
NO_FIXED_CHANNEL_WIDTH
)

376 if(
cuºít
 > 
rouãr_›ts
.
fixed_ch™√l_width
 * 4)

378 
¥ötf


380 "rouã∏›ti⁄s. La° faûedáà%d\n", 
low
);

381 
	`¥ötf
("AbortingÑoutingÖrocedure.\n");

382 
	`exô
(1);

387 if(
cuºít
 > 305)

389 
¥ötf


391 "rouã∏›ti⁄s. La° faûedáà%d\n", 
low
);

392 
	`¥ötf
("AbortingÑoutingÖrocedure.\n");

393 
	`exô
(1);

397 if((
cuºít
 * 3Ë< 
dë_routög_¨ch
.
Fs
)

399 
¥ötf


401 
föÆ
 = 
high
;

405 if(
∂a˚r_›ts
.
∂a˚_‰eq
 =
PLACE_ALWAYS
)

407 
∂a˚r_›ts
.
∂a˚_ch™_width
 = 
cuºít
;

408 
	`åy_∂a˚
(
∂a˚r_›ts
, 
™√Æög_sched
, 
ch™_width_di°
,

409 
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

410 
timög_öf
, 
subblock_d©a_±r
, &
m°
);

412 
suc˚ss
 =

413 
	`åy_rouã
(
cuºít
, 
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

414 
timög_öf
, 
√t_¶ack
, 
√t_dñay
, 
ch™_width_di°
,

415 
fb_›ös_u£d_loˇŒy
, 
m°
, &
Fc_˛ù≥d
);

416 
©ãm±_cou¡
++;

417 
	`fÊush
(
°dout
);

419 if(
suc˚ss
 && (
Fc_˛ù≥d
 =
FALSE
))

422 if(
suc˚ss


423 && (
Fc_˛ù≥d
 =
FALSE


424 || 
dë_routög_¨ch
.
Fc_ty≥
 =
FRACTIONAL
))

427 
high
 = 
cuºít
;

430 if(
Fc_˛ù≥d
)

432 
¥ötf


438 if(
∂a˚r_›ts
.
∂a˚_‰eq
 =
PLACE_ALWAYS
)

440 
	`¥öt_∂a˚
(
∂a˚_fûe
, 
√t_fûe
, 
¨ch_fûe
);

445 
	`ßve_routög
(
be°_routög
, 
fb_›ös_u£d_loˇŒy
,

446 
ßved_˛b_›ös_u£d_loˇŒy
);

448 if((
high
 - 
low
Ë<1 * 
udsd_mu…ùlõr
)

449 
föÆ
 = 
high
;

451 if(
low
 != -1)

453 
cuºít
 = (
high
 + 
low
) / 2;

457 
cuºít
 = 
high
 / 2;

462 if(
suc˚ss
 && 
Fc_˛ù≥d
)

464 
¥ötf


466 
suc˚ss
 = 
FALSE
;

468 
low
 = 
cuºít
;

469 if(
high
 != -1)

472 if((
high
 - 
low
Ë<1 * 
udsd_mu…ùlõr
)

473 
föÆ
 = 
high
;

475 
cuºít
 = (
high
 + 
low
) / 2;

479 if(
rouãr_›ts
.
fixed_ch™√l_width
 !=

480 
NO_FIXED_CHANNEL_WIDTH
)

483 if(
low
 <

484 
rouãr_›ts
.
fixed_ch™√l_width
 + 30)

486 
cuºít
 =

487 
low
 + 5 * 
udsd_mu…ùlõr
;

491 
¥ötf


493 
low
);

494 
	`exô
(1);

499 
cuºít
 = 
low
 * 2;

503 
cuºít
 = cuºíà+ cuºíà% 
udsd_mu…ùlõr
;

515 if(
vîify_bö¨y_£¨ch
)

518 
¥ötf


521 
¥ev_suc˚ss
 = 
TRUE
;

523 
¥ev2_suc˚ss
 = 
TRUE
;

525 
cuºít
 = 
föÆ
 - 2;

527 
¥ev2_suc˚ss
 || 
¥ev_suc˚ss
)

529 if((
rouãr_›ts
.
fixed_ch™√l_width
 !=

530 
NO_FIXED_CHANNEL_WIDTH
)

531 && (
cuºít
 < 
rouãr_›ts
.
fixed_ch™√l_width
))

535 
	`fÊush
(
°dout
);

536 if(
cuºít
 < 1)

538 if(
∂a˚r_›ts
.
∂a˚_‰eq
 =
PLACE_ALWAYS
)

540 
∂a˚r_›ts
.
∂a˚_ch™_width
 = 
cuºít
;

541 
	`åy_∂a˚
(
∂a˚r_›ts
, 
™√Æög_sched
,

542 
ch™_width_di°
, 
rouãr_›ts
,

543 
dë_routög_¨ch
, 
£gmít_öf
,

544 
timög_öf
, 
subblock_d©a_±r
, &
m°
);

547 
suc˚ss
 =

548 
	`åy_rouã
(
cuºít
, 
rouãr_›ts
, 
dë_routög_¨ch
,

549 
£gmít_öf
, 
timög_öf
, 
√t_¶ack
,

550 
√t_dñay
, 
ch™_width_di°
,

551 
fb_›ös_u£d_loˇŒy
, 
m°
, &
Fc_˛ù≥d
);

553 if(
suc˚ss
 && 
Fc_˛ù≥d
 =
FALSE
)

555 
föÆ
 = 
cuºít
;

556 
	`ßve_routög
(
be°_routög
, 
fb_›ös_u£d_loˇŒy
,

557 
ßved_˛b_›ös_u£d_loˇŒy
);

559 if(
∂a˚r_›ts
.
∂a˚_‰eq
 =
PLACE_ALWAYS
)

561 
	`¥öt_∂a˚
(
∂a˚_fûe
, 
√t_fûe
,

562 
¨ch_fûe
);

567 
¥ev2_suc˚ss
 = 
¥ev_suc˚ss
;

568 
¥ev_suc˚ss
 = 
suc˚ss
;

569 
cuºít
--;

570 if(
dë_routög_¨ch
.
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
) {

571 
cuºít
--;

581 
	`öô_ch™
(
föÆ
, 
ch™_width_di°
);

583 if(
∂a˚r_›ts
.
∂a˚_‰eq
 =
PLACE_ALWAYS
)

585 
	`¥ötf
("Reading bestÖlacement back in.\n");

586 
∂a˚r_›ts
.
∂a˚_ch™_width
 = 
föÆ
;

587 
	`ªad_∂a˚
(
∂a˚_fûe
, 
√t_fûe
, 
¨ch_fûe
, 
∂a˚r_›ts
,

588 
rouãr_›ts
, 
ch™_width_di°
, 
dë_routög_¨ch
,

589 
£gmít_öf
, 
timög_öf
, 
subblock_d©a_±r
, &
m°
);

592 
	`‰ì_º_gøph
();

594 
	`buûd_º_gøph
(
gøph_ty≥
,

595 
num_ty≥s
, 
ty≥_des¸ùt‹s
, 
nx
, 
ny
, 
grid
,

596 
ch™_width_x
[0], 
NULL
,

597 
dë_routög_¨ch
.
swôch_block_ty≥
, dë_routög_¨ch.
Fs
,

598 
dë_routög_¨ch
.
num_£gmít
, dë_routög_¨ch.
num_swôch
, 
£gmít_öf
,

599 
dë_routög_¨ch
.
globÆ_rouã_swôch
,

600 
dë_routög_¨ch
.
dñayÀss_swôch
, 
timög_öf
,

601 
dë_routög_¨ch
.
wúe_to_ùö_swôch
,

602 
rouãr_›ts
.
ba£_co°_ty≥
, &
w¨nögs
);

604 
	`ª°‹e_routög
(
be°_routög
, 
fb_›ös_u£d_loˇŒy
,

605 
ßved_˛b_›ös_u£d_loˇŒy
);

606 
	`check_rouã
(
rouãr_›ts
.
rouã_ty≥
, 
dë_routög_¨ch
.
num_swôch
,

607 
fb_›ös_u£d_loˇŒy
);

608 
	`gë_£rül_num
();

609 if(
Fc_˛ù≥d
)

611 
¥ötf


614 
	`¥ötf
("Be°Ñoutög u£dá ch™√»width fa˘‹ o‡%d.\n\n", 
föÆ
);

616 
	`routög_°©s
(
fuŒ_°©s
, 
rouãr_›ts
.
rouã_ty≥
,

617 
dë_routög_¨ch
.
num_swôch
, 
£gmít_öf
,

618 
dë_routög_¨ch
.
num_£gmít
,

619 
dë_routög_¨ch
.
R_möW_nmos
,

620 
dë_routög_¨ch
.
R_möW_pmos
,

621 
dë_routög_¨ch
.
dúe˘i⁄Æôy
,

622 
timög_öf
.
timög_™Æysis_íabÀd
, 
√t_¶ack
, 
√t_dñay
,

623 *
subblock_d©a_±r
);

625 
	`¥öt_rouã
(
rouã_fûe
);

627 #ifde‡
CREATE_ECHO_FILES


631 
	`öô_døw_co‹ds
(
max_pös_≥r_fb
);

632 
	`•rötf
(
msg
, "Routing succeeded withá channel width factor of %d.",

633 
föÆ
);

634 
	`upd©e_s¸ìn
(
MAJOR
, 
msg
, 
ROUTING
, 
timög_öf
.
timög_™Æysis_íabÀd
);

636 
	`‰ì_subblock_d©a
(
subblock_d©a_±r
);

638 if(
timög_öf
.
timög_™Æysis_íabÀd
)

640 
	`‰ì_timög_gøph
(
√t_¶ack
);

641 
	`‰ì_√t_dñay
(
√t_dñay
, &
√t_dñay_chunk_li°_hód
);

644 
	`‰ì_rouã_°ru˘s
(
fb_›ös_u£d_loˇŒy
);

645 
	`‰ì_ßved_routög
(
be°_routög
, 
ßved_˛b_›ös_u£d_loˇŒy
);

646 
	`fÊush
(
°dout
);

648  (
föÆ
);

649 
	}
}

653 
	$öô_ch™
(
cÁ˘‹
,

654 
t_ch™_width_di°
 
ch™_width_di°
)

662 
x
, 
£∑øti⁄
, 
ch™_width_io
;

663 
nio
, 
i
;

664 
t_ch™
 
ch™_x_di°
, 
ch™_y_di°
;

666 
ch™_width_io
 = 
ch™_width_di°
.chan_width_io;

667 
ch™_x_di°
 = 
ch™_width_di°
.chan_x_dist;

668 
ch™_y_di°
 = 
ch™_width_di°
.chan_y_dist;

672 
nio
 = ()
	`Êo‹
(
cÁ˘‹
 * 
ch™_width_io
 + 0.5);

673 if(
nio
 == 0)

674 
nio
 = 1;

676 
ch™_width_x
[0] = ch™_width_x[
ny
] = 
nio
;

677 
ch™_width_y
[0] = ch™_width_y[
nx
] = 
nio
;

679 if(
ny
 > 1)

681 
£∑øti⁄
 = 1. / (
ny
 - 2.);

682 
x
 = 0.;

683 
ch™_width_x
[1] = ()
	`Êo‹
(
cÁ˘‹
 * 
	`comp_width
(&
ch™_x_di°
, 
x
,

684 
£∑øti⁄
) +

688 
ch™_width_x
[1] = 
	`max
(chan_width_x[1], 1);

690 
i
 = 1; i < 
ny
 - 1; i++)

692 
x
 = ()
i
 / (()(
ny
 - 2.));

693 
ch™_width_x
[
i
 + 1] =

694 ()
	`Êo‹
(
cÁ˘‹
 *

695 
	`comp_width
(&
ch™_x_di°
, 
x
,

696 
£∑øti⁄
) + 0.5);

697 
ch™_width_x
[
i
 + 1] = 
	`max
(chan_width_x[i + 1], 1);

701 if(
nx
 > 1)

703 
£∑øti⁄
 = 1. / (
nx
 - 2.);

704 
x
 = 0.;

705 
ch™_width_y
[1] = ()
	`Êo‹
(
cÁ˘‹
 * 
	`comp_width
(&
ch™_y_di°
, 
x
,

706 
£∑øti⁄
) +

709 
ch™_width_y
[1] = 
	`max
(chan_width_y[1], 1);

711 
i
 = 1; i < 
nx
 - 1; i++)

713 
x
 = ()
i
 / (()(
nx
 - 2.));

714 
ch™_width_y
[
i
 + 1] =

715 ()
	`Êo‹
(
cÁ˘‹
 *

716 
	`comp_width
(&
ch™_y_di°
, 
x
,

717 
£∑øti⁄
) + 0.5);

718 
ch™_width_y
[
i
 + 1] = 
	`max
(chan_width_y[i + 1], 1);

721 #ifde‡
VERBOSE


722 
	`¥ötf
("\nchan_width_x:\n");

723 
i
 = 0; i <
ny
; i++)

724 
	`¥ötf
("%d ", 
ch™_width_x
[
i
]);

725 
	`¥ötf
("\n\nchan_width_y:\n");

726 
i
 = 0; i <
nx
; i++)

727 
	`¥ötf
("%d ", 
ch™_width_y
[
i
]);

728 
	`¥ötf
("\n\n");

731 
	}
}

735 
	$comp_width
(
t_ch™
 * 
ch™
,

736 
x
,

737 
£∑øti⁄
)

745 
vÆ
;

747 
ch™
->
ty≥
)

750 
UNIFORM
:

751 
vÆ
 = 
ch™
->
≥ak
;

754 
GAUSSIAN
:

755 
vÆ
 = (
x
 - 
ch™
->
x≥ak
Ë* (x - ch™->x≥akË/ (2 * ch™->
width
 *

756 
ch™
->
width
);

757 
vÆ
 = 
ch™
->
≥ak
 * 
	`exp
(-val);

758 
vÆ
 +
ch™
->
dc
;

761 
PULSE
:

762 
vÆ
 = ()
	`Ábs
(()(
x
 - 
ch™
->
x≥ak
));

763 if(
vÆ
 > 
ch™
->
width
 / 2.)

765 
vÆ
 = 0;

769 
vÆ
 = 
ch™
->
≥ak
;

771 
vÆ
 +
ch™
->
dc
;

774 
DELTA
:

775 
vÆ
 = 
x
 - 
ch™
->
x≥ak
;

776 if(
vÆ
 > -
£∑øti⁄
 / 2. && val <= separation / 2.)

777 
vÆ
 = 
ch™
->
≥ak
;

779 
vÆ
 = 0.;

780 
vÆ
 +
ch™
->
dc
;

784 
	`¥ötf
("Error in comp_width: Unknown channelÅype %d.\n",

785 
ch™
->
ty≥
);

786 
	`exô
(1);

790  (
vÆ
);

791 
	}
}

796 
	$po°_∂a˚_sync
(
IN
 
num_blocks
,

797 
INOUT
 c⁄° 
s_block
 
block_li°
[],

798 
INOUT
 
t_subblock_d©a
 * 
subblock_d©a_±r
)

800 
iblk
, 
j
, 
k
, 
öë
;

801 
t_ty≥_±r
 
ty≥
;

802 
max_num_block_pös
;

803 
t_subblock
 **
subblock_öf
;

805 
subblock_öf
 = 
subblock_d©a_±r
->subblock_inf;

809 
iblk
 = 0; iblk < 
num_blocks
; ++iblk)

811 
ty≥
 = 
block
[
iblk
].type;

812 
	`as£π
(
ty≥
->
num_pös
 %Åy≥->
ˇ∑côy
 == 0);

813 
max_num_block_pös
 = 
ty≥
->
num_pös
 /Åy≥->
ˇ∑côy
;

816 
j
 = 0; j < 
max_num_block_pös
; j++)

818 
öë
 = 
block
[
iblk
].
√ts
[
j
];

819 if(
öë
 !
OPEN
 && 
block
[
iblk
].
z
 > 0)

821 
	`as£π
(
block
[
iblk
].

822 
√ts
[
j
 +

823 
block
[
iblk
].
z
 * 
max_num_block_pös
] ==

824 
OPEN
);

825 
block
[
iblk
].
√ts
[
j
 +

826 
block
[
iblk
].
z
 *

827 
max_num_block_pös
] =

828 
block
[
iblk
].
√ts
[
j
];

829 
block
[
iblk
].
√ts
[
j
] = 
OPEN
;

830 
k
 = 0; k < 
ty≥
->
num_pös
; k++)

832 if(
√t
[
öë
].
node_block
[
k
] =
iblk
)

834 
	`as£π
(
√t
[
öë
].

835 
node_block_pö
[
k
] =
j
);

836 
√t
[
öë
].
node_block_pö
[
k
] =

837 
j
 +

838 
block
[
iblk
].
z
 *

839 
max_num_block_pös
;

847 
j
 = 0; j < 
subblock_d©a_±r
->
num_subblocks_≥r_block
[
iblk
];

848 
j
++)

850 
k
 = 0; k < 
ty≥
->
max_subblock_öputs
; k++)

852 if(
subblock_öf
[
iblk
][
j
].
öputs
[
k
] !
OPEN
)

854 
subblock_öf
[
iblk
][
j
].
öputs
[
k
] =

855 
subblock_öf
[
iblk
][
j
].
öputs
[
k
] +

856 
block
[
iblk
].
z
 * 
max_num_block_pös
;

859 
k
 = 0; k < 
ty≥
->
max_subblock_ouçuts
; k++)

861 if(
subblock_öf
[
iblk
][
j
].
ouçuts
[
k
] !
OPEN
)

863 
subblock_öf
[
iblk
][
j
].
ouçuts
[
k
] =

864 
subblock_öf
[
iblk
][
j
].
ouçuts
[
k
] +

865 
block
[
iblk
].
z
 * 
max_num_block_pös
;

868 if(
subblock_öf
[
iblk
][
j
].
˛ock
 !
OPEN
)

870 
subblock_öf
[
iblk
][
j
].
˛ock
 =

871 
subblock_öf
[
iblk
][
j
].
˛ock
 +

872 
block
[
iblk
].
z
 * 
max_num_block_pös
;

876 
	}
}

879 
	$‰ì_subblock_d©a
(
t_subblock_d©a
 * 
subblock_d©a_±r
)

881 
i
, 
j
;

884 
i
 = 0; i < 
num_blocks
; i++) {

885 if(
subblock_d©a_±r
->
subblock_öf
[
i
] !
NULL
) {

886 
j
 = 0; j < 
subblock_d©a_±r
->
num_subblocks_≥r_block
[
i
]; j++) {

887 
	`‰ì
(
subblock_d©a_±r
->
subblock_öf
[
i
][
j
].
«me
);

888 
	`‰ì
(
subblock_d©a_±r
->
subblock_öf
[
i
][
j
].
ouçuts
);

889 
	`‰ì
(
subblock_d©a_±r
->
subblock_öf
[
i
][
j
].
öputs
);

891 
	`‰ì
(
subblock_d©a_±r
->
subblock_öf
[
i
]);

895 
	`‰ì
(
subblock_d©a_±r
->
subblock_öf
);

896 
	`‰ì
(
subblock_d©a_±r
->
num_subblocks_≥r_block
);

899 
subblock_d©a_±r
->
num_subblocks_≥r_block
 = 
NULL
;

900 
subblock_d©a_±r
->
subblock_öf
 = 
NULL
;

901 
	}
}

	@place_and_route.h

1 
	#INFINITE
 -1

	)

2 
	#NOT_FOUND
 0

	)

4 
	#WNEED
 1

	)

5 
	#WL
 2

	)

6 
	#PROC_TIME
 3

	)

8 
	ss_fm≠_˚Œ


10 
	mfs
;

11 
	mfc
;

12 
	mw√ed
;

13 
	mwúñígth
;

14 
	m¥oc_time
;

15 
s_fm≠_˚Œ
 *
	m√xt
;

17 
	tt_fm≠_˚Œ
;

20 
∂a˚_™d_rouã
(
e_›î©i⁄
 
›î©i⁄
,

21 
s_∂a˚r_›ts
 
∂a˚r_›ts
,

22 *
∂a˚_fûe
,

23 *
√t_fûe
,

24 *
¨ch_fûe
,

25 *
rouã_fûe
,

26 
s_™√Æög_sched
 
™√Æög_sched
,

27 
s_rouãr_›ts
 
rouãr_›ts
,

28 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

29 
t_£gmít_öf
 * 
£gmít_öf
,

30 
t_timög_öf
 
timög_öf
,

31 
t_subblock_d©a
 * 
subblock_d©a_±r
,

32 
t_ch™_width_di°
 
ch™_width_di°
);

34 
öô_ch™
(
cÁ˘‹
,

35 
t_ch™_width_di°
 
ch™_width_di°
);

	@place_stats.c

1 
	~<°dio.h
>

2 
	~<m©h.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"globÆs.h
"

7 
	#ABS_DIFF
(
X
, 
Y
Ë(((XË> (Y))? ((XË- (Y)):((YË- (X)))

	)

8 
	#MAX_X
 50

	)

9 
	#MAX_LEN
 
MAX_X
*2

	)

11 
	sªœpos_ªc_s


13 
	mnum_Ω
[
MAX_LEN
];

15 
	tªœpos_ªc_t
;

18 
	$¥öt_ªœtive_pos_di°r
()

24 #ifde‡
PRINT_REL_POS_DISTR


25 
FILE
 *
out_bö_fûe
;

26 
ªœpos_ªc_t
 
Ω_ªc
;

29 
öë
, 
Àn
, 
Ω
, 
§c_x
, 
§c_y
, 
d°_x
, 
d°_y
, 
dñ_x
, 
dñ_y
, 
mö_dñ
,

30 
sök_pö
, 
sum
;

31 *
tŸÆ_c⁄n
;

32 **
ªœpos
;

33 **
ªœpos_di°r
;

35 
tŸÆ_c⁄n
 = (*)
	`my_mÆloc
((
nx
 + 
ny
 + 1) * ());

36 
ªœpos
 = (**)
	`my_mÆloc
((
nx
 + 
ny
 + 1) * (*));

37 
ªœpos_di°r
 = (**)
	`my_mÆloc
((
nx
 + 
ny
 + 1) * (*));

38 
Àn
 = 0;Üí <
nx
 + 
ny
;Üen++)

40 
ªœpos
[
Àn
] = (*)
	`my_ˇŒoc
(len / 2 + 1, ());

41 
ªœpos_di°r
[
Àn
] =

42 (*)
	`my_ˇŒoc
((
Àn
 / 2 + 1), ());

46 
öë
 = 0; i√à< 
num_√ts
; inet++)

48 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

51 
§c_x
 = 
block
[
√t
[
öë
].
node_block
[0]].
x
;

52 
§c_y
 = 
block
[
√t
[
öë
].
node_block
[0]].
y
;

54 
sök_pö
 = 1; sök_pö <
√t
[
öë
].
num_söks
;

55 
sök_pö
++)

57 
d°_x
 = 
block
[
√t
[
öë
].
node_block
[
sök_pö
]].
x
;

58 
d°_y
 = 
block
[
√t
[
öë
].
node_block
[
sök_pö
]].
y
;

60 
dñ_x
 = 
	`ABS_DIFF
(
d°_x
, 
§c_x
);

61 
dñ_y
 = 
	`ABS_DIFF
(
d°_y
, 
§c_y
);

63 
Àn
 = 
dñ_x
 + 
dñ_y
;

65 
mö_dñ
 = (
dñ_x
 < 
dñ_y
) ? del_x : del_y;

67 if(!(
mö_dñ
 <(
Àn
 / 2)))

69 
¥ötf


71 
mö_dñ
, 
Àn
);

72 
	`exô
(1);

76 
ªœpos
[
Àn
][
mö_dñ
]++;

82 #ifde‡
PRINT_REL_POS_DISTR


83 
out_bö_fûe
 =

84 
	`f›í
("/jayar/b/b5/fang/vpr_test/wirelength/relapos2.bin", "rb+");

87 
Àn
 = 0;Üí <
nx
 + 
ny
;Üen++)

89 
sum
 = 0;

90 
Ω
 = 0;Ñ∞<
Àn
 / 2;Ñp++)

92 
sum
 +
ªœpos
[
Àn
][
Ω
];

94 if(
sum
 != 0)

96 #ifde‡
PRINT_REL_POS_DISTR


97 
	`f£ek
(
out_bö_fûe
, (
ªœpos_ªc_t
Ë* 
Àn
,

98 
SEEK_SET
);

99 
	`‰ód
(&
Ω_ªc
, (
ªœpos_ªc_t
), 1, 
out_bö_fûe
);

102 
Ω
 = 0;Ñ∞<
Àn
 / 2;Ñp++)

105 
ªœpos_di°r
[
Àn
][
Ω
] =

106 ()
ªœpos
[
Àn
][
Ω
] / ()
sum
;

109 #ifde‡
PRINT_REL_POS_DISTR


110 
	`Ârötf
(
°dîr
, "old %d increase by %d\n",

111 
Ω_ªc
.
num_Ω
[
Ω
], 
ªœpos
[
Àn
][rp]);

112 
Ω_ªc
.
num_Ω
[
Ω
] +
ªœpos
[
Àn
][rp];

113 
	`Ârötf
(
°dîr
, "becomes %d\n",

114 
Ω_ªc
.
num_Ω
[
Ω
]);

117 #ifde‡
PRINT_REL_POS_DISTR


119 
	`f£ek
(
out_bö_fûe
, (
ªœpos_ªc_t
Ë* 
Àn
,

120 
SEEK_SET
);

121 
	`fwrôe
(&
Ω_ªc
, (
ªœpos_ªc_t
), 1, 
out_bö_fûe
);

125 
tŸÆ_c⁄n
[
Àn
] = 
sum
;

128 
	`Ârötf
(
°dout
, "SourceÅo sinkÑelativeÖositions:\n");

129 
Àn
 = 1;Üí <
nx
 + 
ny
;Üen++)

131 if(
tŸÆ_c⁄n
[
Àn
] != 0)

133 
	`Ârötf
(
°dout
, "O‡2-pö di°™˚ %dÉxi°†%d\n\n", 
Àn
,

134 
tŸÆ_c⁄n
[
Àn
]);

135 
Ω
 = 0;Ñ∞<
Àn
 / 2;Ñp++)

137 
	`Ârötf
(
°dout
, "\åp%d\t%d\t\t(%.5f)\n", 
Ω
,

138 
ªœpos
[
Àn
][
Ω
], 
ªœpos_di°r
[len][rp]);

140 
	`Ârötf
(
°dout
, "----------------\n");

144 
	`‰ì
((*)
tŸÆ_c⁄n
);

145 
Àn
 = 0;Üí <
nx
 + 
ny
;Üen++)

147 
	`‰ì
((*)
ªœpos
[
Àn
]);

148 
	`‰ì
((*)
ªœpos_di°r
[
Àn
]);

150 
	`‰ì
((*)
ªœpos
);

151 
	`‰ì
((*)
ªœpos_di°r
);

153 #ifde‡
PRINT_REL_POS_DISTR


154 
	`f˛o£
(
out_bö_fûe
);

156 
	}
}

	@place_stats.h

1 
¥öt_ªœtive_pos_di°r
();

	@print_netlist.c

1 
	~<as£π.h
>

2 
	~<°dio.h
>

3 
	~<°rög.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"globÆs.h
"

7 
	~"¥öt_√éi°.h
"

12 
¥öt_pönum
(
FILE
 * 
Â
,

13 
pönum
);

19 
	$¥öt_√éi°
(*
fouçut
,

20 *
√t_fûe
,

21 
t_subblock_d©a
 
subblock_d©a
)

27 
i
, 
j
, 
ùö
, 
max_pö
;

28 
num_globÆ_√ts
;

29 
num_p_öputs
, 
num_p_ouçuts
;

30 
FILE
 *
Â
;

31 
t_subblock
 **
subblock_öf
;

32 *
num_subblocks_≥r_block
;

34 
num_globÆ_√ts
 = 0;

35 
num_p_öputs
 = 0;

36 
num_p_ouçuts
 = 0;

39 
i
 = 0; i < 
num_√ts
; i++)

41 if(!
√t
[
i
].
is_globÆ
)

43 
num_globÆ_√ts
++;

48 
i
 = 0; i < 
num_blocks
; i++)

50 if(
block
[
i
].
ty≥
 =
IO_TYPE
)

52 
j
 = 0; j < 
IO_TYPE
->
num_pös
; j++)

54 if(
block
[
i
].
√ts
[
j
] !
OPEN
)

56 if(
IO_TYPE
->

57 
˛ass_öf
[
IO_TYPE
->
pö_˛ass
[
j
]].

58 
ty≥
 =
DRIVER
)

60 
num_p_öputs
++;

64 
	`as£π
(
IO_TYPE
->

65 
˛ass_öf
[
IO_TYPE
->

66 
pö_˛ass
[
j
]].

67 
ty≥
 =
RECEIVER
);

68 
num_p_ouçuts
++;

76 
Â
 = 
	`my_f›í
(
fouçut
, "w");

78 
	`Ârötf
(
Â
, "I≈uà√éi° fûe: %s\n", 
√t_fûe
);

79 
	`Ârötf
(
Â
, "num_p_inputs: %d,Çum_p_outputs: %d,Çum_clbs: %d\n",

80 
num_p_öputs
, 
num_p_ouçuts
, 
num_blocks
);

81 
	`Ârötf
(
Â
, "num_blocks: %d,Çum_nets: %d,Çum_globals: %d\n",

82 
num_blocks
, 
num_√ts
, 
num_globÆ_√ts
);

83 
	`Ârötf
(
Â
, "\nNet\tName\t\t#Pins\tDriver\t\tRecvs. (block,Öin)\n");

85 
i
 = 0; i < 
num_√ts
; i++)

87 
	`Ârötf
(
Â
, "\n%d\t%s\t", 
i
, 
√t
[i].
«me
);

88 if(
	`°æí
(
√t
[
i
].
«me
) < 8)

89 
	`Ârötf
(
Â
, "\t");

90 
	`Ârötf
(
Â
, "%d", 
√t
[
i
].
num_söks
 + 1);

91 
j
 = 0; j <
√t
[
i
].
num_söks
; j++)

92 
	`Ârötf
(
Â
, "\t(%4d,%4d)", 
√t
[
i
].
node_block
[
j
],

93 
√t
[
i
].
node_block_pö
[
j
]);

96 
	`Ârötf
(
Â
, "\nBlock\tName\t\tType\tPin Connections\n\n");

98 
i
 = 0; i < 
num_blocks
; i++)

100 
	`Ârötf
(
Â
, "\n%d\t%s\t", 
i
, 
block
[i].
«me
);

101 if(
	`°æí
(
block
[
i
].
«me
) < 8)

102 
	`Ârötf
(
Â
, "\t");

103 
	`Ârötf
(
Â
, "%s", 
block
[
i
].
ty≥
->
«me
);

105 
max_pö
 = 
block
[
i
].
ty≥
->
num_pös
;

107 
j
 = 0; j < 
max_pö
; j++)

108 
	`¥öt_pönum
(
Â
, 
block
[
i
].
√ts
[
j
]);

111 
	`Ârötf
(
Â
, "\n");

115 
subblock_öf
 = 
subblock_d©a
.subblock_inf;

116 
num_subblocks_≥r_block
 = 
subblock_d©a
.num_subblocks_per_block;

119 
	`Ârötf
(
Â
, "\n\nSubblock List:\n\n");

121 
i
 = 0; i < 
num_blocks
; i++)

123 
	`Ârötf
(
Â
, "\nBlock: %d (%s)\tNum_subblocks: %d\n", 
i
,

124 
block
[
i
].
«me
, 
num_subblocks_≥r_block
[i]);

128 
	`Ârötf
(
Â
, "Index\tName\t\tInputs");

129 
j
 = 0; j < 
block
[
i
].
ty≥
->
max_subblock_öputs
; j++)

130 
	`Ârötf
(
Â
, "\t");

131 
	`Ârötf
(
Â
, "Outputs");

132 
j
 = 0; j < 
block
[
i
].
ty≥
->
max_subblock_ouçuts
; j++)

133 
	`Ârötf
(
Â
, "\t");

134 
	`Ârötf
(
Â
, "Clock\n");

138 
j
 = 0; j < 
num_subblocks_≥r_block
[
i
]; j++)

140 
	`Ârötf
(
Â
, "%d\t%s", 
j
, 
subblock_öf
[
i
][j].
«me
);

141 if(
	`°æí
(
subblock_öf
[
i
][
j
].
«me
) < 8)

142 
	`Ârötf
(
Â
, "\t");

143 
ùö
 = 0; ipö < 
block
[
i
].
ty≥
->
max_subblock_öputs
;

144 
ùö
++)

145 
	`¥öt_pönum
(
Â
, 
subblock_öf
[
i
][
j
].
öputs
[
ùö
]);

146 
ùö
 = 0; ipö < 
block
[
i
].
ty≥
->
max_subblock_ouçuts
;

147 
ùö
++)

148 
	`¥öt_pönum
(
Â
, 
subblock_öf
[
i
][
j
].
ouçuts
[
ùö
]);

149 
	`¥öt_pönum
(
Â
, 
subblock_öf
[
i
][
j
].
˛ock
);

150 
	`Ârötf
(
Â
, "\n");

154 
	`f˛o£
(
Â
);

155 
	}
}

159 
	$¥öt_pönum
(
FILE
 * 
Â
,

160 
pönum
)

165 if(
pönum
 =
OPEN
)

166 
	`Ârötf
(
Â
, "\tOPEN");

168 
	`Ârötf
(
Â
, "\t%d", 
pönum
);

169 
	}
}

	@print_netlist.h

1 
¥öt_√éi°
(*
fouçut
,

2 *
√t_fûe
,

3 
t_subblock_d©a
 
subblock_d©a
);

	@read_netlist.c

1 
	~<°dio.h
>

2 
	~<°rög.h
>

3 
	~<as£π.h
>

4 
	~"utû.h
"

5 
	~"hash.h
"

6 
	~"v¥_ty≥s.h
"

7 
	~"v¥_utûs.h
"

8 
	~"RódLöe.h
"

9 
	~"globÆs.h
"

12 *
	gpöli°_°r
 = "pinlist:";

13 
	e•ecül_blk


14 { 
	mNORMAL
 = 0, 
	mINPAD
, 
	mOUTPAD
 };

16 
t_ty≥_±r
 
gë_ty≥_by_«me
(
IN
 c⁄° *
«me
,

17 
IN
 
num_ty≥s
,

18 
IN
 c⁄° 
s_ty≥_des¸ùt‹


19 
block_ty≥s
[],

20 
IN
 
t_ty≥_±r
 
IO_ty≥
,

21 
IN
 c⁄° *
√t_fûe
,

22 
IN
 
löe
,

23 
OUT
 
•ecül_blk
 *
ovîide
);

29 
	$ªad_√éi°
(
IN
 c⁄° *
√t_fûe
,

30 
IN
 
num_ty≥s
,

31 
IN
 c⁄° 
s_ty≥_des¸ùt‹
 
block_ty≥s
[],

32 
IN
 
t_ty≥_±r
 
IO_ty≥
,

33 
IN
 
io_ùö
,

34 
IN
 
io_›ö
,

35 
OUT
 
t_subblock_d©a
 * 
subblock_d©a_±r
,

36 
OUT
 *
num_blocks
,

37 
OUT
 
s_block
 *
block_li°
[],

38 
OUT
 *
num_√ts
,

39 
OUT
 
s_√t
 *
√t_li°
[])

42 
FILE
 *
öfûe
;

43 
bcou¡
;

44 
s_block
 *
bli°
;

45 
ncou¡
;

46 
s_√t
 *
∆i°
;

48 
i
, 
j
, 
k
, 
l
, 
m
;

50 { 
COUNT
, 
LOAD
, 
MAP
, 
STOP
 }

51 
∑ss
;

52 
löe
, 
¥ev_löe
;

53 
•ecül_blk
 
ovîide
;

54 **
block_tokís
;

55 **
pö_tokís
;

56 **
tokís
;

57 
t_subblock
 **
¶i°
 = 
NULL
;

58 *
scou¡
 = 
NULL
;

59 
t_ty≥_±r
 
ty≥
 = 
NULL
;

62 
öfûe
 = 
	`my_f›í
(
√t_fûe
, "r");

63 
bcou¡
 = 0;

64 
bli°
 = 
NULL
;

65 
ncou¡
 = 0;

66 
∆i°
 = 
NULL
;

67 
	`mem£t
(
subblock_d©a_±r
, 0, (
t_subblock_d©a
));

88 
∑ss
 = 0;Öas†< 
STOP
; ++pass)

90 
	`ªwöd
(
öfûe
);

91 
löe
 = 0;

92 
i
 = 0;

93 
j
 = 0;

94 
ovîide
 = 
NORMAL
;

97 if(
LOAD
 =
∑ss
)

99 
bli°
 =

100 (
s_block
 *)
	`my_mÆloc
((s_block) *

101 
bcou¡
);

102 
	`mem£t
(
bli°
, 0, ((
s_block
Ë* 
bcou¡
));

104 
∆i°
 =

105 (
s_√t
 *)
	`my_mÆloc
((s_net) *

106 
ncou¡
);

107 
	`mem£t
(
∆i°
, 0, ((
s_√t
Ë* 
ncou¡
));

109 
¶i°
 =

110 (
t_subblock
 **Ë
	`my_mÆloc
((t_subblock *) *

111 
bcou¡
);

112 
	`mem£t
(
¶i°
, 0, ((
t_subblock
 *Ë* 
bcou¡
));

114 
scou¡
 = (*)
	`my_mÆloc
((Ë* 
bcou¡
);

115 
	`mem£t
(
scou¡
, 0, ((Ë* 
bcou¡
));

119 
block_tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

120 
¥ev_löe
 = 
löe
;

121 
block_tokís
)

125 if(0 =
	`°rcmp
(
block_tokís
[0], ".global"))

127 if(
MAP
 =
∑ss
)

129 
l
 = 0;Ü < 
ncou¡
; ++l)

132 
	`°rcmp
(
∆i°
[
l
].
«me
,

133 
block_tokís
[1]))

135 
∆i°
[
l
].
is_globÆ
 = 
TRUE
;

139 if(
l
 =
ncou¡
)

141 
	`¥ötf
(
ERRTAG


143 
√t_fûe
, 
¥ev_löe
);

144 
	`exô
(1);

149 
	`FªeTokís
(&
block_tokís
);

150 
block_tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

151 
¥ev_löe
 = 
löe
;

154 
pö_tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

156 if(
	`Cou¡Tokís
(
block_tokís
) != 2)

158 
	`¥ötf
(
ERRTAG
 "'%s':%d - blockÅypeÜine should "

160 
√t_fûe
, 
¥ev_löe
);

161 
	`exô
(1);

163 if(
NULL
 =
pö_tokís
)

165 
	`¥ötf
(
ERRTAG


167 
√t_fûe
, 
löe
);

168 
	`exô
(1);

170 if(0 !
	`°rcmp
("pöli°:", 
pö_tokís
[0]))

172 
	`¥ötf
(
ERRTAG


174 "blockÅy≥Üöe\n", 
√t_fûe
, 
löe
);

175 
	`exô
(1);

178 
ty≥
 =

179 
	`gë_ty≥_by_«me
(
block_tokís
[0], 
num_ty≥s
,

180 
block_ty≥s
, 
IO_ty≥
, 
√t_fûe
,

181 
¥ev_löe
, &
ovîide
);

183 if(
ovîide
)

185 if(
	`Cou¡Tokís
(
pö_tokís
) != 2)

187 
	`¥ötf
(
ERRTAG


189 "⁄ly havê⁄êôem.\n", 
√t_fûe
,

190 
löe
);

191 
	`exô
(1);

195 
tokís
 =

196 (**)
	`my_mÆloc
((*) *

197 (
ty≥
->
num_pös
 + 2));

199 
l
 = 
	`°æí
(
pöli°_°r
) + 1;

200 
k
 = 
	`°æí
(
pö_tokís
[1]) + 1;

201 
tokís
[0] =

202 (*)
	`my_mÆloc
((Ë* (
k
 + 
l
));

203 
	`mem˝y
(
tokís
[0], 
pöli°_°r
, 
l
 * ());

204 
	`mem˝y
(
tokís
[0] + 
l
, 
pö_tokís
[1],

205 
k
 * ());

208 
k
 = 0; k < 
ty≥
->
num_pös
; ++k)

210 
tokís
[1 + 
k
] = "open";

212 
tokís
[1 + 
k
] = 
NULL
;

214 
k
 = 0; k < 
ty≥
->
num_pös
; ++k)

216 
ovîide
)

218 
INPAD
:

219 
tokís
[1 + 
io_›ö
] =

220 (
tokís
[0] + 
l
);

222 
OUTPAD
:

223 
tokís
[1 + 
io_ùö
] =

224 (
tokís
[0] + 
l
);

228 
	`FªeTokís
(&
pö_tokís
);

229 
pö_tokís
 = 
tokís
;

230 
tokís
 = 
NULL
;

233 if(
	`Cou¡Tokís
(
pö_tokís
Ë!(
ty≥
->
num_pös
 + 1))

235 
	`¥ötf
(
ERRTAG


237 "ex≥˘ %dÖös.\n", 
√t_fûe
, 
löe
,

238 
	`Cou¡Tokís
(
pö_tokís
) - 1,

239 
ty≥
->
num_pös
);

240 
	`exô
(1);

244 if(
LOAD
 =
∑ss
)

246 
bli°
[
i
].
«me
 = 
	`my_°rdup
(
block_tokís
[1]);

247 
bli°
[
i
].
ty≥
 =Åype;

248 
bli°
[
i
].
√ts
 =

249 (*)
	`my_mÆloc
(() *

250 
ty≥
->
num_pös
);

251 
k
 = 0; k < 
ty≥
->
num_pös
; ++k)

253 
bli°
[
i
].
√ts
[
k
] = 
OPEN
;

258 
k
 = 0; k < 
ty≥
->
num_pös
; ++k)

260 if(0 !
	`°rcmp
("›í", 
pö_tokís
[1 + 
k
]))

262 if(
DRIVER
 ==

263 
ty≥
->
˛ass_öf
[ty≥->
pö_˛ass
[
k
]].

264 
ty≥
)

266 if(
LOAD
 =
∑ss
)

268 
∆i°
[
j
].
«me
 =

269 
	`my_°rdup
(
pö_tokís


270 [1 + 
k
]);

272 if(
MAP
 =
∑ss
)

274 
bli°
[
i
].
√ts
[
k
] = 
j
;

277 ++
j
;

281 if(
MAP
 =
∑ss
)

284 
bli°
[
i
].
√ts
[
k
] = 
OPEN
;

285 
l
 = 0;Ü < 
ncou¡
;

286 ++
l
)

289 
	`°rcmp
(
∆i°


290 [
l
].

291 
«me
,

292 
pö_tokís


294 
k
]))

296 
bli°
[
i
].

297 
√ts


298 [
k
] =

299 
l
;

303 if(
OPEN
 ==

304 
bli°
[
i
].
√ts
[
k
])

306 
	`¥ötf
(
ERRTAG


308 
√t_fûe
,

309 
löe
,

310 
pö_tokís


311 [1 + 
k
]);

312 
	`exô
(1);

320 if(
MAP
 =
∑ss
)

324 if(
scou¡
[
i
] > 0) {

325 
¶i°
[
i
] = (
t_subblock
 *)

326 
	`my_mÆloc
((
t_subblock
Ë* 
scou¡
[
i
]);

327 
k
 = 0; k < 
scou¡
[
i
]; ++k)

329 
¶i°
[
i
][
k
].
«me
 = 
NULL
;

330 
¶i°
[
i
][
k
].
˛ock
 = 
OPEN
;

331 
¶i°
[
i
][
k
].
öputs
 =

332 (*)
	`my_mÆloc
(() *

333 
ty≥
->

334 
max_subblock_öputs
);

335 
l
 = 0;Ü < 
ty≥
->
max_subblock_öputs
;

336 ++
l
)

338 
¶i°
[
i
][
k
].
öputs
[
l
] = 
OPEN
;

340 
¶i°
[
i
][
k
].
ouçuts
 =

341 (*)
	`my_mÆloc
(() *

342 
ty≥
->

343 
max_subblock_ouçuts
);

344 
l
 = 0;Ü < 
ty≥
->
max_subblock_ouçuts
;

345 ++
l
)

347 
¶i°
[
i
][
k
].
ouçuts
[
l
] = 
OPEN
;

354 
tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

355 
¥ev_löe
 = 
löe
;

356 
m
 = 0;

357 
tokís
 && (0 =
	`°rcmp
(tokens[0], "subblock:")))

359 if(
	`Cou¡Tokís
(
tokís
Ë!(
ty≥
->
max_subblock_öputs
 +Åy≥->
max_subblock_ouçuts
 + 1 +

362 
	`¥ötf
("subblock wrongÖin count,Çetlist has %d,árchitectureás %d onÜine %d \n" ,

363 
	`Cou¡Tokís
(
tokís
Ë- 2, (
ty≥
->
max_subblock_öputs
 +Åy≥->
max_subblock_ouçuts
 + 1),

364 
löe
);

365 
	`exô
(1);

369 if(
LOAD
 =
∑ss
)

371 
scou¡
[
i
]++;

375 if(
MAP
 =
∑ss
)

377 
	`as£π
(
i
 < 
bcou¡
);

378 
	`as£π
(
m
 < 
scou¡
[
i
]);

379 
¶i°
[
i
][
m
].
«me
 = 
	`my_°rdup
(
tokís
[1]);

380 
k
 = 0; k < 
ty≥
->
max_subblock_öputs
;

381 ++
k
)

384 
l
 = 2 + 
k
;

386 
	`°∫cmp
("bÀ_", 
tokís
[
l
], 4))

388 
¶i°
[
i
][
m
].
öputs
[
k
] = 
ty≥
->
num_pös
 + 
	`my_©oi
(
tokís
[
l
] + 4);

391 
	`°rcmp
("›í", 
tokís
[
l
]))

393 
¶i°
[
i
][
m
].
öputs
[
k
] =

394 
	`my_©oi
(
tokís
[
l
]);

397 
k
 = 0; k < 
ty≥
->
max_subblock_ouçuts
;

398 ++
k
)

400 
l
 = 2 +

401 
ty≥
->
max_subblock_öputs
 + 
k
;

402 if(0 !
	`°rcmp
("›í", 
tokís
[
l
]))

404 
¶i°
[
i
][
m
].
ouçuts
[
k
] =

405 
	`my_©oi
(
tokís
[
l
]);

408 
l
 = 2 + 
ty≥
->
max_subblock_öputs
 +

409 
ty≥
->
max_subblock_ouçuts
;

410 if(0 !
	`°rcmp
("›í", 
tokís
[
l
]))

412 
¶i°
[
i
][
m
].
˛ock
 =

413 
	`my_©oi
(
tokís
[
l
]);

417 ++
m
;

419 
	`FªeTokís
(&
tokís
);

420 
tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

421 
¥ev_löe
 = 
löe
;

424 if(
∑ss
 > 
COUNT
)

427 if(
scou¡
[
i
] > 
ty≥
->
max_subblocks
)

429 
	`¥ötf
("toÿm™y subblock†⁄ block [%d] %s\n", 
i
, 
bli°
[i].
«me
);

430 
	`exô
(1);

434 ++
i
;

436 
	`FªeTokís
(&
block_tokís
);

437 
	`FªeTokís
(&
pö_tokís
);

438 
block_tokís
 = 
tokís
;

442 if(
COUNT
 =
∑ss
)

444 
bcou¡
 = 
i
;

445 
ncou¡
 = 
j
;

448 
	`f˛o£
(
öfûe
);

451 
	`sync_√ts_to_blocks
(
bcou¡
, 
bli°
, 
ncou¡
, 
∆i°
);

454 *
num_blocks
 = 
bcou¡
;

455 *
block_li°
 = 
bli°
;

456 *
num_√ts
 = 
ncou¡
;

457 *
√t_li°
 = 
∆i°
;

458 
subblock_d©a_±r
->
subblock_öf
 = 
¶i°
;

459 
subblock_d©a_±r
->
num_subblocks_≥r_block
 = 
scou¡
;

460 
	}
}

463 
t_ty≥_±r


464 
	$gë_ty≥_by_«me
(
IN
 c⁄° *
«me
,

465 
IN
 
num_ty≥s
,

466 
IN
 c⁄° 
s_ty≥_des¸ùt‹
 
block_ty≥s
[],

467 
IN
 
t_ty≥_±r
 
IO_ty≥
,

468 
IN
 c⁄° *
√t_fûe
,

469 
IN
 
löe
,

470 
OUT
 
•ecül_blk
 *
ovîide
)

474 
i
;

479 *
ovîide
 = 
NORMAL
;

482 if(0 =
	`°rcmp
(".öput", 
«me
))

484 *
ovîide
 = 
INPAD
;

485  
IO_ty≥
;

487 if(0 =
	`°rcmp
(".ouçut", 
«me
))

489 *
ovîide
 = 
OUTPAD
;

490  
IO_ty≥
;

495 
i
 = 0; i < 
num_ty≥s
; ++i)

497 if(0 =
	`°rcmp
(
block_ty≥s
[
i
].
«me
,Çame))

499  (
block_ty≥s
 + 
i
);

504 
	`¥ötf
(
ERRTAG
 "'%s':%d - Invalid blockÅype '%s'\n",

505 
√t_fûe
, 
löe
, 
«me
);

506 
	`exô
(1);

507 
	}
}

	@read_netlist.h

1 
ªad_√éi°
(
IN
 c⁄° *
√t_fûe
,

2 
IN
 
num_ty≥s
,

3 
IN
 c⁄° 
s_ty≥_des¸ùt‹
 
block_ty≥s
[],

4 
IN
 
t_ty≥_±r
 
IO_ty≥
,

5 
IN
 
io_ùö
,

6 
IN
 
io_›ö
,

7 
OUT
 
t_subblock_d©a
 * 
subblock_d©a_±r
,

8 
OUT
 *
num_blocks
,

9 
OUT
 
s_block
 *
block_li°
[],

10 
OUT
 *
num_√ts
,

11 
OUT
 
s_√t
 *
√t_li°
[]);

	@read_place.c

1 
	~<as£π.h
>

2 
	~<°dio.h
>

3 
	~<°rög.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"globÆs.h
"

7 
	~"hash.h
"

8 
	~"ªad_∂a˚.h
"

12 **
RódLöeTokís
(
INOUT
 
FILE
 * 
InFûe
,

13 
INOUT
 *
LöeNum
);

17 
	$ªad_∂a˚
(
IN
 c⁄° *
∂a˚_fûe
,

18 
IN
 c⁄° *
¨ch_fûe
,

19 
IN
 c⁄° *
√t_fûe
,

20 
IN
 
nx
,

21 
IN
 
ny
,

22 
IN
 
num_blocks
,

23 
INOUT
 
s_block
 
block_li°
[])

26 
FILE
 *
öfûe
;

27 **
tokís
;

28 
löe
;

29 
i
;

30 
îr‹
;

31 
s_block
 *
cur_blk
;

33 
öfûe
 = 
	`my_f›í
(
∂a˚_fûe
, "r");

36 
tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

37 
îr‹
 = 0;

38 if(
NULL
 =
tokís
)

40 
îr‹
 = 1;

42 
i
 = 0; i < 6; ++i)

44 if(!
îr‹
)

46 if(
NULL
 =
tokís
[
i
])

48 
îr‹
 = 1;

52 if(!
îr‹
)

54 if((0 !
	`°rcmp
(
tokís
[0], "Netlist")) ||

55 (0 !
	`°rcmp
(
tokís
[1], "file:")) ||

56 (0 !
	`°rcmp
(
tokís
[3], "Architecture")) ||

57 (0 !
	`°rcmp
(
tokís
[4], "file:")))

59 
îr‹
 = 1;

62 if(
îr‹
)

64 
	`¥ötf
(
ERRTAG


66 
∂a˚_fûe
);

67 
	`exô
(1);

69 if(0 !
	`°rcmp
(
tokís
[2], 
¨ch_fûe
))

71 
	`¥ötf
(
ERRTAG


73 "nŸ m©ch cuºíà¨chôe˘uª fûê(%s)\n", 
∂a˚_fûe
,

74 
tokís
[2], 
¨ch_fûe
);

75 
	`exô
(1);

77 if(0 !
	`°rcmp
(
tokís
[5], 
√t_fûe
))

79 
	`¥ötf
(
ERRTAG


81 "nŸ m©ch cuºíà√éi° fûê(%s)\n", 
∂a˚_fûe
,

82 
tokís
[5], 
√t_fûe
);

83 
	`exô
(1);

87 
tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

88 
îr‹
 = 0;

89 if(
NULL
 =
tokís
)

91 
îr‹
 = 1;

93 
i
 = 0; i < 7; ++i)

95 if(!
îr‹
)

97 if(
NULL
 =
tokís
[
i
])

99 
îr‹
 = 1;

103 if(!
îr‹
)

105 if((0 !
	`°rcmp
(
tokís
[0], "Array")) ||

106 (0 !
	`°rcmp
(
tokís
[1], "size:")) ||

107 (0 !
	`°rcmp
(
tokís
[3], "x")) ||

108 (0 !
	`°rcmp
(
tokís
[5], "logic")) ||

109 (0 !
	`°rcmp
(
tokís
[6], "blocks")))

111 
îr‹
 = 1;

114 if(
îr‹
)

116 
	`¥ötf
(
ERRTAG


118 
∂a˚_fûe
);

119 
	`exô
(1);

121 if((
	`my_©oi
(
tokís
[2]Ë!
nx
Ë|| (my_©oi—okís[4]Ë!
ny
))

123 
	`¥ötf
(
ERRTAG


125 "sizêwhíÖœ˚míàgíî©ed (%d x %d)\n", 
∂a˚_fûe
,

126 
nx
, 
ny
, 
	`my_©oi
(
tokís
[2]), my_atoi(tokens[4]));

127 
	`exô
(1);

130 
tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

131 
tokís
)

134 
cur_blk
 = 
NULL
;

135 
i
 = 0; i < 
num_blocks
; ++i)

137 if(0 =
	`°rcmp
(
block_li°
[
i
].
«me
, 
tokís
[0]))

139 
cur_blk
 = (
block_li°
 + 
i
);

145 if(
NULL
 =
cur_blk
)

147 
	`¥ötf
(
ERRTAG
 "'%s':%d - Block inÖlacement file does "

148 "nŸÉxi° i¿√éi°\n", 
∂a˚_fûe
, 
löe
);

149 
	`exô
(1);

153 
cur_blk
->
x
 = 
	`my_©oi
(
tokís
[1]);

154 
cur_blk
->
y
 = 
	`my_©oi
(
tokís
[2]);

155 
cur_blk
->
z
 = 
	`my_©oi
(
tokís
[3]);

158 
	`as£π
(*
tokís
);

159 
	`‰ì
(*
tokís
);

160 
	`‰ì
(
tokís
);

161 
tokís
 = 
	`RódLöeTokís
(
öfûe
, &
löe
);

164 
	`f˛o£
(
öfûe
);

165 
	}
}

168 
	$ªad_u£r_∑d_loc
(*
∑d_loc_fûe
)

173 
s_hash
 **
hash_èbÀ
, *
h_±r
;

174 
iblk
, 
i
, 
j
, 
xtmp
, 
ytmp
, 
bnum
, 
k
;

175 
FILE
 *
Â
;

176 
buf
[
BUFSIZE
], 
b«me
[BUFSIZE], *
±r
;

178 
	`¥ötf
("\nRódögÜoˇti⁄†o‡IOÖad†‰om %s.\n", 
∑d_loc_fûe
);

179 
löíum
 = 0;

180 
Â
 = 
	`my_f›í
(
∑d_loc_fûe
, "r");

182 
hash_èbÀ
 = 
	`Æloc_hash_èbÀ
();

183 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

185 if(
block
[
iblk
].
ty≥
 =
IO_TYPE
)

187 
h_±r
 =

188 
	`ö£π_ö_hash_èbÀ
(
hash_èbÀ
, 
block
[
iblk
].
«me
,

189 
iblk
);

190 
block
[
iblk
].
x
 = 
OPEN
;

194 
i
 = 0; i <
nx
 + 1; i++)

196 
j
 = 0; j <
ny
 + 1; j++)

198 if(
grid
[
i
][
j
].
ty≥
 =
IO_TYPE
)

200 
k
 = 0; k < 
IO_TYPE
->
ˇ∑côy
; k++)

201 
grid
[
i
][
j
].
blocks
[
k
] = 
OPEN
;

206 
±r
 = 
	`my_fgës
(
buf
, 
BUFSIZE
, 
Â
);

208 
±r
 !
NULL
)

210 
±r
 = 
	`my_°πok
(
buf
, 
TOKENS
, 
Â
, buf);

211 if(
±r
 =
NULL
)

213 
±r
 = 
	`my_fgës
(
buf
, 
BUFSIZE
, 
Â
);

217 
	`°r˝y
(
b«me
, 
±r
);

219 
±r
 = 
	`my_°πok
(
NULL
, 
TOKENS
, 
Â
, 
buf
);

220 if(
±r
 =
NULL
)

222 
	`¥ötf
("Eº‹:Üöê%d i†öcom∂ëe.\n", 
löíum
);

223 
	`exô
(1);

225 
	`ssˇnf
(
±r
, "%d", &
xtmp
);

227 
±r
 = 
	`my_°πok
(
NULL
, 
TOKENS
, 
Â
, 
buf
);

228 if(
±r
 =
NULL
)

230 
	`¥ötf
("Eº‹:Üöê%d i†öcom∂ëe.\n", 
löíum
);

231 
	`exô
(1);

233 
	`ssˇnf
(
±r
, "%d", &
ytmp
);

235 
±r
 = 
	`my_°πok
(
NULL
, 
TOKENS
, 
Â
, 
buf
);

236 if(
±r
 =
NULL
)

238 
	`¥ötf
("Eº‹:Üöê%d i†öcom∂ëe.\n", 
löíum
);

239 
	`exô
(1);

241 
	`ssˇnf
(
±r
, "%d", &
k
);

243 
±r
 = 
	`my_°πok
(
NULL
, 
TOKENS
, 
Â
, 
buf
);

244 if(
±r
 !
NULL
)

246 
	`¥ötf
("Error:Éxtra charactersátÉnd ofÜine %d.\n",

247 
löíum
);

248 
	`exô
(1);

251 
h_±r
 = 
	`gë_hash_íåy
(
hash_èbÀ
, 
b«me
);

252 if(
h_±r
 =
NULL
)

254 
	`¥ötf
("Error: block %s onÜine %d:Ço such IOÖad.\n",

255 
b«me
, 
löíum
);

256 
	`exô
(1);

258 
bnum
 = 
h_±r
->
ödex
;

259 
i
 = 
xtmp
;

260 
j
 = 
ytmp
;

262 if(
block
[
bnum
].
x
 !
OPEN
)

264 
¥ötf


266 
löíum
, 
b«me
);

267 
	`exô
(1);

270 if(
i
 < 0 || i > 
nx
 + 1 || 
j
 < 0 || j > 
ny
 + 1)

272 
	`¥ötf
("Eº‹: block #%d (%sËloˇti⁄\n", 
bnum
, 
b«me
);

273 
	`¥ötf
("(%d,%dËi†ouào‡ønge.\n", 
i
, 
j
);

274 
	`exô
(1);

277 
block
[
bnum
].
x
 = 
i
;

278 
block
[
bnum
].
y
 = 
j
;

280 if(
grid
[
i
][
j
].
ty≥
 !
IO_TYPE
)

282 
	`¥ötf
("Error:áttemptÅoÖlace IO block %s in \n",

283 
b«me
);

284 
	`¥ötf
("™ iŒegÆÜoˇti⁄ (%d, %d).\n", 
i
, 
j
);

285 
	`exô
(1);

288 if(
k
 >
IO_TYPE
->
ˇ∑côy
 || k < 0)

290 
¥ötf


292 "ønge.\n", 
b«me
, 
k
, 
löíum
);

293 
	`exô
(1);

295 
grid
[
i
][
j
].
blocks
[
k
] = 
bnum
;

296 
grid
[
i
][
j
].
ußge
++;

298 
±r
 = 
	`my_fgës
(
buf
, 
BUFSIZE
, 
Â
);

301 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

303 if(
block
[
iblk
].
ty≥
 =
IO_TYPE
 && block[iblk].
x
 =
OPEN
)

305 
¥ötf


307 "thê∑d fûe.\n", 
block
[
iblk
].
«me
);

308 
	`exô
(1);

312 
	`f˛o£
(
Â
);

313 
	`‰ì_hash_èbÀ
(
hash_èbÀ
);

314 
	`¥ötf
("Suc˚ssfuŒyÑód %s.\n\n", 
∑d_loc_fûe
);

315 
	}
}

319 
	$¥öt_∂a˚
(*
∂a˚_fûe
,

320 *
√t_fûe
,

321 *
¨ch_fûe
)

329 
FILE
 *
Â
;

330 
i
;

332 
Â
 = 
	`my_f›í
(
∂a˚_fûe
, "w");

334 
	`Ârötf
(
Â
, "Nëli° fûe: %† Archôe˘uª fûe: %s\n", 
√t_fûe
,

335 
¨ch_fûe
);

336 
	`Ârötf
(
Â
, "Aºay size: %d x %dÜogi¯blocks\n\n", 
nx
, 
ny
);

337 
	`Ârötf
(
Â
, "#blockÇame\tx\ty\tsubblk\tblockÇumber\n");

338 
	`Ârötf
(
Â
, "#----------\t--\t--\t------\t------------\n");

340 
i
 = 0; i < 
num_blocks
; i++)

342 
	`Ârötf
(
Â
, "%s\t", 
block
[
i
].
«me
);

343 if(
	`°æí
(
block
[
i
].
«me
) < 8)

344 
	`Ârötf
(
Â
, "\t");

346 
	`Ârötf
(
Â
, "%d\t%d\t%d", 
block
[
i
].
x
, block[i].
y
, block[i].
z
);

347 
	`Ârötf
(
Â
, "\t#%d\n", 
i
);

350 
	`f˛o£
(
Â
);

351 
	}
}

	@read_place.h

1 
ªad_∂a˚
(
IN
 c⁄° *
∂a˚_fûe
,

2 
IN
 c⁄° *
¨ch_fûe
,

3 
IN
 c⁄° *
√t_fûe
,

4 
IN
 
nx
,

5 
IN
 
ny
,

6 
IN
 
num_blocks
,

7 
INOUT
 
s_block
 
block_li°
[]);

9 
¥öt_∂a˚
(
IN
 *
∂a˚_fûe
,

10 
IN
 *
√t_fûe
,

11 
IN
 *
¨ch_fûe
);

13 
ªad_u£r_∑d_loc
(
IN
 *
∑d_loc_fûe
);

	@route_breadth_first.c

1 
	~<°dio.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"m°.h
"

6 
	~"rouã_exp‹t.h
"

7 
	~"rouã_comm⁄.h
"

8 
	~"rouã_bªadth_fú°.h
"

13 
boﬁón
 
bªadth_fú°_rouã_√t
(
öë
,

14 
bíd_co°
);

16 
bªadth_fú°_ex∑nd_åa˚_£gmít
(
s_åa˚
 *
°¨t_±r
,

18 
ªmaöög_c⁄√˘i⁄s_to_sök
);

20 
bªadth_fú°_ex∑nd_√ighbours
(
öode
,

21 
pco°
,

22 
öë
,

23 
bíd_co°
);

25 
bªadth_fú°_add_sour˚_to_hóp
(
öë
);

30 
boﬁón


31 
	$åy_bªadth_fú°_rouã
(
s_rouãr_›ts
 
rouãr_›ts
,

32 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

33 
width_Ác
)

40 
¥es_Ác
;

41 
boﬁón
 
suc˚ss
, 
is_rouèbÀ
, 
rù_up_loˇl_›ös
;

42 
ôry
, 
öë
;

48 
¥es_Ác
 = 
rouãr_›ts
.
fú°_ôî_¥es_Ác
;

50 
ôry
 = 1; iåy <
rouãr_›ts
.
max_rouãr_ôî©i⁄s
; itry++)

53 
öë
 = 0; i√à< 
num_√ts
; inet++)

55 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

58 
	`∑thfödî_upd©e_⁄e_co°
(
åa˚_hód
[
öë
], -1,

59 
¥es_Ác
);

61 
is_rouèbÀ
 =

62 
	`bªadth_fú°_rouã_√t
(
öë
,

63 
rouãr_›ts
.

64 
bíd_co°
);

68 if(!
is_rouèbÀ
)

70 
	`¥ötf
("Routing failed.\n");

71  (
FALSE
);

74 
	`∑thfödî_upd©e_⁄e_co°
(
åa˚_hód
[
öë
], 1,

75 
¥es_Ác
);

83 if(
ôry
 == 1)

84 
rù_up_loˇl_›ös
 = 
FALSE
;

86 
rù_up_loˇl_›ös
 = 
TRUE
;

88 
	`ª£rve_loˇŒy_u£d_›ös
(
¥es_Ác
, 
rù_up_loˇl_›ös
,

89 
fb_›ös_u£d_loˇŒy
);

91 
suc˚ss
 = 
	`„asibÀ_routög
();

92 if(
suc˚ss
)

94 
¥ötf


96 
ôry
);

97  (
TRUE
);

100 if(
ôry
 == 1)

101 
¥es_Ác
 = 
rouãr_›ts
.
öôül_¥es_Ác
;

103 
¥es_Ác
 *
rouãr_›ts
.
¥es_Ác_mu…
;

105 
¥es_Ác
 = 
	`mö
 (¥es_Ác, 
HUGE_FLOAT
 / 1e5);

107 
	`∑thfödî_upd©e_co°
(
¥es_Ác
, 
rouãr_›ts
.
acc_Ác
);

110 
	`¥ötf
("Routing failed.\n");

111  (
FALSE
);

112 
	}
}

115 
boﬁón


116 
	$bªadth_fú°_rouã_√t
(
öë
,

117 
bíd_co°
)

133 
i
, 
öode
, 
¥ev_node
, 
ªmaöög_c⁄√˘i⁄s_to_sök
;

134 
pco°
, 
√w_pco°
;

135 
s_hóp
 *
cuºít
;

136 
s_åa˚
 *
çå
;

138 
	`‰ì_åa˚back
(
öë
);

139 
	`bªadth_fú°_add_sour˚_to_hóp
(
öë
);

140 
	`m¨k_íds
(
öë
);

142 
çå
 = 
NULL
;

143 
ªmaöög_c⁄√˘i⁄s_to_sök
 = 0;

145 
i
 = 1; i <
√t
[
öë
].
num_söks
; i++)

147 
	`bªadth_fú°_ex∑nd_åa˚_£gmít
(
çå
,

148 
ªmaöög_c⁄√˘i⁄s_to_sök
);

149 
cuºít
 = 
	`gë_hóp_hód
();

151 if(
cuºít
 =
NULL
)

153 
	`ª£t_∑th_co°s
();

154  (
FALSE
);

157 
öode
 = 
cuºít
->
ödex
;

159 
º_node_rouã_öf
[
öode
].
èrgë_Êag
 == 0)

161 
pco°
 = 
º_node_rouã_öf
[
öode
].
∑th_co°
;

162 
√w_pco°
 = 
cuºít
->
co°
;

163 if(
pco°
 > 
√w_pco°
)

165 
º_node_rouã_öf
[
öode
].
∑th_co°
 = 
√w_pco°
;

166 
¥ev_node
 = 
cuºít
->
u
.prev_node;

167 
º_node_rouã_öf
[
öode
].
¥ev_node
 =Örev_node;

168 
º_node_rouã_öf
[
öode
].
¥ev_edge
 =

169 
cuºít
->
¥ev_edge
;

171 if(
pco°
 > 0.99 * 
HUGE_FLOAT
)

172 
	`add_to_mod_li°
(&
º_node_rouã_öf
[
öode
].

173 
∑th_co°
);

175 
	`bªadth_fú°_ex∑nd_√ighbours
(
öode
, 
√w_pco°
,

176 
öë
, 
bíd_co°
);

179 
	`‰ì_hóp_d©a
(
cuºít
);

180 
cuºít
 = 
	`gë_hóp_hód
();

182 if(
cuºít
 =
NULL
)

184 
	`ª£t_∑th_co°s
();

185  (
FALSE
);

188 
öode
 = 
cuºít
->
ödex
;

191 
º_node_rouã_öf
[
öode
].
èrgë_Êag
--;

192 
ªmaöög_c⁄√˘i⁄s_to_sök
 =

193 
º_node_rouã_öf
[
öode
].
èrgë_Êag
;

194 
çå
 = 
	`upd©e_åa˚back
(
cuºít
, 
öë
);

195 
	`‰ì_hóp_d©a
(
cuºít
);

198 
	`em±y_hóp
();

199 
	`ª£t_∑th_co°s
();

200  (
TRUE
);

201 
	}
}

205 
	$bªadth_fú°_ex∑nd_åa˚_£gmít
(
s_åa˚
 *
°¨t_±r
,

206 
ªmaöög_c⁄√˘i⁄s_to_sök
)

225 
s_åa˚
 *
çå
, *
√xt_±r
;

226 
öode
, 
sök_node
, 
œ°_ùö_node
;

228 
çå
 = 
°¨t_±r
;

230 if(
ªmaöög_c⁄√˘i⁄s_to_sök
 == 0)

232 
çå
 !
NULL
)

234 
	`node_to_hóp
(
çå
->
ödex
, 0., 
NO_PREVIOUS
, NO_PREVIOUS,

235 
OPEN
, OPEN);

236 
çå
 =Å±r->
√xt
;

249 if(
çå
 =
NULL
)

252 
√xt_±r
 = 
çå
->
√xt
;

253 
œ°_ùö_node
 = 
OPEN
;

259 
√xt_±r
 !
NULL
)

261 
öode
 = 
çå
->
ödex
;

262 
	`node_to_hóp
(
öode
, 0., 
NO_PREVIOUS
, NO_PREVIOUS, 
OPEN
,

263 
OPEN
);

265 if(
º_node
[
öode
].
ty≥
 =
IPIN
)

266 
œ°_ùö_node
 = 
öode
;

268 
çå
 = 
√xt_±r
;

269 
√xt_±r
 = 
çå
->
√xt
;

278 
º_node_rouã_öf
[
œ°_ùö_node
].
∑th_co°
 = -
HUGE_FLOAT
;

283 
sök_node
 = 
çå
->
ödex
;

284 
º_node_rouã_öf
[
sök_node
].
∑th_co°
 = 
HUGE_FLOAT
;

290 
	`övÆid©e_hóp_íåõs
(
sök_node
, 
œ°_ùö_node
);

292 
	}
}

296 
	$bªadth_fú°_ex∑nd_√ighbours
(
öode
,

297 
pco°
,

298 
öë
,

299 
bíd_co°
)

306 
ic⁄n
, 
to_node
, 
num_edges
;

307 
t_º_ty≥
 
‰om_ty≥
, 
to_ty≥
;

308 
tŸ_co°
;

310 
num_edges
 = 
º_node
[
öode
].num_edges;

311 
ic⁄n
 = 0; ic⁄¿< 
num_edges
; iconn++)

313 
to_node
 = 
º_node
[
öode
].
edges
[
ic⁄n
];

315 if(
º_node
[
to_node
].
xhigh
 < 
rouã_bb
[
öë
].
xmö
 ||

316 
º_node
[
to_node
].
xlow
 > 
rouã_bb
[
öë
].
xmax
 ||

317 
º_node
[
to_node
].
yhigh
 < 
rouã_bb
[
öë
].
ymö
 ||

318 
º_node
[
to_node
].
ylow
 > 
rouã_bb
[
öë
].
ymax
)

321 
tŸ_co°
 = 
pco°
 + 
	`gë_º_c⁄g_co°
(
to_node
);

323 if(
bíd_co°
 != 0.)

325 
‰om_ty≥
 = 
º_node
[
öode
].
ty≥
;

326 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

327 if((
‰om_ty≥
 =
CHANX
 && 
to_ty≥
 =
CHANY
) ||

328 (
‰om_ty≥
 =
CHANY
 && 
to_ty≥
 =
CHANX
))

329 
tŸ_co°
 +
bíd_co°
;

332 
	`node_to_hóp
(
to_node
, 
tŸ_co°
, 
öode
, 
ic⁄n
, 
OPEN
, OPEN);

334 
	}
}

338 
	$bªadth_fú°_add_sour˚_to_hóp
(
öë
)

343 
öode
;

344 
co°
;

346 
öode
 = 
√t_º_ãrmöÆs
[
öë
][0];

347 
co°
 = 
	`gë_º_c⁄g_co°
(
öode
);

349 
	`node_to_hóp
(
öode
, 
co°
, 
NO_PREVIOUS
, NO_PREVIOUS, 
OPEN
, OPEN);

350 
	}
}

	@route_breadth_first.h

1 
boﬁón
 
åy_bªadth_fú°_rouã
(
s_rouãr_›ts
 
rouãr_›ts
,

2 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

3 
width_Ác
);

	@route_common.c

1 
	~<m©h.h
>

2 
	~<°dio.h
>

3 
	~<as£π.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"v¥_utûs.h
"

7 
	~"globÆs.h
"

8 
	~"m°.h
"

9 
	~"rouã_exp‹t.h
"

10 
	~"rouã_comm⁄.h
"

11 
	~"rouã_åì_timög.h
"

12 
	~"rouã_timög.h
"

13 
	~"rouã_bªadth_fú°.h
"

14 
	~"rouã_dúe˘ed_£¨ch.h
"

15 
	~"∂a˚_™d_rouã.h
"

16 
	~"º_gøph.h
"

20 
t_º_node_rouã_öf
 *
	gº_node_rouã_öf
 = 
NULL
;

22 
s_bb
 *
	grouã_bb
 = 
NULL
;

29 
s_hóp
 **
	ghóp
;

30 
	ghóp_size
;

31 
	ghóp_èû
;

34 
s_hóp
 *
	ghóp_‰ì_hód
 = 
NULL
;

37 
s_åa˚
 *
	gåa˚_‰ì_hód
 = 
NULL
;

39 #ifde‡
DEBUG


40 
	gnum_åa˚_Æloˇãd
 = 0;

41 
	gnum_hóp_Æloˇãd
 = 0;

42 
	gnum_löked_f_poöãr_Æloˇãd
 = 0;

45 
s_löked_f_poöãr
 *
	gº_modifõd_hód
 = 
NULL
;

46 
s_löked_f_poöãr
 *
	glöked_f_poöãr_‰ì_hód
 = 
NULL
;

82 
‰ì_åa˚_d©a
(
s_åa˚
 *
çå
);

83 
lﬂd_rouã_bb
(
bb_Á˘‹
);

85 
s_åa˚
 *
Æloc_åa˚_d©a
();

86 
add_to_hóp
(
s_hóp
 *
h±r
);

87 
s_hóp
 *
Æloc_hóp_d©a
();

88 
s_löked_f_poöãr
 *
Æloc_löked_f_poöãr
();

90 
t_ivec
 **
Æloc_™d_lﬂd_˛b_›ös_u£d_loˇŒy
(
t_subblock_d©a


91 
subblock_d©a
);

92 
adju°_⁄e_º_occ_™d_pco°
(
öode
,

93 
add_‹_sub
,

94 
¥es_Ác
);

101 
	$ßve_routög
(
s_åa˚
 **
be°_routög
,

102 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

103 
t_ivec
 ** 
ßved_˛b_›ös_u£d_loˇŒy
)

114 
öë
, 
iblk
, 
i˛ass
, 
ùö
, 
num_loˇl_›ös
;

115 
s_åa˚
 *
çå
, *
ãmµå
;

116 
t_ty≥_±r
 
ty≥
;

118 
öë
 = 0; i√à< 
num_√ts
; inet++)

122 
çå
 = 
be°_routög
[
öë
];

123 
çå
 !
NULL
)

125 
ãmµå
 = 
çå
->
√xt
;

126 
	`‰ì_åa˚_d©a
(
çå
);

127 
çå
 = 
ãmµå
;

131 
be°_routög
[
öë
] = 
åa˚_hód
[inet];

136 
åa˚_hód
[
öë
] = 
NULL
;

137 
åa˚_èû
[
öë
] = 
NULL
;

142 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

144 
ty≥
 = 
block
[
iblk
].type;

145 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

147 
num_loˇl_›ös
 =

148 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

149 
ùö
 = 0; ipö < 
num_loˇl_›ös
; ipin++)

151 
ßved_˛b_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

152 
li°
[
ùö
] =

153 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

154 
li°
[
ùö
];

158 
	}
}

162 
	$ª°‹e_routög
(
s_åa˚
 **
be°_routög
,

163 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

164 
t_ivec
 ** 
ßved_˛b_›ös_u£d_loˇŒy
)

174 
öë
, 
iblk
, 
ùö
, 
i˛ass
, 
num_loˇl_›ös
;

175 
t_ty≥_±r
 
ty≥
;

177 
öë
 = 0; i√à< 
num_√ts
; inet++)

181 
	`‰ì_åa˚back
(
öë
);

184 
åa˚_hód
[
öë
] = 
be°_routög
[inet];

185 
be°_routög
[
öë
] = 
NULL
;

190 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

192 
ty≥
 = 
block
[
iblk
].type;

193 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

195 
num_loˇl_›ös
 =

196 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

197 
ùö
 = 0; ipö < 
num_loˇl_›ös
; ipin++)

199 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
li°
[
ùö
] =

200 
ßved_˛b_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

201 
li°
[
ùö
];

206 
	}
}

210 
	$gë_£rül_num
()

217 
öë
, 
£rül_num
, 
öode
;

218 
s_åa˚
 *
çå
;

220 
£rül_num
 = 0;

222 
öë
 = 0; i√à< 
num_√ts
; inet++)

228 
çå
 = 
åa˚_hód
[
öë
];

229 
çå
 !
NULL
)

231 
öode
 = 
çå
->
ödex
;

232 
£rül_num
 +=

233 (
öë
 + 1Ë* (
º_node
[
öode
].
xlow
 * (
nx
 + 1) -

234 
º_node
[
öode
].
yhigh
);

236 
£rül_num
 -
º_node
[
öode
].
±c_num
 * (
öë
 + 1) * 10;

238 
£rül_num
 -
º_node
[
öode
].
ty≥
 * (
öë
 + 1) * 100;

239 
£rül_num
 %= 2000000000;

240 
çå
 =Å±r->
√xt
;

243 
	`¥ötf
("SerialÇumber (magic cookie) forÅheÑouting is: %d\n",

244 
£rül_num
);

245 
	}
}

248 
boﬁón


249 
	$åy_rouã
(
width_Ác
,

250 
s_rouãr_›ts
 
rouãr_›ts
,

251 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

252 
t_£gmít_öf
 * 
£gmít_öf
,

253 
t_timög_öf
 
timög_öf
,

254 **
√t_¶ack
,

255 **
√t_dñay
,

256 
t_ch™_width_di°
 
ch™_width_di°
,

257 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

258 
t_m°_edge
 ** 
m°
,

259 
boﬁón
 * 
Fc_˛ù≥d
)

269 
tmp
;

270 
boﬁón
 
suc˚ss
;

271 
t_gøph_ty≥
 
gøph_ty≥
;

273 if(
rouãr_›ts
.
rouã_ty≥
 =
GLOBAL
) {

274 
gøph_ty≥
 = 
GRAPH_GLOBAL
;

276 
gøph_ty≥
 = (
dë_routög_¨ch
.
dúe˘i⁄Æôy
 ==

277 
BI_DIRECTIONAL
 ? 
GRAPH_BIDIR
 : 
GRAPH_UNIDIR
);

282 
	`öô_ch™
(
width_Ác
, 
ch™_width_di°
);

286 
	`‰ì_º_gøph
();

290 
	`buûd_º_gøph
(
gøph_ty≥
,

291 
num_ty≥s
, 
ty≥_des¸ùt‹s
, 
nx
, 
ny
, 
grid
,

292 
ch™_width_x
[0], 
NULL
,

293 
dë_routög_¨ch
.
swôch_block_ty≥
, dë_routög_¨ch.
Fs
,

294 
dë_routög_¨ch
.
num_£gmít
, dë_routög_¨ch.
num_swôch
, 
£gmít_öf
,

295 
dë_routög_¨ch
.
globÆ_rouã_swôch
,

296 
dë_routög_¨ch
.
dñayÀss_swôch
, 
timög_öf
,

297 
dë_routög_¨ch
.
wúe_to_ùö_swôch
,

298 
rouãr_›ts
.
ba£_co°_ty≥
, &
tmp
);

303 
	`Æloc_™d_lﬂd_º_node_rouã_°ru˘s
();

305 
	`öô_rouã_°ru˘s
(
rouãr_›ts
.
bb_Á˘‹
);

307 if(
rouãr_›ts
.
rouãr_Æg‹ôhm
 =
BREADTH_FIRST
)

309 
	`¥ötf
("Confirming Router Algorithm: BREADTH_FIRST.\n");

310 
suc˚ss
 =

311 
	`åy_bªadth_fú°_rouã
(
rouãr_›ts
, 
fb_›ös_u£d_loˇŒy
,

312 
width_Ác
);

314 if(
rouãr_›ts
.
rouãr_Æg‹ôhm
 =
TIMING_DRIVEN
)

316 
	`¥ötf
("Confirming Router Algorithm: TIMING_DRIVEN.\n");

317 
	`as£π
(
rouãr_›ts
.
rouã_ty≥
 !
GLOBAL
);

318 
suc˚ss
 =

319 
	`åy_timög_driví_rouã
(
rouãr_›ts
, 
√t_¶ack
, 
√t_dñay
,

320 
fb_›ös_u£d_loˇŒy
);

324 
	`¥ötf
("Confirming Router Algorithm: DIRECTED_SEARCH.\n");

325 
suc˚ss
 =

326 
	`åy_dúe˘ed_£¨ch_rouã
(
rouãr_›ts
, 
fb_›ös_u£d_loˇŒy
,

327 
width_Ác
, 
m°
);

330 
	`‰ì_º_node_rouã_°ru˘s
();

332  (
suc˚ss
);

333 
	}
}

336 
boﬁón


337 
	$„asibÀ_routög
()

344 
öode
;

346 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

347 if(
º_node
[
öode
].
occ
 >Ñr_node[öode].
ˇ∑côy
)

348  (
FALSE
);

350  (
TRUE
);

351 
	}
}

355 
	$∑thfödî_upd©e_⁄e_co°
(
s_åa˚
 *
rouã_£gmít_°¨t
,

356 
add_‹_sub
,

357 
¥es_Ác
)

368 
s_åa˚
 *
çå
;

369 
öode
, 
occ
, 
ˇ∑côy
;

371 
çå
 = 
rouã_£gmít_°¨t
;

372 if(
çå
 =
NULL
)

377 
öode
 = 
çå
->
ödex
;

379 
occ
 = 
º_node
[
öode
].oc¯+ 
add_‹_sub
;

380 
ˇ∑côy
 = 
º_node
[
öode
].capacity;

382 
º_node
[
öode
].
occ
 = occ;

388 if(
occ
 < 
ˇ∑côy
)

390 
º_node_rouã_öf
[
öode
].
¥es_co°
 = 1.;

394 
º_node_rouã_öf
[
öode
].
¥es_co°
 =

395 1. + (
occ
 + 1 - 
ˇ∑côy
Ë* 
¥es_Ác
;

398 if(
º_node
[
öode
].
ty≥
 =
SINK
)

400 
çå
 =Å±r->
√xt
;

401 if(
çå
 =
NULL
)

405 
çå
 =Å±r->
√xt
;

408 
	}
}

412 
	$∑thfödî_upd©e_co°
(
¥es_Ác
,

413 
acc_Ác
)

424 
öode
, 
occ
, 
ˇ∑côy
;

426 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

428 
occ
 = 
º_node
[
öode
].occ;

429 
ˇ∑côy
 = 
º_node
[
öode
].capacity;

431 if(
occ
 > 
ˇ∑côy
)

433 
º_node_rouã_öf
[
öode
].
acc_co°
 +=

434 (
occ
 - 
ˇ∑côy
Ë* 
acc_Ác
;

435 
º_node_rouã_öf
[
öode
].
¥es_co°
 =

436 1. + (
occ
 + 1 - 
ˇ∑côy
Ë* 
¥es_Ác
;

442 if(
occ
 =
ˇ∑côy
)

444 
º_node_rouã_öf
[
öode
].
¥es_co°
 = 1. + 
¥es_Ác
;

447 
	}
}

451 
	$öô_rouã_°ru˘s
(
bb_Á˘‹
)

457 
i
;

459 
i
 = 0; i < 
num_√ts
; i++)

460 
	`‰ì_åa˚back
(
i
);

462 
	`lﬂd_rouã_bb
(
bb_Á˘‹
);

467 if(
º_modifõd_hód
 !
NULL
)

469 
¥ötf


472 
	`exô
(1);

475 if(
hóp_èû
 != 1)

477 
	`¥ötf
("Error in init_route_structs. Heap isÇotÉmpty.\n");

478 
	`exô
(1);

480 
	}
}

483 
s_åa˚
 *

484 
	$upd©e_åa˚back
(
s_hóp
 *
h±r
,

485 
öë
)

501 
s_åa˚
 *
çå
, *
¥ev±r
, *
ãm±aû
, *
ªt_±r
;

502 
öode
;

503 
õdge
;

505 #ifde‡
DEBUG


506 
t_º_ty≥
 
º_ty≥
;

509 
öode
 = 
h±r
->
ödex
;

511 #ifde‡
DEBUG


512 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

513 if(
º_ty≥
 !
SINK
)

515 
	`¥ötf
("Error in update_traceback. ExpectedÅype = SINK (%d).\n",

516 
SINK
);

517 
	`¥ötf
("GŸÅy≥ = %d whûêåacög backÇë %d.\n", 
º_ty≥
,

518 
öë
);

519 
	`exô
(1);

523 
çå
 = 
	`Æloc_åa˚_d©a
();

524 
çå
->
ödex
 = 
öode
;

525 
çå
->
iswôch
 = 
OPEN
;

526 
çå
->
√xt
 = 
NULL
;

527 
ãm±aû
 = 
çå
;

532 
öode
 = 
h±r
->
u
.
¥ev_node
;

533 
õdge
 = 
h±r
->
¥ev_edge
;

535 
öode
 !
NO_PREVIOUS
)

537 
¥ev±r
 = 
	`Æloc_åa˚_d©a
();

538 
¥ev±r
->
ödex
 = 
öode
;

539 
¥ev±r
->
iswôch
 = 
º_node
[
öode
].
swôches
[
õdge
];

540 
¥ev±r
->
√xt
 = 
çå
;

541 
çå
 = 
¥ev±r
;

543 
õdge
 = 
º_node_rouã_öf
[
öode
].
¥ev_edge
;

544 
öode
 = 
º_node_rouã_öf
[öode].
¥ev_node
;

547 if(
åa˚_èû
[
öë
] !
NULL
)

549 
åa˚_èû
[
öë
]->
√xt
 = 
çå
;

550 
ªt_±r
 = 
çå
->
√xt
;

554 
åa˚_hód
[
öë
] = 
çå
;

555 
ªt_±r
 = 
çå
;

558 
åa˚_èû
[
öë
] = 
ãm±aû
;

559  (
ªt_±r
);

560 
	}
}

564 
	$ª£t_∑th_co°s
()

570 
s_löked_f_poöãr
 *
mod_±r
;

572 #ifde‡
DEBUG


573 
num_mod_±rs
;

578 if(
º_modifõd_hód
 !
NULL
)

580 
mod_±r
 = 
º_modifõd_hód
;

582 #ifde‡
DEBUG


583 
num_mod_±rs
 = 1;

586 
mod_±r
->
√xt
 !
NULL
)

588 *(
mod_±r
->
Âå
Ë
HUGE_FLOAT
;

589 
mod_±r
 = mod_±r->
√xt
;

590 #ifde‡
DEBUG


591 
num_mod_±rs
++;

594 *(
mod_±r
->
Âå
Ë
HUGE_FLOAT
;

599 
mod_±r
->
√xt
 = 
löked_f_poöãr_‰ì_hód
;

600 
löked_f_poöãr_‰ì_hód
 = 
º_modifõd_hód
;

601 
º_modifõd_hód
 = 
NULL
;

603 #ifde‡
DEBUG


604 
num_löked_f_poöãr_Æloˇãd
 -
num_mod_±rs
;

607 
	}
}

611 
	$gë_º_c⁄g_co°
(
öode
)

616 
co°_ödex
;

617 
co°
;

619 
co°_ödex
 = 
º_node
[
öode
].cost_index;

620 
co°
 = 
º_ödexed_d©a
[
co°_ödex
].
ba£_co°
 *

621 
º_node_rouã_öf
[
öode
].
acc_co°
 *

622 
º_node_rouã_öf
[
öode
].
¥es_co°
;

623  (
co°
);

624 
	}
}

628 
	$m¨k_íds
(
öë
)

637 
ùö
, 
öode
;

639 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

641 
öode
 = 
√t_º_ãrmöÆs
[
öë
][
ùö
];

642 
º_node_rouã_öf
[
öode
].
èrgë_Êag
++;

644 
	}
}

648 
	$node_to_hóp
(
öode
,

649 
co°
,

650 
¥ev_node
,

651 
¥ev_edge
,

652 
backw¨d_∑th_co°
,

653 
R_up°ªam
)

663 
s_hóp
 *
h±r
;

665 if(
co°
 >
º_node_rouã_öf
[
öode
].
∑th_co°
)

668 
h±r
 = 
	`Æloc_hóp_d©a
();

669 
h±r
->
ödex
 = 
öode
;

670 
h±r
->
co°
 = cost;

671 
h±r
->
u
.
¥ev_node
 =Örev_node;

672 
h±r
->
¥ev_edge
 =Örev_edge;

673 
h±r
->
backw¨d_∑th_co°
 = backward_path_cost;

674 
h±r
->
R_up°ªam
 = R_upstream;

675 
	`add_to_hóp
(
h±r
);

676 
	}
}

680 
	$‰ì_åa˚back
(
öë
)

686 
s_åa˚
 *
çå
, *
ãmµå
;

688 
çå
 = 
åa˚_hód
[
öë
];

690 
çå
 !
NULL
)

692 
ãmµå
 = 
çå
->
√xt
;

693 
	`‰ì_åa˚_d©a
(
çå
);

694 
çå
 = 
ãmµå
;

697 
åa˚_hód
[
öë
] = 
NULL
;

698 
åa˚_èû
[
öë
] = 
NULL
;

699 
	}
}

702 
t_ivec
 **

703 
	$Æloc_rouã_°ru˘s
(
t_subblock_d©a
 
subblock_d©a
)

708 
t_ivec
 **
fb_›ös_u£d_loˇŒy
;

710 
åa˚_hód
 = (
s_åa˚
 **)
	`my_ˇŒoc
(
num_√ts
,

711 (
s_åa˚
 *));

712 
åa˚_èû
 = (
s_åa˚
 **)
	`my_mÆloc
(
num_√ts
 *

713 (
s_åa˚
 *));

715 
hóp_size
 = 
nx
 * 
ny
;

716 
hóp
 = (
s_hóp
 **)
	`my_mÆloc
(
hóp_size
 * (s_heap *));

717 
hóp
--;

718 
hóp_èû
 = 1;

720 
rouã_bb
 = (
s_bb
 *)
	`my_mÆloc
(
num_√ts
 * (s_bb));

722 
fb_›ös_u£d_loˇŒy
 =

723 
	`Æloc_™d_lﬂd_˛b_›ös_u£d_loˇŒy
(
subblock_d©a
);

725  (
fb_›ös_u£d_loˇŒy
);

726 
	}
}

729 
s_åa˚
 **

730 
	$Æloc_ßved_routög
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

731 
t_ivec
 *** 
ßved_˛b_›ös_u£d_loˇŒy_±r
)

738 
s_åa˚
 **
be°_routög
;

739 
t_ivec
 **
ßved_˛b_›ös_u£d_loˇŒy
;

740 
iblk
, 
i˛ass
, 
num_loˇl_›ös
;

741 
t_ty≥_±r
 
ty≥
;

743 
be°_routög
 = (
s_åa˚
 **)
	`my_ˇŒoc
(
num_√ts
,

744 (
s_åa˚
 *));

746 
ßved_˛b_›ös_u£d_loˇŒy
 =

747 (
t_ivec
 **Ë
	`my_mÆloc
(
num_blocks
 * (t_ivec *));

749 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

751 
ty≥
 = 
block
[
iblk
].type;

752 
ßved_˛b_›ös_u£d_loˇŒy
[
iblk
] =

753 (
t_ivec
 *Ë
	`my_mÆloc
(
ty≥
->
num_˛ass
 * (t_ivec));

754 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

756 
num_loˇl_›ös
 =

757 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

758 
ßved_˛b_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
 =

759 
num_loˇl_›ös
;

761 if(
num_loˇl_›ös
 == 0)

763 
ßved_˛b_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
li°
 =

764 
NULL
;

768 
ßved_˛b_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
li°
 =

769 (*)
	`my_mÆloc
(
num_loˇl_›ös
 *

775 *
ßved_˛b_›ös_u£d_loˇŒy_±r
 = 
ßved_˛b_›ös_u£d_loˇŒy
;

776  (
be°_routög
);

777 
	}
}

780 
t_ivec
 **

781 
	$Æloc_™d_lﬂd_˛b_›ös_u£d_loˇŒy
(
t_subblock_d©a
 
subblock_d©a
)

788 
t_ivec
 **
fb_›ös_u£d_loˇŒy
;

789 *
num_subblocks_≥r_block
;

790 
t_subblock
 **
subblock_öf
;

791 
iblk
, 
isub
, 
˛b_pö
, 
›ö
, 
i˛ass
, 
num_loˇl_›ös
;

792 
˛ass_low
, 
˛ass_high
;

793 
t_ty≥_±r
 
ty≥
;

795 
fb_›ös_u£d_loˇŒy
 =

796 (
t_ivec
 **Ë
	`my_mÆloc
(
num_blocks
 * (t_ivec *));

797 
num_subblocks_≥r_block
 = 
subblock_d©a
.num_subblocks_per_block;

798 
subblock_öf
 = 
subblock_d©a
.subblock_inf;

800 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

802 
ty≥
 = 
block
[
iblk
].type;

803 
	`gë_˛ass_ønge_f‹_block
(
iblk
, &
˛ass_low
, &
˛ass_high
);

804 
fb_›ös_u£d_loˇŒy
[
iblk
] =

805 (
t_ivec
 *Ë
	`my_mÆloc
(
ty≥
->
num_˛ass
 * (t_ivec));

806 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

807 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
 = 0;

809 
isub
 = 0; isub < 
num_subblocks_≥r_block
[
iblk
]; isub++)

811 
›ö
 = 0;

812 
›ö
 < 
block
[
iblk
].
ty≥
->
max_subblock_ouçuts
; opin++)

814 
˛b_pö
 = 
subblock_öf
[
iblk
][
isub
].
ouçuts
[
›ö
];

817 if(
˛b_pö
 !
OPEN


818 && 
block
[
iblk
].
√ts
[
˛b_pö
] =
OPEN
)

820 
i˛ass
 = 
ty≥
->
pö_˛ass
[
˛b_pö
];

822 
	`as£π
(
i˛ass
 >
˛ass_low


823 && 
i˛ass
 <
˛ass_high
);

824 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

825 
√Àm
++;

830 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

832 
num_loˇl_›ös
 =

833 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

835 if(
num_loˇl_›ös
 == 0)

836 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
li°
 = 
NULL
;

838 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
li°
 =

839 (*)
	`my_mÆloc
(
num_loˇl_›ös
 * ());

843  (
fb_›ös_u£d_loˇŒy
);

844 
	}
}

847 
	$‰ì_åa˚_°ru˘s
()

852 
i
;

854 
i
 = 0; i < 
num_√ts
; i++)

855 
	`‰ì_åa˚back
(
i
);

857 
	`‰ì
(
åa˚_hód
);

858 
	`‰ì
(
åa˚_èû
);

859 
åa˚_hód
 = 
NULL
;

860 
åa˚_èû
 = 
NULL
;

861 
	}
}

864 
	$‰ì_rouã_°ru˘s
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
)

869 
i
;

871 
	`‰ì
(
hóp
 + 1);

872 
	`‰ì
(
rouã_bb
);

874 
hóp
 = 
NULL
;

875 
rouã_bb
 = 
NULL
;

877 
i
 = 0; i < 
num_blocks
; i++)

879 
	`‰ì_ivec_ve˘‹
(
fb_›ös_u£d_loˇŒy
[
i
], 0,

880 
block
[
i
].
ty≥
->
num_˛ass
 - 1);

882 
	`‰ì
(
fb_›ös_u£d_loˇŒy
);

887 
	}
}

891 
	$‰ì_ßved_routög
(
s_åa˚
 **
be°_routög
,

892 
t_ivec
 ** 
ßved_˛b_›ös_u£d_loˇŒy
)

896 
i
;

898 
	`‰ì
(
be°_routög
);

899 
i
 = 0; i < 
num_blocks
; i++)

901 
	`‰ì_ivec_ve˘‹
(
ßved_˛b_›ös_u£d_loˇŒy
[
i
], 0,

902 
block
[
i
].
ty≥
->
num_˛ass
 - 1);

904 
	`‰ì
(
ßved_˛b_›ös_u£d_loˇŒy
);

905 
	}
}

909 
	$Æloc_™d_lﬂd_º_node_rouã_°ru˘s
()

915 
öode
;

917 if(
º_node_rouã_öf
 !
NULL
)

919 
	`¥ötf
("Error inálloc_and_load_rr_node_route_structs: \n"

921 
	`exô
(1);

924 
º_node_rouã_öf
 = 
	`my_mÆloc
(
num_º_nodes
 * (
t_º_node_rouã_öf
));

926 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

928 
º_node_rouã_öf
[
öode
].
¥ev_node
 = 
NO_PREVIOUS
;

929 
º_node_rouã_öf
[
öode
].
¥ev_edge
 = 
NO_PREVIOUS
;

930 
º_node_rouã_öf
[
öode
].
¥es_co°
 = 1.;

931 
º_node_rouã_öf
[
öode
].
acc_co°
 = 1.;

932 
º_node_rouã_öf
[
öode
].
∑th_co°
 = 
HUGE_FLOAT
;

933 
º_node_rouã_öf
[
öode
].
èrgë_Êag
 = 0;

935 
	}
}

939 
	$‰ì_º_node_rouã_°ru˘s
()

945 
	`‰ì
(
º_node_rouã_öf
);

946 
º_node_rouã_öf
 = 
NULL
;

947 
	}
}

951 
	$lﬂd_rouã_bb
(
bb_Á˘‹
)

965 
k
, 
xmax
, 
ymax
, 
xmö
, 
ymö
, 
x
, 
y
, 
öë
;

967 
öë
 = 0; i√à< 
num_√ts
; inet++)

969 
x
 = 
block
[
√t
[
öë
].
node_block
[0]].x;

970 
y
 = 
block
[
√t
[
öë
].
node_block
[0]].y;

972 
xmö
 = 
x
;

973 
ymö
 = 
y
;

974 
xmax
 = 
x
;

975 
ymax
 = 
y
;

977 
k
 = 1; k <
√t
[
öë
].
num_söks
; k++)

979 
x
 = 
block
[
√t
[
öë
].
node_block
[
k
]].x;

980 
y
 = 
block
[
√t
[
öë
].
node_block
[
k
]].y;

982 if(
x
 < 
xmö
)

984 
xmö
 = 
x
;

986 if(
x
 > 
xmax
)

988 
xmax
 = 
x
;

991 if(
y
 < 
ymö
)

993 
ymö
 = 
y
;

995 if(
y
 > 
ymax
)

997 
ymax
 = 
y
;

1003 
xmö
 -= 1;

1004 
ymö
 -= 1;

1009 
rouã_bb
[
öë
].
xmö
 = 
	`max
(xmö - 
bb_Á˘‹
, 0);

1010 
rouã_bb
[
öë
].
xmax
 = 
	`mö
(xmax + 
bb_Á˘‹
, 
nx
 + 1);

1011 
rouã_bb
[
öë
].
ymö
 = 
	`max
(ymö - 
bb_Á˘‹
, 0);

1012 
rouã_bb
[
öë
].
ymax
 = 
	`mö
(ymax + 
bb_Á˘‹
, 
ny
 + 1);

1014 
	}
}

1018 
	$add_to_mod_li°
(*
Âå
)

1025 
s_löked_f_poöãr
 *
mod_±r
;

1027 
mod_±r
 = 
	`Æloc_löked_f_poöãr
();

1031 
mod_±r
->
√xt
 = 
º_modifõd_hód
;

1032 
mod_±r
->
Âå
 = fptr;

1033 
º_modifõd_hód
 = 
mod_±r
;

1034 
	}
}

1038 
	$add_to_hóp
(
s_hóp
 *
h±r
)

1043 
ôo
, 
i‰om
;

1044 
s_hóp
 *
ãmp_±r
;

1046 if(
hóp_èû
 > 
hóp_size
)

1048 
hóp_size
 *= 2;

1049 
hóp
 = 
	`my_ªÆloc
((*)(hó∞+ 1), 
hóp_size
 *

1050 (
s_hóp
 *));

1051 
hóp
--;

1054 
hóp
[
hóp_èû
] = 
h±r
;

1055 
i‰om
 = 
hóp_èû
;

1056 
ôo
 = 
i‰om
 / 2;

1057 
hóp_èû
++;

1059 (
ôo
 >1Ë&& (
hóp
[
i‰om
]->
co°
 < heap[ito]->cost))

1061 
ãmp_±r
 = 
hóp
[
ôo
];

1062 
hóp
[
ôo
] = hóp[
i‰om
];

1063 
hóp
[
i‰om
] = 
ãmp_±r
;

1064 
i‰om
 = 
ôo
;

1065 
ôo
 = 
i‰om
 / 2;

1067 
	}
}

1070 
boﬁón


1071 
	$is_em±y_hóp
()

1073  (
hóp_èû
 == 1);

1074 
	}
}

1076 
s_hóp
 *

1077 
	$gë_hóp_hód
()

1084 
ôo
, 
i‰om
;

1085 
s_hóp
 *
hóp_hód
, *
ãmp_±r
;

1089 if(
hóp_èû
 == 1)

1091 
	`¥ötf
("Empty heap occurred in get_heap_head.\n");

1092 
¥ötf


1094  (
NULL
);

1097 
hóp_hód
 = 
hóp
[1];

1101 
hóp_èû
--;

1102 
hóp
[1] = hóp[
hóp_èû
];

1103 
i‰om
 = 1;

1104 
ôo
 = 2 * 
i‰om
;

1106 
ôo
 < 
hóp_èû
)

1108 if(
hóp
[
ôo
 + 1]->
co°
 < heap[ito]->cost)

1109 
ôo
++;

1110 if(
hóp
[
ôo
]->
co°
 > hóp[
i‰om
]->cost)

1112 
ãmp_±r
 = 
hóp
[
ôo
];

1113 
hóp
[
ôo
] = hóp[
i‰om
];

1114 
hóp
[
i‰om
] = 
ãmp_±r
;

1115 
i‰om
 = 
ôo
;

1116 
ôo
 = 2 * 
i‰om
;

1120 
hóp_hód
->
ödex
 =
OPEN
);

1122  (
hóp_hód
);

1123 
	}
}

1127 
	$em±y_hóp
()

1130 
i
;

1132 
i
 = 1; i < 
hóp_èû
; i++)

1133 
	`‰ì_hóp_d©a
(
hóp
[
i
]);

1135 
hóp_èû
 = 1;

1136 
	}
}

1138 
	#NCHUNK
 200

	)

1141 
s_hóp
 *

1142 
	$Æloc_hóp_d©a
()

1145 
i
;

1146 
s_hóp
 *
ãmp_±r
;

1148 if(
hóp_‰ì_hód
 =
NULL
)

1150 
hóp_‰ì_hód
 = (
s_hóp
 *)
	`my_mÆloc
(
NCHUNK
 *

1152 
s_hóp
));

1158 
i
 = 0; i < 
NCHUNK
 - 1; i++)

1159 (
hóp_‰ì_hód
 + 
i
)->
u
.
√xt
 = heap_free_head + i + 1;

1160 (
hóp_‰ì_hód
 + 
NCHUNK
 - 1)->
u
.
√xt
 = 
NULL
;

1163 
ãmp_±r
 = 
hóp_‰ì_hód
;

1164 
hóp_‰ì_hód
 = hóp_‰ì_hód->
u
.
√xt
;

1165 #ifde‡
DEBUG


1166 
num_hóp_Æloˇãd
++;

1168  (
ãmp_±r
);

1169 
	}
}

1173 
	$‰ì_hóp_d©a
(
s_hóp
 *
h±r
)

1176 
h±r
->
u
.
√xt
 = 
hóp_‰ì_hód
;

1177 
hóp_‰ì_hód
 = 
h±r
;

1178 #ifde‡
DEBUG


1179 
num_hóp_Æloˇãd
--;

1181 
	}
}

1185 
	$övÆid©e_hóp_íåõs
(
sök_node
,

1186 
ùö_node
)

1193 
i
;

1195 
i
 = 1; i < 
hóp_èû
; i++)

1197 if(
hóp
[
i
]->
ödex
 =
sök_node


1198 && 
hóp
[
i
]->
u
.
¥ev_node
 =
ùö_node
)

1199 
hóp
[
i
]->
ödex
 = 
OPEN
;

1201 
	}
}

1204 
s_åa˚
 *

1205 
	$Æloc_åa˚_d©a
()

1208 
i
;

1209 
s_åa˚
 *
ãmp_±r
;

1211 if(
åa˚_‰ì_hód
 =
NULL
)

1213 
åa˚_‰ì_hód
 = (
s_åa˚
 *)
	`my_mÆloc
(
NCHUNK
 *

1215 
s_åa˚
));

1221 
i
 = 0; i < 
NCHUNK
 - 1; i++)

1222 (
åa˚_‰ì_hód
 + 
i
)->
√xt
 =Årace_free_head + i + 1;

1223 (
åa˚_‰ì_hód
 + 
NCHUNK
 - 1)->
√xt
 = 
NULL
;

1225 
ãmp_±r
 = 
åa˚_‰ì_hód
;

1226 
åa˚_‰ì_hód
 =Åø˚_‰ì_hód->
√xt
;

1227 #ifde‡
DEBUG


1228 
num_åa˚_Æloˇãd
++;

1230  (
ãmp_±r
);

1231 
	}
}

1235 
	$‰ì_åa˚_d©a
(
s_åa˚
 *
çå
)

1240 
çå
->
√xt
 = 
åa˚_‰ì_hód
;

1241 
åa˚_‰ì_hód
 = 
çå
;

1242 #ifde‡
DEBUG


1243 
num_åa˚_Æloˇãd
--;

1245 
	}
}

1248 
s_löked_f_poöãr
 *

1249 
	$Æloc_löked_f_poöãr
()

1255 
i
;

1256 
s_löked_f_poöãr
 *
ãmp_±r
;

1258 if(
löked_f_poöãr_‰ì_hód
 =
NULL
)

1261 
löked_f_poöãr_‰ì_hód
 = (
s_löked_f_poöãr
 *)

1262 
	`my_mÆloc
(
NCHUNK
 * (
s_löked_f_poöãr
));

1268 
i
 = 0; i < 
NCHUNK
 - 1; i++)

1270 (
löked_f_poöãr_‰ì_hód
 + 
i
)->
√xt
 =

1271 
löked_f_poöãr_‰ì_hód
 + 
i
 + 1;

1273 (
löked_f_poöãr_‰ì_hód
 + 
NCHUNK
 - 1)->
√xt
 = 
NULL
;

1276 
ãmp_±r
 = 
löked_f_poöãr_‰ì_hód
;

1277 
löked_f_poöãr_‰ì_hód
 =Üöked_f_poöãr_‰ì_hód->
√xt
;

1279 #ifde‡
DEBUG


1280 
num_löked_f_poöãr_Æloˇãd
++;

1283  (
ãmp_±r
);

1284 
	}
}

1288 
	$¥öt_rouã
(*
rouã_fûe
)

1293 
öë
, 
öode
, 
ùö
, 
bnum
, 
ûow
, 
jlow
, 
node_block_pö
, 
i˛ass
;

1294 
t_º_ty≥
 
º_ty≥
;

1295 
s_åa˚
 *
çå
;

1296 *
«me_ty≥
[] =

1298 
FILE
 *
Â
;

1300 
Â
 = 
	`my_f›í
(
rouã_fûe
, "w");

1302 
	`Ârötf
(
Â
, "Aºay size: %d x %dÜogi¯blocks.\n", 
nx
, 
ny
);

1303 
	`Ârötf
(
Â
, "\nRouting:");

1304 
öë
 = 0; i√à< 
num_√ts
; inet++)

1306 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

1308 
	`Ârötf
(
Â
, "\n\nNë %d (%s)\n\n", 
öë
, 
√t
[öë].
«me
);

1309 
çå
 = 
åa˚_hód
[
öë
];

1311 
çå
 !
NULL
)

1313 
öode
 = 
çå
->
ödex
;

1314 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

1315 
ûow
 = 
º_node
[
öode
].
xlow
;

1316 
jlow
 = 
º_node
[
öode
].
ylow
;

1318 
	`Ârötf
(
Â
, "%6†(%d,%dË", 
«me_ty≥
[
º_ty≥
],

1319 
ûow
, 
jlow
);

1321 if((
ûow
 !
º_node
[
öode
].
xhigh
Ë|| (
jlow
 !=

1322 
º_node


1323 [
öode
].

1324 
yhigh
))

1325 
	`Ârötf
(
Â
, "to (%d,%d) ",

1326 
º_node
[
öode
].
xhigh
,

1327 
º_node
[
öode
].
yhigh
);

1329 
º_ty≥
)

1332 
IPIN
:

1333 
OPIN
:

1334 if(
grid
[
ûow
][
jlow
].
ty≥
 =
IO_TYPE
)

1336 
	`Ârötf
(
Â
, " Pad: ");

1340 
	`Ârötf
(
Â
, " Pin: ");

1344 
CHANX
:

1345 
CHANY
:

1346 
	`Ârötf
(
Â
, " Track: ");

1349 
SOURCE
:

1350 
SINK
:

1351 if(
grid
[
ûow
][
jlow
].
ty≥
 =
IO_TYPE
)

1353 
	`Ârötf
(
Â
, " Pad: ");

1357 
	`Ârötf
(
Â
, " Class: ");

1362 
¥ötf


1364 "ty≥: %d (%s).\n", 
º_ty≥
,

1365 
«me_ty≥
[
º_ty≥
]);

1366 
	`exô
(1);

1370 
	`Ârötf
(
Â
, "%d ", 
º_node
[
öode
].
±c_num
);

1376 
	`Ârötf
(
Â
, "\n");

1378 
çå
 =Å±r->
√xt
;

1384 
	`Ârötf
(
Â
, "\n\nNet %d (%s): globalÇet connecting:\n\n",

1385 
öë
, 
√t
[öë].
«me
);

1387 
ùö
 = 0; ipö <
√t
[
öë
].
num_söks
; ipin++)

1389 
bnum
 = 
√t
[
öë
].
node_block
[
ùö
];

1391 
node_block_pö
 = 
√t
[
öë
].node_block_pö[
ùö
];

1392 
i˛ass
 =

1393 
block
[
bnum
].
ty≥
->
pö_˛ass
[
node_block_pö
];

1395 
	`Ârötf
(
Â
,

1397 
block
[
bnum
].
«me
, bnum, block[bnum].
x
,

1398 
block
[
bnum
].
y
, 
i˛ass
);

1403 
	`f˛o£
(
Â
);

1405 #ifde‡
CREATE_ECHO_FILES


1406 
Â
 = 
	`my_f›í
("mem.echo", "w");

1407 
	`Ârötf
(
Â
, "\nNum_heap_allocated: %d Num_trace_allocated: %d\n",

1408 
num_hóp_Æloˇãd
, 
num_åa˚_Æloˇãd
);

1409 
	`Ârötf
(
Â
, "Num_linked_f_pointer_allocated: %d\n",

1410 
num_löked_f_poöãr_Æloˇãd
);

1411 
	`f˛o£
(
Â
);

1414 
	}
}

1418 
	$ª£rve_loˇŒy_u£d_›ös
(
¥es_Ác
,

1419 
boﬁón
 
rù_up_loˇl_›ös
,

1420 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
)

1431 
iblk
, 
num_loˇl_›ö
, 
öode
, 
‰om_node
, 
ic⁄n
, 
num_edges
, 
to_node
;

1432 
i˛ass
, 
ùö
;

1433 
co°
;

1434 
s_hóp
 *
hóp_hód_±r
;

1435 
t_ty≥_±r
 
ty≥
;

1437 if(
rù_up_loˇl_›ös
)

1439 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

1441 
ty≥
 = 
block
[
iblk
].type;

1442 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

1444 
num_loˇl_›ö
 =

1445 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

1447 
ùö
 = 0; ipö < 
num_loˇl_›ö
; ipin++)

1449 
öode
 =

1450 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

1451 
li°
[
ùö
];

1452 
	`adju°_⁄e_º_occ_™d_pco°
(
öode
, -1,

1453 
¥es_Ác
);

1459 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

1461 
ty≥
 = 
block
[
iblk
].type;

1462 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

1464 
num_loˇl_›ö
 =

1465 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].
√Àm
;

1468 if(
num_loˇl_›ö
 != 0)

1470 
‰om_node
 = 
º_blk_sour˚
[
iblk
][
i˛ass
];

1471 
num_edges
 = 
º_node
[
‰om_node
].num_edges;

1472 
ic⁄n
 = 0; ic⁄¿< 
num_edges
; iconn++)

1474 
to_node
 = 
º_node
[
‰om_node
].
edges
[
ic⁄n
];

1475 
co°
 = 
	`gë_º_c⁄g_co°
(
to_node
);

1476 
	`node_to_hóp
(
to_node
, 
co°
, 
OPEN
, OPEN,

1480 
ùö
 = 0; ipö < 
num_loˇl_›ö
; ipin++)

1482 
hóp_hód_±r
 = 
	`gë_hóp_hód
();

1483 
öode
 = 
hóp_hód_±r
->
ödex
;

1484 
	`adju°_⁄e_º_occ_™d_pco°
(
öode
, 1,

1485 
¥es_Ác
);

1486 
fb_›ös_u£d_loˇŒy
[
iblk
][
i˛ass
].

1487 
li°
[
ùö
] = 
öode
;

1488 
	`‰ì_hóp_d©a
(
hóp_hód_±r
);

1491 
	`em±y_hóp
();

1495 
	}
}

1499 
	$adju°_⁄e_º_occ_™d_pco°
(
öode
,

1500 
add_‹_sub
,

1501 
¥es_Ác
)

1507 
occ
, 
ˇ∑côy
;

1509 
occ
 = 
º_node
[
öode
].oc¯+ 
add_‹_sub
;

1510 
ˇ∑côy
 = 
º_node
[
öode
].capacity;

1511 
º_node
[
öode
].
occ
 = occ;

1513 if(
occ
 < 
ˇ∑côy
)

1515 
º_node_rouã_öf
[
öode
].
¥es_co°
 = 1.;

1519 
º_node_rouã_öf
[
öode
].
¥es_co°
 = 1. + (
occ
 + 1 - 
ˇ∑côy
) *

1520 
¥es_Ác
;

1522 
	}
}

	@route_common.h

3 
	ss_hóp


5 
	mödex
;

6 
	mco°
;

9 
	m¥ev_node
;

10 
s_hóp
 *
	m√xt
;

12 
	mu
;

13 
	m¥ev_edge
;

14 
	mbackw¨d_∑th_co°
;

15 
	mR_up°ªam
;

40 
	m¥ev_node
;

41 
	m¥es_co°
;

42 
	macc_co°
;

43 
	m∑th_co°
;

44 
	mbackw¨d_∑th_co°
;

45 
	m¥ev_edge
;

46 
	mèrgë_Êag
;

48 
	tt_º_node_rouã_öf
;

73 
t_º_node_rouã_öf
 *
º_node_rouã_öf
;

74 
s_bb
 *
rouã_bb
;

78 
∑thfödî_upd©e_⁄e_co°
(
s_åa˚
 *
rouã_£gmít_°¨t
,

79 
add_‹_sub
,

80 
¥es_Ác
);

82 
∑thfödî_upd©e_co°
(
¥es_Ác
,

83 
acc_Ác
);

85 
s_åa˚
 *
upd©e_åa˚back
(
s_hóp
 *
h±r
,

86 
öë
);

88 
ª£t_∑th_co°s
();

90 
gë_º_c⁄g_co°
(
öode
);

92 
m¨k_íds
(
öë
);

94 
node_to_hóp
(
öode
,

95 
co°
,

96 
¥ev_node
,

97 
¥ev_edge
,

98 
backw¨d_∑th_co°
,

99 
R_up°ªam
);

101 
boﬁón
 
is_em±y_hóp
();

103 
‰ì_åa˚back
(
öë
);

105 
add_to_mod_li°
(*
Âå
);

107 
s_hóp
 *
gë_hóp_hód
();

109 
em±y_hóp
();

111 
‰ì_hóp_d©a
(
s_hóp
 *
h±r
);

113 
övÆid©e_hóp_íåõs
(
sök_node
,

114 
ùö_node
);

116 
öô_rouã_°ru˘s
(
bb_Á˘‹
);

118 
‰ì_º_node_rouã_°ru˘s
();

120 
Æloc_™d_lﬂd_º_node_rouã_°ru˘s
();

122 
‰ì_åa˚_°ru˘s
();

124 
ª£rve_loˇŒy_u£d_›ös
(
¥es_Ác
,

125 
boﬁón
 
rù_up_loˇl_›ös
,

126 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
);

	@route_directed_search.c

1 
	~<°dio.h
>

2 
	~<as£π.h
>

3 
	~<sys/ty≥s.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"globÆs.h
"

7 
	~"m°.h
"

8 
	~"rouã_exp‹t.h
"

9 
	~"rouã_comm⁄.h
"

10 
	~"rouã_dúe˘ed_£¨ch.h
"

11 
	~"døw.h
"

16 
boﬁón
 
dúe˘ed_£¨ch_rouã_√t
(
öë
,

17 
¥es_Ác
,

18 
a°¨_Ác
,

19 
bíd_co°
,

20 
t_m°_edge
 ** 
m°
);

22 
dúe˘ed_£¨ch_ex∑nd_åa˚_£gmít
(
s_åa˚
 *
°¨t_±r
,

23 
èrgë_node
,

24 
a°¨_Ác
,

26 
ªmaöög_c⁄√˘i⁄s_to_sök
);

28 
dúe˘ed_£¨ch_ex∑nd_√ighbours
(
s_hóp
 *
cuºít
,

29 
öë
,

30 
bíd_co°
,

31 
èrgë_node
,

32 
a°¨_Ác
);

34 
dúe˘ed_£¨ch_add_sour˚_to_hóp
(
öë
,

35 
èrgë_node
,

36 
a°¨_Ác
);

38 
gë_dúe˘ed_£¨ch_ex≥˘ed_co°
(
öode
,

39 
èrgë_node
);

41 
gë_ex≥˘ed_£gs_to_èrgë
(
öode
,

42 
èrgë_node
,

43 *
num_£gs_‹tho_dú_±r
);

47 
boﬁón


48 
	$åy_dúe˘ed_£¨ch_rouã
(
s_rouãr_›ts
 
rouãr_›ts
,

49 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

50 
width_Ác
,

51 
t_m°_edge
 ** 
m°
)

58 
¥es_Ác
;

59 
boﬁón
 
suc˚ss
, 
is_rouèbÀ
, 
rù_up_loˇl_›ös
;

60 
ôry
, 
öë
;

66 if(
m°
)

68 
öë
 = 0; i√à< 
num_√ts
; inet++)

70 
	`‰ì
(
m°
[
öë
]);

71 
m°
[
öë
] = 
	`gë_m°_of_√t
(inet);

79 
¥es_Ác
 = 
rouãr_›ts
.
fú°_ôî_¥es_Ác
;

81 
ôry
 = 1; iåy <
rouãr_›ts
.
max_rouãr_ôî©i⁄s
; itry++)

84 
öë
 = 0; i√à< 
num_√ts
; inet++)

86 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

89 
is_rouèbÀ
 =

90 
	`dúe˘ed_£¨ch_rouã_√t
(
öë
, 
¥es_Ác
,

91 
rouãr_›ts
.

92 
a°¨_Ác
,

93 
rouãr_›ts
.

94 
bíd_co°
, 
m°
);

98 if(!
is_rouèbÀ
)

100 
	`¥ötf
("Routing failed.\n");

101  (
FALSE
);

110 if(
ôry
 == 1)

111 
rù_up_loˇl_›ös
 = 
FALSE
;

113 
rù_up_loˇl_›ös
 = 
TRUE
;

115 
	`ª£rve_loˇŒy_u£d_›ös
(
¥es_Ác
, 
rù_up_loˇl_›ös
,

116 
fb_›ös_u£d_loˇŒy
);

118 
suc˚ss
 = 
	`„asibÀ_routög
();

119 if(
suc˚ss
)

121 
¥ötf


123 
ôry
);

124  (
TRUE
);

129 
	`•rötf
(
msg
,

131 
ôry
, 
width_Ác
, 
Fc_öt
, 
Fs_öt
);

132 
	`öô_døw_co‹ds
(
pös_≥r_˛b
);

133 
	`upd©e_s¸ìn
(
MAJOR
, 
msg
, 
ROUTING
, 
FALSE
);

138 if(
ôry
 == 1)

140 
¥es_Ác
 = 
rouãr_›ts
.
öôül_¥es_Ác
;

141 
	`∑thfödî_upd©e_co°
(
¥es_Ác
, 0.);

145 
¥es_Ác
 *
rouãr_›ts
.
¥es_Ác_mu…
;

146 
	`∑thfödî_upd©e_co°
(
¥es_Ác
, 
rouãr_›ts
.
acc_Ác
);

151 
	`¥ötf
("Routing failed.\n");

153  (
FALSE
);

154 
	}
}

157 
boﬁón


158 
	$dúe˘ed_£¨ch_rouã_√t
(
öë
,

159 
¥es_Ác
,

160 
a°¨_Ác
,

161 
bíd_co°
,

162 
t_m°_edge
 ** 
m°
)

179 
öode
, 
ªmaöög_c⁄√˘i⁄s_to_sök
;

180 
ô¨gë
, 
èrgë_pö
, 
èrgë_node
;

181 
s_hóp
 *
cuºít
;

182 
s_åa˚
 *
√w_rouã_°¨t_çå
;

183 
ﬁd_tco°
, 
√w_tco°
, 
ﬁd_back_co°
, 
√w_back_co°
;

190 
	`∑thfödî_upd©e_⁄e_co°
(
åa˚_hód
[
öë
], -1, 
¥es_Ác
);

191 
	`‰ì_åa˚back
(
öë
);

194 
èrgë_pö
 = 
m°
[
öë
][0].
to_node
;

195 
èrgë_node
 = 
√t_º_ãrmöÆs
[
öë
][
èrgë_pö
];

196 
	`dúe˘ed_£¨ch_add_sour˚_to_hóp
(
öë
, 
èrgë_node
, 
a°¨_Ác
);

198 
	`m¨k_íds
(
öë
);

200 
ªmaöög_c⁄√˘i⁄s_to_sök
 = 0;

202 
ô¨gë
 = 0; ièrgë < 
√t
[
öë
].
num_söks
; itarget++)

204 
èrgë_pö
 = 
m°
[
öë
][
ô¨gë
].
to_node
;

205 
èrgë_node
 = 
√t_º_ãrmöÆs
[
öë
][
èrgë_pö
];

217 
	`dúe˘ed_£¨ch_ex∑nd_åa˚_£gmít
(
åa˚_hód
[
öë
],

218 
èrgë_node
, 
a°¨_Ác
,

219 
ªmaöög_c⁄√˘i⁄s_to_sök
);

221 
cuºít
 = 
	`gë_hóp_hód
();

223 if(
cuºít
 =
NULL
)

225 
	`ª£t_∑th_co°s
();

226  (
FALSE
);

229 
öode
 = 
cuºít
->
ödex
;

231 
öode
 !
èrgë_node
)

233 
ﬁd_tco°
 = 
º_node_rouã_öf
[
öode
].
∑th_co°
;

234 
√w_tco°
 = 
cuºít
->
co°
;

238 if(
ﬁd_tco°
 > 0.99 * 
HUGE_FLOAT
)

239 
ﬁd_back_co°
 = 
HUGE_FLOAT
;

241 
ﬁd_back_co°
 =

242 
º_node_rouã_öf
[
öode
].
backw¨d_∑th_co°
;

244 
√w_back_co°
 = 
cuºít
->
backw¨d_∑th_co°
;

255 if(
ﬁd_tco°
 > 
√w_tco°
 && 
ﬁd_back_co°
 > 
√w_back_co°
)

258 
º_node_rouã_öf
[
öode
].
¥ev_node
 =

259 
cuºít
->
u
.
¥ev_node
;

260 
º_node_rouã_öf
[
öode
].
¥ev_edge
 =

261 
cuºít
->
¥ev_edge
;

262 
º_node_rouã_öf
[
öode
].
∑th_co°
 = 
√w_tco°
;

263 
º_node_rouã_öf
[
öode
].
backw¨d_∑th_co°
 =

264 
√w_back_co°
;

266 if(
ﬁd_tco°
 > 0.99 * 
HUGE_FLOAT
)

267 
	`add_to_mod_li°
(&
º_node_rouã_öf
[
öode
].

268 
∑th_co°
);

270 
	`dúe˘ed_£¨ch_ex∑nd_√ighbours
(
cuºít
, 
öë
,

271 
bíd_co°
,

272 
èrgë_node
,

273 
a°¨_Ác
);

276 
	`‰ì_hóp_d©a
(
cuºít
);

277 
cuºít
 = 
	`gë_hóp_hód
();

279 if(
cuºít
 =
NULL
)

281 
	`ª£t_∑th_co°s
();

282  (
FALSE
);

285 
öode
 = 
cuºít
->
ödex
;

288 
º_node_rouã_öf
[
öode
].
èrgë_Êag
--;

289 
ªmaöög_c⁄√˘i⁄s_to_sök
 =

290 
º_node_rouã_öf
[
öode
].
èrgë_Êag
;

293 
√w_rouã_°¨t_çå
 = 
	`upd©e_åa˚back
(
cuºít
, 
öë
);

295 
	`‰ì_hóp_d©a
(
cuºít
);

299 
	`∑thfödî_upd©e_⁄e_co°
(
√w_rouã_°¨t_çå
, 1, 
¥es_Ác
);

305 
	`em±y_hóp
();

306 
	`ª£t_∑th_co°s
();

309  (
TRUE
);

310 
	}
}

313 
	$dúe˘ed_£¨ch_ex∑nd_åa˚_£gmít
(
s_åa˚
 *
°¨t_±r
,

314 
èrgë_node
,

315 
a°¨_Ác
,

316 
ªmaöög_c⁄√˘i⁄s_to_sök
)

335 
s_åa˚
 *
çå
;

336 
öode
, 
backw¨d_∑th_co°
, 
tŸ_co°
;

338 
çå
 = 
°¨t_±r
;

340 if(
ªmaöög_c⁄√˘i⁄s_to_sök
 == 0)

342 
çå
 !
NULL
)

355 
öode
 = 
çå
->
ödex
;

358 (
º_node
[
öode
].
ty≥
 =
IPIN


359 || 
º_node
[
öode
].
ty≥
 =
SINK
))

362 
backw¨d_∑th_co°
 = 0;

363 
tŸ_co°
 =

364 
backw¨d_∑th_co°
 +

365 
a°¨_Ác
 *

366 
	`gë_dúe˘ed_£¨ch_ex≥˘ed_co°
(
öode
,

367 
èrgë_node
);

368 
	`node_to_hóp
(
öode
, 
tŸ_co°
, 
NO_PREVIOUS
,

369 
NO_PREVIOUS
, 
backw¨d_∑th_co°
,

370 
OPEN
);

373 
çå
 =Å±r->
√xt
;

379 
	`¥ötf
("Warning: Multiple connections fromÇetÅoÅhe same sink. "

381 
	`exô
(1);

383 
	}
}

386 
	$dúe˘ed_£¨ch_ex∑nd_√ighbours
(
s_hóp
 *
cuºít
,

387 
öë
,

388 
bíd_co°
,

389 
èrgë_node
,

390 
a°¨_Ác
)

398 
ic⁄n
, 
to_node
, 
num_edges
, 
öode
, 
èrgë_x
, 
èrgë_y
;

399 
t_º_ty≥
 
‰om_ty≥
, 
to_ty≥
;

400 
√w_tŸ_co°
, 
ﬁd_back_pco°
, 
√w_back_pco°
;

402 
öode
 = 
cuºít
->
ödex
;

403 
ﬁd_back_pco°
 = 
cuºít
->
backw¨d_∑th_co°
;

404 
num_edges
 = 
º_node
[
öode
].num_edges;

406 
èrgë_x
 = 
º_node
[
èrgë_node
].
xhigh
;

407 
èrgë_y
 = 
º_node
[
èrgë_node
].
yhigh
;

409 
ic⁄n
 = 0; ic⁄¿< 
num_edges
; iconn++)

411 
to_node
 = 
º_node
[
öode
].
edges
[
ic⁄n
];

413 if(
º_node
[
to_node
].
xhigh
 < 
rouã_bb
[
öë
].
xmö
 ||

414 
º_node
[
to_node
].
xlow
 > 
rouã_bb
[
öë
].
xmax
 ||

415 
º_node
[
to_node
].
yhigh
 < 
rouã_bb
[
öë
].
ymö
 ||

416 
º_node
[
to_node
].
ylow
 > 
rouã_bb
[
öë
].
ymax
)

424 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

425 if(
to_ty≥
 =
IPIN
 && (
º_node
[
to_node
].
xhigh
 !
èrgë_x
 ||

426 
º_node
[
to_node
].
yhigh
 !
èrgë_y
))

434 
√w_back_pco°
 = 
ﬁd_back_pco°
 + 
	`gë_º_c⁄g_co°
(
to_node
);

436 if(
bíd_co°
 != 0.)

438 
‰om_ty≥
 = 
º_node
[
öode
].
ty≥
;

439 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

440 if((
‰om_ty≥
 =
CHANX
 && 
to_ty≥
 =
CHANY
) ||

441 (
‰om_ty≥
 =
CHANY
 && 
to_ty≥
 =
CHANX
))

442 
√w_back_pco°
 +
bíd_co°
;

446 
√w_tŸ_co°
 = 
√w_back_pco°
 + 
a°¨_Ác
 *

447 
	`gë_dúe˘ed_£¨ch_ex≥˘ed_co°
(
to_node
, 
èrgë_node
);

449 
	`node_to_hóp
(
to_node
, 
√w_tŸ_co°
, 
öode
, 
ic⁄n
, 
√w_back_pco°
,

450 
OPEN
);

452 
	}
}

456 
	$dúe˘ed_£¨ch_add_sour˚_to_hóp
(
öë
,

457 
èrgë_node
,

458 
a°¨_Ác
)

463 
öode
;

464 
back_co°
, 
tŸ_co°
;

466 
öode
 = 
√t_º_ãrmöÆs
[
öë
][0];

467 
back_co°
 = 0.0 + 
	`gë_º_c⁄g_co°
(
öode
);

470 if(!
	`is_em±y_hóp
())

472 
¥ötf


475 
	`exô
(1);

480 
tŸ_co°
 =

481 
back_co°
 + 
a°¨_Ác
 * 
	`gë_dúe˘ed_£¨ch_ex≥˘ed_co°
(
öode
,

482 
èrgë_node
);

483 
	`node_to_hóp
(
öode
, 
tŸ_co°
, 
NO_PREVIOUS
, NO_PREVIOUS, 
back_co°
, 
OPEN
);

485 
	}
}

489 
	$gë_dúe˘ed_£¨ch_ex≥˘ed_co°
(
öode
,

490 
èrgë_node
)

497 
t_º_ty≥
 
º_ty≥
;

498 
co°_ödex
, 
‹tho_co°_ödex
, 
num_£gs_ßme_dú
, 
num_£gs_‹tho_dú
;

499 
c⁄g_co°
;

501 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

503 if(
º_ty≥
 =
CHANX
 ||Ñr_ty≥ =
CHANY
)

505 
num_£gs_ßme_dú
 =

506 
	`gë_ex≥˘ed_£gs_to_èrgë
(
öode
, 
èrgë_node
,

507 &
num_£gs_‹tho_dú
);

508 
co°_ödex
 = 
º_node
[
öode
].cost_index;

509 
‹tho_co°_ödex
 = 
º_ödexed_d©a
[
co°_ödex
].ortho_cost_index;

511 
c⁄g_co°
 =

512 
num_£gs_ßme_dú
 * 
º_ödexed_d©a
[
co°_ödex
].
ba£_co°
 +

513 
num_£gs_‹tho_dú
 *

514 
º_ödexed_d©a
[
‹tho_co°_ödex
].
ba£_co°
;

515 
c⁄g_co°
 +=

516 
º_ödexed_d©a
[
IPIN_COST_INDEX
].
ba£_co°
 +

517 
º_ödexed_d©a
[
SINK_COST_INDEX
].
ba£_co°
;

519  (
c⁄g_co°
);

522 if(
º_ty≥
 =
IPIN
)

524  (
º_ödexed_d©a
[
SINK_COST_INDEX
].
ba£_co°
);

531 
	}
}

537 
	#ROUND_UP
(
x
Ë(
	`˚û
 (x - 0.001))

	)

541 
	$gë_ex≥˘ed_£gs_to_èrgë
(
öode
,

542 
èrgë_node
,

543 *
num_£gs_‹tho_dú_±r
)

550 
t_º_ty≥
 
º_ty≥
;

551 
èrgë_x
, 
èrgë_y
, 
num_£gs_ßme_dú
, 
co°_ödex
, 
‹tho_co°_ödex
;

552 
no_√ed_to_∑ss_by_˛b
;

553 
öv_Àngth
, 
‹tho_öv_Àngth
, 
ylow
, 
yhigh
, 
xlow
, 
xhigh
;

555 
èrgë_x
 = 
º_node
[
èrgë_node
].
xlow
;

556 
èrgë_y
 = 
º_node
[
èrgë_node
].
ylow
;

557 
co°_ödex
 = 
º_node
[
öode
].cost_index;

558 
öv_Àngth
 = 
º_ödexed_d©a
[
co°_ödex
].inv_length;

559 
‹tho_co°_ödex
 = 
º_ödexed_d©a
[
co°_ödex
].ortho_cost_index;

560 
‹tho_öv_Àngth
 = 
º_ödexed_d©a
[
‹tho_co°_ödex
].
öv_Àngth
;

561 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

563 if(
º_ty≥
 =
CHANX
)

565 
ylow
 = 
º_node
[
öode
].ylow;

566 
xhigh
 = 
º_node
[
öode
].xhigh;

567 
xlow
 = 
º_node
[
öode
].xlow;

571 if(
ylow
 > 
èrgë_y
)

573 *
num_£gs_‹tho_dú_±r
 =

574 
	`ROUND_UP
((
ylow
 - 
èrgë_y
 + 1.Ë* 
‹tho_öv_Àngth
);

575 
no_√ed_to_∑ss_by_˛b
 = 1;

577 if(
ylow
 < 
èrgë_y
 - 1)

579 *
num_£gs_‹tho_dú_±r
 = 
	`ROUND_UP
((
èrgë_y
 - 
ylow
) *

580 
‹tho_öv_Àngth
);

581 
no_√ed_to_∑ss_by_˛b
 = 1;

585 *
num_£gs_‹tho_dú_±r
 = 0;

586 
no_√ed_to_∑ss_by_˛b
 = 0;

591 if(
xlow
 > 
èrgë_x
 + 
no_√ed_to_∑ss_by_˛b
)

593 
num_£gs_ßme_dú
 =

594 
	`ROUND_UP
((
xlow
 - 
no_√ed_to_∑ss_by_˛b
 -

595 
èrgë_x
Ë* 
öv_Àngth
);

597 if(
xhigh
 < 
èrgë_x
 - 
no_√ed_to_∑ss_by_˛b
)

599 
num_£gs_ßme_dú
 =

600 
	`ROUND_UP
((
èrgë_x
 - 
no_√ed_to_∑ss_by_˛b
 -

601 
xhigh
Ë* 
öv_Àngth
);

605 
num_£gs_ßme_dú
 = 0;

611 
ylow
 = 
º_node
[
öode
].ylow;

612 
yhigh
 = 
º_node
[
öode
].yhigh;

613 
xlow
 = 
º_node
[
öode
].xlow;

617 if(
xlow
 > 
èrgë_x
)

619 *
num_£gs_‹tho_dú_±r
 =

620 
	`ROUND_UP
((
xlow
 - 
èrgë_x
 + 1.Ë* 
‹tho_öv_Àngth
);

621 
no_√ed_to_∑ss_by_˛b
 = 1;

623 if(
xlow
 < 
èrgë_x
 - 1)

625 *
num_£gs_‹tho_dú_±r
 = 
	`ROUND_UP
((
èrgë_x
 - 
xlow
) *

626 
‹tho_öv_Àngth
);

627 
no_√ed_to_∑ss_by_˛b
 = 1;

631 *
num_£gs_‹tho_dú_±r
 = 0;

632 
no_√ed_to_∑ss_by_˛b
 = 0;

637 if(
ylow
 > 
èrgë_y
 + 
no_√ed_to_∑ss_by_˛b
)

639 
num_£gs_ßme_dú
 =

640 
	`ROUND_UP
((
ylow
 - 
no_√ed_to_∑ss_by_˛b
 -

641 
èrgë_y
Ë* 
öv_Àngth
);

643 if(
yhigh
 < 
èrgë_y
 - 
no_√ed_to_∑ss_by_˛b
)

645 
num_£gs_ßme_dú
 =

646 
	`ROUND_UP
((
èrgë_y
 - 
no_√ed_to_∑ss_by_˛b
 -

647 
yhigh
Ë* 
öv_Àngth
);

651 
num_£gs_ßme_dú
 = 0;

655  (
num_£gs_ßme_dú
);

656 
	}
}

	@route_directed_search.h

1 
boﬁón
 
åy_dúe˘ed_£¨ch_rouã
(
s_rouãr_›ts
 
rouãr_›ts
,

2 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

3 
width_Ác
,

4 
t_m°_edge
 ** 
m°
);

	@route_export.h

4 
boﬁón
 
åy_rouã
(
width_Ác
,

5 
s_rouãr_›ts
 
rouãr_›ts
,

6 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

7 
t_£gmít_öf
 * 
£gmít_öf
,

8 
t_timög_öf
 
timög_öf
,

9 **
√t_¶ack
,

10 **
√t_dñay
,

11 
t_ch™_width_di°
 
ch™_width_di°
,

12 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

13 
t_m°_edge
 ** 
m°
,

14 
boﬁón
 * 
Fc_˛ù≥d
);

16 
boﬁón
 
„asibÀ_routög
();

18 
t_ivec
 **
Æloc_rouã_°ru˘s
(
t_subblock_d©a
 
subblock_d©a
);

20 
‰ì_rouã_°ru˘s
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
);

22 
s_åa˚
 **
Æloc_ßved_routög
(
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

23 
t_ivec
 ***

24 
ßved_˛b_›ös_u£d_loˇŒy_±r
);

26 
‰ì_ßved_routög
(
s_åa˚
 **
be°_routög
,

27 
t_ivec
 ** 
ßved_˛b_›ös_u£d_loˇŒy
);

29 
ßve_routög
(
s_åa˚
 **
be°_routög
,

30 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

31 
t_ivec
 ** 
ßved_˛b_›ös_u£d_loˇŒy
);

33 
ª°‹e_routög
(
s_åa˚
 **
be°_routög
,

34 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
,

35 
t_ivec
 ** 
ßved_˛b_›ös_u£d_loˇŒy
);

37 
gë_£rül_num
();

39 
¥öt_rouã
(*
«me
);

	@route_timing.c

1 
	~<°dio.h
>

2 
	~<m©h.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"globÆs.h
"

6 
	~"m°.h
"

7 
	~"rouã_exp‹t.h
"

8 
	~"rouã_comm⁄.h
"

9 
	~"rouã_åì_timög.h
"

10 
	~"rouã_timög.h
"

11 
	~"hóps‹t.h
"

12 
	~"∑th_dñay.h
"

13 
	~"√t_dñay.h
"

18 
gë_max_pös_≥r_√t
();

20 
add_rouã_åì_to_hóp
(
t_π_node
 * 
π_node
,

21 
èrgë_node
,

22 
èrgë_¸ôiˇlôy
,

23 
a°¨_Ác
);

25 
timög_driví_ex∑nd_√ighbours
(
s_hóp
 *
cuºít
,

26 
öë
,

27 
bíd_co°
,

28 
¸ôiˇlôy_Ác
,

29 
èrgë_node
,

30 
a°¨_Ác
);

32 
gë_timög_driví_ex≥˘ed_co°
(
öode
,

33 
èrgë_node
,

34 
¸ôiˇlôy_Ác
,

35 
R_up°ªam
);

37 
gë_ex≥˘ed_£gs_to_èrgë
(
öode
,

38 
èrgë_node
,

39 *
num_£gs_‹tho_dú_±r
);

41 
upd©e_º_ba£_co°s
(
öë
,

42 
œrge°_¸ôiˇlôy
);

44 
timög_driví_check_√t_dñays
(**
√t_dñay
);

49 
boﬁón


50 
	$åy_timög_driví_rouã
(
s_rouãr_›ts
 
rouãr_›ts
,

51 **
√t_¶ack
,

52 **
√t_dñay
,

53 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
)

60 
ôry
, 
öë
, 
ùö
;

61 
boﬁón
 
suc˚ss
, 
is_rouèbÀ
, 
rù_up_loˇl_›ös
;

62 *
pö_¸ôiˇlôy
;

63 *
sök_‹dî
;

64 
t_π_node
 **
π_node_of_sök
;

65 
T_¸ô
, 
¥es_Ác
;

67 
	`Æloc_timög_driví_rouã_°ru˘s
(&
pö_¸ôiˇlôy
, &
sök_‹dî
,

68 &
π_node_of_sök
);

73 
öë
 = 0; i√à< 
num_√ts
; inet++)

75 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

77 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

78 
√t_¶ack
[
öë
][
ùö
] = 0.;

82 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

83 
√t_dñay
[
öë
][
ùö
] = 0.;

87 
T_¸ô
 = 1.;

88 
¥es_Ác
 = 
rouãr_›ts
.
fú°_ôî_¥es_Ác
;

90 
ôry
 = 1; iåy <
rouãr_›ts
.
max_rouãr_ôî©i⁄s
; itry++)

93 
öë
 = 0; i√à< 
num_√ts
; inet++)

95 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

98 
is_rouèbÀ
 =

99 
	`timög_driví_rouã_√t
(
öë
, 
¥es_Ác
,

100 
rouãr_›ts
.

101 
max_¸ôiˇlôy
,

102 
rouãr_›ts
.

103 
¸ôiˇlôy_exp
,

104 
rouãr_›ts
.
a°¨_Ác
,

105 
rouãr_›ts
.
bíd_co°
,

106 
√t_¶ack
[
öë
],

107 
pö_¸ôiˇlôy
,

108 
sök_‹dî
,

109 
π_node_of_sök
,

110 
T_¸ô
,

111 
√t_dñay
[
öë
]);

115 if(!
is_rouèbÀ
)

117 
	`¥ötf
("Routing failed.\n");

118 
‰ì_timög_driví_rouã_°ru˘s


119 (
pö_¸ôiˇlôy
, 
sök_‹dî
,

120 
π_node_of_sök
);

121  (
FALSE
);

129 if(
ôry
 == 1)

130 
rù_up_loˇl_›ös
 = 
FALSE
;

132 
rù_up_loˇl_›ös
 = 
TRUE
;

134 
	`ª£rve_loˇŒy_u£d_›ös
(
¥es_Ác
, 
rù_up_loˇl_›ös
,

135 
fb_›ös_u£d_loˇŒy
);

140 
suc˚ss
 = 
	`„asibÀ_routög
();

141 if(
suc˚ss
)

143 
¥ötf


145 
ôry
);

146 
	`‰ì_timög_driví_rouã_°ru˘s
(
pö_¸ôiˇlôy
,

147 
sök_‹dî
,

148 
π_node_of_sök
);

149 #ifde‡
DEBUG


150 
	`timög_driví_check_√t_dñays
(
√t_dñay
);

152  (
TRUE
);

155 if(
ôry
 == 1)

157 
¥es_Ác
 = 
rouãr_›ts
.
öôül_¥es_Ác
;

158 
	`∑thfödî_upd©e_co°
(
¥es_Ác
, 0.);

162 
¥es_Ác
 *
rouãr_›ts
.
¥es_Ác_mu…
;

165 
¥es_Ác
 = 
	`mö
 (¥es_Ác, 
HUGE_FLOAT
 / 1e5);

167 
	`∑thfödî_upd©e_co°
(
¥es_Ác
, 
rouãr_›ts
.
acc_Ác
);

173 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

174 
T_¸ô
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

175 
	`¥ötf
("T_¸ô: %g.\n", 
T_¸ô
);

178 
	`¥ötf
("Routing failed.\n");

179 
	`‰ì_timög_driví_rouã_°ru˘s
(
pö_¸ôiˇlôy
, 
sök_‹dî
,

180 
π_node_of_sök
);

181  (
FALSE
);

182 
	}
}

186 
	$Æloc_timög_driví_rouã_°ru˘s
(**
pö_¸ôiˇlôy_±r
,

187 **
sök_‹dî_±r
,

188 
t_π_node
 *** 
π_node_of_sök_±r
)

193 
max_pös_≥r_√t
;

194 *
pö_¸ôiˇlôy
;

195 *
sök_‹dî
;

196 
t_π_node
 **
π_node_of_sök
;

198 
max_pös_≥r_√t
 = 
	`gë_max_pös_≥r_√t
();

200 
pö_¸ôiˇlôy
 =

201 (*)
	`my_mÆloc
((
max_pös_≥r_√t
 - 1) * ());

202 *
pö_¸ôiˇlôy_±r
 = 
pö_¸ôiˇlôy
 - 1;

204 
sök_‹dî
 = (*)
	`my_mÆloc
((
max_pös_≥r_√t
 - 1) * ());

205 *
sök_‹dî_±r
 = 
sök_‹dî
 - 1;

207 
π_node_of_sök
 = (
t_π_node
 **Ë
	`my_mÆloc
((
max_pös_≥r_√t
 - 1) *

208 (
t_π_node
 *));

209 *
π_node_of_sök_±r
 = 
π_node_of_sök
 - 1;

211 
	`Æloc_rouã_åì_timög_°ru˘s
();

212 
	}
}

216 
	$‰ì_timög_driví_rouã_°ru˘s
(*
pö_¸ôiˇlôy
,

217 *
sök_‹dî
,

218 
t_π_node
 ** 
π_node_of_sök
)

223 
	`‰ì
(
pö_¸ôiˇlôy
 + 1);

224 
	`‰ì
(
sök_‹dî
 + 1);

225 
	`‰ì
(
π_node_of_sök
 + 1);

226 
	`‰ì_rouã_åì_timög_°ru˘s
();

227 
	}
}

231 
	$gë_max_pös_≥r_√t
()

236 
öë
, 
max_pös_≥r_√t
;

238 
max_pös_≥r_√t
 = 0;

239 
öë
 = 0; i√à< 
num_√ts
; inet++)

241 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

243 
max_pös_≥r_√t
 =

244 
	`max
(
max_pös_≥r_√t
, (
√t
[
öë
].
num_söks
 + 1));

248  (
max_pös_≥r_√t
);

249 
	}
}

252 
boﬁón


253 
	$timög_driví_rouã_√t
(
öë
,

254 
¥es_Ác
,

255 
max_¸ôiˇlôy
,

256 
¸ôiˇlôy_exp
,

257 
a°¨_Ác
,

258 
bíd_co°
,

259 *
√t_¶ack
,

260 *
pö_¸ôiˇlôy
,

261 *
sök_‹dî
,

262 
t_π_node
 ** 
π_node_of_sök
,

263 
T_¸ô
,

264 *
√t_dñay
)

272 
ùö
, 
num_söks
, 
ô¨gë
, 
èrgë_pö
, 
èrgë_node
, 
öode
;

273 
èrgë_¸ôiˇlôy
, 
ﬁd_tco°
, 
√w_tco°
, 
œrge°_¸ôiˇlôy
,

274 
pö_¸ô
;

275 
ﬁd_back_co°
, 
√w_back_co°
;

276 
t_π_node
 *
π_roŸ
;

277 
s_hóp
 *
cuºít
;

278 
s_åa˚
 *
√w_rouã_°¨t_çå
;

282 
	`∑thfödî_upd©e_⁄e_co°
(
åa˚_hód
[
öë
], -1, 
¥es_Ác
);

283 
	`‰ì_åa˚back
(
öë
);

285 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

287 
pö_¸ô
 = 
	`max
(
max_¸ôiˇlôy
 - 
√t_¶ack
[
ùö
] / 
T_¸ô
, 0.);

288 
pö_¸ô
 = 
	`pow
’ö_¸ô, 
¸ôiˇlôy_exp
);

289 
pö_¸ô
 = 
	`mö
’ö_¸ô, 
max_¸ôiˇlôy
);

290 
pö_¸ôiˇlôy
[
ùö
] = 
pö_¸ô
;

293 
num_söks
 = 
√t
[
öë
].num_sinks;

294 
	`hóps‹t
(
sök_‹dî
, 
pö_¸ôiˇlôy
, 
num_söks
);

298 
œrge°_¸ôiˇlôy
 = 
pö_¸ôiˇlôy
[
sök_‹dî
[1]];

299 
	`upd©e_º_ba£_co°s
(
öë
, 
œrge°_¸ôiˇlôy
);

301 
	`m¨k_íds
(
öë
);

303 
π_roŸ
 = 
	`öô_rouã_åì_to_sour˚
(
öë
);

305 
ô¨gë
 = 1; ièrgë <
num_söks
; itarget++)

307 
èrgë_pö
 = 
sök_‹dî
[
ô¨gë
];

308 
èrgë_node
 = 
√t_º_ãrmöÆs
[
öë
][
èrgë_pö
];

310 
èrgë_¸ôiˇlôy
 = 
pö_¸ôiˇlôy
[
èrgë_pö
];

312 
	`add_rouã_åì_to_hóp
(
π_roŸ
, 
èrgë_node
, 
èrgë_¸ôiˇlôy
,

313 
a°¨_Ác
);

315 
cuºít
 = 
	`gë_hóp_hód
();

317 if(
cuºít
 =
NULL
)

319 
	`ª£t_∑th_co°s
();

320 
	`‰ì_rouã_åì
(
π_roŸ
);

321  (
FALSE
);

324 
öode
 = 
cuºít
->
ödex
;

326 
öode
 !
èrgë_node
)

328 
ﬁd_tco°
 = 
º_node_rouã_öf
[
öode
].
∑th_co°
;

329 
√w_tco°
 = 
cuºít
->
co°
;

331 if(
ﬁd_tco°
 > 0.99 * 
HUGE_FLOAT
)

332 
ﬁd_back_co°
 = 
HUGE_FLOAT
;

334 
ﬁd_back_co°
 =

335 
º_node_rouã_öf
[
öode
].
backw¨d_∑th_co°
;

337 
√w_back_co°
 = 
cuºít
->
backw¨d_∑th_co°
;

347 if(
ﬁd_tco°
 > 
√w_tco°
 && 
ﬁd_back_co°
 > 
√w_back_co°
)

349 
º_node_rouã_öf
[
öode
].
¥ev_node
 =

350 
cuºít
->
u
.
¥ev_node
;

351 
º_node_rouã_öf
[
öode
].
¥ev_edge
 =

352 
cuºít
->
¥ev_edge
;

353 
º_node_rouã_öf
[
öode
].
∑th_co°
 = 
√w_tco°
;

354 
º_node_rouã_öf
[
öode
].
backw¨d_∑th_co°
 =

355 
√w_back_co°
;

357 if(
ﬁd_tco°
 > 0.99 * 
HUGE_FLOAT
)

358 
	`add_to_mod_li°
(&
º_node_rouã_öf
[
öode
].

359 
∑th_co°
);

361 
	`timög_driví_ex∑nd_√ighbours
(
cuºít
, 
öë
,

362 
bíd_co°
,

363 
èrgë_¸ôiˇlôy
,

364 
èrgë_node
,

365 
a°¨_Ác
);

368 
	`‰ì_hóp_d©a
(
cuºít
);

369 
cuºít
 = 
	`gë_hóp_hód
();

371 if(
cuºít
 =
NULL
)

373 
	`ª£t_∑th_co°s
();

374 
	`‰ì_rouã_åì
(
π_roŸ
);

375  (
FALSE
);

378 
öode
 = 
cuºít
->
ödex
;

389 
º_node_rouã_öf
[
öode
].
èrgë_Êag
--;

390 
√w_rouã_°¨t_çå
 = 
	`upd©e_åa˚back
(
cuºít
, 
öë
);

391 
π_node_of_sök
[
èrgë_pö
] = 
	`upd©e_rouã_åì
(
cuºít
);

392 
	`‰ì_hóp_d©a
(
cuºít
);

393 
	`∑thfödî_upd©e_⁄e_co°
(
√w_rouã_°¨t_çå
, 1, 
¥es_Ác
);

395 
	`em±y_hóp
();

396 
	`ª£t_∑th_co°s
();

401 
	`upd©e_√t_dñays_‰om_rouã_åì
(
√t_dñay
, 
π_node_of_sök
, 
öë
);

402 
	`‰ì_rouã_åì
(
π_roŸ
);

403  (
TRUE
);

404 
	}
}

408 
	$add_rouã_åì_to_hóp
(
t_π_node
 * 
π_node
,

409 
èrgë_node
,

410 
èrgë_¸ôiˇlôy
,

411 
a°¨_Ác
)

418 
öode
;

419 
t_π_node
 *
chûd_node
;

420 
t_löked_π_edge
 *
löked_π_edge
;

421 
tŸ_co°
, 
backw¨d_∑th_co°
, 
R_up°ªam
;

425 if(
π_node
->
ª_ex∑nd
)

427 
öode
 = 
π_node
->inode;

428 
backw¨d_∑th_co°
 = 
èrgë_¸ôiˇlôy
 * 
π_node
->
Tdñ
;

429 
R_up°ªam
 = 
π_node
->R_upstream;

430 
tŸ_co°
 =

431 
backw¨d_∑th_co°
 +

432 
a°¨_Ác
 * 
	`gë_timög_driví_ex≥˘ed_co°
(
öode
,

433 
èrgë_node
,

434 
èrgë_¸ôiˇlôy
,

435 
R_up°ªam
);

436 
	`node_to_hóp
(
öode
, 
tŸ_co°
, 
NO_PREVIOUS
, NO_PREVIOUS,

437 
backw¨d_∑th_co°
, 
R_up°ªam
);

440 
löked_π_edge
 = 
π_node
->
u
.
chûd_li°
;

442 
löked_π_edge
 !
NULL
)

444 
chûd_node
 = 
löked_π_edge
->
chûd
;

445 
	`add_rouã_åì_to_hóp
(
chûd_node
, 
èrgë_node
,

446 
èrgë_¸ôiˇlôy
, 
a°¨_Ác
);

447 
löked_π_edge
 =Üöked_π_edge->
√xt
;

449 
	}
}

453 
	$timög_driví_ex∑nd_√ighbours
(
s_hóp
 *
cuºít
,

454 
öë
,

455 
bíd_co°
,

456 
¸ôiˇlôy_Ác
,

457 
èrgë_node
,

458 
a°¨_Ác
)

465 
ic⁄n
, 
to_node
, 
num_edges
, 
öode
, 
iswôch
, 
èrgë_x
, 
èrgë_y
;

466 
t_º_ty≥
 
‰om_ty≥
, 
to_ty≥
;

467 
√w_tŸ_co°
, 
ﬁd_back_pco°
, 
√w_back_pco°
, 
R_up°ªam
;

468 
√w_R_up°ªam
, 
Tdñ
;

470 
öode
 = 
cuºít
->
ödex
;

471 
ﬁd_back_pco°
 = 
cuºít
->
backw¨d_∑th_co°
;

472 
R_up°ªam
 = 
cuºít
->R_upstream;

473 
num_edges
 = 
º_node
[
öode
].num_edges;

475 
èrgë_x
 = 
º_node
[
èrgë_node
].
xhigh
;

476 
èrgë_y
 = 
º_node
[
èrgë_node
].
yhigh
;

478 
ic⁄n
 = 0; ic⁄¿< 
num_edges
; iconn++)

480 
to_node
 = 
º_node
[
öode
].
edges
[
ic⁄n
];

482 if(
º_node
[
to_node
].
xhigh
 < 
rouã_bb
[
öë
].
xmö
 ||

483 
º_node
[
to_node
].
xlow
 > 
rouã_bb
[
öë
].
xmax
 ||

484 
º_node
[
to_node
].
yhigh
 < 
rouã_bb
[
öë
].
ymö
 ||

485 
º_node
[
to_node
].
ylow
 > 
rouã_bb
[
öë
].
ymax
)

493 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

494 if(
to_ty≥
 =
IPIN
 && (
º_node
[
to_node
].
xhigh
 !
èrgë_x
 ||

495 
º_node
[
to_node
].
yhigh
 !
èrgë_y
))

504 
√w_back_pco°
 = 
ﬁd_back_pco°
 + (1. - 
¸ôiˇlôy_Ác
) *

505 
	`gë_º_c⁄g_co°
(
to_node
);

507 
iswôch
 = 
º_node
[
öode
].
swôches
[
ic⁄n
];

508 if(
swôch_öf
[
iswôch
].
buf„ªd
)

510 
√w_R_up°ªam
 = 
swôch_öf
[
iswôch
].
R
;

514 
√w_R_up°ªam
 = 
R_up°ªam
 + 
swôch_öf
[
iswôch
].
R
;

517 
Tdñ
 =

518 
º_node
[
to_node
].
C
 * (
√w_R_up°ªam
 +

519 0.5 * 
º_node
[
to_node
].
R
);

520 
Tdñ
 +
swôch_öf
[
iswôch
].Tdel;

521 
√w_R_up°ªam
 +
º_node
[
to_node
].
R
;

522 
√w_back_pco°
 +
¸ôiˇlôy_Ác
 * 
Tdñ
;

524 if(
bíd_co°
 != 0.)

526 
‰om_ty≥
 = 
º_node
[
öode
].
ty≥
;

527 
to_ty≥
 = 
º_node
[
to_node
].
ty≥
;

528 if((
‰om_ty≥
 =
CHANX
 && 
to_ty≥
 =
CHANY
) ||

529 (
‰om_ty≥
 =
CHANY
 && 
to_ty≥
 =
CHANX
))

530 
√w_back_pco°
 +
bíd_co°
;

533 
√w_tŸ_co°
 = 
√w_back_pco°
 + 
a°¨_Ác
 *

534 
	`gë_timög_driví_ex≥˘ed_co°
(
to_node
, 
èrgë_node
,

535 
¸ôiˇlôy_Ác
,

536 
√w_R_up°ªam
);

538 
	`node_to_hóp
(
to_node
, 
√w_tŸ_co°
, 
öode
, 
ic⁄n
, 
√w_back_pco°
,

539 
√w_R_up°ªam
);

542 
	}
}

546 
	$gë_timög_driví_ex≥˘ed_co°
(
öode
,

547 
èrgë_node
,

548 
¸ôiˇlôy_Ác
,

549 
R_up°ªam
)

556 
t_º_ty≥
 
º_ty≥
;

557 
co°_ödex
, 
‹tho_co°_ödex
, 
num_£gs_ßme_dú
, 
num_£gs_‹tho_dú
;

558 
ex≥˘ed_co°
, 
c⁄g_co°
, 
Tdñ
;

560 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

562 if(
º_ty≥
 =
CHANX
 ||Ñr_ty≥ =
CHANY
)

564 
num_£gs_ßme_dú
 =

565 
	`gë_ex≥˘ed_£gs_to_èrgë
(
öode
, 
èrgë_node
,

566 &
num_£gs_‹tho_dú
);

567 
co°_ödex
 = 
º_node
[
öode
].cost_index;

568 
‹tho_co°_ödex
 = 
º_ödexed_d©a
[
co°_ödex
].ortho_cost_index;

570 
c⁄g_co°
 =

571 
num_£gs_ßme_dú
 * 
º_ödexed_d©a
[
co°_ödex
].
ba£_co°
 +

572 
num_£gs_‹tho_dú
 *

573 
º_ödexed_d©a
[
‹tho_co°_ödex
].
ba£_co°
;

574 
c⁄g_co°
 +=

575 
º_ödexed_d©a
[
IPIN_COST_INDEX
].
ba£_co°
 +

576 
º_ödexed_d©a
[
SINK_COST_INDEX
].
ba£_co°
;

578 
Tdñ
 = 
num_£gs_ßme_dú
 * 
º_ödexed_d©a
[
co°_ödex
].
T_löór
 +

579 
num_£gs_‹tho_dú
 *

580 
º_ödexed_d©a
[
‹tho_co°_ödex
].
T_löór
 +

581 
num_£gs_ßme_dú
 *Çum_segs_same_dir *

582 
º_ödexed_d©a
[
co°_ödex
].
T_quadøtic
 +

583 
num_£gs_‹tho_dú
 *Çum_segs_ortho_dir *

584 
º_ödexed_d©a
[
‹tho_co°_ödex
].
T_quadøtic
 +

585 
R_up°ªam
 * (
num_£gs_ßme_dú
 *

586 
º_ödexed_d©a
[
co°_ödex
].
C_lﬂd
 +

587 
num_£gs_‹tho_dú
 *

588 
º_ödexed_d©a
[
‹tho_co°_ödex
].
C_lﬂd
);

590 
Tdñ
 +
º_ödexed_d©a
[
IPIN_COST_INDEX
].
T_löór
;

592 
ex≥˘ed_co°
 =

593 
¸ôiˇlôy_Ác
 * 
Tdñ
 + (1. - crôiˇlôy_ÁcË* 
c⁄g_co°
;

594  (
ex≥˘ed_co°
);

597 if(
º_ty≥
 =
IPIN
)

599  (
º_ödexed_d©a
[
SINK_COST_INDEX
].
ba£_co°
);

606 
	}
}

612 
	#ROUND_UP
(
x
Ë(
	`˚û
 (x - 0.001))

	)

616 
	$gë_ex≥˘ed_£gs_to_èrgë
(
öode
,

617 
èrgë_node
,

618 *
num_£gs_‹tho_dú_±r
)

625 
t_º_ty≥
 
º_ty≥
;

626 
èrgë_x
, 
èrgë_y
, 
num_£gs_ßme_dú
, 
co°_ödex
, 
‹tho_co°_ödex
;

627 
no_√ed_to_∑ss_by_˛b
;

628 
öv_Àngth
, 
‹tho_öv_Àngth
, 
ylow
, 
yhigh
, 
xlow
, 
xhigh
;

630 
èrgë_x
 = 
º_node
[
èrgë_node
].
xlow
;

631 
èrgë_y
 = 
º_node
[
èrgë_node
].
ylow
;

632 
co°_ödex
 = 
º_node
[
öode
].cost_index;

633 
öv_Àngth
 = 
º_ödexed_d©a
[
co°_ödex
].inv_length;

634 
‹tho_co°_ödex
 = 
º_ödexed_d©a
[
co°_ödex
].ortho_cost_index;

635 
‹tho_öv_Àngth
 = 
º_ödexed_d©a
[
‹tho_co°_ödex
].
öv_Àngth
;

636 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

638 if(
º_ty≥
 =
CHANX
)

640 
ylow
 = 
º_node
[
öode
].ylow;

641 
xhigh
 = 
º_node
[
öode
].xhigh;

642 
xlow
 = 
º_node
[
öode
].xlow;

646 if(
ylow
 > 
èrgë_y
)

648 *
num_£gs_‹tho_dú_±r
 =

649 
	`ROUND_UP
((
ylow
 - 
èrgë_y
 + 1.Ë* 
‹tho_öv_Àngth
);

650 
no_√ed_to_∑ss_by_˛b
 = 1;

652 if(
ylow
 < 
èrgë_y
 - 1)

654 *
num_£gs_‹tho_dú_±r
 = 
	`ROUND_UP
((
èrgë_y
 - 
ylow
) *

655 
‹tho_öv_Àngth
);

656 
no_√ed_to_∑ss_by_˛b
 = 1;

660 *
num_£gs_‹tho_dú_±r
 = 0;

661 
no_√ed_to_∑ss_by_˛b
 = 0;

666 if(
xlow
 > 
èrgë_x
 + 
no_√ed_to_∑ss_by_˛b
)

668 
num_£gs_ßme_dú
 =

669 
	`ROUND_UP
((
xlow
 - 
no_√ed_to_∑ss_by_˛b
 -

670 
èrgë_x
Ë* 
öv_Àngth
);

672 if(
xhigh
 < 
èrgë_x
 - 
no_√ed_to_∑ss_by_˛b
)

674 
num_£gs_ßme_dú
 =

675 
	`ROUND_UP
((
èrgë_x
 - 
no_√ed_to_∑ss_by_˛b
 -

676 
xhigh
Ë* 
öv_Àngth
);

680 
num_£gs_ßme_dú
 = 0;

686 
ylow
 = 
º_node
[
öode
].ylow;

687 
yhigh
 = 
º_node
[
öode
].yhigh;

688 
xlow
 = 
º_node
[
öode
].xlow;

692 if(
xlow
 > 
èrgë_x
)

694 *
num_£gs_‹tho_dú_±r
 =

695 
	`ROUND_UP
((
xlow
 - 
èrgë_x
 + 1.Ë* 
‹tho_öv_Àngth
);

696 
no_√ed_to_∑ss_by_˛b
 = 1;

698 if(
xlow
 < 
èrgë_x
 - 1)

700 *
num_£gs_‹tho_dú_±r
 = 
	`ROUND_UP
((
èrgë_x
 - 
xlow
) *

701 
‹tho_öv_Àngth
);

702 
no_√ed_to_∑ss_by_˛b
 = 1;

706 *
num_£gs_‹tho_dú_±r
 = 0;

707 
no_√ed_to_∑ss_by_˛b
 = 0;

712 if(
ylow
 > 
èrgë_y
 + 
no_√ed_to_∑ss_by_˛b
)

714 
num_£gs_ßme_dú
 =

715 
	`ROUND_UP
((
ylow
 - 
no_√ed_to_∑ss_by_˛b
 -

716 
èrgë_y
Ë* 
öv_Àngth
);

718 if(
yhigh
 < 
èrgë_y
 - 
no_√ed_to_∑ss_by_˛b
)

720 
num_£gs_ßme_dú
 =

721 
	`ROUND_UP
((
èrgë_y
 - 
no_√ed_to_∑ss_by_˛b
 -

722 
yhigh
Ë* 
öv_Àngth
);

726 
num_£gs_ßme_dú
 = 0;

730  (
num_£gs_ßme_dú
);

731 
	}
}

735 
	$upd©e_º_ba£_co°s
(
öë
,

736 
œrge°_¸ôiˇlôy
)

742 
Ánout
, 
Á˘‹
;

743 
ödex
;

745 
Ánout
 = 
√t
[
öë
].
num_söks
;

748 
Á˘‹
 = 
	`sqπ
(
Ánout
);

750 
ödex
 = 
CHANX_COST_INDEX_START
; index < 
num_º_ödexed_d©a
; index++)

752 if(
º_ödexed_d©a
[
ödex
].
T_quadøtic
 > 0.)

754 
º_ödexed_d©a
[
ödex
].
ba£_co°
 =

755 
º_ödexed_d©a
[
ödex
].
ßved_ba£_co°
 * 
Á˘‹
;

759 
º_ödexed_d©a
[
ödex
].
ba£_co°
 =

760 
º_ödexed_d©a
[
ödex
].
ßved_ba£_co°
;

763 
	}
}

766 
	#ERROR_TOL
 0.0001

	)

769 
	$timög_driví_check_√t_dñays
(**
√t_dñay
)

775 
öë
, 
ùö
;

776 **
√t_dñay_check
;

777 
s_löked_v±r
 *
ch_li°_hód_√t_dñay_check
;

779 
√t_dñay_check
 = 
	`Æloc_√t_dñay
(&
ch_li°_hód_√t_dñay_check
);

780 
	`lﬂd_√t_dñay_‰om_routög
(
√t_dñay_check
);

782 
öë
 = 0; i√à< 
num_√ts
; inet++)

784 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

786 if(
√t_dñay_check
[
öë
][
ùö
] == 0.)

788 if(
√t_dñay
[
öë
][
ùö
] != 0.)

790 
¥ötf


793 "√àdñay i†%g.\n", 
öë
, 
ùö
,

794 
√t_dñay
[
öë
][
ùö
],

795 
√t_dñay_check
[
öë
][
ùö
]);

796 
	`exô
(1);

801 if(
Ábs


803 
√t_dñay
[
öë
][
ùö
] /

804 
√t_dñay_check
[
öë
][
ùö
]Ë> 
ERROR_TOL
)

806 
¥ötf


809 "√àdñay i†%g.\n", 
öë
, 
ùö
,

810 
√t_dñay
[
öë
][
ùö
],

811 
√t_dñay_check
[
öë
][
ùö
]);

812 
	`exô
(1);

818 
	`‰ì_√t_dñay
(
√t_dñay_check
, &
ch_li°_hód_√t_dñay_check
);

819 
	`¥ötf
("CompletedÇet delay value cross check successfully.\n");

820 
	}
}

	@route_timing.h

1 
boﬁón
 
åy_timög_driví_rouã
(
s_rouãr_›ts
 
rouãr_›ts
,

2 **
√t_¶ack
,

3 **
√t_dñay
,

4 
t_ivec
 ** 
fb_›ös_u£d_loˇŒy
);

5 
boﬁón
 
timög_driví_rouã_√t
(
öë
,

6 
¥es_Ác
,

7 
max_¸ôiˇlôy
,

8 
¸ôiˇlôy_exp
,

9 
a°¨_Ác
,

10 
bíd_co°
,

11 *
√t_¶ack
,

12 *
pö_¸ôiˇlôy
,

13 *
sök_‹dî
,

14 
t_π_node
 ** 
π_node_of_sök
,

15 
T_¸ô
,

16 *
√t_dñay
);

17 
Æloc_timög_driví_rouã_°ru˘s
(**
pö_¸ôiˇlôy_±r
,

18 **
sök_‹dî_±r
,

19 
t_π_node
 *** 
π_node_of_sök_±r
);

20 
‰ì_timög_driví_rouã_°ru˘s
(*
pö_¸ôiˇlôy
,

21 *
sök_‹dî
,

22 
t_π_node
 ** 
π_node_of_sök
);

	@route_tree_timing.c

1 
	~<°dio.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"rouã_comm⁄.h
"

6 
	~"rouã_åì_timög.h
"

25 
t_π_node
 **
	gº_node_to_π_node
 = 
NULL
;

29 
t_π_node
 *
	gπ_node_‰ì_li°
 = 
NULL
;

30 
t_löked_π_edge
 *
	gπ_edge_‰ì_li°
 = 
NULL
;

36 
t_π_node
 *
Æloc_π_node
();

38 
‰ì_π_node
(
t_π_node
 * 
π_node
);

40 
t_löked_π_edge
 *
Æloc_löked_π_edge
();

42 
‰ì_löked_π_edge
(
t_löked_π_edge
 * 
π_edge
);

44 
t_π_node
 *
add_∑th_to_rouã_åì
(
s_hóp
 *
h±r
,

45 
t_π_node
 ** 
sök_π_node_±r
);

47 
lﬂd_√w_∑th_R_up°ªam
(
t_π_node
 * 
°¨t_of_√w_∑th_π_node
);

49 
t_π_node
 *
upd©e_unbuf„ªd_™˚°‹s_C_down°ªam
(t_rt_node

51 
°¨t_of_√w_∑th_π_node
);

53 
lﬂd_π_subåì_Tdñ
(
t_π_node
 * 
subåì_π_roŸ
,

54 
T¨rivÆ
);

61 
	$Æloc_rouã_åì_timög_°ru˘s
()

66 if(
º_node_to_π_node
 !
NULL
 || 
π_node_‰ì_li°
 != NULL ||

67 
π_node_‰ì_li°
 !
NULL
)

69 
	`¥ötf
("Error inálloc_route_tree_timing_structs: old structures "

71 
	`exô
(1);

74 
º_node_to_π_node
 = (
t_π_node
 **Ë
	`my_mÆloc
(
num_º_nodes
 *

75 (
t_π_node
 *));

76 
	}
}

80 
	$‰ì_rouã_åì_timög_°ru˘s
()

86 
t_π_node
 *
π_node
, *
√xt_node
;

87 
t_löked_π_edge
 *
π_edge
, *
√xt_edge
;

89 
	`‰ì
(
º_node_to_π_node
);

90 
º_node_to_π_node
 = 
NULL
;

92 
π_node
 = 
π_node_‰ì_li°
;

94 
π_node
 !
NULL
)

96 
√xt_node
 = 
π_node
->
u
.
√xt
;

97 
	`‰ì
(
π_node
);

98 
π_node
 = 
√xt_node
;

101 
π_node_‰ì_li°
 = 
NULL
;

103 
π_edge
 = 
π_edge_‰ì_li°
;

105 
π_edge
 !
NULL
)

107 
√xt_edge
 = 
π_edge
->
√xt
;

108 
	`‰ì
(
π_edge
);

109 
π_edge
 = 
√xt_edge
;

112 
π_edge_‰ì_li°
 = 
NULL
;

113 
	}
}

116 
t_π_node
 *

117 
	$Æloc_π_node
()

123 
t_π_node
 *
π_node
;

125 
π_node
 = 
π_node_‰ì_li°
;

127 if(
π_node
 !
NULL
)

129 
π_node_‰ì_li°
 = 
π_node
->
u
.
√xt
;

133 
π_node
 = (
t_π_node
 *Ë
	`my_mÆloc
((t_rt_node));

136  (
π_node
);

137 
	}
}

141 
	$‰ì_π_node
(
t_π_node
 * 
π_node
)

146 
π_node
->
u
.
√xt
 = 
π_node_‰ì_li°
;

147 
π_node_‰ì_li°
 = 
π_node
;

148 
	}
}

151 
t_löked_π_edge
 *

152 
	$Æloc_löked_π_edge
()

158 
t_löked_π_edge
 *
löked_π_edge
;

160 
löked_π_edge
 = 
π_edge_‰ì_li°
;

162 if(
löked_π_edge
 !
NULL
)

164 
π_edge_‰ì_li°
 = 
löked_π_edge
->
√xt
;

168 
löked_π_edge
 = (
t_löked_π_edge
 *Ë
	`my_mÆloc
(

169 (
t_löked_π_edge
));

172  (
löked_π_edge
);

173 
	}
}

177 
	$‰ì_löked_π_edge
(
t_löked_π_edge
 * 
π_edge
)

182 
π_edge
->
√xt
 = 
π_edge_‰ì_li°
;

183 
π_edge_‰ì_li°
 = 
π_edge
;

184 
	}
}

187 
t_π_node
 *

188 
	$öô_rouã_åì_to_sour˚
(
öë
)

194 
t_π_node
 *
π_roŸ
;

195 
öode
;

197 
π_roŸ
 = 
	`Æloc_π_node
();

198 
π_roŸ
->
u
.
chûd_li°
 = 
NULL
;

199 
π_roŸ
->
∑ª¡_node
 = 
NULL
;

200 
π_roŸ
->
∑ª¡_swôch
 = 
OPEN
;

201 
π_roŸ
->
ª_ex∑nd
 = 
TRUE
;

203 
öode
 = 
√t_º_ãrmöÆs
[
öë
][0];

205 
π_roŸ
->
öode
 = inode;

206 
π_roŸ
->
C_down°ªam
 = 
º_node
[
öode
].
C
;

207 
π_roŸ
->
R_up°ªam
 = 
º_node
[
öode
].
R
;

208 
π_roŸ
->
Tdñ
 = 0.5 * 
º_node
[
öode
].
R
 *Ñr_node[öode].
C
;

209 
º_node_to_π_node
[
öode
] = 
π_roŸ
;

211  (
π_roŸ
);

212 
	}
}

215 
t_π_node
 *

216 
	$upd©e_rouã_åì
(
s_hóp
 * 
h±r
)

224 
t_π_node
 *
°¨t_of_√w_∑th_π_node
, *
sök_π_node
;

225 
t_π_node
 *
unbuf„ªd_subåì_π_roŸ
, *
subåì_∑ª¡_π_node
;

226 
Tdñ_°¨t
;

227 
iswôch
;

229 
°¨t_of_√w_∑th_π_node
 = 
	`add_∑th_to_rouã_åì
(
h±r
, &
sök_π_node
);

230 
	`lﬂd_√w_∑th_R_up°ªam
(
°¨t_of_√w_∑th_π_node
);

231 
unbuf„ªd_subåì_π_roŸ
 =

232 
	`upd©e_unbuf„ªd_™˚°‹s_C_down°ªam
(
°¨t_of_√w_∑th_π_node
);

234 
subåì_∑ª¡_π_node
 = 
unbuf„ªd_subåì_π_roŸ
->
∑ª¡_node
;

236 if(
subåì_∑ª¡_π_node
 !
NULL
)

238 
Tdñ_°¨t
 = 
subåì_∑ª¡_π_node
->
Tdñ
;

239 
iswôch
 = 
unbuf„ªd_subåì_π_roŸ
->
∑ª¡_swôch
;

240 
Tdñ_°¨t
 +
swôch_öf
[
iswôch
].
R
 *

241 
unbuf„ªd_subåì_π_roŸ
->
C_down°ªam
;

242 
Tdñ_°¨t
 +
swôch_öf
[
iswôch
].
Tdñ
;

246 
Tdñ_°¨t
 = 0.;

249 
	`lﬂd_π_subåì_Tdñ
(
unbuf„ªd_subåì_π_roŸ
, 
Tdñ_°¨t
);

251  (
sök_π_node
);

252 
	}
}

255 
t_π_node
 *

256 
	$add_∑th_to_rouã_åì
(
s_hóp
 *
h±r
,

257 
t_π_node
 ** 
sök_π_node_±r
)

264 
öode
, 
ªmaöög_c⁄√˘i⁄s_to_sök
;

265 
õdge
, 
iswôch
;

266 
C_down°ªam
;

267 
t_π_node
 *
π_node
, *
down°ªam_π_node
, *
sök_π_node
;

268 
t_löked_π_edge
 *
löked_π_edge
;

271 
öode
 = 
h±r
->
ödex
;

273 #ifde‡
DEBUG


274 if(
º_node
[
öode
].
ty≥
 !
SINK
)

276 
¥ötf


278 
SINK
);

279 
	`¥ötf
("GŸÅy≥ = %d.", 
º_node
[
öode
].
ty≥
);

280 
	`exô
(1);

284 
ªmaöög_c⁄√˘i⁄s_to_sök
 = 
º_node_rouã_öf
[
öode
].
èrgë_Êag
;

285 
sök_π_node
 = 
	`Æloc_π_node
();

286 
sök_π_node
->
u
.
chûd_li°
 = 
NULL
;

287 
sök_π_node
->
öode
 = inode;

288 
C_down°ªam
 = 
º_node
[
öode
].
C
;

289 
sök_π_node
->
C_down°ªam
 = C_downstream;

290 
º_node_to_π_node
[
öode
] = 
sök_π_node
;

297 
	#NO_ROUTE_THROUGHS
 1

	)

299 #ifde‡
NO_ROUTE_THROUGHS


300 
sök_π_node
->
ª_ex∑nd
 = 
FALSE
;

302 if(
ªmaöög_c⁄√˘i⁄s_to_sök
 == 0)

304 
sök_π_node
->
ª_ex∑nd
 = 
TRUE
;

313 
sök_π_node
->
ª_ex∑nd
 = 
FALSE
;

320 
down°ªam_π_node
 = 
sök_π_node
;

321 
öode
 = 
h±r
->
u
.
¥ev_node
;

322 
õdge
 = 
h±r
->
¥ev_edge
;

323 
iswôch
 = 
º_node
[
öode
].
swôches
[
õdge
];

327 
º_node_rouã_öf
[
öode
].
¥ev_node
 !
NO_PREVIOUS
)

329 
löked_π_edge
 = 
	`Æloc_löked_π_edge
();

330 
löked_π_edge
->
chûd
 = 
down°ªam_π_node
;

331 
löked_π_edge
->
iswôch
 = iswitch;

332 
löked_π_edge
->
√xt
 = 
NULL
;

334 
π_node
 = 
	`Æloc_π_node
();

335 
down°ªam_π_node
->
∑ª¡_node
 = 
π_node
;

336 
down°ªam_π_node
->
∑ª¡_swôch
 = 
iswôch
;

338 
π_node
->
u
.
chûd_li°
 = 
löked_π_edge
;

339 
π_node
->
öode
 = inode;

341 if(
swôch_öf
[
iswôch
].
buf„ªd
 =
FALSE
)

342 
C_down°ªam
 +
º_node
[
öode
].
C
;

344 
C_down°ªam
 = 
º_node
[
öode
].
C
;

346 
π_node
->
C_down°ªam
 = C_downstream;

347 
º_node_to_π_node
[
öode
] = 
π_node
;

349 #ifde‡
NO_ROUTE_THROUGHS


350 if(
º_node
[
öode
].
ty≥
 =
IPIN
)

351 
π_node
->
ª_ex∑nd
 = 
FALSE
;

353 
π_node
->
ª_ex∑nd
 = 
TRUE
;

356 if(
ªmaöög_c⁄√˘i⁄s_to_sök
 == 0)

358 
π_node
->
ª_ex∑nd
 = 
TRUE
;

362 
π_node
->
ª_ex∑nd
 = 
FALSE
;

366 
ªmaöög_c⁄√˘i⁄s_to_sök
 = 0;

370 
down°ªam_π_node
 = 
π_node
;

371 
õdge
 = 
º_node_rouã_öf
[
öode
].
¥ev_edge
;

372 
öode
 = 
º_node_rouã_öf
[öode].
¥ev_node
;

373 
iswôch
 = 
º_node
[
öode
].
swôches
[
õdge
];

378 
π_node
 = 
º_node_to_π_node
[
öode
];

380 
löked_π_edge
 = 
	`Æloc_löked_π_edge
();

381 
löked_π_edge
->
chûd
 = 
down°ªam_π_node
;

382 
löked_π_edge
->
iswôch
 = iswitch;

383 
löked_π_edge
->
√xt
 = 
π_node
->
u
.
chûd_li°
;

384 
π_node
->
u
.
chûd_li°
 = 
löked_π_edge
;

386 
down°ªam_π_node
->
∑ª¡_node
 = 
π_node
;

387 
down°ªam_π_node
->
∑ª¡_swôch
 = 
iswôch
;

389 *
sök_π_node_±r
 = 
sök_π_node
;

390  (
down°ªam_π_node
);

391 
	}
}

395 
	$lﬂd_√w_∑th_R_up°ªam
(
t_π_node
 * 
°¨t_of_√w_∑th_π_node
)

401 
R_up°ªam
;

402 
öode
;

403 
iswôch
;

404 
t_π_node
 *
π_node
, *
∑ª¡_π_node
;

405 
t_löked_π_edge
 *
löked_π_edge
;

407 
π_node
 = 
°¨t_of_√w_∑th_π_node
;

408 
iswôch
 = 
π_node
->
∑ª¡_swôch
;

409 
öode
 = 
π_node
->inode;

410 
∑ª¡_π_node
 = 
π_node
->
∑ª¡_node
;

412 
R_up°ªam
 = 
swôch_öf
[
iswôch
].
R
 + 
º_node
[
öode
].R;

414 if(
swôch_öf
[
iswôch
].
buf„ªd
 =
FALSE
)

415 
R_up°ªam
 +
∑ª¡_π_node
->R_upstream;

417 
π_node
->
R_up°ªam
 = R_upstream;

423 
löked_π_edge
 = 
π_node
->
u
.
chûd_li°
;

425 
löked_π_edge
 !
NULL
)

428 #ifde‡
DEBUG


429 if(
löked_π_edge
->
√xt
 !
NULL
)

431 
¥ötf


434 
	`exô
(1);

438 
π_node
 = 
löked_π_edge
->
chûd
;

439 
iswôch
 = 
löked_π_edge
->iswitch;

440 
öode
 = 
π_node
->inode;

442 if(
swôch_öf
[
iswôch
].
buf„ªd
)

443 
R_up°ªam
 = 
swôch_öf
[
iswôch
].
R
 + 
º_node
[
öode
].R;

445 
R_up°ªam
 +
swôch_öf
[
iswôch
].
R
 + 
º_node
[
öode
].R;

447 
π_node
->
R_up°ªam
 = R_upstream;

448 
löked_π_edge
 = 
π_node
->
u
.
chûd_li°
;

450 
	}
}

453 
t_π_node
 *

454 
	$upd©e_unbuf„ªd_™˚°‹s_C_down°ªam
(
t_π_node


455 * 
°¨t_of_√w_∑th_π_node
)

463 
t_π_node
 *
π_node
, *
∑ª¡_π_node
;

464 
iswôch
;

465 
C_down°ªam_addôi⁄
;

467 
π_node
 = 
°¨t_of_√w_∑th_π_node
;

468 
C_down°ªam_addôi⁄
 = 
π_node
->
C_down°ªam
;

469 
∑ª¡_π_node
 = 
π_node
->
∑ª¡_node
;

470 
iswôch
 = 
π_node
->
∑ª¡_swôch
;

472 
∑ª¡_π_node
 !
NULL
 && 
swôch_öf
[
iswôch
].
buf„ªd
 =
FALSE
)

474 
π_node
 = 
∑ª¡_π_node
;

475 
π_node
->
C_down°ªam
 +
C_down°ªam_addôi⁄
;

476 
∑ª¡_π_node
 = 
π_node
->
∑ª¡_node
;

477 
iswôch
 = 
π_node
->
∑ª¡_swôch
;

480  (
π_node
);

481 
	}
}

485 
	$lﬂd_π_subåì_Tdñ
(
t_π_node
 * 
subåì_π_roŸ
,

486 
T¨rivÆ
)

494 
öode
;

495 
iswôch
;

496 
t_π_node
 *
chûd_node
;

497 
t_löked_π_edge
 *
löked_π_edge
;

498 
Tdñ
, 
Tchûd
;

500 
öode
 = 
subåì_π_roŸ
->inode;

506 
Tdñ
 = 
T¨rivÆ
 + 0.5 * 
subåì_π_roŸ
->
C_down°ªam
 * 
º_node
[
öode
].
R
;

507 
subåì_π_roŸ
->
Tdñ
 = Tdel;

512 
löked_π_edge
 = 
subåì_π_roŸ
->
u
.
chûd_li°
;

514 
löked_π_edge
 !
NULL
)

516 
iswôch
 = 
löked_π_edge
->iswitch;

517 
chûd_node
 = 
löked_π_edge
->
chûd
;

519 
Tchûd
 = 
Tdñ
 + 
swôch_öf
[
iswôch
].
R
 * 
chûd_node
->
C_down°ªam
;

520 
Tchûd
 +
swôch_öf
[
iswôch
].
Tdñ
;

521 
	`lﬂd_π_subåì_Tdñ
(
chûd_node
, 
Tchûd
);

523 
löked_π_edge
 =Üöked_π_edge->
√xt
;

525 
	}
}

529 
	$‰ì_rouã_åì
(
t_π_node
 * 
π_node
)

535 
t_π_node
 *
chûd_node
;

536 
t_löked_π_edge
 *
π_edge
, *
√xt_edge
;

538 
π_edge
 = 
π_node
->
u
.
chûd_li°
;

540 
π_edge
 !
NULL
)

542 
chûd_node
 = 
π_edge
->
chûd
;

543 
	`‰ì_rouã_åì
(
chûd_node
);

544 
√xt_edge
 = 
π_edge
->
√xt
;

545 
	`‰ì_löked_π_edge
(
π_edge
);

546 
π_edge
 = 
√xt_edge
;

549 
	`‰ì_π_node
(
π_node
);

550 
	}
}

554 
	$upd©e_√t_dñays_‰om_rouã_åì
(*
√t_dñay
,

555 
t_π_node
 ** 
π_node_of_sök
,

556 
öë
)

562 
isök
;

563 
t_π_node
 *
sök_π_node
;

565 
isök
 = 1; isök <
√t
[
öë
].
num_söks
; isink++)

567 
sök_π_node
 = 
π_node_of_sök
[
isök
];

568 
√t_dñay
[
isök
] = 
sök_π_node
->
Tdñ
;

570 
	}
}

	@route_tree_timing.h

3 
	ss_löked_π_edge


5 
s_π_node
 *
	mchûd
;

6 
	miswôch
;

7 
s_löked_π_edge
 *
	m√xt
;

10 
s_löked_π_edge
 
	tt_löked_π_edge
;

20 
	ss_π_node


24 
t_löked_π_edge
 *
	mchûd_li°
;

25 
s_π_node
 *
	m√xt
;

27 
	mu
;

28 
s_π_node
 *
	m∑ª¡_node
;

29 
	m∑ª¡_swôch
;

30 
	mª_ex∑nd
;

31 
	möode
;

32 
	mC_down°ªam
;

33 
	mR_up°ªam
;

34 
	mTdñ
;

37 
s_π_node
 
	tt_π_node
;

65 
Æloc_rouã_åì_timög_°ru˘s
();

67 
‰ì_rouã_åì_timög_°ru˘s
();

69 
t_π_node
 *
öô_rouã_åì_to_sour˚
(
öë
);

71 
‰ì_rouã_åì
(
t_π_node
 * 
π_node
);

73 
t_π_node
 *
upd©e_rouã_åì
(
s_hóp
 *
h±r
);

75 
upd©e_√t_dñays_‰om_rouã_åì
(*
√t_dñay
,

76 
t_π_node
 ** 
π_node_of_sök
,

77 
öë
);

	@rr_graph.c

1 
	~<°dio.h
>

2 
	~<m©h.h
>

3 
	~<as£π.h
>

4 
	~<°rög.h
>

5 
	~"utû.h
"

6 
	~"v¥_ty≥s.h
"

7 
	~"globÆs.h
"

8 
	~"º_gøph_utû.h
"

9 
	~"º_gøph.h
"

10 
	~"º_gøph2.h
"

11 
	~"º_gøph_sbox.h
"

12 
	~"check_º_gøph.h
"

13 
	~"º_gøph_timög_∑øms.h
"

14 
	~"º_gøph_ödexed_d©a.h
"

15 
	~"v¥_utûs.h
"

23 
	#REVERSE_OPIN_ORDER


	)

26 
	#MUX_SIZE_DIST_DISPLAY


	)

30 
	ss_mux


32 
	msize
;

33 
s_mux
 *
	m√xt
;

35 
	tt_mux
;

37 
	ss_mux_size_di°ributi⁄


39 
	mmux_cou¡
;

40 
	mmax_ödex
;

41 *
	mdi°r
;

42 
s_mux_size_di°ributi⁄
 *
	m√xt
;

44 
	tt_mux_size_di°ributi⁄
;

51 
s_löked_v±r
 *
	gº_mem_chunk_li°_hód
 = 
NULL
;

55 
	gchunk_byãs_avaû
 = 0;

56 *
	gchunk_√xt_avaû_mem
 = 
NULL
;

61 ****
Æloc_™d_lﬂd_pö_to_åack_m≠
(
IN
 
e_pö_ty≥
 
pö_ty≥
,

62 
IN
 
nodes_≥r_ch™
,

63 
IN
 
Fc
,

64 
IN
 
t_ty≥_±r
 
Ty≥
,

65 
IN
 
boﬁón


66 
≥πurb_swôch_∑âîn
,

67 
IN
 
e_dúe˘i⁄Æôy


68 
dúe˘i⁄Æôy
);

70 
s_ivec
 ***
Æloc_™d_lﬂd_åack_to_pö_lookup
(
IN
 

71 ****
pö_to_åack_m≠
,

72 
IN
 
Fc
,

73 
IN
 
height
,

74 
IN
 
num_pös
,

75 
IN
 

76 
nodes_≥r_ch™
);

78 
buûd_bidú_º_›ös
(
IN
 
i
,

79 
IN
 
j
,

80 
INOUT
 
t_º_node
 * 
º_node
,

81 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

82 
IN
 *****
›ö_to_åack_m≠
,

83 
IN
 *
Fc_out
,

84 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

85 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

86 
IN
 
s_grid_tûe
 **
grid
);

88 
buûd_unidú_º_›ös
(
IN
 
i
,

89 
IN
 
j
,

90 
IN
 
s_grid_tûe
 **
grid
,

91 
IN
 *
Fc_out
,

92 
IN
 
nodes_≥r_ch™
,

93 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

94 
INOUT
 **
Fc_xofs
,

95 
INOUT
 **
Fc_yofs
,

96 
INOUT
 
t_º_node
 * 
º_node
,

97 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

98 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
,

99 
IN
 
t_ivec
 *** 
º_node_ödi˚s
);

101 
Æloc_™d_lﬂd_º_gøph
(
IN
 
num_nodes
,

102 
IN
 
t_º_node
 * 
º_node
,

103 
IN
 
num_£g_ty≥s
,

104 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

105 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

106 
IN
 
s_ivec
 ****
åack_to_ùö_lookup
,

107 
IN
 *****
›ö_to_åack_m≠
,

108 
IN
 
s_ivec
 ***
swôch_block_c⁄n
,

109 
IN
 
s_grid_tûe
 **
grid
,

110 
IN
 
nx
,

111 
IN
 
ny
,

112 
IN
 
Fs
,

113 
IN
 *****
sblock_∑âîn
,

114 
IN
 *
Fc_out
,

115 
IN
 **
Fc_xofs
,

116 
IN
 **
Fc_yofs
,

117 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

118 
IN
 
nodes_≥r_ch™
,

119 
IN
 
e_swôch_block_ty≥
 
sb_ty≥
,

120 
IN
 
dñayÀss_swôch
,

121 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

122 
IN
 
wúe_to_ùö_swôch
,

123 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
);

125 
lﬂd_unif‹m_swôch_∑âîn
(
IN
 
t_ty≥_±r
 
ty≥
,

126 
INOUT
 ****
åacks_c⁄√˘ed_to_pö
,

127 
IN
 
num_phys_pös
,

128 
IN
 *
pö_num_‹dîög
,

129 
IN
 *
side_‹dîög
,

130 
IN
 *
off£t_‹dîög
,

131 
IN
 
nodes_≥r_ch™
,

132 
IN
 
Fc
,

133 
IN
 
e_dúe˘i⁄Æôy


134 
dúe˘i⁄Æôy
);

136 
lﬂd_≥πurbed_swôch_∑âîn
(
IN
 
t_ty≥_±r
 
ty≥
,

137 
INOUT
 

138 ****
åacks_c⁄√˘ed_to_pö
,

139 
IN
 
num_phys_pös
,

140 
IN
 *
pö_num_‹dîög
,

141 
IN
 *
side_‹dîög
,

142 
IN
 *
off£t_‹dîög
,

143 
IN
 
nodes_≥r_ch™
,

144 
IN
 
Fc
,

145 
IN
 
e_dúe˘i⁄Æôy


146 
dúe˘i⁄Æôy
);

148 
check_Æl_åacks_ªach_pös
(
t_ty≥_±r
 
ty≥
,

149 ****
åacks_c⁄√˘ed_to_pö
,

150 
nodes_≥r_ch™
,

151 
Fc
,

152 
e_pö_ty≥
 
ùö_‹_›ö
);

154 
åack_side
(
˛b_side
);

156 
boﬁón
 *
Æloc_™d_lﬂd_≥πurb_ùös
(
IN
 
nodes_≥r_ch™
,

157 
IN
 
num_ty≥s
,

158 
IN
 *
Fc_ö
,

159 
IN
 *
Fc_out
,

160 
IN
 
e_dúe˘i⁄Æôy


161 
dúe˘i⁄Æôy
);

164 
¥öt_º_node
(
FILE
 * 
Â
,

165 
t_º_node
 * 
º_node
,

166 
öode
);

168 
buûd_º_söks_sour˚s
(
IN
 
i
,

169 
IN
 
j
,

170 
IN
 
t_º_node
 * 
º_node
,

171 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

172 
IN
 
dñayÀss_swôch
,

173 
IN
 
s_grid_tûe
 **
grid
);

175 
buûd_º_xch™
(
IN
 
i
,

176 
IN
 
j
,

177 
IN
 
s_ivec
 ****
åack_to_ùö_lookup
,

178 
IN
 
s_ivec
 ***
swôch_block_c⁄n
,

179 
IN
 
co°_ödex_off£t
,

180 
IN
 
nodes_≥r_ch™
,

181 
IN
 *
›ö_mux_size
,

182 
IN
 *****
sblock_∑âîn
,

183 
IN
 
Fs_≥r_side
,

184 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

185 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

186 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

187 
INOUT
 
t_º_node
 * 
º_node
,

188 
IN
 
wúe_to_ùö_swôch
,

189 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
);

191 
buûd_º_ych™
(
IN
 
i
,

192 
IN
 
j
,

193 
IN
 
s_ivec
 ****
åack_to_ùö_lookup
,

194 
IN
 
s_ivec
 ***
swôch_block_c⁄n
,

195 
IN
 
co°_ödex_off£t
,

196 
IN
 
nodes_≥r_ch™
,

197 
IN
 *
›ö_mux_size
,

198 
IN
 *****
sblock_∑âîn
,

199 
IN
 
Fs_≥r_side
,

200 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

201 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

202 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

203 
INOUT
 
t_º_node
 * 
º_node
,

204 
IN
 
wúe_to_ùö_swôch
,

205 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
);

208 
º_gøph_exã∫Æs
(

209 
t_timög_öf
 
timög_öf
,

210 
t_£gmít_öf
 * 
£gmít_öf
,

211 
num_£g_ty≥s
,

212 
nodes_≥r_ch™
,

213 
wúe_to_ùö_swôch
,

214 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
);

216 
Æloc_™d_lﬂd_edges_™d_swôches
(
IN
 
t_º_node
 * 
º_node
,

217 
IN
 
öode
,

218 
IN
 
num_edges
,

219 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

220 
IN
 
t_löked_edge
 * 
edge_li°_hód
);

222 
Æloc_√t_º_ãrmöÆs
();

224 
Æloc_™d_lﬂd_º_˛b_sour˚
(
t_ivec
 *** 
º_node_ödi˚s
);

227 
lﬂd_unif‹m_›ö_swôch_∑âîn_∑úed
(
IN
 *
Fc_out
,

228 
IN
 
num_pös
,

229 
IN
 *
pös_ö_ch™_£g
,

230 
IN
 
num_wúe_öc_muxes
,

231 
IN
 
num_wúe_dec_muxes
,

232 
IN
 *
wúe_öc_muxes
,

233 
IN
 *
wúe_dec_muxes
,

234 
INOUT
 
t_º_node
 * 
º_node
,

235 
INOUT
 
boﬁón
 *

236 
º_edge_d⁄e
,

237 
IN
 
t_£g_dëaûs
 *

238 
£g_dëaûs
,

239 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
);

241 *
gë_adj_›ös
(
IN
 
i
,

242 
IN
 
j
,

243 
OUT
 *
num_pös
,

244 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

245 
IN
 
e_º_ty≥
 
ch™_ty≥
);

247 
w©ch_edges
(
öode
,

248 
t_löked_edge
 * 
edge_li°_hód
);

250 
võw_mux_size_di°ributi⁄
(
t_ivec
 *** 
º_node_ödi˚s
,

251 
nodes_≥r_ch™
,

252 
t_£g_dëaûs
 * 
£g_dëaûs_x
,

253 
t_£g_dëaûs
 * 
£g_dëaûs_y
);

255 
¥öt_di°ributi⁄
(
FILE
 * 
Âå
,

256 
t_mux_size_di°ributi⁄
 * 
di°r_°ru˘
);

258 
‰ì_ty≥_pö_to_åack_m≠
(***** 
ùö_to_åack_m≠
, 
t_ty≥_±r
 
ty≥s
, * 
fc_ö
);

260 
‰ì_ty≥_åack_to_ùö_m≠
(
s_ivec
**** 
åack_to_pö_m≠
, 
t_ty≥_±r
 
ty≥s
, 
nodes_≥r_ch™
);

262 
t_£g_dëaûs
 *
Æloc_™d_lﬂd_globÆ_rouã_£g_dëaûs
(
IN
 

263 
nodes_≥r_ch™
,

264 
IN
 

265 
globÆ_rouã_swôch
);

269 *
Æloc_™d_lﬂd_a˘uÆ_fc
(
IN
 
num_ty≥s
,

270 
IN
 
t_ty≥_±r
 
ty≥s
,

271 
IN
 
nodes_≥r_ch™
,

272 
IN
 
boﬁón
 
is_Fc_out
,

273 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

274 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
);

280 
	$buûd_º_gøph
(
IN
 
t_gøph_ty≥
 
gøph_ty≥
,

281 
IN
 
num_ty≥s
,

282 
IN
 
t_ty≥_±r
 
ty≥s
,

283 
IN
 
nx
,

284 
IN
 
ny
,

285 
IN
 
s_grid_tûe
 **
grid
,

286 
IN
 
ch™_width
,

287 
IN
 
s_ch™_width_di°
 *
ch™_ˇ∑côy_öf
,

288 
IN
 
e_swôch_block_ty≥
 
sb_ty≥
,

289 
IN
 
Fs
,

290 
IN
 
num_£g_ty≥s
,

291 
IN
 
num_swôches
,

292 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

293 
IN
 
globÆ_rouã_swôch
,

294 
IN
 
dñayÀss_swôch
,

295 
IN
 
t_timög_öf
 
timög_öf
,

296 
IN
 
wúe_to_ùö_swôch
,

297 
IN
 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
,

298 
OUT
 *
W¨nögs
)

301 
nodes_≥r_ch™
, 
i
, 
j
;

302 
t_£g_dëaûs
 *
£g_dëaûs
 = 
NULL
;

303 *
Fc_ö
 = 
NULL
;

304 *
Fc_out
 = 
NULL
;

306 *****
›ö_to_åack_m≠
 = 
NULL
;

307 *****
ùö_to_åack_m≠
 = 
NULL
;

308 
t_ivec
 ****
åack_to_ùö_lookup
 = 
NULL
;

309 
t_ivec
 ***
swôch_block_c⁄n
 = 
NULL
;

310 *****
unidú_sb_∑âîn
 = 
NULL
;

311 
boﬁón
 *
º_edge_d⁄e
 = 
NULL
;

312 
boﬁón
 
is_globÆ_gøph
;

313 
boﬁón
 
Fc_˛ù≥d
;

314 
boﬁón
 
u£_fuŒ_£g_groups
;

315 
boﬁón
 *
≥πurb_ùös
 = 
NULL
;

316 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
;

317 **
Fc_xofs
 = 
NULL
;

318 **
Fc_yofs
 = 
NULL
;

320 
º_node_ödi˚s
 = 
NULL
;

321 
º_node
 = 
NULL
;

322 
num_º_nodes
 = 0;

325 *
W¨nögs
 = 
RR_GRAPH_NO_WARN
;

328 
is_globÆ_gøph
 = 
FALSE
;

329 if(
GRAPH_GLOBAL
 =
gøph_ty≥
)

331 
is_globÆ_gøph
 = 
TRUE
;

333 
u£_fuŒ_£g_groups
 = 
FALSE
;

334 if(
GRAPH_UNIDIR_TILEABLE
 =
gøph_ty≥
)

336 
u£_fuŒ_£g_groups
 = 
TRUE
;

338 
dúe˘i⁄Æôy
 = 
UNI_DIRECTIONAL
;

339 if(
GRAPH_BIDIR
 =
gøph_ty≥
)

341 
dúe˘i⁄Æôy
 = 
BI_DIRECTIONAL
;

343 if(
is_globÆ_gøph
)

345 
dúe˘i⁄Æôy
 = 
BI_DIRECTIONAL
;

350 
nodes_≥r_ch™
 = (
is_globÆ_gøph
 ? 1 : 
ch™_width
);

351 
	`as£π
(
nodes_≥r_ch™
 > 0);

356 if(
is_globÆ_gøph
)

359 
£g_dëaûs
 =

360 
	`Æloc_™d_lﬂd_globÆ_rouã_£g_dëaûs
(
nodes_≥r_ch™
,

361 
globÆ_rouã_swôch
);

368 
£g_dëaûs
 = 
	`Æloc_™d_lﬂd_£g_dëaûs
(&
nodes_≥r_ch™
,

369 
	`max
(
nx
, 
ny
),

370 
num_£g_ty≥s
,

371 
£gmít_öf
,

372 
u£_fuŒ_£g_groups
,

373 
is_globÆ_gøph
,

374 
dúe˘i⁄Æôy
);

375 if((
is_globÆ_gøph
 ? 1 : 
ch™_width
Ë!
nodes_≥r_ch™
)

377 *
W¨nögs
 |
RR_GRAPH_WARN_CHAN_WIDTH_CHANGED
;

379 #ifde‡
CREATE_ECHO_FILES


380 
	`dump_£g_dëaûs
(
£g_dëaûs
, 
nodes_≥r_ch™
, "seg_details.txt");

389 if(
is_globÆ_gøph
)

391 
Fc_ö
 = (*)
	`my_mÆloc
((Ë* 
num_ty≥s
);

392 
Fc_out
 = (*)
	`my_mÆloc
((Ë* 
num_ty≥s
);

393 
i
 = 0; i < 
num_ty≥s
; ++i)

395 
Fc_ö
[
i
] = 1;

396 
Fc_out
[
i
] = 1;

401 
Fc_˛ù≥d
 = 
FALSE
;

402 
Fc_ö
 =

403 
	`Æloc_™d_lﬂd_a˘uÆ_fc
(
num_ty≥s
, 
ty≥s
, 
nodes_≥r_ch™
,

404 
FALSE
, 
dúe˘i⁄Æôy
, &
Fc_˛ù≥d
);

405 if(
Fc_˛ù≥d
)

407 *
W¨nögs
 |
RR_GRAPH_WARN_FC_CLIPPED
;

409 
Fc_˛ù≥d
 = 
FALSE
;

410 
Fc_out
 =

411 
	`Æloc_™d_lﬂd_a˘uÆ_fc
(
num_ty≥s
, 
ty≥s
, 
nodes_≥r_ch™
,

412 
TRUE
, 
dúe˘i⁄Æôy
, &
Fc_˛ù≥d
);

413 if(
Fc_˛ù≥d
)

415 *
W¨nögs
 |
RR_GRAPH_WARN_FC_CLIPPED
;

419 #ifde‡
VERBOSE


420 
i
 = 1; i < 
num_ty≥s
; ++i)

422 if(
ty≥_des¸ùt‹s
[
i
].
is_Fc_out_fuŒ_Êex
)

424 
¥ötf


426 
ty≥_des¸ùt‹s
[
i
].
«me
, 
Fc_öput
[i]);

430 
¥ötf


432 
ty≥_des¸ùt‹s
[
i
].
«me
, 
Fc_ouçut
[i],

433 
Fc_öput
[
i
]);

439 
≥πurb_ùös
 =

440 
	`Æloc_™d_lﬂd_≥πurb_ùös
(
nodes_≥r_ch™
, 
num_ty≥s
, 
Fc_ö
,

441 
Fc_out
, 
dúe˘i⁄Æôy
);

446 
num_º_nodes
 = 0;

447 
º_node_ödi˚s
 =

448 
	`Æloc_™d_lﬂd_º_node_ödi˚s
(
nodes_≥r_ch™
, 
nx
, 
ny
, &
num_º_nodes
,

449 
£g_dëaûs
);

450 
º_node
 = (
t_º_node
 *Ë
	`my_mÆloc
(—_º_nodeË* 
num_º_nodes
);

451 
	`mem£t
(
º_node
, 0, (
t_º_node
Ë* 
num_º_nodes
);

452 
º_edge_d⁄e
 = (
boﬁón
 *Ë
	`my_mÆloc
((boﬁónË* 
num_º_nodes
);

453 
	`mem£t
(
º_edge_d⁄e
, 0, (
boﬁón
Ë* 
num_º_nodes
);

456 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

458 
Fc_xofs
 = (**)
	`Æloc_m©rix
(0, 
ny
, 0, 
nx
, ());

459 
Fc_yofs
 = (**)
	`Æloc_m©rix
(0, 
nx
, 0, 
ny
, ());

460 
i
 = 0; i <
nx
; ++i)

462 
j
 = 0; j <
ny
; ++j)

464 
Fc_xofs
[
j
][
i
] = 0;

465 
Fc_yofs
[
i
][
j
] = 0;

474 if(
is_globÆ_gøph
)

476 
	`as£π
(
nodes_≥r_ch™
 == 1);

477 
swôch_block_c⁄n
 =

478 
	`Æloc_™d_lﬂd_swôch_block_c⁄n
(1, 
SUBSET
, 3);

480 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

482 
swôch_block_c⁄n
 =

483 
	`Æloc_™d_lﬂd_swôch_block_c⁄n
(
nodes_≥r_ch™
, 
sb_ty≥
, 
Fs
);

487 
	`as£π
(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
);

489 
unidú_sb_∑âîn
 =

490 
	`Æloc_sblock_∑âîn_lookup
(
nx
, 
ny
, 
nodes_≥r_ch™
);

491 
i
 = 0; i <
nx
; i++)

493 
j
 = 0; j <
ny
; j++)

495 
	`lﬂd_sblock_∑âîn_lookup
(
i
, 
j
, 
nodes_≥r_ch™
,

496 
£g_dëaûs
, 
Fs
,

497 
sb_ty≥
,

498 
unidú_sb_∑âîn
);

508 
ùö_to_åack_m≠
 = (*****)
	`my_mÆloc
((****Ë* 
num_ty≥s
);

509 
åack_to_ùö_lookup
 =

510 (
s_ivec
 ****)
	`my_mÆloc
((s_ive¯***Ë* 
num_ty≥s
);

511 
i
 = 0; i < 
num_ty≥s
; ++i)

513 
ùö_to_åack_m≠
[
i
] = 
	`Æloc_™d_lﬂd_pö_to_åack_m≠
(
RECEIVER
,

514 
nodes_≥r_ch™
,

515 
Fc_ö
[
i
],

516 &
ty≥s
[
i
],

517 
≥πurb_ùös


518 [
i
],

519 
dúe˘i⁄Æôy
);

520 
åack_to_ùö_lookup
[
i
] =

521 
	`Æloc_™d_lﬂd_åack_to_pö_lookup
(
ùö_to_åack_m≠
[
i
],

522 
Fc_ö
[
i
], 
ty≥s
[i].
height
,

523 
ty≥s
[
i
].
num_pös
,

524 
nodes_≥r_ch™
);

532 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

534 
›ö_to_åack_m≠
 =

535 (*****)
	`my_mÆloc
((****Ë* 
num_ty≥s
);

536 
i
 = 0; i < 
num_ty≥s
; ++i)

538 
›ö_to_åack_m≠
[
i
] =

539 
	`Æloc_™d_lﬂd_pö_to_åack_m≠
(
DRIVER
,

540 
nodes_≥r_ch™
,

541 
Fc_out
[
i
], &
ty≥s
[i],

542 
FALSE
,

543 
dúe˘i⁄Æôy
);

550 
i
 = 0; i < 
num_º_nodes
; i++)

552 
º_node
[
i
].
num_wúe_drivîs
 = 0;

553 
º_node
[
i
].
num_›ö_drivîs
 = 0;

557 
	`Æloc_™d_lﬂd_º_gøph
(
num_º_nodes
, 
º_node
, 
num_£g_ty≥s
,

558 
£g_dëaûs
, 
º_edge_d⁄e
,

559 
åack_to_ùö_lookup
, 
›ö_to_åack_m≠
,

560 
swôch_block_c⁄n
, 
grid
, 
nx
,

561 
ny
, 
Fs
, 
unidú_sb_∑âîn
, 
Fc_out
, 
Fc_xofs
,

562 
Fc_yofs
, 
º_node_ödi˚s
, 
nodes_≥r_ch™
,

563 
sb_ty≥
, 
dñayÀss_swôch
, 
dúe˘i⁄Æôy
,

564 
wúe_to_ùö_swôch
, &
Fc_˛ù≥d
);

568 #ifde‡
MUX_SIZE_DIST_DISPLAY


569 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

571 
	`võw_mux_size_di°ributi⁄
(
º_node_ödi˚s
, 
nodes_≥r_ch™
,

572 
£g_dëaûs
, seg_details);

578 if(
gøph_ty≥
 =
GLOBAL
) {

579 
i
 = 0; i < 
num_º_nodes
; i++) {

580 if(
º_node
[
i
].
ty≥
 =
CHANX
 ||Ñr_node[i].ty≥ =
CHANY
) {

581 
º_node
[
i
].
ˇ∑côy
 = 
ch™_width
;

586 
	`º_gøph_exã∫Æs
(
timög_öf
, 
£gmít_öf
, 
num_£g_ty≥s
,

587 
nodes_≥r_ch™
, 
wúe_to_ùö_swôch
, 
ba£_co°_ty≥
);

589 #ifde‡
CREATE_ECHO_FILES


590 
	`dump_º_gøph
("rr_graph.echo");

593 
	`check_º_gøph
(
gøph_ty≥
, 
num_ty≥s
, 
ty≥s
, 
nx
, 
ny
,

594 
grid
, 
nodes_≥r_ch™
, 
Fs
, 
num_£g_ty≥s
, 
num_swôches
, 
£gmít_öf
,

595 
globÆ_rouã_swôch
, 
dñayÀss_swôch
,

596 
wúe_to_ùö_swôch
, 
£g_dëaûs
, 
Fc_ö
, 
Fc_out
,

597 
º_node_ödi˚s
, 
›ö_to_åack_m≠
, 
ùö_to_åack_m≠
,

598 
åack_to_ùö_lookup
, 
swôch_block_c⁄n
, 
≥πurb_ùös
);

601 if(
£g_dëaûs
)

603 
	`‰ì_£g_dëaûs
(
£g_dëaûs
, 
nodes_≥r_ch™
);

604 
£g_dëaûs
 = 
NULL
;

606 if(
Fc_ö
)

608 
	`‰ì
(
Fc_ö
);

609 
Fc_ö
 = 
NULL
;

611 if(
Fc_out
)

613 
	`‰ì
(
Fc_out
);

614 
Fc_out
 = 
NULL
;

616 if(
≥πurb_ùös
)

618 
	`‰ì
(
≥πurb_ùös
);

619 
≥πurb_ùös
 = 
NULL
;

621 if(
swôch_block_c⁄n
)

623 
	`‰ì_swôch_block_c⁄n
(
swôch_block_c⁄n
, 
nodes_≥r_ch™
);

624 
swôch_block_c⁄n
 = 
NULL
;

626 if(
º_edge_d⁄e
)

628 
	`‰ì
(
º_edge_d⁄e
);

629 
º_edge_d⁄e
 = 
NULL
;

631 if(
Fc_xofs
)

633 
	`‰ì_m©rix
(
Fc_xofs
, 0, 
ny
, 0, ());

634 
Fc_xofs
 = 
NULL
;

636 if(
Fc_yofs
)

638 
	`‰ì_m©rix
(
Fc_yofs
, 0, 
nx
, 0, ());

639 
Fc_yofs
 = 
NULL
;

641 if(
unidú_sb_∑âîn
)

643 
	`‰ì_sblock_∑âîn_lookup
(
unidú_sb_∑âîn
);

644 
unidú_sb_∑âîn
 = 
NULL
;

646 if(
›ö_to_åack_m≠
) {

647 
i
 = 0; i < 
num_ty≥s
; ++i)

649 
	`‰ì_m©rix4
(
›ö_to_åack_m≠
[
i
], 0, 
ty≥s
[i].
num_pös
 - 1,

650 0, 
ty≥s
[
i
].
height
 - 1, 0, 3, 0, ());

652 
	`‰ì
(
›ö_to_åack_m≠
);

655 
	`‰ì_ty≥_pö_to_åack_m≠
(
ùö_to_åack_m≠
, 
ty≥s
, 
Fc_ö
);

656 
	`‰ì_ty≥_åack_to_ùö_m≠
(
åack_to_ùö_lookup
, 
ty≥s
, 
nodes_≥r_ch™
);

657 
	}
}

661 
	$º_gøph_exã∫Æs
–
t_timög_öf
 
timög_öf
,

662 
t_£gmít_öf
 * 
£gmít_öf
,

663 
num_£g_ty≥s
,

664 
nodes_≥r_ch™
,

665 
wúe_to_ùö_swôch
,

666 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
)

668 
	`add_º_gøph_C_‰om_swôches
(
timög_öf
.
C_ùö_cblock
);

669 
	`Æloc_™d_lﬂd_º_ödexed_d©a
(
£gmít_öf
, 
num_£g_ty≥s
,

670 
º_node_ödi˚s
, 
nodes_≥r_ch™
,

671 
wúe_to_ùö_swôch
, 
ba£_co°_ty≥
);

673 
	`Æloc_√t_º_ãrmöÆs
();

674 
	`lﬂd_√t_º_ãrmöÆs
(
º_node_ödi˚s
);

675 
	`Æloc_™d_lﬂd_º_˛b_sour˚
(
º_node_ödi˚s
);

676 
	}
}

679 
boﬁón
 *

680 
	$Æloc_™d_lﬂd_≥πurb_ùös
(
IN
 
nodes_≥r_ch™
,

681 
IN
 
num_ty≥s
,

682 
IN
 *
Fc_ö
,

683 
IN
 *
Fc_out
,

684 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

686 
i
;

687 
Fc_øtio
;

688 
boﬁón
 *
ªsu…
 = 
NULL
;

690 
ªsu…
 = (
boﬁón
 *Ë
	`my_mÆloc
(
num_ty≥s
 * (boolean));

692 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

694 
i
 = 0; i < 
num_ty≥s
; ++i)

696 
ªsu…
[
i
] = 
FALSE
;

698 if(
Fc_ö
[
i
] > 
Fc_out
[i])

700 
Fc_øtio
 = ()
Fc_ö
[
i
] / ()
Fc_out
[i];

704 
Fc_øtio
 = ()
Fc_out
[
i
] / ()
Fc_ö
[i];

707 if((
Fc_ö
[
i
] <
nodes_≥r_ch™
 - 2) &&

708 (
	`Ábs
(
Fc_øtio
 - 
	`nöt
(Fc_ratio)) <

709 (0.5 / ()
nodes_≥r_ch™
)))

711 
ªsu…
[
i
] = 
TRUE
;

719 
	`as£π
(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
);

720 
i
 = 0; i < 
num_ty≥s
; ++i)

722 
ªsu…
[
i
] = 
FALSE
;

726  
ªsu…
;

727 
	}
}

730 
t_£g_dëaûs
 *

731 
	$Æloc_™d_lﬂd_globÆ_rouã_£g_dëaûs
(
IN
 
nodes_≥r_ch™
,

732 
IN
 
globÆ_rouã_swôch
)

734 
t_£g_dëaûs
 *
ªsu…
 = 
NULL
;

736 
	`as£π
(
nodes_≥r_ch™
 == 1);

737 
ªsu…
 = (
t_£g_dëaûs
 *Ë
	`my_mÆloc
((t_seg_details));

739 
ªsu…
->
ödex
 = 0;

740 
ªsu…
->
Àngth
 = 1;

741 
ªsu…
->
wúe_swôch
 = 
globÆ_rouã_swôch
;

742 
ªsu…
->
›ö_swôch
 = 
globÆ_rouã_swôch
;

743 
ªsu…
->
l⁄glöe
 = 
FALSE
;

744 
ªsu…
->
dúe˘i⁄
 = 
BI_DIRECTION
;

745 
ªsu…
->
CmëÆ
 = 0.0;

746 
ªsu…
->
RmëÆ
 = 0.0;

747 
ªsu…
->
°¨t
 = 1;

748 
ªsu…
->
drivîs
 = 
MULTI_BUFFERED
;

749 
ªsu…
->
cb
 = (
boﬁón
 *Ë
	`my_mÆloc
((boolean) * 1);

750 
ªsu…
->
cb
[0] = 
TRUE
;

751 
ªsu…
->
sb
 = (
boﬁón
 *Ë
	`my_mÆloc
((boolean) * 2);

752 
ªsu…
->
sb
[0] = 
TRUE
;

753 
ªsu…
->
sb
[1] = 
TRUE
;

754 
ªsu…
->
group_size
 = 1;

755 
ªsu…
->
group_°¨t
 = 0;

757  
ªsu…
;

758 
	}
}

765 
	$Æloc_™d_lﬂd_a˘uÆ_fc
(
IN
 
num_ty≥s
,

766 
IN
 
t_ty≥_±r
 
ty≥s
,

767 
IN
 
nodes_≥r_ch™
,

768 
IN
 
boﬁón
 
is_Fc_out
,

769 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

770 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
)

773 
i
;

774 *
Resu…
 = 
NULL
;

775 
Ác
, 
num_£ts
;

776 
Fc
;

778 *
Fc_˛ù≥d
 = 
FALSE
;

781 
Ác
 = 1;

782 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

784 
Ác
 = 2;

787 
	`as£π
((
nodes_≥r_ch™
 % 
Ác
) == 0);

788 
num_£ts
 = 
nodes_≥r_ch™
 / 
Ác
;

790 
Resu…
 = (*)
	`my_mÆloc
((Ë* 
num_ty≥s
);

792 
i
 = 0; i < 
num_ty≥s
; ++i)

794 
Fc
 = (
is_Fc_out
 ? 
ty≥_des¸ùt‹s
[
i
].

795 
Fc_out
 : 
ty≥_des¸ùt‹s
[
i
].
Fc_ö
);

797 if(
ty≥_des¸ùt‹s
[
i
].
is_Fc_‰ac
)

799 
Resu…
[
i
] = 
Ác
 * 
	`nöt
(
num_£ts
 * 
Fc
);

803 
Resu…
[
i
] = 
Fc
;

806 if(
is_Fc_out
 && 
ty≥_des¸ùt‹s
[
i
].
is_Fc_out_fuŒ_Êex
)

808 
Resu…
[
i
] = 
nodes_≥r_ch™
;

811 
Resu…
[
i
] = 
	`max
(Resu…[i], 
Ác
);

812 if(
Resu…
[
i
] > 
nodes_≥r_ch™
)

814 *
Fc_˛ù≥d
 = 
TRUE
;

815 
Resu…
[
i
] = 
nodes_≥r_ch™
;

818 
	`as£π
(
Resu…
[
i
] % 
Ác
 == 0);

821  
Resu…
;

822 
	}
}

826 
	$‰ì_ty≥_åack_to_ùö_m≠
(
s_ivec
**** 
åack_to_pö_m≠
, 
t_ty≥_±r
 
ty≥s
, 
nodes_≥r_ch™
)

828 
i
, 
ôøck
, 
ioff
, 
iside
;

829 
i
 = 0; i < 
num_ty≥s
; i++) {

830 if(
åack_to_pö_m≠
[
i
] !
NULL
) {

831 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

833 
ioff
 = 0; iof‡< 
ty≥s
[
i
].
height
; ioff++)

835 
iside
 = 0; iside < 4; iside++)

837 if(
åack_to_pö_m≠
[
i
][
ôøck
][
ioff
][
iside
].
li°
 !
NULL
) {

838 
	`‰ì
(
åack_to_pö_m≠
[
i
][
ôøck
][
ioff
][
iside
].
li°
);

843 
	`‰ì_m©rix3
(
åack_to_pö_m≠
[
i
], 0, 
nodes_≥r_ch™
 - 1, 0,

844 
ty≥s
[
i
].
height
 - 1, 0,

845 (
s_ivec
));

848 
	`‰ì
(
åack_to_pö_m≠
);

849 
	}
}

853 
	$‰ì_ty≥_pö_to_åack_m≠
(***** 
ùö_to_åack_m≠
, 
t_ty≥_±r
 
ty≥s
, * 
fc_ö
)

855 
i
;

856 
i
 = 0; i < 
num_ty≥s
; i++) {

857 
	`‰ì_m©rix4
(
ùö_to_åack_m≠
[
i
], 0, 
ty≥s
[i].
num_pös
 - 1,

858 0, 
ty≥s
[
i
].
height
 - 1, 0, 3, 0, ());

860 
	`‰ì
(
ùö_to_åack_m≠
);

861 
	}
}

866 
	$Æloc_™d_lﬂd_º_gøph
(
IN
 
num_nodes
,

867 
IN
 
t_º_node
 * 
º_node
,

868 
IN
 
num_£g_ty≥s
,

869 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

870 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

871 
IN
 
s_ivec
 ****
åack_to_ùö_lookup
,

872 
IN
 *****
›ö_to_åack_m≠
,

873 
IN
 
s_ivec
 ***
swôch_block_c⁄n
,

874 
IN
 
s_grid_tûe
 **
grid
,

875 
IN
 
nx
,

876 
IN
 
ny
,

877 
IN
 
Fs
,

878 
IN
 *****
sblock_∑âîn
,

879 
IN
 *
Fc_out
,

880 
IN
 **
Fc_xofs
,

881 
IN
 **
Fc_yofs
,

882 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

883 
IN
 
nodes_≥r_ch™
,

884 
IN
 
e_swôch_block_ty≥
 
sb_ty≥
,

885 
IN
 
dñayÀss_swôch
,

886 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

887 
IN
 
wúe_to_ùö_swôch
,

888 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
)

891 
i
, 
j
;

892 
boﬁón
 
˛ù≥d
;

893 *
›ö_mux_size
 = 
NULL
;

897 *
Fc_˛ù≥d
 = 
FALSE
;

900 
i
 = 0; i <(
nx
 + 1); i++)

902 
j
 = 0; j <(
ny
 + 1); j++)

904 
	`buûd_º_söks_sour˚s
(
i
, 
j
, 
º_node
, 
º_node_ödi˚s
,

905 
dñayÀss_swôch
, 
grid
);

910 
i
 = 0; i <(
nx
 + 1); ++i)

912 
j
 = 0; j <(
ny
 + 1); ++j)

914 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

916 
	`buûd_bidú_º_›ös
(
i
, 
j
, 
º_node
,

917 
º_node_ödi˚s
,

918 
›ö_to_åack_m≠
, 
Fc_out
,

919 
º_edge_d⁄e
, 
£g_dëaûs
,

920 
grid
);

924 
	`as£π
(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
);

925 
	`buûd_unidú_º_›ös
(
i
, 
j
, 
grid
, 
Fc_out
,

926 
nodes_≥r_ch™
, 
£g_dëaûs
,

927 
Fc_xofs
, 
Fc_yofs
, 
º_node
,

928 
º_edge_d⁄e
, &
˛ù≥d
,

929 
º_node_ödi˚s
);

930 if(
˛ù≥d
)

932 *
Fc_˛ù≥d
 = 
TRUE
;

940 
›ö_mux_size
 = (*)
	`my_mÆloc
((Ë* 
num_nodes
);

941 
i
 = 0; i < 
num_nodes
; ++i)

943 
›ö_mux_size
[
i
] = 
º_node
[i].
Án_ö
;

947 
	`as£π
(
Fs
 % 3 == 0);

948 
i
 = 0; i <
nx
; i++)

950 
j
 = 0; j <
ny
; j++)

952 if(
i
 > 0)

954 
	`buûd_º_xch™
(
i
, 
j
, 
åack_to_ùö_lookup
,

955 
swôch_block_c⁄n
,

956 
CHANX_COST_INDEX_START
,

957 
nodes_≥r_ch™
, 
›ö_mux_size
,

958 
sblock_∑âîn
, 
Fs
 / 3,

959 
£g_dëaûs
, 
º_node_ödi˚s
,

960 
º_edge_d⁄e
, 
º_node
,

961 
wúe_to_ùö_swôch
,

962 
dúe˘i⁄Æôy
);

964 if(
j
 > 0)

966 
	`buûd_º_ych™
(
i
, 
j
, 
åack_to_ùö_lookup
,

967 
swôch_block_c⁄n
,

968 
CHANX_COST_INDEX_START
 +

969 
num_£g_ty≥s
, 
nodes_≥r_ch™
,

970 
›ö_mux_size
, 
sblock_∑âîn
,

971 
Fs
 / 3, 
£g_dëaûs
,

972 
º_node_ödi˚s
, 
º_edge_d⁄e
,

973 
º_node
, 
wúe_to_ùö_swôch
,

974 
dúe˘i⁄Æôy
);

978 
	`‰ì
(
›ö_mux_size
);

979 
	}
}

984 
	$buûd_bidú_º_›ös
(
IN
 
i
,

985 
IN
 
j
,

986 
INOUT
 
t_º_node
 * 
º_node
,

987 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

988 
IN
 *****
›ö_to_åack_m≠
,

989 
IN
 *
Fc_out
,

990 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

991 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

992 
IN
 
s_grid_tûe
 **
grid
)

995 
ùö
, 
öode
, 
num_edges
, 
Fc
, 
ofs
;

996 
t_ty≥_±r
 
ty≥
;

997 
s_löked_edge
 *
edge_li°
, *
√xt
;

1001 if(
grid
[
i
][
j
].
off£t
 > 0)

1006 
ty≥
 = 
grid
[
i
][
j
].type;

1007 
Fc
 = 
Fc_out
[
ty≥
->
ödex
];

1009 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ++ipin)

1012 if(
ty≥
->
˛ass_öf
[ty≥->
pö_˛ass
[
ùö
]].ty≥ !
DRIVER
)

1017 
num_edges
 = 0;

1018 
edge_li°
 = 
NULL
;

1020 
ofs
 = 0; of†< 
ty≥
->
height
; ++ofs)

1022 
num_edges
 +=

1023 
	`gë_bidú_›ö_c⁄√˘i⁄s
(
i
, 
j
 + 
ofs
, 
ùö
,

1024 &
edge_li°
,

1025 
›ö_to_åack_m≠
, 
Fc
,

1026 
º_edge_d⁄e
,

1027 
º_node_ödi˚s
,

1028 
£g_dëaûs
);

1031 
öode
 = 
	`gë_º_node_ödex
(
i
, 
j
, 
OPIN
, 
ùö
, 
º_node_ödi˚s
);

1032 
	`Æloc_™d_lﬂd_edges_™d_swôches
(
º_node
, 
öode
, 
num_edges
,

1033 
º_edge_d⁄e
, 
edge_li°
);

1034 
edge_li°
 !
NULL
) {

1035 
√xt
 = 
edge_li°
->next;

1036 
	`‰ì
(
edge_li°
);

1037 
edge_li°
 = 
√xt
;

1040 
	}
}

1045 
	$‰ì_º_gøph
()

1047 
i
;

1055 if(
º_mem_chunk_li°_hód
 =
NULL
)

1058 
	`‰ì_chunk_mem‹y
(
º_mem_chunk_li°_hód
);

1059 
º_mem_chunk_li°_hód
 = 
NULL
;

1060 
chunk_byãs_avaû
 = 0;

1061 
chunk_√xt_avaû_mem
 = 
NULL
;

1066 
	`‰ì
(
√t_º_ãrmöÆs
);

1068 
i
 = 0; i < 
num_º_nodes
; i++) {

1069 if(
º_node
[
i
].
edges
 !
NULL
) {

1070 
	`‰ì
(
º_node
[
i
].
edges
);

1072 if(
º_node
[
i
].
swôches
 !
NULL
) {

1073 
	`‰ì
(
º_node
[
i
].
swôches
);

1077 
	`as£π
(
º_node_ödi˚s
);

1078 
	`‰ì_º_node_ödi˚s
(
º_node_ödi˚s
);

1079 
	`‰ì
(
º_node
);

1080 
	`‰ì
(
º_ödexed_d©a
);

1081 
i
 = 0; i < 
num_blocks
; i++)

1083 
	`‰ì
(
º_blk_sour˚
[
i
]);

1085 
	`‰ì
(
º_blk_sour˚
);

1086 
º_blk_sour˚
 = 
NULL
;

1087 
√t_º_ãrmöÆs
 = 
NULL
;

1088 
º_node
 = 
NULL
;

1089 
º_node_ödi˚s
 = 
NULL
;

1090 
º_ödexed_d©a
 = 
NULL
;

1091 
	}
}

1095 
	$Æloc_√t_º_ãrmöÆs
()

1097 
öë
;

1099 
√t_º_ãrmöÆs
 = (**)
	`my_mÆloc
(
num_√ts
 * (*));

1101 
öë
 = 0; i√à< 
num_√ts
; inet++)

1103 
√t_º_ãrmöÆs
[
öë
] =

1104 (*)
	`my_chunk_mÆloc
((
√t
[
öë
].
num_söks
 + 1) *

1105 (), &
º_mem_chunk_li°_hód
,

1106 &
chunk_byãs_avaû
,

1107 &
chunk_√xt_avaû_mem
);

1109 
	}
}

1113 
	$lﬂd_√t_º_ãrmöÆs
(
t_ivec
 *** 
º_node_ödi˚s
)

1121 
öë
, 
ùö
, 
öode
, 
iblk
, 
i
, 
j
, 
k
, 
node_block_pö
, 
i˛ass
;

1122 
t_ty≥_±r
 
ty≥
;

1124 
öë
 = 0; i√à< 
num_√ts
; inet++)

1126 
ùö
 = 0; ipö <
√t
[
öë
].
num_söks
; ipin++)

1128 
iblk
 = 
√t
[
öë
].
node_block
[
ùö
];

1129 
i
 = 
block
[
iblk
].
x
;

1130 
j
 = 
block
[
iblk
].
y
;

1131 
k
 = 
block
[
iblk
].
z
;

1132 
ty≥
 = 
block
[
iblk
].type;

1137 
node_block_pö
 = 
√t
[
öë
].node_block_pö[
ùö
];

1139 
i˛ass
 = 
ty≥
->
pö_˛ass
[
node_block_pö
];

1141 
öode
 = 
	`gë_º_node_ödex
(
i
, 
j
, (
ùö
 =0 ? 
SOURCE
 : 
SINK
),

1142 
i˛ass
, 
º_node_ödi˚s
);

1143 
√t_º_ãrmöÆs
[
öë
][
ùö
] = 
öode
;

1146 
	}
}

1149 
	$Æloc_™d_lﬂd_º_˛b_sour˚
(
t_ivec
 *** 
º_node_ödi˚s
)

1158 
iblk
, 
i
, 
j
, 
i˛ass
, 
öode
;

1159 
˛ass_low
, 
˛ass_high
;

1160 
t_º_ty≥
 
º_ty≥
;

1161 
t_ty≥_±r
 
ty≥
;

1163 
º_blk_sour˚
 = (**)
	`my_mÆloc
(
num_blocks
 * (*));

1165 
iblk
 = 0; iblk < 
num_blocks
; iblk++)

1167 
ty≥
 = 
block
[
iblk
].type;

1168 
	`gë_˛ass_ønge_f‹_block
(
iblk
, &
˛ass_low
, &
˛ass_high
);

1169 
º_blk_sour˚
[
iblk
] =

1170 (*)
	`my_mÆloc
(
ty≥
->
num_˛ass
 * ());

1171 
i˛ass
 = 0; i˛as†< 
ty≥
->
num_˛ass
; iclass++)

1173 if(
i˛ass
 >
˛ass_low
 && i˛as†<
˛ass_high
)

1175 
i
 = 
block
[
iblk
].
x
;

1176 
j
 = 
block
[
iblk
].
y
;

1178 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
DRIVER
)

1179 
º_ty≥
 = 
SOURCE
;

1181 
º_ty≥
 = 
SINK
;

1183 
öode
 =

1184 
	`gë_º_node_ödex
(
i
, 
j
, 
º_ty≥
, 
i˛ass
,

1185 
º_node_ödi˚s
);

1186 
º_blk_sour˚
[
iblk
][
i˛ass
] = 
öode
;

1190 
º_blk_sour˚
[
iblk
][
i˛ass
] = 
OPEN
;

1194 
	}
}

1197 
	$buûd_º_söks_sour˚s
(
IN
 
i
,

1198 
IN
 
j
,

1199 
IN
 
t_º_node
 * 
º_node
,

1200 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

1201 
IN
 
dñayÀss_swôch
,

1202 
IN
 
s_grid_tûe
 **
grid
)

1208 
ùö
, 
i˛ass
, 
öode
, 
pö_num
, 
to_node
, 
num_edges
;

1209 
num_˛ass
, 
num_pös
;

1210 
t_ty≥_±r
 
ty≥
;

1211 
s_˛ass
 *
˛ass_öf
;

1212 *
pö_˛ass
;

1216 if(
grid
[
i
][
j
].
off£t
 > 0)

1219 
ty≥
 = 
grid
[
i
][
j
].type;

1220 
num_˛ass
 = 
ty≥
->num_class;

1221 
˛ass_öf
 = 
ty≥
->class_inf;

1222 
num_pös
 = 
ty≥
->num_pins;

1223 
pö_˛ass
 = 
ty≥
->pin_class;

1226 
i˛ass
 = 0; i˛as†< 
num_˛ass
; iclass++)

1228 if(
˛ass_öf
[
i˛ass
].
ty≥
 =
DRIVER
)

1230 
öode
 =

1231 
	`gë_º_node_ödex
(
i
, 
j
, 
SOURCE
, 
i˛ass
,

1232 
º_node_ödi˚s
);

1234 
num_edges
 = 
˛ass_öf
[
i˛ass
].
num_pös
;

1235 
º_node
[
öode
].
num_edges
 =Çum_edges;

1236 
º_node
[
öode
].
edges
 =

1237 (*)
	`my_mÆloc
(
num_edges
 * ());

1238 
º_node
[
öode
].
swôches
 =

1239 (*)
	`my_mÆloc
(
num_edges
 * ());

1241 
ùö
 = 0; ipö < 
˛ass_öf
[
i˛ass
].
num_pös
; ipin++)

1243 
pö_num
 = 
˛ass_öf
[
i˛ass
].
pöli°
[
ùö
];

1244 
to_node
 =

1245 
	`gë_º_node_ödex
(
i
, 
j
, 
OPIN
, 
pö_num
,

1246 
º_node_ödi˚s
);

1247 
º_node
[
öode
].
edges
[
ùö
] = 
to_node
;

1248 
º_node
[
öode
].
swôches
[
ùö
] = 
dñayÀss_swôch
;

1250 ++
º_node
[
to_node
].
Án_ö
;

1253 
º_node
[
öode
].
co°_ödex
 = 
SOURCE_COST_INDEX
;

1254 
º_node
[
öode
].
ty≥
 = 
SOURCE
;

1258 
	`as£π
(
˛ass_öf
[
i˛ass
].
ty≥
 =
RECEIVER
);

1259 
öode
 =

1260 
	`gë_º_node_ödex
(
i
, 
j
, 
SINK
, 
i˛ass
,

1261 
º_node_ödi˚s
);

1270 
º_node
[
öode
].
num_edges
 = 0;

1271 
º_node
[
öode
].
edges
 = 
NULL
;

1272 
º_node
[
öode
].
swôches
 = 
NULL
;

1274 
º_node
[
öode
].
co°_ödex
 = 
SINK_COST_INDEX
;

1275 
º_node
[
öode
].
ty≥
 = 
SINK
;

1279 
º_node
[
öode
].
ˇ∑côy
 = 
˛ass_öf
[
i˛ass
].
num_pös
;

1280 
º_node
[
öode
].
occ
 = 0;

1281 
º_node
[
öode
].
xlow
 = 
i
;

1282 
º_node
[
öode
].
xhigh
 = 
i
;

1283 
º_node
[
öode
].
ylow
 = 
j
;

1284 
º_node
[
öode
].
yhigh
 = 
j
 + 
ty≥
->
height
 - 1;

1285 
º_node
[
öode
].
R
 = 0;

1286 
º_node
[
öode
].
C
 = 0;

1287 
º_node
[
öode
].
±c_num
 = 
i˛ass
;

1288 
º_node
[
öode
].
dúe˘i⁄
 = 
OPEN
;

1289 
º_node
[
öode
].
drivîs
 = 
OPEN
;

1293 
ùö
 = 0; ipö < 
num_pös
; ipin++)

1295 
i˛ass
 = 
pö_˛ass
[
ùö
];

1297 if(
˛ass_öf
[
i˛ass
].
ty≥
 =
RECEIVER
)

1299 
öode
 =

1300 
	`gë_º_node_ödex
(
i
, 
j
, 
IPIN
, 
ùö
, 
º_node_ödi˚s
);

1301 
to_node
 =

1302 
	`gë_º_node_ödex
(
i
, 
j
, 
SINK
, 
i˛ass
,

1303 
º_node_ödi˚s
);

1305 
º_node
[
öode
].
num_edges
 = 1;

1306 
º_node
[
öode
].
edges
 = (*)
	`my_mÆloc
(());

1307 
º_node
[
öode
].
swôches
 =

1308 (*)
	`my_mÆloc
(());

1310 
º_node
[
öode
].
edges
[0] = 
to_node
;

1311 
º_node
[
öode
].
swôches
[0] = 
dñayÀss_swôch
;

1313 ++
º_node
[
to_node
].
Án_ö
;

1315 
º_node
[
öode
].
co°_ödex
 = 
IPIN_COST_INDEX
;

1316 
º_node
[
öode
].
ty≥
 = 
IPIN
;

1320 
	`as£π
(
˛ass_öf
[
i˛ass
].
ty≥
 =
DRIVER
);

1322 
öode
 =

1323 
	`gë_º_node_ödex
(
i
, 
j
, 
OPIN
, 
ùö
, 
º_node_ödi˚s
);

1325 
º_node
[
öode
].
num_edges
 = 0;

1326 
º_node
[
öode
].
edges
 = 
NULL
;

1328 
º_node
[
öode
].
swôches
 = 
NULL
;

1330 
º_node
[
öode
].
co°_ödex
 = 
OPIN_COST_INDEX
;

1331 
º_node
[
öode
].
ty≥
 = 
OPIN
;

1335 
º_node
[
öode
].
ˇ∑côy
 = 1;

1336 
º_node
[
öode
].
occ
 = 0;

1337 
º_node
[
öode
].
xlow
 = 
i
;

1338 
º_node
[
öode
].
xhigh
 = 
i
;

1339 
º_node
[
öode
].
ylow
 = 
j
;

1340 
º_node
[
öode
].
yhigh
 = 
j
 + 
ty≥
->
height
 - 1;

1341 
º_node
[
öode
].
C
 = 0;

1342 
º_node
[
öode
].
R
 = 0;

1343 
º_node
[
öode
].
±c_num
 = 
ùö
;

1344 
º_node
[
öode
].
dúe˘i⁄
 = 
OPEN
;

1345 
º_node
[
öode
].
drivîs
 = 
OPEN
;

1347 
	}
}

1352 
	$buûd_º_xch™
(
IN
 
i
,

1353 
IN
 
j
,

1354 
IN
 
s_ivec
 ****
åack_to_ùö_lookup
,

1355 
IN
 
s_ivec
 ***
swôch_block_c⁄n
,

1356 
IN
 
co°_ödex_off£t
,

1357 
IN
 
nodes_≥r_ch™
,

1358 
IN
 *
›ö_mux_size
,

1359 
IN
 *****
sblock_∑âîn
,

1360 
IN
 
Fs_≥r_side
,

1361 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1362 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

1363 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

1364 
INOUT
 
t_º_node
 * 
º_node
,

1365 
IN
 
wúe_to_ùö_swôch
,

1366 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1372 
ôøck
, 
i°¨t
, 
õnd
, 
num_edges
, 
öode
, 
Àngth
;

1373 
s_löked_edge
 *
edge_li°
, *
√xt
;

1376 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

1378 
i°¨t
 = 
	`gë_£g_°¨t
(
£g_dëaûs
, 
ôøck
, 
j
, 
i
);

1379 
õnd
 = 
	`gë_£g_íd
(
£g_dëaûs
, 
ôøck
, 
i°¨t
, 
j
, 
nx
);

1381 if(
i
 > 
i°¨t
)

1384 
edge_li°
 = 
NULL
;

1387 
num_edges
 = 0;

1389 
num_edges
 +
	`gë_åack_to_ùös
(
i°¨t
, 
j
, 
ôøck
,

1390 &
edge_li°
,

1391 
º_node_ödi˚s
,

1392 
åack_to_ùö_lookup
,

1393 
£g_dëaûs
,

1394 
CHANX
, 
nx
,

1395 
wúe_to_ùö_swôch
,

1396 
dúe˘i⁄Æôy
);

1398 if(
j
 > 0)

1400 
num_edges
 +
	`gë_åack_to_åacks
(
j
, 
i°¨t
, 
ôøck
, 
CHANX
,

1401 
j
, 
CHANY
, 
nx
,

1402 
nodes_≥r_ch™
,

1403 
›ö_mux_size
,

1404 
Fs_≥r_side
,

1405 
sblock_∑âîn
,

1406 &
edge_li°
,

1407 
£g_dëaûs
,

1408 
dúe˘i⁄Æôy
,

1409 
º_node_ödi˚s
,

1410 
º_edge_d⁄e
,

1411 
swôch_block_c⁄n
);

1414 if(
j
 < 
ny
)

1416 
num_edges
 +
	`gë_åack_to_åacks
(
j
, 
i°¨t
, 
ôøck
, 
CHANX
,

1417 
j
 + 1, 
CHANY
, 
nx
,

1418 
nodes_≥r_ch™
,

1419 
›ö_mux_size
,

1420 
Fs_≥r_side
,

1421 
sblock_∑âîn
,

1422 &
edge_li°
,

1423 
£g_dëaûs
,

1424 
dúe˘i⁄Æôy
,

1425 
º_node_ödi˚s
,

1426 
º_edge_d⁄e
,

1427 
swôch_block_c⁄n
);

1430 if(
i°¨t
 > 1)

1432 
num_edges
 +
	`gë_åack_to_åacks
(
j
, 
i°¨t
, 
ôøck
, 
CHANX
,

1433 
i°¨t
 - 1, 
CHANX
, 
nx
,

1434 
nodes_≥r_ch™
,

1435 
›ö_mux_size
,

1436 
Fs_≥r_side
,

1437 
sblock_∑âîn
,

1438 &
edge_li°
,

1439 
£g_dëaûs
,

1440 
dúe˘i⁄Æôy
,

1441 
º_node_ödi˚s
,

1442 
º_edge_d⁄e
,

1443 
swôch_block_c⁄n
);

1446 if(
õnd
 < 
nx
)

1448 
num_edges
 +
	`gë_åack_to_åacks
(
j
, 
i°¨t
, 
ôøck
, 
CHANX
,

1449 
õnd
 + 1, 
CHANX
, 
nx
,

1450 
nodes_≥r_ch™
,

1451 
›ö_mux_size
,

1452 
Fs_≥r_side
,

1453 
sblock_∑âîn
,

1454 &
edge_li°
,

1455 
£g_dëaûs
,

1456 
dúe˘i⁄Æôy
,

1457 
º_node_ödi˚s
,

1458 
º_edge_d⁄e
,

1459 
swôch_block_c⁄n
);

1463 
öode
 = 
	`gë_º_node_ödex
(
i
, 
j
, 
CHANX
, 
ôøck
, 
º_node_ödi˚s
);

1464 
	`Æloc_™d_lﬂd_edges_™d_swôches
(
º_node
, 
öode
, 
num_edges
,

1465 
º_edge_d⁄e
, 
edge_li°
);

1467 
edge_li°
 !
NULL
) {

1468 
√xt
 = 
edge_li°
->next;

1469 
	`‰ì
(
edge_li°
);

1470 
edge_li°
 = 
√xt
;

1474 
º_node
[
öode
].
co°_ödex
 =

1475 
co°_ödex_off£t
 + 
£g_dëaûs
[
ôøck
].
ödex
;

1476 
º_node
[
öode
].
occ
 = 0;

1478 
º_node
[
öode
].
ˇ∑côy
 = 1;

1480 
º_node
[
öode
].
xlow
 = 
i°¨t
;

1481 
º_node
[
öode
].
xhigh
 = 
õnd
;

1482 
º_node
[
öode
].
ylow
 = 
j
;

1483 
º_node
[
öode
].
yhigh
 = 
j
;

1485 
Àngth
 = 
õnd
 - 
i°¨t
 + 1;

1486 
º_node
[
öode
].
R
 = 
Àngth
 * 
£g_dëaûs
[
ôøck
].
RmëÆ
;

1487 
º_node
[
öode
].
C
 = 
Àngth
 * 
£g_dëaûs
[
ôøck
].
CmëÆ
;

1489 
º_node
[
öode
].
±c_num
 = 
ôøck
;

1490 
º_node
[
öode
].
ty≥
 = 
CHANX
;

1491 
º_node
[
öode
].
dúe˘i⁄
 = 
£g_dëaûs
[
ôøck
].direction;

1492 
º_node
[
öode
].
drivîs
 = 
£g_dëaûs
[
ôøck
].drivers;

1494 
	}
}

1500 
	$buûd_º_ych™
(
IN
 
i
,

1501 
IN
 
j
,

1502 
IN
 
s_ivec
 ****
åack_to_ùö_lookup
,

1503 
IN
 
s_ivec
 ***
swôch_block_c⁄n
,

1504 
IN
 
co°_ödex_off£t
,

1505 
IN
 
nodes_≥r_ch™
,

1506 
IN
 *
›ö_mux_size
,

1507 
IN
 *****
sblock_∑âîn
,

1508 
IN
 
Fs_≥r_side
,

1509 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1510 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

1511 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

1512 
INOUT
 
t_º_node
 * 
º_node
,

1513 
IN
 
wúe_to_ùö_swôch
,

1514 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1520 
ôøck
, 
i°¨t
, 
õnd
, 
num_edges
, 
öode
, 
Àngth
;

1521 
s_löked_edge
 *
edge_li°
, *
√xt
;

1524 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

1526 
i°¨t
 = 
	`gë_£g_°¨t
(
£g_dëaûs
, 
ôøck
, 
i
, 
j
);

1527 
õnd
 = 
	`gë_£g_íd
(
£g_dëaûs
, 
ôøck
, 
i°¨t
, 
i
, 
ny
);

1529 if(
j
 > 
i°¨t
)

1532 
edge_li°
 = 
NULL
;

1535 
num_edges
 = 0;

1537 
num_edges
 +
	`gë_åack_to_ùös
(
i°¨t
, 
i
, 
ôøck
,

1538 &
edge_li°
,

1539 
º_node_ödi˚s
,

1540 
åack_to_ùö_lookup
,

1541 
£g_dëaûs
,

1542 
CHANY
, 
ny
,

1543 
wúe_to_ùö_swôch
,

1544 
dúe˘i⁄Æôy
);

1546 if(
i
 > 0)

1548 
num_edges
 +
	`gë_åack_to_åacks
(
i
, 
i°¨t
, 
ôøck
, 
CHANY
,

1549 
i
, 
CHANX
, 
ny
,

1550 
nodes_≥r_ch™
,

1551 
›ö_mux_size
,

1552 
Fs_≥r_side
,

1553 
sblock_∑âîn
,

1554 &
edge_li°
,

1555 
£g_dëaûs
,

1556 
dúe˘i⁄Æôy
,

1557 
º_node_ödi˚s
,

1558 
º_edge_d⁄e
,

1559 
swôch_block_c⁄n
);

1562 if(
i
 < 
nx
)

1564 
num_edges
 +
	`gë_åack_to_åacks
(
i
, 
i°¨t
, 
ôøck
, 
CHANY
,

1565 
i
 + 1, 
CHANX
, 
ny
,

1566 
nodes_≥r_ch™
,

1567 
›ö_mux_size
,

1568 
Fs_≥r_side
,

1569 
sblock_∑âîn
,

1570 &
edge_li°
,

1571 
£g_dëaûs
,

1572 
dúe˘i⁄Æôy
,

1573 
º_node_ödi˚s
,

1574 
º_edge_d⁄e
,

1575 
swôch_block_c⁄n
);

1578 if(
i°¨t
 > 1)

1580 
num_edges
 +
	`gë_åack_to_åacks
(
i
, 
i°¨t
, 
ôøck
, 
CHANY
,

1581 
i°¨t
 - 1, 
CHANY
, 
ny
,

1582 
nodes_≥r_ch™
,

1583 
›ö_mux_size
,

1584 
Fs_≥r_side
,

1585 
sblock_∑âîn
,

1586 &
edge_li°
,

1587 
£g_dëaûs
,

1588 
dúe˘i⁄Æôy
,

1589 
º_node_ödi˚s
,

1590 
º_edge_d⁄e
,

1591 
swôch_block_c⁄n
);

1594 if(
õnd
 < 
ny
)

1596 
num_edges
 +
	`gë_åack_to_åacks
(
i
, 
i°¨t
, 
ôøck
, 
CHANY
,

1597 
õnd
 + 1, 
CHANY
, 
ny
,

1598 
nodes_≥r_ch™
,

1599 
›ö_mux_size
,

1600 
Fs_≥r_side
,

1601 
sblock_∑âîn
,

1602 &
edge_li°
,

1603 
£g_dëaûs
,

1604 
dúe˘i⁄Æôy
,

1605 
º_node_ödi˚s
,

1606 
º_edge_d⁄e
,

1607 
swôch_block_c⁄n
);

1611 
öode
 = 
	`gë_º_node_ödex
(
i
, 
j
, 
CHANY
, 
ôøck
, 
º_node_ödi˚s
);

1612 
	`Æloc_™d_lﬂd_edges_™d_swôches
(
º_node
, 
öode
, 
num_edges
,

1613 
º_edge_d⁄e
, 
edge_li°
);

1615 
edge_li°
 !
NULL
) {

1616 
√xt
 = 
edge_li°
->next;

1617 
	`‰ì
(
edge_li°
);

1618 
edge_li°
 = 
√xt
;

1622 
º_node
[
öode
].
co°_ödex
 =

1623 
co°_ödex_off£t
 + 
£g_dëaûs
[
ôøck
].
ödex
;

1624 
º_node
[
öode
].
occ
 = 0;

1626 
º_node
[
öode
].
ˇ∑côy
 = 1;

1628 
º_node
[
öode
].
xlow
 = 
i
;

1629 
º_node
[
öode
].
xhigh
 = 
i
;

1630 
º_node
[
öode
].
ylow
 = 
i°¨t
;

1631 
º_node
[
öode
].
yhigh
 = 
õnd
;

1633 
Àngth
 = 
õnd
 - 
i°¨t
 + 1;

1634 
º_node
[
öode
].
R
 = 
Àngth
 * 
£g_dëaûs
[
ôøck
].
RmëÆ
;

1635 
º_node
[
öode
].
C
 = 
Àngth
 * 
£g_dëaûs
[
ôøck
].
CmëÆ
;

1637 
º_node
[
öode
].
±c_num
 = 
ôøck
;

1638 
º_node
[
öode
].
ty≥
 = 
CHANY
;

1639 
º_node
[
öode
].
dúe˘i⁄
 = 
£g_dëaûs
[
ôøck
].direction;

1640 
º_node
[
öode
].
drivîs
 = 
£g_dëaûs
[
ôøck
].drivers;

1642 
	}
}

1645 
	$w©ch_edges
(
öode
,

1646 
t_löked_edge
 * 
edge_li°_hód
)

1648 
t_löked_edge
 *
li°_±r
;

1649 
i
, 
to_node
;

1651 
li°_±r
 = 
edge_li°_hód
;

1652 
i
 = 0;

1654 
	`¥ötf
("!!! W©chög Nodê%d !!!!\n", 
öode
);

1655 
	`¥öt_º_node
(
°dout
, 
º_node
, 
öode
);

1656 
	`¥ötf
("Currently connectsÅo: \n");

1657 
li°_±r
 !
NULL
)

1659 
to_node
 = 
li°_±r
->
edge
;

1660 
	`¥öt_º_node
(
°dout
, 
º_node
, 
to_node
);

1661 
li°_±r
 =Üi°_±r->
√xt
;

1662 
i
++;

1664 
	}
}

1667 
	$Æloc_™d_lﬂd_edges_™d_swôches
(
IN
 
t_º_node
 * 
º_node
,

1668 
IN
 
öode
,

1669 
IN
 
num_edges
,

1670 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

1671 
IN
 
t_löked_edge
 * 
edge_li°_hód
)

1681 
t_löked_edge
 *
li°_±r
, *
¥ev_±r
;

1682 
i
;

1685 
	`as£π
(
º_node
[
öode
].
num_edges
 < 1);

1686 
	`as£π
(
NULL
 =
º_node
[
öode
].
edges
);

1687 
	`as£π
(
NULL
 =
º_node
[
öode
].
swôches
);

1689 
º_node
[
öode
].
num_edges
 =Çum_edges;

1690 
º_node
[
öode
].
edges
 = (*)
	`my_mÆloc
(
num_edges
 * ());

1691 
º_node
[
öode
].
swôches
 = (*)
	`my_mÆloc
(
num_edges
 * ());

1693 
i
 = 0;

1694 
li°_±r
 = 
edge_li°_hód
;

1695 
li°_±r
 && (
i
 < 
num_edges
))

1697 
º_node
[
öode
].
edges
[
i
] = 
li°_±r
->
edge
;

1698 
º_node
[
öode
].
swôches
[
i
] = 
li°_±r
->
iswôch
;

1700 ++
º_node
[
li°_±r
->
edge
].
Án_ö
;

1703 
º_edge_d⁄e
[
li°_±r
->
edge
] = 
FALSE
;

1705 
¥ev_±r
 = 
li°_±r
;

1706 
li°_±r
 =Üi°_±r->
√xt
;

1707 ++
i
;

1709 
	`as£π
(
li°_±r
 =
NULL
);

1710 
	`as£π
(
i
 =
num_edges
);

1711 
	}
}

1720 
	$Æloc_™d_lﬂd_pö_to_åack_m≠
(
IN
 
e_pö_ty≥
 
pö_ty≥
,

1721 
IN
 
nodes_≥r_ch™
,

1722 
IN
 
Fc
,

1723 
IN
 
t_ty≥_±r
 
Ty≥
,

1724 
IN
 
boﬁón
 
≥πurb_swôch_∑âîn
,

1725 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1728 **
num_dú
;

1729 ***
dú_li°
;

1732 
i
, 
j
, 
k
, 
iside
, 
ùö
, 
i˛ass
, 
num_phys_pös
, 
pödex
, 
ioff
;

1733 *
pö_num_‹dîög
, *
side_‹dîög
, *
off£t_‹dîög
;

1734 **
num_d⁄e_≥r_dú
;

1735 ****
åacks_c⁄√˘ed_to_pö
;

1743 if(
Ty≥
->
num_pös
 < 1)

1745  
NULL
;

1748 
åacks_c⁄√˘ed_to_pö
 = (****)

1749 
	`Æloc_m©rix4
(0, 
Ty≥
->
num_pös
 - 1,

1750 0, 
Ty≥
->
height
 - 1, 0, 3, 0, 
Fc
 - 1, ());

1752 
ùö
 = 0; ipö < 
Ty≥
->
num_pös
; ipin++)

1754 
ioff
 = 0; iof‡< 
Ty≥
->
height
; ioff++)

1756 
iside
 = 0; iside < 4; iside++)

1758 
i
 = 0; i < 
Fc
; ++i)

1760 
åacks_c⁄√˘ed_to_pö
[
ùö
][
ioff
][
iside
][
i
] = 
OPEN
;

1766 
num_dú
 = (**)
	`Æloc_m©rix
(0, 
Ty≥
->
height
 - 1, 0, 3, ());

1767 
dú_li°
 =

1768 (***)
	`Æloc_m©rix3
(0, 
Ty≥
->
height
 - 1, 0, 3, 0,

1769 
Ty≥
->
num_pös
 - 1, ());

1772 
i
 = 0; i < 
Ty≥
->
height
; i++)

1773 
j
 = 0; j < 4; j++)

1774 
k
 = 0; k < 
Ty≥
->
num_pös
; k++)

1775 
dú_li°
[
i
][
j
][
k
] = (-1);

1777 
i
 = 0; i < 
Ty≥
->
height
; i++)

1778 
j
 = 0; j < 4; j++)

1779 
num_dú
[
i
][
j
] = 0;

1781 
ùö
 = 0; ipö < 
Ty≥
->
num_pös
; ipin++)

1783 
i˛ass
 = 
Ty≥
->
pö_˛ass
[
ùö
];

1784 if(
Ty≥
->
˛ass_öf
[
i˛ass
].
ty≥
 !
pö_ty≥
)

1790 if(
Ty≥
->
is_globÆ_pö
[
ùö
])

1792 
ioff
 = 0; iof‡< 
Ty≥
->
height
; ioff++)

1794 
iside
 = 0; iside < 4; iside++)

1796 if(
Ty≥
->
pöloc
[
ioff
][
iside
][
ùö
] == 1)

1798 
dú_li°
[
ioff
][
iside
][
num_dú
[ioff]

1799 [
iside
]] = 
ùö
;

1800 
num_dú
[
ioff
][
iside
]++;

1806 
num_phys_pös
 = 0;

1807 
ioff
 = 0; iof‡< 
Ty≥
->
height
; ioff++)

1809 
iside
 = 0; iside < 4; iside++)

1810 
num_phys_pös
 +
num_dú
[
ioff
][
iside
];

1812 
num_d⁄e_≥r_dú
 =

1813 (**)
	`Æloc_m©rix
(0, 
Ty≥
->
height
 - 1, 0, 3, ());

1814 
ioff
 = 0; iof‡< 
Ty≥
->
height
; ioff++)

1816 
iside
 = 0; iside < 4; iside++)

1818 
num_d⁄e_≥r_dú
[
ioff
][
iside
] = 0;

1821 
pö_num_‹dîög
 = (*)
	`my_mÆloc
(
num_phys_pös
 * ());

1822 
side_‹dîög
 = (*)
	`my_mÆloc
(
num_phys_pös
 * ());

1823 
off£t_‹dîög
 = (*)
	`my_mÆloc
(
num_phys_pös
 * ());

1833 
iside
 = 
LEFT
;

1834 
ioff
 = 
Ty≥
->
height
 - 1;

1835 
ùö
 = 0;

1836 
pödex
 = -1;

1838 
ùö
 < 
num_phys_pös
)

1840 if(
iside
 =
TOP
)

1842 
iside
 = 
RIGHT
;

1844 if(
iside
 =
RIGHT
)

1846 if(
ioff
 <= 0)

1848 
iside
 = 
BOTTOM
;

1852 
ioff
--;

1855 if(
iside
 =
BOTTOM
)

1857 
iside
 = 
LEFT
;

1861 
	`as£π
(
iside
 =
LEFT
);

1862 if(
ioff
 >
Ty≥
->
height
 - 1)

1864 
pödex
++;

1865 
iside
 = 
TOP
;

1869 
ioff
++;

1873 
	`as£π
(
pödex
 < 
num_phys_pös
);

1875 if(
num_d⁄e_≥r_dú
[
ioff
][
iside
] >
num_dú
[ioff][iside])

1877 
pö_num_‹dîög
[
ùö
] = 
dú_li°
[
ioff
][
iside
][
pödex
];

1878 
side_‹dîög
[
ùö
] = 
iside
;

1879 
off£t_‹dîög
[
ùö
] = 
ioff
;

1880 
	`as£π
(
Ty≥
->
pöloc
[
ioff
][
iside
][
dú_li°
[ioff][iside][
pödex
]]);

1881 
num_d⁄e_≥r_dú
[
ioff
][
iside
]++;

1882 
ùö
++;

1885 if(
≥πurb_swôch_∑âîn
)

1887 
	`lﬂd_≥πurbed_swôch_∑âîn
(
Ty≥
,

1888 
åacks_c⁄√˘ed_to_pö
,

1889 
num_phys_pös
,

1890 
pö_num_‹dîög
,

1891 
side_‹dîög
,

1892 
off£t_‹dîög
,

1893 
nodes_≥r_ch™
, 
Fc
, 
dúe˘i⁄Æôy
);

1897 
	`lﬂd_unif‹m_swôch_∑âîn
(
Ty≥
,

1898 
åacks_c⁄√˘ed_to_pö
,

1899 
num_phys_pös
,

1900 
pö_num_‹dîög
,

1901 
side_‹dîög
,

1902 
off£t_‹dîög
,

1903 
nodes_≥r_ch™
, 
Fc
, 
dúe˘i⁄Æôy
);

1905 
	`check_Æl_åacks_ªach_pös
(
Ty≥
, 
åacks_c⁄√˘ed_to_pö
,

1906 
nodes_≥r_ch™
, 
Fc
, 
pö_ty≥
);

1909 
	`‰ì_m©rix
(
num_dú
, 0, 
Ty≥
->
height
 - 1, 0, ());

1910 
	`‰ì_m©rix3
(
dú_li°
, 0, 
Ty≥
->
height
 - 1, 0, 3, 0, ());

1911 
	`‰ì_m©rix
(
num_d⁄e_≥r_dú
, 0, 
Ty≥
->
height
 - 1, 0, ());

1912 
	`‰ì
(
pö_num_‹dîög
);

1913 
	`‰ì
(
side_‹dîög
);

1914 
	`‰ì
(
off£t_‹dîög
);

1916  
åacks_c⁄√˘ed_to_pö
;

1917 
	}
}

1923 
	$lﬂd_unif‹m_swôch_∑âîn
(
IN
 
t_ty≥_±r
 
ty≥
,

1924 
INOUT
 ****
åacks_c⁄√˘ed_to_pö
,

1925 
IN
 
num_phys_pös
,

1926 
IN
 *
pö_num_‹dîög
,

1927 
IN
 *
side_‹dîög
,

1928 
IN
 *
off£t_‹dîög
,

1929 
IN
 
nodes_≥r_ch™
,

1930 
IN
 
Fc
,

1931 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1939 
i
, 
j
, 
ùö
, 
iside
, 
ioff
, 
ôøck
, 
k
;

1940 
f_åack
, 
fc_°ï
;

1941 
group_size
;

1942 
°ï_size
;

1959 
°ï_size
 = ()
nodes_≥r_ch™
 / ()(
Fc
 * 
num_phys_pös
);

1961 if(
dúe˘i⁄Æôy
 =
BI_DIRECTIONAL
)

1963 
group_size
 = 1;

1967 
	`as£π
(
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
);

1968 
group_size
 = 2;

1971 
	`as£π
((
nodes_≥r_ch™
 % 
group_size
 =0Ë&& (
Fc
 % group_size == 0));

1973 
fc_°ï
 = ()
nodes_≥r_ch™
 / ()
Fc
;

1975 
i
 = 0; i < 
num_phys_pös
; i++)

1977 
ùö
 = 
pö_num_‹dîög
[
i
];

1978 
iside
 = 
side_‹dîög
[
i
];

1979 
ioff
 = 
off£t_‹dîög
[
i
];

1982 
j
 = 0; j < (
Fc
 / 
group_size
); j++)

1984 
f_åack
 = (
i
 * 
°ï_size
Ë+ (
j
 * 
fc_°ï
);

1985 
ôøck
 = (()
f_åack
Ë* 
group_size
;

1988 
ôøck
 = 
	`mö
(ôøck, 
nodes_≥r_ch™
 - 
group_size
);

1991 
k
 = 0; k < 
group_size
; ++k)

1993 
åacks_c⁄√˘ed_to_pö
[
ùö
][
ioff
][
iside
]

1994 [
group_size
 * 
j
 + 
k
] = 
ôøck
 + k;

1998 
	}
}

2001 
	$lﬂd_≥πurbed_swôch_∑âîn
(
IN
 
t_ty≥_±r
 
ty≥
,

2002 
INOUT
 ****
åacks_c⁄√˘ed_to_pö
,

2003 
IN
 
num_phys_pös
,

2004 
IN
 *
pö_num_‹dîög
,

2005 
IN
 *
side_‹dîög
,

2006 
IN
 *
off£t_‹dîög
,

2007 
IN
 
nodes_≥r_ch™
,

2008 
IN
 
Fc
,

2009 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

2023 
i
, 
j
, 
ùö
, 
iside
, 
ôøck
, 
ihÆf
, 
ic⁄n
, 
ioff
;

2024 
Fc_dí£
, 
Fc_•¨£
, 
Fc_hÆf
[2];

2025 
f_åack
, 
•acög_dí£
, 
•acög_•¨£
, 
•acög
[2];

2026 
°ï_size
;

2028 
	`as£π
(
dúe˘i⁄Æôy
 =
BI_DIRECTIONAL
);

2030 
°ï_size
 = ()
nodes_≥r_ch™
 / ()(
Fc
 * 
num_phys_pös
);

2032 
Fc_dí£
 = (
Fc
 / 2) + 1;

2033 
Fc_•¨£
 = 
Fc
 - 
Fc_dí£
;

2035 
•acög_dí£
 = ()
nodes_≥r_ch™
 / ()(2 * 
Fc_dí£
);

2036 
•acög_•¨£
 = ()
nodes_≥r_ch™
 / ()(2 * 
Fc_•¨£
);

2038 
i
 = 0; i < 
num_phys_pös
; i++)

2040 
ùö
 = 
pö_num_‹dîög
[
i
];

2041 
iside
 = 
side_‹dîög
[
i
];

2042 
ioff
 = 
off£t_‹dîög
[
i
];

2045 
•acög
[
i
 % 2] = 
•acög_dí£
;

2046 
Fc_hÆf
[
i
 % 2] = 
Fc_dí£
;

2047 
•acög
[(
i
 + 1Ë% 2] = 
•acög_•¨£
;

2048 
Fc_hÆf
[(
i
 + 1Ë% 2] = 
Fc_•¨£
;

2050 
f_åack
 = 
i
 * 
°ï_size
;

2051 
ic⁄n
 = 0;

2053 
ihÆf
 = 0; ihalf < 2; ihalf++)

2055 
j
 = 0; j < 
Fc_hÆf
[
ihÆf
]; ++j)

2057 
ôøck
 = ()
f_åack
;

2062 
ôøck
 = iåack % 
nodes_≥r_ch™
;

2063 
åacks_c⁄√˘ed_to_pö
[
ùö
][
ioff
][
iside
][
ic⁄n
]

2064 
ôøck
;

2066 
f_åack
 +
•acög
[
ihÆf
];

2067 
ic⁄n
++;

2071 
	}
}

2075 
	$check_Æl_åacks_ªach_pös
(
t_ty≥_±r
 
ty≥
,

2076 ****
åacks_c⁄√˘ed_to_pö
,

2077 
nodes_≥r_ch™
,

2078 
Fc
,

2079 
e_pö_ty≥
 
ùö_‹_›ö
)

2084 
ic⁄n
, 
iside
, 
ôøck
, 
ùö
, 
ioff
;

2085 *
num_c⁄ns_to_åack
;

2087 
	`as£π
(
nodes_≥r_ch™
 > 0);

2089 
num_c⁄ns_to_åack
 = (*)
	`my_ˇŒoc
(
nodes_≥r_ch™
, ());

2091 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ipin++)

2093 
ioff
 = 0; iof‡< 
ty≥
->
height
; ioff++)

2095 
iside
 = 0; iside < 4; iside++)

2097 if(
åacks_c⁄√˘ed_to_pö
[
ùö
][
ioff
][
iside
][0]

2098 !
OPEN
)

2100 
ic⁄n
 = 0; ic⁄¿< 
Fc
; iconn++)

2102 
ôøck
 =

2103 
åacks_c⁄√˘ed_to_pö
[
ùö
]

2104 [
ioff
][
iside
][
ic⁄n
];

2105 
num_c⁄ns_to_åack
[
ôøck
]++;

2112 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2114 if(
num_c⁄ns_to_åack
[
ôøck
] <= 0)

2116 
¥ötf


2118 "\tc⁄√˘Åÿ™y FB ", 
ôøck
);

2120 if(
ùö_‹_›ö
 =
DRIVER
)

2121 
	`¥ötf
("OPINs.\n");

2123 
	`¥ötf
("IPINs.\n");

2127 
	`‰ì
(
num_c⁄ns_to_åack
);

2128 
	}
}

2133 
s_ivec
 ***

2134 
	$Æloc_™d_lﬂd_åack_to_pö_lookup
(
IN
 ****
pö_to_åack_m≠
,

2135 
IN
 
Fc
,

2136 
IN
 
height
,

2137 
IN
 
num_pös
,

2138 
IN
 
nodes_≥r_ch™
)

2140 
ùö
, 
iside
, 
ôøck
, 
ic⁄n
, 
ioff
, 
pö_cou¡î
;

2141 
s_ivec
 ***
åack_to_pö_lookup
;

2155 if(
num_pös
 < 1)

2157  
NULL
;

2161 
åack_to_pö_lookup
 =

2162 (
s_ivec
 ***)
	`Æloc_m©rix3
(0, 
nodes_≥r_ch™
 - 1, 0,

2163 
height
 - 1, 0, 3,

2164 (
s_ivec
));

2165 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2167 
ioff
 = 0; iof‡< 
height
; ioff++)

2169 
iside
 = 0; iside < 4; iside++)

2171 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].
√Àm
 =

2173 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].
li°
 =

2174 
NULL
;

2180 
ùö
 = 0; ipö < 
num_pös
; ipin++)

2182 
ioff
 = 0; iof‡< 
height
; ioff++)

2184 
iside
 = 0; iside < 4; iside++)

2186 if(
pö_to_åack_m≠
[
ùö
][
ioff
][
iside
][0] =
OPEN
)

2189 
ic⁄n
 = 0; ic⁄¿< 
Fc
; iconn++)

2191 
ôøck
 =

2192 
pö_to_åack_m≠
[
ùö
][
ioff
][
iside
]

2193 [
ic⁄n
];

2194 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].

2195 
√Àm
++;

2202 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2204 
ioff
 = 0; iof‡< 
height
; ioff++)

2206 
iside
 = 0; iside < 4; iside++)

2208 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].
li°
 = 
NULL
;

2209 if(
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].

2210 
√Àm
 != 0)

2212 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].

2213 
li°
 =

2215 
	`my_mÆloc
(
åack_to_pö_lookup
[
ôøck
]

2216 [
ioff
][
iside
].
√Àm
 *

2218 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].

2219 
√Àm
 = 0;

2226 
ùö
 = 0; ipö < 
num_pös
; ipin++)

2228 
ioff
 = 0; iof‡< 
height
; ioff++)

2230 
iside
 = 0; iside < 4; iside++)

2232 if(
pö_to_åack_m≠
[
ùö
][
ioff
][
iside
][0] =
OPEN
)

2235 
ic⁄n
 = 0; ic⁄¿< 
Fc
; iconn++)

2237 
ôøck
 =

2238 
pö_to_åack_m≠
[
ùö
][
ioff
][
iside
]

2239 [
ic⁄n
];

2240 
pö_cou¡î
 =

2241 
åack_to_pö_lookup
[
ôøck
][
ioff
]

2242 [
iside
].
√Àm
;

2243 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].

2244 
li°
[
pö_cou¡î
] = 
ùö
;

2245 
åack_to_pö_lookup
[
ôøck
][
ioff
][
iside
].

2246 
√Àm
++;

2252  
åack_to_pö_lookup
;

2253 
	}
}

2259 
	$dump_º_gøph
(
IN
 c⁄° *
fûe_«me
)

2262 
öode
;

2263 
FILE
 *
Â
;

2265 
Â
 = 
	`my_f›í
(
fûe_«me
, "w");

2267 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

2269 
	`¥öt_º_node
(
Â
, 
º_node
, 
öode
);

2270 
	`Ârötf
(
Â
, "\n");

2274 
	`Ârötf
(
Â
, "\n\n%dÑr_ödexed_d©®íåõs.\n\n", 
num_º_ödexed_d©a
);

2276 
ödex
 = 0; index < 
num_º_ödexed_d©a
; index++)

2278 
	`¥öt_º_ödexed_d©a
(
Â
, 
ödex
);

2279 
	`Ârötf
(
Â
, "\n");

2283 
	`f˛o£
(
Â
);

2284 
	}
}

2289 
	$¥öt_º_node
(
FILE
 * 
Â
,

2290 
t_º_node
 * 
º_node
,

2291 
öode
)

2294 c⁄° *
«me_ty≥
[] = {

2297 c⁄° *
dúe˘i⁄_«me
[] = {

2300 c⁄° *
drivîs_«me
[] = {

2304 
t_º_ty≥
 
º_ty≥
;

2305 
ic⁄n
;

2307 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

2310 
	`as£π
(
º_ty≥
 < ((
«me_ty≥
) / (*)));

2311 
	`as£π
((
º_node
[
öode
].
dúe˘i⁄
 + 1) <

2312 ((
dúe˘i⁄_«me
) / (*)));

2313 
	`as£π
((
º_node
[
öode
].
drivîs
 + 1) <

2314 ((
drivîs_«me
) / (*)));

2316 
	`Ârötf
(
Â
, "Node: %d %†", 
öode
, 
«me_ty≥
[
º_ty≥
]);

2317 if((
º_node
[
öode
].
xlow
 =º_node[öode].
xhigh
) &&

2318 (
º_node
[
öode
].
ylow
 =º_node[öode].
yhigh
))

2320 
	`Ârötf
(
Â
, "(%d, %dË", 
º_node
[
öode
].
xlow
,

2321 
º_node
[
öode
].
ylow
);

2325 
	`Ârötf
(
Â
, "(%d, %dËtÿ(%d, %dË", 
º_node
[
öode
].
xlow
,

2326 
º_node
[
öode
].
ylow
,Ñr_node[öode].
xhigh
,

2327 
º_node
[
öode
].
yhigh
);

2329 
	`Ârötf
(
Â
, "Ptc_num: %d ", 
º_node
[
öode
].
±c_num
);

2330 
	`Ârötf
(
Â
, "Direction: %s ",

2331 
dúe˘i⁄_«me
[
º_node
[
öode
].
dúe˘i⁄
 + 1]);

2332 
	`Ârötf
(
Â
, "Drivîs: %†", 
drivîs_«me
[
º_node
[
öode
].
drivîs
 + 1]);

2333 
	`Ârötf
(
Â
, "\n");

2335 
	`Ârötf
(
Â
, "%dÉdge(s):", 
º_node
[
öode
].
num_edges
);

2336 
ic⁄n
 = 0; ic⁄¿< 
º_node
[
öode
].
num_edges
; iconn++)

2337 
	`Ârötf
(
Â
, " %d", 
º_node
[
öode
].
edges
[
ic⁄n
]);

2338 
	`Ârötf
(
Â
, "\n");

2340 
	`Ârötf
(
Â
, "SwitchÅypes:");

2341 
ic⁄n
 = 0; ic⁄¿< 
º_node
[
öode
].
num_edges
; iconn++)

2342 
	`Ârötf
(
Â
, " %d", 
º_node
[
öode
].
swôches
[
ic⁄n
]);

2343 
	`Ârötf
(
Â
, "\n");

2345 
	`Ârötf
(
Â
, "Occ: %d C≠acôy: %d\n", 
º_node
[
öode
].
occ
,

2346 
º_node
[
öode
].
ˇ∑côy
);

2347 
	`Ârötf
(
Â
, "R: %g C: %g\n", 
º_node
[
öode
].
R
,Ñr_node[öode].
C
);

2348 
	`Ârötf
(
Â
, "Co°_ödex: %d\n", 
º_node
[
öode
].
co°_ödex
);

2349 
	}
}

2354 
	$¥öt_º_ödexed_d©a
(
FILE
 * 
Â
,

2355 
ödex
)

2358 
	`Ârötf
(
Â
, "Index: %d\n", 
ödex
);

2360 
	`Ârötf
(
Â
, "ortho_cost_index: %d ",

2361 
º_ödexed_d©a
[
ödex
].
‹tho_co°_ödex
);

2362 
	`Ârötf
(
Â
, "ba£_co°: %g ", 
º_ödexed_d©a
[
ödex
].
ßved_ba£_co°
);

2363 
	`Ârötf
(
Â
, "saved_base_cost: %g\n",

2364 
º_ödexed_d©a
[
ödex
].
ßved_ba£_co°
);

2366 
	`Ârötf
(
Â
, "Seg_ödex: %d ", 
º_ödexed_d©a
[
ödex
].
£g_ödex
);

2367 
	`Ârötf
(
Â
, "öv_Àngth: %g\n", 
º_ödexed_d©a
[
ödex
].
öv_Àngth
);

2369 
	`Ârötf
(
Â
, "T_löór: %g ", 
º_ödexed_d©a
[
ödex
].
T_löór
);

2370 
	`Ârötf
(
Â
, "T_quadøtic: %g ", 
º_ödexed_d©a
[
ödex
].
T_quadøtic
);

2371 
	`Ârötf
(
Â
, "C_lﬂd: %g\n", 
º_ödexed_d©a
[
ödex
].
C_lﬂd
);

2372 
	}
}

2377 
	$buûd_unidú_º_›ös
(
IN
 
i
,

2378 
IN
 
j
,

2379 
IN
 
s_grid_tûe
 **
grid
,

2380 
IN
 *
Fc_out
,

2381 
IN
 
nodes_≥r_ch™
,

2382 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

2383 
INOUT
 **
Fc_xofs
,

2384 
INOUT
 **
Fc_yofs
,

2385 
INOUT
 
t_º_node
 * 
º_node
,

2386 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

2387 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
,

2388 
IN
 
t_ivec
 *** 
º_node_ödi˚s
)

2394 
t_ty≥_±r
 
ty≥
;

2395 
ùö
, 
i˛ass
, 
ofs
, 
ch™
, 
£g
, 
max_Àn
, 
öode
;

2396 
e_side
 
side
;

2397 
t_º_ty≥
 
ch™_ty≥
;

2398 
t_löked_edge
 *
edge_li°
 = 
NULL
, *
√xt
;

2399 
boﬁón
 
˛ù≥d
, 
vît
, 
pos_dú
;

2400 
num_edges
;

2401 **
Fc_ofs
;

2403 *
Fc_˛ù≥d
 = 
FALSE
;

2406 if(
grid
[
i
][
j
].
off£t
 > 0)

2411 
ty≥
 = 
grid
[
i
][
j
].type;

2414 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ++ipin)

2417 
i˛ass
 = 
ty≥
->
pö_˛ass
[
ùö
];

2418 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ !
DRIVER
)

2422 if(
ty≥
->
is_globÆ_pö
[
ùö
])

2427 
num_edges
 = 0;

2428 
edge_li°
 = 
NULL
;

2429 
ofs
 = 0; of†< 
ty≥
->
height
; ++ofs)

2431 
side
 = 0; side < 4; ++side)

2434 if(0 =
ty≥
->
pöloc
[
ofs
][
side
][
ùö
])

2441 
vît
 = ((
side
 =
TOP
Ë|| (sidê=
BOTTOM
));

2442 
pos_dú
 = ((
side
 =
TOP
Ë|| (sidê=
RIGHT
));

2443 
ch™_ty≥
 = (
vît
 ? 
CHANX
 : 
CHANY
);

2444 
ch™
 = (
vît
 ? (
j
 + 
ofs
Ë: 
i
);

2445 
£g
 = (
vît
 ? 
i
 : (
j
 + 
ofs
));

2446 
max_Àn
 = (
vît
 ? 
ny
 : 
nx
);

2447 
Fc_ofs
 = (
vît
 ? 
Fc_xofs
 : 
Fc_yofs
);

2448 if(
FALSE
 =
pos_dú
)

2450 --
ch™
;

2454 if(
ch™
 < 0)

2458 if(
£g
 < 1)

2462 if(
£g
 > (
vît
 ? 
ny
 : 
nx
))

2466 if(
ch™
 > (
vît
 ? 
nx
 : 
ny
))

2472 
num_edges
 +=

2473 
	`gë_unidú_›ö_c⁄√˘i⁄s
(
ch™
, 
£g
,

2474 
Fc_out
[
ty≥
->

2475 
ödex
],

2476 
ch™_ty≥
,

2477 
£g_dëaûs
,

2478 &
edge_li°
,

2479 
Fc_ofs
,

2480 
º_edge_d⁄e
,

2481 
max_Àn
,

2482 
nodes_≥r_ch™
,

2483 
º_node_ödi˚s
,

2484 &
˛ù≥d
);

2485 if(
˛ù≥d
)

2487 *
Fc_˛ù≥d
 = 
TRUE
;

2493 
öode
 = 
	`gë_º_node_ödex
(
i
, 
j
, 
OPIN
, 
ùö
, 
º_node_ödi˚s
);

2494 
	`Æloc_™d_lﬂd_edges_™d_swôches
(
º_node
, 
öode
, 
num_edges
,

2495 
º_edge_d⁄e
, 
edge_li°
);

2496 
edge_li°
 !
NULL
) {

2497 
√xt
 = 
edge_li°
->next;

2498 
	`‰ì
(
edge_li°
);

2499 
edge_li°
 = 
√xt
;

2502 
	}
}

2505 
	$lﬂd_unif‹m_›ö_swôch_∑âîn_∑úed
(
IN
 *
Fc_out
,

2506 
IN
 
num_pös
,

2507 
IN
 *
pös_ö_ch™_£g
,

2508 
IN
 
num_wúe_öc_muxes
,

2509 
IN
 
num_wúe_dec_muxes
,

2510 
IN
 *
wúe_öc_muxes
,

2511 
IN
 *
wúe_dec_muxes
,

2512 
INOUT
 
t_º_node
 * 
º_node
,

2513 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

2514 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

2515 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
)

2548 
ùö
, 
ic⁄n
, 
num_edges
, 
öô_mux
;

2549 
‰om_node
, 
to_node
, 
to_åack
;

2550 
xlow
, 
ylow
;

2551 
t_löked_edge
 *
edge_li°
;

2552 *
wúe_muxes
;

2553 
k
, 
num_wúe_muxes
, 
Fc_ouçut_≥r_side
, 
CurFc
;

2554 
cou¡_öc
, 
cou¡_dec
;

2555 
t_ty≥_±r
 
ty≥
;

2557 *
Fc_˛ù≥d
 = 
FALSE
;

2559 
cou¡_öc
 = 
cou¡_dec
 = 0;

2561 
ùö
 = 0; ipö < 
num_pös
; ipin++)

2563 
‰om_node
 = 
pös_ö_ch™_£g
[
ùö
];

2564 
xlow
 = 
º_node
[
‰om_node
].xlow;

2565 
ylow
 = 
º_node
[
‰om_node
].ylow;

2566 
ty≥
 = 
grid
[
xlow
][
ylow
].type;

2567 
edge_li°
 = 
NULL
;

2568 
num_edges
 = 0;

2571 
k
 = 0; k < 2; ++k)

2573 if(
k
 == 0)

2575 
num_wúe_muxes
 = 
num_wúe_öc_muxes
;

2576 
wúe_muxes
 = 
wúe_öc_muxes
;

2580 
num_wúe_muxes
 = 
num_wúe_dec_muxes
;

2581 
wúe_muxes
 = 
wúe_dec_muxes
;

2585 
	`as£π
(
Fc_out
[
ty≥
->
ödex
] % 2 == 0);

2586 
Fc_ouçut_≥r_side
 = 
Fc_out
[
ty≥
->
ödex
] / 2;

2590 
CurFc
 = 
Fc_ouçut_≥r_side
;

2591 if(
Fc_ouçut_≥r_side
 > 
num_wúe_muxes
)

2593 *
Fc_˛ù≥d
 = 
TRUE
;

2594 
CurFc
 = 
num_wúe_muxes
;

2597 if(
k
 == 0)

2599 
öô_mux
 = (
cou¡_öc
Ë% 
num_wúe_muxes
;

2600 
cou¡_öc
 +
CurFc
;

2604 
öô_mux
 = (
cou¡_dec
Ë% 
num_wúe_muxes
;

2605 
cou¡_dec
 +
CurFc
;

2608 
ic⁄n
 = 0; ic⁄¿< 
CurFc
; iconn++)

2612 
to_node
 =

2613 
wúe_muxes
[(
öô_mux
 +

2614 
ic⁄n
Ë% 
num_wúe_muxes
];

2616 
º_node
[
to_node
].
num_›ö_drivîs
++;

2617 
to_åack
 = 
º_node
[
to_node
].
±c_num
;

2619 if(
FALSE
 =
º_edge_d⁄e
[
to_node
])

2623 
º_edge_d⁄e
[
to_node
] = 
TRUE
;

2624 
edge_li°
 =

2625 
	`ö£π_ö_edge_li°
(
edge_li°
,

2626 
to_node
,

2627 
£g_dëaûs


2628 [
to_åack
].

2629 
wúe_swôch
);

2630 
num_edges
++;

2635 if(
num_edges
 < 1)

2637 
¥ötf


2639 "åacks.\n", 
º_node
[
‰om_node
].
±c_num
,

2640 
º_node
[
‰om_node
].
xlow
,Ñr_node[‰om_node].
ylow
);

2641 
	`exô
(1);

2644 
	`Æloc_™d_lﬂd_edges_™d_swôches
(
º_node
, 
‰om_node
, 
num_edges
,

2645 
º_edge_d⁄e
, 
edge_li°
);

2647 
	}
}

2660 
	$võw_mux_size_di°ributi⁄
(
t_ivec
 *** 
º_node_ödi˚s
,

2661 
nodes_≥r_ch™
,

2662 
t_£g_dëaûs
 * 
£g_dëaûs_x
,

2663 
t_£g_dëaûs
 * 
£g_dëaûs_y
)

2666 
i
, 
j
, 
ôøck
, 
£g_num
, 
ch™_num
, 
max_Àn
;

2667 
°¨t
, 
íd
, 
öode
, 
max_vÆue
, 
mö_vÆue
;

2668 
¨øy_cou¡
, 
k
, 
num_muxes
;

2669 
dúe˘i⁄
, 
side
;

2670 *
≥r˚¡_ønge_¨øy
;

2671 
≥r˚¡_ønge
, 
≥r˚¡_ønge_sum
, 
avg_≥r˚¡_ønge
;

2672 
°d_dev_≥r˚¡_ønge
, 
devüti⁄_f
;

2673 
ønge
, *
ønge_¨øy
, 
globÆ_max_ønge
;

2674 
avg_ønge
, 
ønge_sum
, 
°d_dev_ønge
;

2675 
t_£g_dëaûs
 *
£g_dëaûs
;

2676 
t_mux
 *
√w_mux
, *
sblock_mux_li°_hód
, *
cuºít
, *
√xt
;

2678 #ifde‡
ENABLE_DUMP


2679 
FILE
 *
dump_fûe_≥r_sblock
, *
dump_fûe
;

2681 
t_mux_size_di°ributi⁄
 *
di°r_li°
, *
di°r_cuºít
, *
√w_di°ributi⁄
,

2682 *
di°r_√xt
;

2684 #ifde‡
ENABLE_DUMP


2685 
dump_fûe
 = 
	`my_f›í
("mux_size_dump.txt", "w");

2686 
dump_fûe_≥r_sblock
 = 
	`my_f›í
("mux_size_per_sblock_dump.txt", "w");

2689 
sblock_mux_li°_hód
 = 
NULL
;

2690 
≥r˚¡_ønge_¨øy
 =

2691 (*)
	`my_mÆloc
((
nx
 - 1Ë* (
ny
 - 1) * ());

2692 
ønge_¨øy
 = (*)
	`my_mÆloc
((
nx
 - 1Ë* (
ny
 - 1) * ());

2693 
¨øy_cou¡
 = 0;

2694 
≥r˚¡_ønge_sum
 = 0.0;

2695 
ønge_sum
 = 0.0;

2696 
globÆ_max_ønge
 = 0;

2697 
mö_vÆue
 = 0;

2698 
max_vÆue
 = 0;

2699 
£g_num
 = 0;

2700 
ch™_num
 = 0;

2701 
dúe˘i⁄
 = 0;

2702 
£g_dëaûs
 = 0;

2703 
max_Àn
 = 0;

2704 
di°r_li°
 = 
NULL
;

2707 
j
 = (
ny
 - 1); j > 0; j--)

2709 
i
 = 1; i < 
nx
; i++)

2711 
num_muxes
 = 0;

2712 
side
 = 0; side < 4; side++)

2714 
side
)

2716 
LEFT
:

2717 
£g_num
 = 
i
;

2718 
ch™_num
 = 
j
;

2719 
dúe˘i⁄
 = 
DEC_DIRECTION
;

2720 
£g_dëaûs
 = 
£g_dëaûs_x
;

2721 
max_Àn
 = 
nx
;

2724 
RIGHT
:

2725 
£g_num
 = 
i
 + 1;

2726 
ch™_num
 = 
j
;

2727 
dúe˘i⁄
 = 
INC_DIRECTION
;

2728 
£g_dëaûs
 = 
£g_dëaûs_x
;

2729 
max_Àn
 = 
nx
;

2732 
TOP
:

2733 
£g_num
 = 
j
 + 1;

2734 
ch™_num
 = 
i
;

2735 
dúe˘i⁄
 = 
INC_DIRECTION
;

2736 
£g_dëaûs
 = 
£g_dëaûs_y
;

2737 
max_Àn
 = 
ny
;

2740 
BOTTOM
:

2741 
£g_num
 = 
j
;

2742 
ch™_num
 = 
i
;

2743 
dúe˘i⁄
 = 
DEC_DIRECTION
;

2744 
£g_dëaûs
 = 
£g_dëaûs_y
;

2745 
max_Àn
 = 
ny
;

2749 
	`as£π
(
FALSE
);

2752 
	`as£π
(
nodes_≥r_ch™
 > 0);

2753 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2755 
°¨t
 =

2756 
	`gë_£g_°¨t
(
£g_dëaûs
, 
ôøck
,

2757 
£g_num
, 
ch™_num
);

2758 
íd
 =

2759 
	`gë_£g_íd
(
£g_dëaûs
, 
ôøck
,

2760 
°¨t
, 
ch™_num
, 
max_Àn
);

2762 if((
£g_dëaûs
[
ôøck
].
dúe˘i⁄
 ==

2763 
dúe˘i⁄
Ë&& (((
°¨t
 =
£g_num
)

2764 && (
dúe˘i⁄
 ==

2765 
INC_DIRECTION
))

2766 || ((
íd
 =
£g_num
)

2767 && (
dúe˘i⁄
 ==

2768 
DEC_DIRECTION
))))

2770 
num_muxes
++;

2771 if(
side
 =
LEFT
 || sidê=
RIGHT
)

2773 
öode
 =

2774 
gë_º_node_ödex


2775 (
£g_num
, 
ch™_num
,

2776 
CHANX
, 
ôøck
,

2777 
º_node_ödi˚s
);

2781 
	`as£π
((
side
 =
TOP
Ë|| (sidê=
BOTTOM
));

2782 
öode
 =

2783 
gë_º_node_ödex


2784 (
ch™_num
, 
£g_num
,

2785 
CHANY
, 
ôøck
,

2786 
º_node_ödi˚s
);

2789 
√w_mux
 = (
t_mux
 *)

2790 
	`my_mÆloc
((
t_mux
));

2791 
√w_mux
->
size
 =

2792 
º_node
[
öode
].

2793 
num_wúe_drivîs
 +

2794 
º_node
[
öode
].

2795 
num_›ö_drivîs
;

2796 
√w_mux
->
√xt
 = 
NULL
;

2799 if(
sblock_mux_li°_hód
 =
NULL
)

2802 
sblock_mux_li°_hód
 =

2803 
√w_mux
;

2805 if(
sblock_mux_li°_hód
->

2806 
size
 < 
√w_mux
->size)

2809 
√w_mux
->
√xt
 =

2810 
sblock_mux_li°_hód
;

2811 
sblock_mux_li°_hód
 =

2812 
√w_mux
;

2817 
cuºít
 =

2818 
sblock_mux_li°_hód
;

2819 
√xt
 = 
cuºít
->next;

2821 (
√xt
 !
NULL
)

2822 && (
√xt
->
size
 >

2823 
√w_mux
->
size
))

2825 
cuºít
 = 
√xt
;

2826 
√xt
 =

2827 
cuºít
->
√xt
;

2830 if(
√xt
 =
NULL
)

2832 
cuºít
->
√xt
 =

2833 
√w_mux
;

2837 
√w_mux
->
√xt
 =

2838 
cuºít
->
√xt
;

2839 
cuºít
->
√xt
 =

2840 
√w_mux
;

2849 
cuºít
 = 
sblock_mux_li°_hód
;

2851 #ifde‡
ENABLE_DUMP


2852 
	`Ârötf
(
dump_fûe_≥r_sblock
,

2853 "sblockáà(%d, %dËha†mux sizes: {", 
i
, 
j
);

2856 if(
cuºít
 !
NULL
)

2858 
max_vÆue
 = 
mö_vÆue
 = 
cuºít
->
size
;

2860 
cuºít
 !
NULL
)

2862 if(
max_vÆue
 < 
cuºít
->
size
)

2863 
max_vÆue
 = 
cuºít
->
size
;

2864 if(
mö_vÆue
 > 
cuºít
->
size
)

2865 
mö_vÆue
 = 
cuºít
->
size
;

2867 #ifde‡
ENABLE_DUMP


2868 
	`Ârötf
(
dump_fûe_≥r_sblock
, "%d ",

2869 
cuºít
->
size
);

2870 
	`Ârötf
(
dump_fûe
, "%d\n", 
cuºít
->
size
);

2873 
cuºít
 = cuºít->
√xt
;

2876 #ifde‡
ENABLE_DUMP


2877 
	`Ârötf
(
dump_fûe_≥r_sblock
, "}\n\tmax: %d\tmin:%d",

2878 
max_vÆue
, 
mö_vÆue
);

2881 
ønge
 = 
max_vÆue
 - 
mö_vÆue
;

2882 
≥r˚¡_ønge
 = (()
ønge
Ë/ (()
mö_vÆue
);

2884 if(
globÆ_max_ønge
 < 
ønge
)

2885 
globÆ_max_ønge
 = 
ønge
;

2887 #ifde‡
ENABLE_DUMP


2888 
	`Ârötf
(
dump_fûe_≥r_sblock
,

2890 
ønge
, 
≥r˚¡_ønge
);

2893 
≥r˚¡_ønge_¨øy
[
¨øy_cou¡
] = 
≥r˚¡_ønge
;

2894 
ønge_¨øy
[
¨øy_cou¡
] = 
ønge
;

2896 
≥r˚¡_ønge_sum
 +
≥r˚¡_ønge
;

2897 
ønge_sum
 +
ønge
;

2899 
¨øy_cou¡
++;

2907 
di°r_cuºít
 = 
di°r_li°
;

2908 
di°r_cuºít
 !
NULL


2909 && 
di°r_cuºít
->
mux_cou¡
 !
num_muxes
)

2911 
di°r_cuºít
 = di°r_cuºít->
√xt
;

2914 if(
di°r_cuºít
 =
NULL
)

2919 
√w_di°ributi⁄
 = (
t_mux_size_di°ributi⁄
 *)

2920 
	`my_mÆloc
((
t_mux_size_di°ributi⁄
));

2921 
√w_di°ributi⁄
->
mux_cou¡
 = 
num_muxes
;

2922 
√w_di°ributi⁄
->
max_ödex
 = 
max_vÆue
;

2923 
√w_di°ributi⁄
->
di°r
 =

2924 (*)
	`my_ˇŒoc
(
max_vÆue
 + 1, ());

2927 
cuºít
 = 
sblock_mux_li°_hód
;

2928 
cuºít
 !
NULL
)

2930 
	`as£π
(
cuºít
->
size
 <=

2931 
√w_di°ributi⁄
->
max_ödex
);

2932 
√w_di°ributi⁄
->
di°r
[
cuºít
->
size
]++;

2933 
cuºít
 = cuºít->
√xt
;

2937 
√w_di°ributi⁄
->
√xt
 = 
di°r_li°
;

2938 
di°r_li°
 = 
√w_di°ributi⁄
;

2943 
cuºít
 = 
sblock_mux_li°_hód
;

2945 
cuºít
 !
NULL
)

2947 if(
cuºít
->
size
 >

2948 
di°r_cuºít
->
max_ödex
)

2951 
di°r_cuºít
->
di°r
 =

2952 
	`my_ªÆloc
(
di°r_cuºít
->

2953 
di°r
,

2954 (
cuºít
->
size
 +

2958 
k
 =

2959 (
di°r_cuºít
->
max_ödex
 +

2960 1); 
k
 <
cuºít
->
size
; k++)

2961 
di°r_cuºít
->
di°r
[
k
] = 0;

2963 
di°r_cuºít
->
max_ödex
 =

2964 
cuºít
->
size
;

2965 
di°r_cuºít
->
di°r
[
cuºít
->

2966 
size
]++;

2970 
di°r_cuºít
->
di°r
[
cuºít
->

2971 
size
]++;

2973 
cuºít
 = cuºít->
√xt
;

2978 
cuºít
 = 
sblock_mux_li°_hód
;

2979 
cuºít
 !
NULL
)

2981 
√xt
 = 
cuºít
->next;

2982 
	`‰ì
(
cuºít
);

2983 
cuºít
 = 
√xt
;

2985 
sblock_mux_li°_hód
 = 
NULL
;

2989 
avg_≥r˚¡_ønge
 = ()
≥r˚¡_ønge_sum
 / 
¨øy_cou¡
;

2990 
avg_ønge
 = ()
ønge_sum
 / 
¨øy_cou¡
;

2992 
≥r˚¡_ønge_sum
 = 0.0;

2993 
ønge_sum
 = 0.0;

2994 
k
 = 0; k < 
¨øy_cou¡
; k++)

2996 
devüti⁄_f
 = (
≥r˚¡_ønge_¨øy
[
k
] - 
avg_≥r˚¡_ønge
);

2997 
≥r˚¡_ønge_sum
 +
devüti⁄_f
 * deviation_f;

2999 
devüti⁄_f
 = (()
ønge_¨øy
[
k
] - 
avg_ønge
);

3000 
ønge_sum
 +
devüti⁄_f
 * deviation_f;

3002 
°d_dev_≥r˚¡_ønge
 =

3003 
	`sqπ
(
≥r˚¡_ønge_sum
 / (()
¨øy_cou¡
 - 1.0));

3004 
°d_dev_ønge
 = 
	`sqπ
(
ønge_sum
 / (()
¨øy_cou¡
 - 1.0));

3005 
	`¥ötf
("==== MUX size statistics ====\n");

3006 
	`¥ötf
("maxÑange of mux size withiná sblock is; %d\n",

3007 
globÆ_max_ønge
);

3008 
	`¥ötf
("avîagêøngêo‡mux sizêwôhöá sblock is; %.2f\n", 
avg_ønge
);

3009 
	`¥ötf
("std dev ofÑange of mux size withiná sblock is; %.2f\n",

3010 
°d_dev_ønge
);

3011 
¥ötf


3013 
avg_≥r˚¡_ønge
 * 100.0);

3014 
¥ötf


3016 
°d_dev_≥r˚¡_ønge
 * 100.0);

3018 
	`¥ötf
(" -- Detailed MUX size distribution by sblockÅype -- \n");

3019 
di°r_cuºít
 = 
di°r_li°
;

3020 
di°r_cuºít
 !
NULL
)

3022 
	`¥öt_di°ributi⁄
(
°dout
, 
di°r_cuºít
);

3025 
di°r_√xt
 = 
di°r_cuºít
->
√xt
;

3027 
	`‰ì
(
di°r_cuºít
->
di°r
);

3028 
	`‰ì
(
di°r_cuºít
);

3030 
di°r_cuºít
 = 
di°r_√xt
;

3033 
	`‰ì
(
≥r˚¡_ønge_¨øy
);

3034 
	`‰ì
(
ønge_¨øy
);

3035 #ifde‡
ENABLE_DUMP


3036 
	`f˛o£
(
dump_fûe_≥r_sblock
);

3037 
	`f˛o£
(
dump_fûe
);

3039 
	}
}

3043 
	$¥öt_di°ributi⁄
(
FILE
 * 
Âå
,

3044 
t_mux_size_di°ributi⁄
 * 
di°r_°ru˘
)

3046 *
di°r
;

3047 
k
;

3048 
sum
;

3049 
boﬁón
 
zîos
;

3051 
di°r
 = 
di°r_°ru˘
->distr;

3052 
	`Ârötf
(
Âå
,

3054 
di°r_°ru˘
->
mux_cou¡
);

3055 
	`Ârötf
(
Âå
, "\t\t\tSize\t\t\tFrequency (percent)\n");

3057 
sum
 = 0.0;

3058 
k
 = 0; k <
di°r_°ru˘
->
max_ödex
; k++)

3059 
sum
 +
di°r
[
k
];

3061 
zîos
 = 
TRUE
;

3062 
k
 = 0; k <
di°r_°ru˘
->
max_ödex
; k++)

3064 if(
zîos
 && (
di°r
[
k
] == 0))

3070 
zîos
 = 
FALSE
;

3071 
	`Ârötf
(
Âå
, "\t\t\t%d\t\t\t%d (%.2f%%)\n", 
k
, 
di°r
[k],

3072 ()
di°r
[
k
] / 
sum
 * 100.0);

3075 
	`Ârötf
(
Âå
, "\nEnd ofÅhis Sblock MUX size distribution.\n");

3077 
	}
}

	@rr_graph.h

1 
	ee_gøph_ty≥


3 
	mGRAPH_GLOBAL
,

4 
	mGRAPH_BIDIR
,

5 
	mGRAPH_UNIDIR
,

7 
	mGRAPH_UNIDIR_TILEABLE


9 
e_gøph_ty≥
 
	tt_gøph_ty≥
;

15 
	mRR_GRAPH_NO_WARN
 = 0x00,

16 
	mRR_GRAPH_WARN_FC_CLIPPED
 = 0x01,

17 
	mRR_GRAPH_WARN_CHAN_WIDTH_CHANGED
 = 0x02

20 
buûd_º_gøph
(
IN
 
t_gøph_ty≥
 
gøph_ty≥
,

21 
IN
 
num_ty≥s
,

22 
IN
 
t_ty≥_±r
 
ty≥s
,

23 
IN
 
nx
,

24 
IN
 
ny
,

25 
IN
 
s_grid_tûe
 **
grid
,

26 
IN
 
ch™_width
,

27 
IN
 
s_ch™_width_di°
 *
ch™_ˇ∑côy_öf
,

28 
IN
 
e_swôch_block_ty≥
 
sb_ty≥
,

29 
IN
 
Fs
,

30 
IN
 
num_£g_ty≥s
,

31 
IN
 
num_swôches
,

32 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

33 
IN
 
globÆ_rouã_swôch
,

34 
IN
 
dñayÀss_swôch
,

35 
IN
 
t_timög_öf
 
timög_öf
,

36 
IN
 
wúe_to_ùö_swôch
,

37 
IN
 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
,

38 
OUT
 *
W¨nögs
);

40 
‰ì_º_gøph
();

42 
dump_º_gøph
(
IN
 c⁄° *
fûe_«me
);

43 
¥öt_º_ödexed_d©a
(
FILE
 * 
Â
,

44 
ödex
);

45 
lﬂd_√t_º_ãrmöÆs
(
t_ivec
 *** 
º_node_ödi˚s
);

	@rr_graph2.c

1 
	~<°dio.h
>

2 
	~<as£π.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"globÆs.h
"

6 
	~"º_gøph_utû.h
"

7 
	~"º_gøph2.h
"

8 
	~"º_gøph_sbox.h
"

10 
	#ALLOW_SWITCH_OFF


	)

15 
	#ENABLE_REVERSE
 0

	)

18 
	#SAME_TRACK
 -5

	)

19 
	#UN_SET
 -1

	)

27 
boﬁón
 *
	gº_edge_d⁄e
;

32 
t_löked_edge
 *
	g‰ì_edge_li°_hód
 = 
NULL
;

52 
gë_swôch_ty≥
(
boﬁón
 
is_‰om_sbox
,

53 
boﬁón
 
is_to_sbox
,

54 
‰om_node_swôch
,

55 
to_node_swôch
,

56 
swôch_ty≥s
[2]);

58 
lﬂd_ch™_º_ödi˚s
(
IN
 
nodes_≥r_ch™
,

59 
IN
 
ch™_Àn
,

60 
IN
 
num_ch™s
,

61 
IN
 
t_º_ty≥
 
ty≥
,

62 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

63 
INOUT
 *
ödex
,

64 
INOUT
 
t_ivec
 *** 
ödi˚s
);

66 
gë_bidú_åack_to_ch™_£g
(
IN
 
s_ivec
 
c⁄n_åacks
,

67 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

68 
IN
 
to_ch™
,

69 
IN
 
to_£g
,

70 
IN
 
to_sb
,

71 
IN
 
t_º_ty≥
 
to_ty≥
,

72 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

73 
IN
 
boﬁón
 
‰om_is_sbox
,

74 
IN
 
‰om_swôch
,

75 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

76 
IN
 
e_dúe˘i⁄Æôy


77 
dúe˘i⁄Æôy
,

78 
INOUT
 
s_löked_edge


79 **
edge_li°
);

81 
gë_unidú_åack_to_ch™_£g
(
IN
 
boﬁón
 
is_íd_sb
,

82 
IN
 
‰om_åack
,

83 
IN
 
to_ch™
,

84 
IN
 
to_£g
,

85 
IN
 
to_sb
,

86 
IN
 
t_º_ty≥
 
to_ty≥
,

87 
IN
 
nodes_≥r_ch™
,

88 
IN
 
nx
,

89 
IN
 
ny
,

90 
IN
 
e_side
 
‰om_side
,

91 
IN
 
e_side
 
to_side
,

92 
IN
 
Fs_≥r_side
,

93 
IN
 *
›ö_mux_size
,

94 
IN
 *****
sblock_∑âîn
,

95 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

96 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

97 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

98 
OUT
 
boﬁón
 * 
Fs_˛ù≥d
,

99 
INOUT
 
s_löked_edge


100 **
edge_li°
);

102 
v¥_to_phy_åack
(
IN
 
ôøck
,

103 
IN
 
ch™_num
,

104 
IN
 
£g_num
,

105 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

106 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
);

108 *
gë_£g_åack_cou¡s
(
IN
 
num_£ts
,

109 
IN
 
num_£g_ty≥s
,

110 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

111 
IN
 
boﬁón
 
u£_fuŒ_£g_groups
);

113 *
œbñ_wúe_muxes
(
IN
 
ch™_num
,

114 
IN
 
£g_num
,

115 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

116 
IN
 
max_Àn
,

117 
IN
 
e_dúe˘i⁄
 
dú
,

118 
IN
 
nodes_≥r_ch™
,

119 
OUT
 *
num_wúe_muxes
);

121 *
œbñ_wúe_muxes_f‹_bÆ™˚
(
IN
 
ch™_num
,

122 
IN
 
£g_num
,

123 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

124 
IN
 
max_Àn
,

125 
IN
 
e_dúe˘i⁄
 
dúe˘i⁄
,

126 
IN
 
nodes_≥r_ch™
,

127 
IN
 *
num_wúe_muxes
,

128 
IN
 
t_º_ty≥
 
ch™_ty≥
,

129 
IN
 *
›ö_mux_size
,

130 
IN
 
t_ivec
 *** 
º_node_ödi˚s
);

132 *
œbñ_öcomög_wúes
(
IN
 
ch™_num
,

133 
IN
 
£g_num
,

134 
IN
 
sb_£g
,

135 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

136 
IN
 
max_Àn
,

137 
IN
 
e_dúe˘i⁄
 
dú
,

138 
IN
 
nodes_≥r_ch™
,

139 
OUT
 *
num_öcomög_wúes
,

140 
OUT
 *
num_ídög_wúes
);

142 
föd_œbñ_of_åack
(*
wúe_mux_⁄_åack
,

143 
num_wúe_muxes
,

144 
‰om_åack
);

163 
	$gë_£g_åack_cou¡s
(
IN
 
num_£ts
,

164 
IN
 
num_£g_ty≥s
,

165 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

166 
IN
 
boﬁón
 
u£_fuŒ_£g_groups
)

168 *
ªsu…
;

169 *
dem™d
;

170 
i
, 
imax
, 
‰eq_sum
, 
assig√d
, 
size
;

171 
sˇÀ
, 
max
, 
ªdu˚
;

173 
ªsu…
 = (*)
	`my_mÆloc
((Ë* 
num_£g_ty≥s
);

174 
dem™d
 = (*)
	`my_mÆloc
((Ë* 
num_£g_ty≥s
);

178 
sˇÀ
 = 1;

179 
‰eq_sum
 = 0;

180 
i
 = 0; i < 
num_£g_ty≥s
; ++i)

182 
sˇÀ
 *
£gmít_öf
[
i
].
Àngth
;

183 
‰eq_sum
 +
£gmít_öf
[
i
].
‰equícy
;

185 
ªdu˚
 = 
sˇÀ
 * 
‰eq_sum
;

188 
i
 = 0; i < 
num_£g_ty≥s
; ++i)

190 
ªsu…
[
i
] = 0;

191 
dem™d
[
i
] = 
sˇÀ
 * 
num_£ts
 * 
£gmít_öf
[i].
‰equícy
;

192 if(
u£_fuŒ_£g_groups
)

194 
dem™d
[
i
] /
£gmít_öf
[i].
Àngth
;

199 
assig√d
 = 0;

200 
size
 = 0;

201 
imax
 = 0;

202 
assig√d
 < 
num_£ts
)

205 
max
 = 0;

206 
i
 = 0; i < 
num_£g_ty≥s
; ++i)

208 if(
dem™d
[
i
] > 
max
)

210 
imax
 = 
i
;

211 
max
 = 
dem™d
[
i
];

216 
size
 = (
u£_fuŒ_£g_groups
 ? 
£gmít_öf
[
imax
].
Àngth
 : 1);

217 
dem™d
[
imax
] -
ªdu˚
;

218 
ªsu…
[
imax
] +
size
;

219 
assig√d
 +
size
;

223 if((
assig√d
 - 
num_£ts
Ë> (
size
 / 2))

225 
ªsu…
[
imax
] -
size
;

229 if(
dem™d
)

231 
	`‰ì
(
dem™d
);

232 
dem™d
 = 
NULL
;

236  
ªsu…
;

237 
	}
}

240 
t_£g_dëaûs
 *

241 
	$Æloc_™d_lﬂd_£g_dëaûs
(
INOUT
 *
nodes_≥r_ch™
,

242 
IN
 
max_Àn
,

243 
IN
 
num_£g_ty≥s
,

244 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

245 
IN
 
boﬁón
 
u£_fuŒ_£g_groups
,

246 
IN
 
boﬁón
 
is_globÆ_gøph
,

247 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

259 
i
, 
cur_åack
, 
¡øcks
, 
ôøck
, 
Àngth
, 
j
, 
ödex
;

260 
wúe_swôch
, 
›ö_swôch
, 
Ác
, 
num_£ts
, 
tmp
;

261 
group_°¨t
, 
fú°_åack
;

262 *
£ts_≥r_£g_ty≥
 = 
NULL
;

263 
t_£g_dëaûs
 *
£g_dëaûs
 = 
NULL
;

264 
boﬁón
 
l⁄glöe
;

267 if(
dúe˘i⁄Æôy
 =
BI_DIRECTIONAL
)

269 
Ác
 = 1;

273 
	`as£π
(
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
);

274 
Ác
 = 2;

276 
	`as£π
(*
nodes_≥r_ch™
 % 
Ác
 == 0);

279 
£ts_≥r_£g_ty≥
 = 
	`gë_£g_åack_cou¡s
((*
nodes_≥r_ch™
 / 
Ác
),

280 
num_£g_ty≥s
,

281 
£gmít_öf
,

282 
u£_fuŒ_£g_groups
);

285 
tmp
 = 0;

286 
i
 = 0; i < 
num_£g_ty≥s
; ++i)

288 
tmp
 +
£ts_≥r_£g_ty≥
[
i
] * 
Ác
;

290 
	`as£π
(
u£_fuŒ_£g_groups
 || (
tmp
 =*
nodes_≥r_ch™
));

291 *
nodes_≥r_ch™
 = 
tmp
;

293 
£g_dëaûs
 = (
t_£g_dëaûs
 *)

294 
	`my_mÆloc
(*
nodes_≥r_ch™
 * (
t_£g_dëaûs
));

297 
cur_åack
 = 0;

298 
i
 = 0; i < 
num_£g_ty≥s
; ++i)

300 
fú°_åack
 = 
cur_åack
;

302 
num_£ts
 = 
£ts_≥r_£g_ty≥
[
i
];

303 
¡øcks
 = 
Ác
 * 
num_£ts
;

304 if(
¡øcks
 < 1)

309 
l⁄glöe
 = 
£gmít_öf
[
i
].longline;

310 
Àngth
 = 
£gmít_öf
[
i
].length;

311 if(
l⁄glöe
)

313 
Àngth
 = 
max_Àn
;

316 
wúe_swôch
 = 
£gmít_öf
[
i
].wire_switch;

317 
›ö_swôch
 = 
£gmít_öf
[
i
].opin_switch;

318 
	`as£π
((
wúe_swôch
 =
›ö_swôch
)

319 || (
dúe˘i⁄Æôy
 !
UNI_DIRECTIONAL
));

322 
group_°¨t
 = 0;

323 
ôøck
 = 0; iåack < 
¡øcks
; itrack++)

327 if((
ôøck
 / 
Ác
Ë% 
Àngth
 == 0 && (itrack % fac) == 0)

329 
group_°¨t
 = 
cur_åack
;

332 
£g_dëaûs
[
cur_åack
].
Àngth
 =Üength;

333 
£g_dëaûs
[
cur_åack
].
l⁄glöe
 =Üongline;

341 
£g_dëaûs
[
cur_åack
].
°¨t
 =

342 (
cur_åack
 / 
Ác
Ë% 
Àngth
 + 1;

346 
£g_dëaûs
[
cur_åack
].
group_°¨t
 = group_start;

347 
£g_dëaûs
[
cur_åack
].
group_size
 =

348 
	`mö
(
¡øcks
 + 
fú°_åack
 - 
group_°¨t
,

349 
Àngth
 * 
Ác
);

350 
	`as£π
(0 =
£g_dëaûs
[
cur_åack
].
group_size
 % 
Ác
);

351 if(0 =
£g_dëaûs
[
cur_åack
].
group_size
)

353 
£g_dëaûs
[
cur_åack
].
group_size
 = 
Àngth
 * 
Ác
;

358 
£g_dëaûs
[
cur_åack
].
cb
 =

359 (
boﬁón
 *Ë
	`my_mÆloc
(
Àngth
 * (boolean));

360 
£g_dëaûs
[
cur_åack
].
sb
 =

361 (
boﬁón
 *Ë
	`my_mÆloc
((
Àngth
 + 1) * (boolean));

362 
j
 = 0; j < 
Àngth
; ++j)

364 if(
is_globÆ_gøph
)

366 
£g_dëaûs
[
cur_åack
].
cb
[
j
] = 
TRUE
;

370 
ödex
 = 
j
;

373 if(
l⁄glöe
)

375 
ödex
 = (ödex + 
ôøck
Ë% 
Àngth
;

379 if(
ôøck
 % 
Ác
 == 1)

381 
ödex
 = (
Àngth
 - 1Ë- 
j
;

385 
ödex
 = 
j
 % 
£gmít_öf
[
i
].
cb_Àn
;

386 
£g_dëaûs
[
cur_åack
].
cb
[
j
] =

387 
£gmít_öf
[
i
].
cb
[
ödex
];

390 
j
 = 0; j < (
Àngth
 + 1); ++j)

392 if(
is_globÆ_gøph
)

394 
£g_dëaûs
[
cur_åack
].
sb
[
j
] = 
TRUE
;

398 
ödex
 = 
j
;

401 if(
l⁄glöe
)

403 
ödex
 =

404 (
ödex
 + 
ôøck
Ë% (
Àngth
 +

409 if(
ôøck
 % 
Ác
 == 1)

411 
ödex
 = ((
Àngth
 + 1Ë- 1Ë- 
j
;

415 
ödex
 = 
j
 % 
£gmít_öf
[
i
].
sb_Àn
;

416 
£g_dëaûs
[
cur_åack
].
sb
[
j
] =

417 
£gmít_öf
[
i
].
sb
[
ödex
];

421 
£g_dëaûs
[
cur_åack
].
RmëÆ
 = 
£gmít_öf
[
i
].Rmetal;

422 
£g_dëaûs
[
cur_åack
].
CmëÆ
 = 
£gmít_öf
[
i
].Cmetal;

424 
£g_dëaûs
[
cur_åack
].
wúe_swôch
 = wire_switch;

425 
£g_dëaûs
[
cur_åack
].
›ö_swôch
 = opin_switch;

427 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

429 
£g_dëaûs
[
cur_åack
].
dúe˘i⁄
 = 
BI_DIRECTION
;

433 
	`as£π
(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
);

434 
£g_dëaûs
[
cur_åack
].
dúe˘i⁄
 =

435 (
ôøck
 % 2Ë? 
DEC_DIRECTION
 : 
INC_DIRECTION
;

438 
£gmít_öf
[
i
].
dúe˘i⁄Æôy
)

440 
UNI_DIRECTIONAL
:

441 
£g_dëaûs
[
cur_åack
].
drivîs
 = 
SINGLE
;

443 
BI_DIRECTIONAL
:

444 
£g_dëaûs
[
cur_åack
].
drivîs
 = 
MULTI_BUFFERED
;

448 
£g_dëaûs
[
cur_åack
].
ödex
 = 
i
;

450 ++
cur_åack
;

455 
	`‰ì
(
£ts_≥r_£g_ty≥
);

457  
£g_dëaûs
;

458 
	}
}

461 
	$‰ì_£g_dëaûs
(
t_£g_dëaûs
 * 
£g_dëaûs
,

462 
nodes_≥r_ch™
)

467 
i
;

469 
i
 = 0; i < 
nodes_≥r_ch™
; i++)

471 
	`‰ì
(
£g_dëaûs
[
i
].
cb
);

472 
	`‰ì
(
£g_dëaûs
[
i
].
sb
);

474 
	`‰ì
(
£g_dëaûs
);

475 
	}
}

481 
	$dump_£g_dëaûs
(
t_£g_dëaûs
 * 
£g_dëaûs
,

482 
nodes_≥r_ch™
,

483 *
‚ame
)

486 
FILE
 *
Â
;

487 
i
, 
j
;

488 c⁄° *
drivîs_«mes
[] = { "multi_buffered",

493 c⁄° *
dúe˘i⁄_«mes
[] = { "inc_direction",

498 
Â
 = 
	`my_f›í
(
‚ame
, "w");

500 
i
 = 0; i < 
nodes_≥r_ch™
; i++)

502 
	`Ârötf
(
Â
, "Tøck: %d.\n", 
i
);

503 
	`Ârötf
(
Â
, "Length: %d, Start: %d, LongÜine: %d "

505 
£g_dëaûs
[
i
].
Àngth
,

506 
£g_dëaûs
[
i
].
°¨t
,

507 
£g_dëaûs
[
i
].
l⁄glöe
,

508 
£g_dëaûs
[
i
].
wúe_swôch
, seg_dëaûs[i].
›ö_swôch
);

510 
	`Ârötf
(
Â
, "Rmetal: %g Cmetal: %g\n",

511 
£g_dëaûs
[
i
].
RmëÆ
, seg_dëaûs[i].
CmëÆ
);

513 
	`Ârötf
(
Â
, "Direction: %s Drivers: %s\n",

514 
dúe˘i⁄_«mes
[
£g_dëaûs
[
i
].
dúe˘i⁄
],

515 
drivîs_«mes
[
£g_dëaûs
[
i
].
drivîs
]);

517 
	`Ârötf
(
Â
, "Start Track: %d End Track: %d\n",

518 
£g_dëaûs
[
i
].
°¨t_åack
, seg_dëaûs[i].
íd_åack
);

520 
	`Ârötf
(
Â
, "cbÜist: ");

521 
j
 = 0; j < 
£g_dëaûs
[
i
].
Àngth
; j++)

522 
	`Ârötf
(
Â
, "%d ", 
£g_dëaûs
[
i
].
cb
[
j
]);

523 
	`Ârötf
(
Â
, "\n");

525 
	`Ârötf
(
Â
, "sbÜist: ");

526 
j
 = 0; j <
£g_dëaûs
[
i
].
Àngth
; j++)

527 
	`Ârötf
(
Â
, "%d ", 
£g_dëaûs
[
i
].
sb
[
j
]);

528 
	`Ârötf
(
Â
, "\n");

530 
	`Ârötf
(
Â
, "\n");

533 
	`f˛o£
(
Â
);

534 
	}
}

541 
	$gë_£g_°¨t
(
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

542 
IN
 
ôøck
,

543 
IN
 
ch™_num
,

544 
IN
 
£g_num
)

547 
£g_°¨t
, 
Àngth
, 
°¨t
;

549 
£g_°¨t
 = 1;

550 if(
FALSE
 =
£g_dëaûs
[
ôøck
].
l⁄glöe
)

553 
Àngth
 = 
£g_dëaûs
[
ôøck
].length;

554 
°¨t
 = 
£g_dëaûs
[
ôøck
].start;

559 
	`as£π
(
°¨t
 > 0);

560 
	`as£π
(
°¨t
 <
Àngth
);

566 
£g_°¨t
 =

567 
£g_num
 - (£g_num + 
Àngth
 + 
ch™_num
 - 
°¨t
) %Üength;

568 if(
£g_°¨t
 < 1)

570 
£g_°¨t
 = 1;

574  
£g_°¨t
;

575 
	}
}

578 
	$gë_£g_íd
(
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

579 
IN
 
ôøck
,

580 
IN
 
i°¨t
,

581 
IN
 
ch™_num
,

582 
IN
 
£g_max
)

584 
Àn
, 
ofs
, 
íd
, 
fú°_fuŒ
;

586 
Àn
 = 
£g_dëaûs
[
ôøck
].
Àngth
;

587 
ofs
 = 
£g_dëaûs
[
ôøck
].
°¨t
;

590 
íd
 = 
i°¨t
 + 
Àn
 - 1;

593 if(1 =
i°¨t
)

597 
fú°_fuŒ
 = (
Àn
 - (
ch™_num
 %ÜíË+ 
ofs
 - 1) %Üen + 1;

598 if(
fú°_fuŒ
 > 1)

601 
íd
 = 
fú°_fuŒ
 - 1;

606 if(
íd
 > 
£g_max
)

608 
íd
 = 
£g_max
;

611  
íd
;

612 
	}
}

621 
	$gë_bidú_›ö_c⁄√˘i⁄s
(
IN
 
i
,

622 
IN
 
j
,

623 
IN
 
ùö
,

624 
IN
 
s_löked_edge
 **
edge_li°
,

625 
IN
 *****
›ö_to_åack_m≠
,

626 
IN
 
Fc
,

627 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

628 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

629 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
)

632 
iside
, 
num_c⁄n
, 
ofs
, 
å_i
, 
å_j
, 
ch™
, 
£g
;

633 
to_åack
, 
to_swôch
, 
to_node
, 
ic⁄n
;

634 
is_c⁄√˘ed_åack
;

635 
t_ty≥_±r
 
ty≥
;

636 
t_º_ty≥
 
to_ty≥
;

638 
ty≥
 = 
grid
[
i
][
j
].type;

639 
ofs
 = 
grid
[
i
][
j
].
off£t
;

641 
num_c⁄n
 = 0;

644 
iside
 = 0; iside < 4; iside++)

648 
å_i
 = ((
iside
 =
LEFT
Ë? (
i
 - 1) : i);

649 
å_j
 = ((
iside
 =
BOTTOM
Ë? (
j
 - 1) : j);

651 
to_ty≥
 = ((
iside
 =
LEFT
Ë|| (isidê=
RIGHT
)Ë? 
CHANY
 : 
CHANX
;

653 
ch™
 = ((
to_ty≥
 =
CHANX
Ë? 
å_j
 : 
å_i
);

654 
£g
 = ((
to_ty≥
 =
CHANX
Ë? 
å_i
 : 
å_j
);

657 if((
å_i
 < 0Ë|| (å_ò> 
nx
))

661 if((
å_j
 < 0Ë|| (å_j > 
ny
))

665 if((
CHANX
 =
to_ty≥
Ë&& (
å_i
 < 1))

669 if((
CHANY
 =
to_ty≥
Ë&& (
å_j
 < 1))

674 
is_c⁄√˘ed_åack
 = 
FALSE
;

677 
ic⁄n
 = 0; ic⁄¿< 
Fc
; ++iconn)

679 
to_åack
 =

680 
›ö_to_åack_m≠
[
ty≥
->

681 
ödex
][
ùö
][
ofs
][
iside
][
ic⁄n
];

684 if(
OPEN
 =
to_åack
 || 
is_c⁄√˘ed_åack
)

686 
is_c⁄√˘ed_åack
 = 
TRUE
;

687 
	`as£π
(
OPEN
 ==

688 
›ö_to_åack_m≠
[
ty≥
->

689 
ödex
][
ùö
][
ofs
][
iside
]

695 if(
is_cbox


696 (
ch™
, 
£g
, 
to_åack
, 
£g_dëaûs
, 
BI_DIRECTIONAL
))

698 
to_swôch
 = 
£g_dëaûs
[
to_åack
].
wúe_swôch
;

699 
to_node
 =

700 
	`gë_º_node_ödex
(
å_i
, 
å_j
, 
to_ty≥
,

701 
to_åack
, 
º_node_ödi˚s
);

703 *
edge_li°
 =

704 
	`ö£π_ö_edge_li°
(*
edge_li°
, 
to_node
,

705 
to_swôch
);

706 
º_edge_d⁄e
[
to_node
] = 
TRUE
;

707 ++
num_c⁄n
;

712  
num_c⁄n
;

713 
	}
}

718 
	$gë_unidú_›ö_c⁄√˘i⁄s
(
IN
 
ch™
,

719 
IN
 
£g
,

720 
IN
 
Fc
,

721 
IN
 
t_º_ty≥
 
ch™_ty≥
,

722 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

723 
INOUT
 
t_löked_edge
 ** 
edge_li°_±r
,

724 
INOUT
 **
Fc_ofs
,

725 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

726 
IN
 
max_Àn
,

727 
IN
 
nodes_≥r_ch™
,

728 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

729 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
)

735 *
öc_muxes
 = 
NULL
;

736 *
dec_muxes
 = 
NULL
;

737 
num_öc_muxes
, 
num_dec_muxes
, 
ic⁄n
;

738 
öc_öode
, 
dec_öode
;

739 
öc_mux
, 
dec_mux
;

740 
öc_åack
, 
dec_åack
;

741 
x
, 
y
;

742 
num_edges
;

744 *
Fc_˛ù≥d
 = 
FALSE
;

747 
	`as£π
(
Fc
 % 2 == 0);

750 
x
 = ((
CHANX
 =
ch™_ty≥
Ë? 
£g
 : 
ch™
);

751 
y
 = ((
CHANX
 =
ch™_ty≥
Ë? 
ch™
 : 
£g
);

754 
öc_muxes
 = 
	`œbñ_wúe_muxes
(
ch™
, 
£g
, 
£g_dëaûs
, 
max_Àn
,

755 
INC_DIRECTION
, 
nodes_≥r_ch™
,

756 &
num_öc_muxes
);

757 
dec_muxes
 =

758 
	`œbñ_wúe_muxes
(
ch™
, 
£g
, 
£g_dëaûs
, 
max_Àn
, 
DEC_DIRECTION
,

759 
nodes_≥r_ch™
, &
num_dec_muxes
);

762 if(((
Fc
 / 2Ë> 
num_öc_muxes
Ë|| ((F¯/ 2Ë> 
num_dec_muxes
))

764 *
Fc_˛ù≥d
 = 
TRUE
;

765 
Fc
 = 2 * 
	`mö
(
num_öc_muxes
, 
num_dec_muxes
);

769 
num_edges
 = 0;

770 
ic⁄n
 = 0; ic⁄¿< (
Fc
 / 2); ++iconn)

773 
öc_mux
 = 
Fc_ofs
[
ch™
][
£g
] % 
num_öc_muxes
;

774 
dec_mux
 = 
Fc_ofs
[
ch™
][
£g
] % 
num_dec_muxes
;

775 ++
Fc_ofs
[
ch™
][
£g
];

778 
öc_åack
 = 
öc_muxes
[
öc_mux
];

779 
dec_åack
 = 
dec_muxes
[
dec_mux
];

782 
öc_öode
 =

783 
	`gë_º_node_ödex
(
x
, 
y
, 
ch™_ty≥
, 
öc_åack
,

784 
º_node_ödi˚s
);

785 
dec_öode
 =

786 
	`gë_º_node_ödex
(
x
, 
y
, 
ch™_ty≥
, 
dec_åack
,

787 
º_node_ödi˚s
);

790 if(
FALSE
 =
º_edge_d⁄e
[
öc_öode
])

792 
º_edge_d⁄e
[
öc_öode
] = 
TRUE
;

793 *
edge_li°_±r
 = 
	`ö£π_ö_edge_li°
(*edge_list_ptr,

794 
öc_öode
,

795 
£g_dëaûs


796 [
öc_åack
].

797 
›ö_swôch
);

798 ++
num_edges
;

800 if(
FALSE
 =
º_edge_d⁄e
[
dec_öode
])

802 
º_edge_d⁄e
[
dec_öode
] = 
TRUE
;

803 *
edge_li°_±r
 = 
	`ö£π_ö_edge_li°
(*edge_list_ptr,

804 
dec_öode
,

805 
£g_dëaûs


806 [
dec_åack
].

807 
›ö_swôch
);

808 ++
num_edges
;

812 if(
öc_muxes
)

814 
	`‰ì
(
öc_muxes
);

815 
öc_muxes
 = 
NULL
;

817 if(
dec_muxes
)

819 
	`‰ì
(
dec_muxes
);

820 
dec_muxes
 = 
NULL
;

823  
num_edges
;

824 
	}
}

826 
boﬁón


827 
	$is_cbox
(
IN
 
ch™
,

828 
IN
 
£g
,

829 
IN
 
åack
,

830 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

831 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

834 
°¨t
, 
Àngth
, 
ofs
, 
Ác
, 
°¨t_£g
;

836 
Ác
 = 1;

837 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

839 
Ác
 = 2;

842 
°¨t
 = 
£g_dëaûs
[
åack
].start;

843 
Àngth
 = 
£g_dëaûs
[
åack
].length;

846 
°¨t_£g
 = 
	`gë_£g_°¨t
(
£g_dëaûs
, 
åack
, 
ch™
, 
£g
);

848 
ofs
 = 
£g
 - 
°¨t_£g
;

850 
	`as£π
(
ofs
 >= 0);

851 
	`as£π
(
ofs
 < 
Àngth
);

854 if(
DEC_DIRECTION
 =
£g_dëaûs
[
åack
].
dúe˘i⁄
)

856 
ofs
 = (
Àngth
 - 1) - ofs;

859  
£g_dëaûs
[
åack
].
cb
[
ofs
];

860 
	}
}

864 
	$lﬂd_ch™_º_ödi˚s
(
IN
 
nodes_≥r_ch™
,

865 
IN
 
ch™_Àn
,

866 
IN
 
num_ch™s
,

867 
IN
 
t_º_ty≥
 
ty≥
,

868 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

869 
INOUT
 *
ödex
,

870 
INOUT
 
t_ivec
 *** 
ödi˚s
)

872 
ch™
, 
£g
, 
åack
, 
°¨t
, 
öode
;

874 
ödi˚s
[
ty≥
] = (
t_ivec
 **Ë
	`my_mÆloc
(—_ive¯*Ë* 
num_ch™s
);

875 
ch™
 = 0; ch™ < 
num_ch™s
; ++chan)

877 
ödi˚s
[
ty≥
][
ch™
] =

878 (
t_ivec
 *Ë
	`my_mÆloc
(—_ivecË* 
ch™_Àn
);

880 
ödi˚s
[
ty≥
][
ch™
][0].
√Àm
 = 0;

881 
ödi˚s
[
ty≥
][
ch™
][0].
li°
 = 
NULL
;

883 
£g
 = 1; seg < 
ch™_Àn
; ++seg)

886 
ödi˚s
[
ty≥
][
ch™
][
£g
].
√Àm
 = 
nodes_≥r_ch™
;

887 
ödi˚s
[
ty≥
][
ch™
][
£g
].
li°
 =

888 (*)
	`my_mÆloc
((Ë* 
nodes_≥r_ch™
);

889 
åack
 = 0;Åøck < 
nodes_≥r_ch™
; ++track)

891 
ödi˚s
[
ty≥
][
ch™
][
£g
].
li°
[
åack
] = 
OPEN
;

896 
ch™
 = 0; ch™ < 
num_ch™s
; ++chan)

898 
£g
 = 1; seg < 
ch™_Àn
; ++seg)

901 
åack
 = 0;Åøck < 
ödi˚s
[
ty≥
][
ch™
][
£g
].
√Àm
;

902 ++
åack
)

904 
°¨t
 =

905 
	`gë_£g_°¨t
(
£g_dëaûs
, 
åack
, 
ch™
, 
£g
);

909 
öode
 = 
ödi˚s
[
ty≥
][
ch™
][
°¨t
].
li°
[
åack
];

910 if(
OPEN
 =
öode
)

912 
öode
 = *
ödex
;

913 ++(*
ödex
);

915 
ödi˚s
[
ty≥
][
ch™
][
°¨t
].
li°
[
åack
] =

916 
öode
;

920 
ödi˚s
[
ty≥
][
ch™
][
£g
].
li°
[
åack
] = 
öode
;

924 
	}
}

927 
s_ivec
 ***

928 
	$Æloc_™d_lﬂd_º_node_ödi˚s
(
IN
 
nodes_≥r_ch™
,

929 
IN
 
nx
,

930 
IN
 
ny
,

931 
INOUT
 *
ödex
,

932 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
)

939 
i
, 
j
, 
k
, 
ofs
;

940 
t_ivec
 ***
ödi˚s
;

941 
t_ivec
 
tmp
;

942 
t_ty≥_±r
 
ty≥
;

945 
ödi˚s
 = (
t_ivec
 ***Ë
	`my_mÆloc
(—_ive¯**Ë* 
NUM_RR_TYPES
);

946 
ödi˚s
[
IPIN
] = (
t_ivec
 **Ë
	`my_mÆloc
(—_ive¯*Ë* (
nx
 + 2));

947 
ödi˚s
[
SINK
] = (
t_ivec
 **Ë
	`my_mÆloc
(—_ive¯*Ë* (
nx
 + 2));

948 
i
 = 0; i <(
nx
 + 1); ++i)

950 
ödi˚s
[
IPIN
][
i
] =

951 (
t_ivec
 *Ë
	`my_mÆloc
(—_ivecË* (
ny
 + 2));

952 
ödi˚s
[
SINK
][
i
] =

953 (
t_ivec
 *Ë
	`my_mÆloc
(—_ivecË* (
ny
 + 2));

954 
j
 = 0; j <(
ny
 + 1); ++j)

956 
ödi˚s
[
IPIN
][
i
][
j
].
√Àm
 = 0;

957 
ödi˚s
[
IPIN
][
i
][
j
].
li°
 = 
NULL
;

959 
ödi˚s
[
SINK
][
i
][
j
].
√Àm
 = 0;

960 
ödi˚s
[
SINK
][
i
][
j
].
li°
 = 
NULL
;

966 
i
 = 0; i <(
nx
 + 1); i++)

968 
j
 = 0; j <(
ny
 + 1); j++)

970 
ofs
 = 
grid
[
i
][
j
].
off£t
;

971 if(0 =
ofs
)

973 
ty≥
 = 
grid
[
i
][
j
].type;

977 
tmp
.
√Àm
 = 
ty≥
->
num_˛ass
;

978 
tmp
.
li°
 = 
NULL
;

979 if(
tmp
.
√Àm
 > 0)

981 
tmp
.
li°
 =

982 (*)
	`my_mÆloc
(() *

983 
tmp
.
√Àm
);

984 
k
 = 0; k < 
tmp
.
√Àm
; ++k)

986 
tmp
.
li°
[
k
] = *
ödex
;

987 ++(*
ödex
);

990 
ödi˚s
[
SINK
][
i
][
j
] = 
tmp
;

994 
tmp
.
√Àm
 = 
ty≥
->
num_pös
;

995 
tmp
.
li°
 = 
NULL
;

996 if(
tmp
.
√Àm
 > 0)

998 
tmp
.
li°
 =

999 (*)
	`my_mÆloc
(() *

1000 
tmp
.
√Àm
);

1001 
k
 = 0; k < 
tmp
.
√Àm
; ++k)

1003 
tmp
.
li°
[
k
] = *
ödex
;

1004 ++(*
ödex
);

1007 
ödi˚s
[
IPIN
][
i
][
j
] = 
tmp
;

1013 
i
 = 0; i <(
nx
 + 1); i++)

1015 
j
 = 0; j <(
ny
 + 1); j++)

1017 
ofs
 = 
grid
[
i
][
j
].
off£t
;

1018 if(
ofs
 > 0)

1021 
ödi˚s
[
SINK
][
i
][
j
] = indi˚s[SINK][i][j - 
ofs
];

1022 
ödi˚s
[
IPIN
][
i
][
j
] = indi˚s[IPIN][i][j - 
ofs
];

1029 
ödi˚s
[
SOURCE
] = indi˚s[
SINK
];

1030 
ödi˚s
[
OPIN
] = indi˚s[
IPIN
];

1033 
	`lﬂd_ch™_º_ödi˚s
(
nodes_≥r_ch™
, 
nx
 + 1, 
ny
 + 1, 
CHANX
,

1034 
£g_dëaûs
, 
ödex
, 
ödi˚s
);

1035 
	`lﬂd_ch™_º_ödi˚s
(
nodes_≥r_ch™
, 
ny
 + 1, 
nx
 + 1, 
CHANY
,

1036 
£g_dëaûs
, 
ödex
, 
ödi˚s
);

1038  
ödi˚s
;

1039 
	}
}

1043 
	$‰ì_º_node_ödi˚s
(
IN
 
t_ivec
 *** 
º_node_ödi˚s
)

1045 
i
, 
j
, 
ofs
;

1048 
i
 = 0; i <(
nx
 + 1); ++i)

1050 
j
 = 0; j <(
ny
 + 1); ++j)

1052 
ofs
 = 
grid
[
i
][
j
].
off£t
;

1053 if(
ofs
 > 0)

1056 
º_node_ödi˚s
[
SINK
][
i
][
j
].
li°
 = 
NULL
;

1057 
º_node_ödi˚s
[
IPIN
][
i
][
j
].
li°
 = 
NULL
;

1060 if(
º_node_ödi˚s
[
SINK
][
i
][
j
].
li°
 !
NULL
) {

1061 
	`‰ì
(
º_node_ödi˚s
[
SINK
][
i
][
j
].
li°
);

1063 if(
º_node_ödi˚s
[
IPIN
][
i
][
j
].
li°
 !
NULL
) {

1064 
	`‰ì
(
º_node_ödi˚s
[
IPIN
][
i
][
j
].
li°
);

1067 
	`‰ì
(
º_node_ödi˚s
[
SINK
][
i
]);

1068 
	`‰ì
(
º_node_ödi˚s
[
IPIN
][
i
]);

1070 
	`‰ì
(
º_node_ödi˚s
[
SINK
]);

1071 
	`‰ì
(
º_node_ödi˚s
[
IPIN
]);

1073 
i
 = 0; i < (
nx
 + 1); ++i)

1075 
j
 = 0; j < (
ny
 + 1); ++j)

1077 if(
º_node_ödi˚s
[
CHANY
][
i
][
j
].
li°
 !
NULL
) {

1078 
	`‰ì
(
º_node_ödi˚s
[
CHANY
][
i
][
j
].
li°
);

1081 
	`‰ì
(
º_node_ödi˚s
[
CHANY
][
i
]);

1083 
	`‰ì
(
º_node_ödi˚s
[
CHANY
]);

1085 
i
 = 0; i < (
ny
 + 1); ++i)

1087 
j
 = 0; j < (
nx
 + 1); ++j)

1089 if(
º_node_ödi˚s
[
CHANX
][
i
][
j
].
li°
 !
NULL
) {

1090 
	`‰ì
(
º_node_ödi˚s
[
CHANX
][
i
][
j
].
li°
);

1093 
	`‰ì
(
º_node_ödi˚s
[
CHANX
][
i
]);

1095 
	`‰ì
(
º_node_ödi˚s
[
CHANX
]);

1097 
	`‰ì
(
º_node_ödi˚s
);

1098 
	}
}

1102 
	$gë_º_node_ödex
(
x
,

1103 
y
,

1104 
t_º_ty≥
 
º_ty≥
,

1105 
±c
,

1106 
t_ivec
 *** 
º_node_ödi˚s
)

1127 
i˛ass
, 
tmp
;

1128 
t_ty≥_±r
 
ty≥
;

1129 
t_ivec
 
lookup
;

1131 
	`as£π
(
±c
 >= 0);

1132 
	`as£π
(
x
 >0 && x <(
nx
 + 1));

1133 
	`as£π
(
y
 >0 && y <(
ny
 + 1));

1135 
ty≥
 = 
grid
[
x
][
y
].type;

1138 if(
CHANX
 =
º_ty≥
)

1140 
tmp
 = 
x
;

1141 
x
 = 
y
;

1142 
y
 = 
tmp
;

1146 
lookup
 = 
º_node_ödi˚s
[
º_ty≥
][
x
][
y
];

1149 
	`as£π
(
±c
 >= 0);

1150 
	`as£π
(
±c
 < 
lookup
.
√Àm
);

1152 #ifde‡
DEBUG


1153 
º_ty≥
)

1155 
SOURCE
:

1156 
	`as£π
(
±c
 < 
ty≥
->
num_˛ass
);

1157 
	`as£π
(
ty≥
->
˛ass_öf
[
±c
].ty≥ =
DRIVER
);

1160 
SINK
:

1161 
	`as£π
(
±c
 < 
ty≥
->
num_˛ass
);

1162 
	`as£π
(
ty≥
->
˛ass_öf
[
±c
].ty≥ =
RECEIVER
);

1165 
OPIN
:

1166 
	`as£π
(
±c
 < 
ty≥
->
num_pös
);

1167 
i˛ass
 = 
ty≥
->
pö_˛ass
[
±c
];

1168 
	`as£π
(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
DRIVER
);

1171 
IPIN
:

1172 
	`as£π
(
±c
 < 
ty≥
->
num_pös
);

1173 
i˛ass
 = 
ty≥
->
pö_˛ass
[
±c
];

1174 
	`as£π
(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
RECEIVER
);

1177 
CHANX
:

1178 
CHANY
:

1182 
	`¥ötf
("Error: BadÑr_nodeÖassedÅo get_rr_node_index.\n"

1184 
º_ty≥
, 
±c
, 
x
, 
y
);

1185 
	`exô
(1);

1189  
lookup
.
li°
[
±c
];

1190 
	}
}

1194 
	$gë_åack_to_ùös
(
£g
,

1195 
ch™
,

1196 
åack
,

1197 
t_löked_edge
 ** 
edge_li°_±r
,

1198 
t_ivec
 *** 
º_node_ödi˚s
,

1199 
s_ivec
 ****
åack_to_ùö_lookup
,

1200 
t_£g_dëaûs
 * 
£g_dëaûs
,

1201 
e_º_ty≥
 
ch™_ty≥
,

1202 
ch™_Àngth
,

1203 
wúe_to_ùö_swôch
,

1204 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1209 
t_löked_edge
 *
edge_li°_hód
;

1210 
j
, 
∑ss
, 
ic⁄n
, 
phy_åack
, 
íd
, 
to_node
, 
max_c⁄n
, 
ùö
, 
side
, 
x
,

1211 
y
, 
num_c⁄n
;

1212 
t_ty≥_±r
 
ty≥
;

1213 
off
;

1216 
íd
 = 
	`gë_£g_íd
(
£g_dëaûs
, 
åack
, 
£g
, 
ch™
, 
ch™_Àngth
);

1218 
edge_li°_hód
 = *
edge_li°_±r
;

1219 
num_c⁄n
 = 0;

1221 
j
 = 
£g
; j <
íd
; j++)

1223 if(
	`is_cbox
(
ch™
, 
j
, 
åack
, 
£g_dëaûs
, 
dúe˘i⁄Æôy
))

1225 
∑ss
 = 0;Öass < 2; ++pass)

1227 if(
CHANX
 =
ch™_ty≥
)

1229 
x
 = 
j
;

1230 
y
 = 
ch™
 + 
∑ss
;

1231 
side
 = (0 =
∑ss
 ? 
TOP
 : 
BOTTOM
);

1235 
	`as£π
(
CHANY
 =
ch™_ty≥
);

1236 
x
 = 
ch™
 + 
∑ss
;

1237 
y
 = 
j
;

1238 
side
 = (0 =
∑ss
 ? 
RIGHT
 : 
LEFT
);

1242 if(
grid
[
x
][
y
].
ty≥
 =
EMPTY_TYPE
)

1248 
phy_åack
 =

1249 
	`v¥_to_phy_åack
(
åack
, 
ch™
, 
j
, 
£g_dëaûs
,

1250 
dúe˘i⁄Æôy
);

1253 
ty≥
 = 
grid
[
x
][
y
].type;

1254 
off
 = 
grid
[
x
][
y
].
off£t
;

1256 
max_c⁄n
 =

1257 
åack_to_ùö_lookup
[
ty≥
->

1258 
ödex
][
phy_åack
][
off
]

1259 [
side
].
√Àm
;

1260 
ic⁄n
 = 0; ic⁄¿< 
max_c⁄n
; iconn++)

1262 
ùö
 =

1263 
åack_to_ùö_lookup
[
ty≥
->

1264 
ödex
][
phy_åack
]

1265 [
off
][
side
].
li°
[
ic⁄n
];

1268 
	`as£π
(
ty≥
->
pöloc
[
off
][
side
][
ùö
]);

1269 
	`as£π
(
ty≥
->
is_globÆ_pö
[
ùö
] ==

1270 
FALSE
);

1272 
to_node
 =

1273 
	`gë_º_node_ödex
(
x
, 
y
, 
IPIN
, 
ùö
,

1274 
º_node_ödi˚s
);

1275 
edge_li°_hód
 =

1276 
	`ö£π_ö_edge_li°
(
edge_li°_hód
,

1277 
to_node
,

1278 
wúe_to_ùö_swôch
);

1280 
num_c⁄n
 +
max_c⁄n
;

1285 *
edge_li°_±r
 = 
edge_li°_hód
;

1286  (
num_c⁄n
);

1287 
	}
}

1307 
	$gë_åack_to_åacks
(
IN
 
‰om_ch™
,

1308 
IN
 
‰om_£g
,

1309 
IN
 
‰om_åack
,

1310 
IN
 
t_º_ty≥
 
‰om_ty≥
,

1311 
IN
 
to_£g
,

1312 
IN
 
t_º_ty≥
 
to_ty≥
,

1313 
IN
 
ch™_Àn
,

1314 
IN
 
nodes_≥r_ch™
,

1315 
IN
 *
›ö_mux_size
,

1316 
IN
 
Fs_≥r_side
,

1317 
IN
 *****
sblock_∑âîn
,

1318 
INOUT
 
s_löked_edge
 **
edge_li°
,

1319 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1320 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

1321 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

1322 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

1323 
IN
 
s_ivec
 ***
swôch_block_c⁄n
)

1325 
num_c⁄n
;

1326 
‰om_swôch
, 
‰om_íd
, 
‰om_sb
, 
‰om_fú°
;

1327 
to_ch™
, 
to_sb
;

1328 
°¨t
, 
íd
;

1329 
s_ivec
 
c⁄n_åacks
;

1330 
boﬁón
 
‰om_is_sbox
, 
is_behöd
, 
Fs_˛ù≥d
;

1331 
e_side
 
‰om_side_a
, 
‰om_side_b
, 
to_side
;

1333 
	`as£π
(
‰om_£g
 ==

1334 
	`gë_£g_°¨t
(
£g_dëaûs
, 
‰om_åack
, 
‰om_ch™
, 
‰om_£g
));

1336 
‰om_swôch
 = 
£g_dëaûs
[
‰om_åack
].
wúe_swôch
;

1337 
‰om_íd
 =

1338 
	`gë_£g_íd
(
£g_dëaûs
, 
‰om_åack
, 
‰om_£g
, 
‰om_ch™
, 
ch™_Àn
);

1339 
‰om_fú°
 = 
‰om_£g
 - 1;

1342 if(
CHANX
 =
‰om_ty≥
)

1344 
‰om_side_a
 = 
RIGHT
;

1345 
‰om_side_b
 = 
LEFT
;

1349 
	`as£π
(
CHANY
 =
‰om_ty≥
);

1350 
‰om_side_a
 = 
TOP
;

1351 
‰om_side_b
 = 
BOTTOM
;

1356 
is_behöd
 = 
FALSE
;

1357 if(
to_ty≥
 =
‰om_ty≥
)

1361 
	`as£π
((
to_£g
 =(
‰om_íd
 + 1)Ë|| (to_£g =(
‰om_£g
 - 1)));

1362 if(
to_£g
 > 
‰om_íd
)

1364 
is_behöd
 = 
TRUE
;

1371 
	`as£π
((
to_£g
 =
‰om_ch™
) || (to_seg == (from_chan + 1)));

1372 if(
to_£g
 > 
‰om_ch™
)

1374 
is_behöd
 = 
TRUE
;

1380 if(
CHANX
 =
to_ty≥
)

1382 
to_side
 = (
is_behöd
 ? 
RIGHT
 : 
LEFT
);

1386 
	`as£π
(
CHANY
 =
to_ty≥
);

1387 
to_side
 = (
is_behöd
 ? 
TOP
 : 
BOTTOM
);

1391 
°¨t
 = 
‰om_fú°
;

1392 
íd
 = 
‰om_íd
;

1397 if(
to_ty≥
 =
‰om_ty≥
)

1399 
°¨t
 = (
is_behöd
 ? 
íd
 : start);

1400 
íd
 = 
°¨t
;

1404 
num_c⁄n
 = 0;

1405 
‰om_sb
 = 
°¨t
; from_sb <
íd
; ++from_sb)

1408 
‰om_is_sbox
 = 
	`is_sbox
(
‰om_ch™
, 
‰om_£g
, 
‰om_sb
, 
‰om_åack
,

1409 
£g_dëaûs
, 
dúe˘i⁄Æôy
);

1411 if(
‰om_sb
 =
‰om_íd
 || from_sb =
‰om_fú°
)

1413 
‰om_is_sbox
 = 
TRUE
;

1418 
to_ch™
 = 
‰om_sb
;

1419 
to_sb
 = 
‰om_ch™
;

1420 if(
‰om_ty≥
 =
to_ty≥
)

1422 
to_ch™
 = 
‰om_ch™
;

1423 
to_sb
 = 
‰om_sb
;

1427 if(
‰om_sb
 < 
‰om_íd
)

1429 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

1431 
c⁄n_åacks
 =

1432 
swôch_block_c⁄n
[
‰om_side_a
][
to_side
]

1433 [
‰om_åack
];

1434 
num_c⁄n
 +=

1435 
	`gë_bidú_åack_to_ch™_£g
(
c⁄n_åacks
,

1436 
º_node_ödi˚s
,

1437 
to_ch™
, 
to_£g
,

1438 
to_sb
, 
to_ty≥
,

1439 
£g_dëaûs
,

1440 
‰om_is_sbox
,

1441 
‰om_swôch
,

1442 
º_edge_d⁄e
,

1443 
dúe˘i⁄Æôy
,

1444 
edge_li°
);

1446 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

1451 if((
‰om_is_sbox
) &&

1452 (
DEC_DIRECTION
 ==

1453 
£g_dëaûs
[
‰om_åack
].
dúe˘i⁄
))

1455 
num_c⁄n
 +=

1456 
	`gë_unidú_åack_to_ch™_£g
((
‰om_sb


1458 
‰om_fú°
),

1459 
‰om_åack
,

1460 
to_ch™
,

1461 
to_£g
,

1462 
to_sb
,

1463 
to_ty≥
,

1464 
nodes_≥r_ch™
,

1465 
nx
, 
ny
,

1466 
‰om_side_a
,

1467 
to_side
,

1468 
Fs_≥r_side
,

1469 
›ö_mux_size
,

1470 
sblock_∑âîn
,

1471 
º_node_ödi˚s
,

1472 
£g_dëaûs
,

1473 
º_edge_d⁄e
,

1474 &
Fs_˛ù≥d
,

1475 
edge_li°
);

1481 if(
‰om_sb
 > 
‰om_fú°
)

1483 if(
BI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

1485 
c⁄n_åacks
 =

1486 
swôch_block_c⁄n
[
‰om_side_b
][
to_side
]

1487 [
‰om_åack
];

1488 
num_c⁄n
 +=

1489 
	`gë_bidú_åack_to_ch™_£g
(
c⁄n_åacks
,

1490 
º_node_ödi˚s
,

1491 
to_ch™
, 
to_£g
,

1492 
to_sb
, 
to_ty≥
,

1493 
£g_dëaûs
,

1494 
‰om_is_sbox
,

1495 
‰om_swôch
,

1496 
º_edge_d⁄e
,

1497 
dúe˘i⁄Æôy
,

1498 
edge_li°
);

1500 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

1505 if((
‰om_is_sbox
) &&

1506 (
INC_DIRECTION
 ==

1507 
£g_dëaûs
[
‰om_åack
].
dúe˘i⁄
))

1509 
num_c⁄n
 +=

1510 
	`gë_unidú_åack_to_ch™_£g
((
‰om_sb


1512 
‰om_íd
),

1513 
‰om_åack
,

1514 
to_ch™
,

1515 
to_£g
,

1516 
to_sb
,

1517 
to_ty≥
,

1518 
nodes_≥r_ch™
,

1519 
nx
, 
ny
,

1520 
‰om_side_b
,

1521 
to_side
,

1522 
Fs_≥r_side
,

1523 
›ö_mux_size
,

1524 
sblock_∑âîn
,

1525 
º_node_ödi˚s
,

1526 
£g_dëaûs
,

1527 
º_edge_d⁄e
,

1528 &
Fs_˛ù≥d
,

1529 
edge_li°
);

1535  
num_c⁄n
;

1536 
	}
}

1541 
	$gë_bidú_åack_to_ch™_£g
(
IN
 
s_ivec
 
c⁄n_åacks
,

1542 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

1543 
IN
 
to_ch™
,

1544 
IN
 
to_£g
,

1545 
IN
 
to_sb
,

1546 
IN
 
t_º_ty≥
 
to_ty≥
,

1547 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1548 
IN
 
boﬁón
 
‰om_is_sbox
,

1549 
IN
 
‰om_swôch
,

1550 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

1551 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

1552 
INOUT
 
s_löked_edge
 **
edge_li°
)

1554 
ic⁄n
, 
to_åack
, 
to_node
, 
to_swôch
, 
num_c⁄n
, 
to_x
, 
to_y
, 
i
;

1555 
boﬁón
 
to_is_sbox
;

1556 
swôch_ty≥s
[2];

1559 if(
CHANX
 =
to_ty≥
)

1561 
to_x
 = 
to_£g
;

1562 
to_y
 = 
to_ch™
;

1566 
	`as£π
(
CHANY
 =
to_ty≥
);

1567 
to_x
 = 
to_ch™
;

1568 
to_y
 = 
to_£g
;

1572 
num_c⁄n
 = 0;

1573 
ic⁄n
 = 0; ic⁄¿< 
c⁄n_åacks
.
√Àm
; ++iconn)

1575 
to_åack
 = 
c⁄n_åacks
.
li°
[
ic⁄n
];

1576 
to_node
 = 
	`gë_º_node_ödex
(
to_x
, 
to_y
, 
to_ty≥
, 
to_åack
,

1577 
º_node_ödi˚s
);

1580 if(
º_edge_d⁄e
[
to_node
])

1586 
to_swôch
 = 
£g_dëaûs
[
to_åack
].
wúe_swôch
;

1588 
to_is_sbox
 = 
	`is_sbox
(
to_ch™
, 
to_£g
, 
to_sb
, 
to_åack
,

1589 
£g_dëaûs
, 
dúe˘i⁄Æôy
);

1590 
	`gë_swôch_ty≥
(
‰om_is_sbox
, 
to_is_sbox
,

1591 
‰om_swôch
, 
to_swôch
, 
swôch_ty≥s
);

1594 
i
 = 0; i < 2; ++i)

1597 if(
OPEN
 =
swôch_ty≥s
[
i
])

1603 *
edge_li°
 = 
	`ö£π_ö_edge_li°
(*edge_list,

1604 
to_node
,

1605 
swôch_ty≥s
[
i
]);

1607 
º_edge_d⁄e
[
to_node
] = 
TRUE
;

1608 ++
num_c⁄n
;

1612  
num_c⁄n
;

1613 
	}
}

1616 
	$gë_unidú_åack_to_ch™_£g
(
IN
 
boﬁón
 
is_íd_sb
,

1617 
IN
 
‰om_åack
,

1618 
IN
 
to_ch™
,

1619 
IN
 
to_£g
,

1620 
IN
 
to_sb
,

1621 
IN
 
t_º_ty≥
 
to_ty≥
,

1622 
IN
 
nodes_≥r_ch™
,

1623 
IN
 
nx
,

1624 
IN
 
ny
,

1625 
IN
 
e_side
 
‰om_side
,

1626 
IN
 
e_side
 
to_side
,

1627 
IN
 
Fs_≥r_side
,

1628 
IN
 *
›ö_mux_size
,

1629 
IN
 *****
sblock_∑âîn
,

1630 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

1631 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1632 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

1633 
OUT
 
boﬁón
 * 
Fs_˛ù≥d
,

1634 
INOUT
 
s_löked_edge
 **
edge_li°
)

1636 
to_åack
, 
to_mux
, 
to_node
, 
to_x
, 
to_y
, 
i
, 
max_Àn
, 
num_œbñs
;

1637 
sb_x
, 
sb_y
, 
cou¡
;

1638 *
mux_œbñs
 = 
NULL
;

1639 
e_dúe˘i⁄
 
to_dú
;

1640 
boﬁón
 
is_‰öge
, 
is_c‹e
, 
is_c‹√r
, 
is_°øight
;

1643 if(
CHANX
 =
to_ty≥
)

1645 
to_x
 = 
to_£g
;

1646 
to_y
 = 
to_ch™
;

1647 
sb_x
 = 
to_sb
;

1648 
sb_y
 = 
to_ch™
;

1649 
max_Àn
 = 
nx
;

1653 
	`as£π
(
CHANY
 =
to_ty≥
);

1654 
to_x
 = 
to_ch™
;

1655 
to_y
 = 
to_£g
;

1656 
sb_x
 = 
to_ch™
;

1657 
sb_y
 = 
to_sb
;

1658 
max_Àn
 = 
ny
;

1662 
to_dú
 = 
DEC_DIRECTION
;

1663 if(
to_sb
 < 
to_£g
)

1665 
to_dú
 = 
INC_DIRECTION
;

1668 *
Fs_˛ù≥d
 = 
FALSE
;

1671 
is_c‹√r
 = ((
sb_x
 < 1Ë|| (sb_x >
nx
)Ë&& ((
sb_y
 < 1Ë|| (sb_y >
ny
));

1672 
is_‰öge
 = (
FALSE
 =
is_c‹√r
Ë&& ((
sb_x
 < 1Ë|| (
sb_y
 < 1)

1673 || (
sb_x
 >
nx
Ë|| (
sb_y
 >
ny
));

1674 
is_c‹e
 = (
FALSE
 =
is_c‹√r
Ë&& (FALSE =
is_‰öge
);

1675 
is_°øight
 = (
‰om_side
 =
RIGHT
 && 
to_side
 =
LEFT
) ||

1676 (
‰om_side
 =
LEFT
 && 
to_side
 =
RIGHT
) ||

1677 (
‰om_side
 =
TOP
 && 
to_side
 =
BOTTOM
) ||

1678 (
‰om_side
 =
BOTTOM
 && 
to_side
 =
TOP
);

1681 if(
is_íd_sb
 && (
is_c‹e
 || 
is_c‹√r
 || 
is_°øight
))

1684 
mux_œbñs
 = 
	`œbñ_wúe_muxes
(
to_ch™
, 
to_£g
, 
£g_dëaûs
,

1685 
max_Àn
, 
to_dú
, 
nodes_≥r_ch™
,

1686 &
num_œbñs
);

1690 
	`as£π
(
is_‰öge
 || !
is_íd_sb
);

1692 
mux_œbñs
 = 
	`œbñ_wúe_muxes_f‹_bÆ™˚
(
to_ch™
, 
to_£g
,

1693 
£g_dëaûs
, 
max_Àn
,

1694 
to_dú
, 
nodes_≥r_ch™
,

1695 &
num_œbñs
, 
to_ty≥
,

1696 
›ö_mux_size
,

1697 
º_node_ödi˚s
);

1701 if(
num_œbñs
 < 1)

1703 if(
mux_œbñs
)

1705 
	`‰ì
(
mux_œbñs
);

1706 
mux_œbñs
 = 
NULL
;

1712 if(
Fs_≥r_side
 > 
num_œbñs
)

1714 *
Fs_˛ù≥d
 = 
TRUE
;

1718 
to_mux
 = 
sblock_∑âîn
[
sb_x
][
sb_y
][
‰om_side
][
to_side
][
‰om_åack
];

1719 
	`as£π
(
to_mux
 !
UN_SET
);

1722 
cou¡
 = 0;

1723 
i
 = 0; i < 
Fs_≥r_side
; ++i)

1726 
to_åack
 = 
mux_œbñs
[(
to_mux
 + 
i
Ë% 
num_œbñs
];

1727 
to_node
 =

1728 
	`gë_º_node_ödex
(
to_x
, 
to_y
, 
to_ty≥
, 
to_åack
,

1729 
º_node_ödi˚s
);

1732 if(
FALSE
 =
º_edge_d⁄e
[
to_node
])

1734 
º_edge_d⁄e
[
to_node
] = 
TRUE
;

1735 *
edge_li°
 =

1736 
	`ö£π_ö_edge_li°
(*
edge_li°
, 
to_node
,

1737 
£g_dëaûs
[
to_åack
].

1738 
wúe_swôch
);

1739 ++
cou¡
;

1743 if(
mux_œbñs
)

1745 
	`‰ì
(
mux_œbñs
);

1746 
mux_œbñs
 = 
NULL
;

1749  
cou¡
;

1750 
	}
}

1752 
boﬁón


1753 
	$is_sbox
(
IN
 
ch™
,

1754 
IN
 
wúe_£g
,

1755 
IN
 
sb_£g
,

1756 
IN
 
åack
,

1757 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1758 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1761 
°¨t
, 
Àngth
, 
ofs
, 
Ác
;

1763 
Ác
 = 1;

1764 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

1766 
Ác
 = 2;

1769 
°¨t
 = 
£g_dëaûs
[
åack
].start;

1770 
Àngth
 = 
£g_dëaûs
[
åack
].length;

1773 
wúe_£g
 = 
	`gë_£g_°¨t
(
£g_dëaûs
, 
åack
, 
ch™
, wire_seg);

1775 
ofs
 = 
sb_£g
 - 
wúe_£g
 + 1;

1777 
	`as£π
(
ofs
 >= 0);

1778 
	`as£π
(
ofs
 < (
Àngth
 + 1));

1781 if((
ofs
 % 
Ác
) > 0)

1783 
ofs
 = 
Àngth
 - ofs;

1786  
£g_dëaûs
[
åack
].
sb
[
ofs
];

1787 
	}
}

1792 
	$gë_swôch_ty≥
(
boﬁón
 
is_‰om_sbox
,

1793 
boﬁón
 
is_to_sbox
,

1794 
‰om_node_swôch
,

1795 
to_node_swôch
,

1796 
swôch_ty≥s
[2])

1807 
boﬁón
 
f‹w¨d_∑ss_å™s
;

1808 
boﬁón
 
backw¨d_∑ss_å™s
;

1809 
u£d
, 
mö
, 
max
;

1811 
swôch_ty≥s
[0] = 
OPEN
;

1812 
swôch_ty≥s
[1] = 
OPEN
;

1813 
u£d
 = 0;

1814 
f‹w¨d_∑ss_å™s
 = 
FALSE
;

1815 
backw¨d_∑ss_å™s
 = 
FALSE
;

1818 if(
is_‰om_sbox
)

1820 
swôch_ty≥s
[
u£d
] = 
to_node_swôch
;

1821 if(
FALSE
 =
swôch_öf
[
to_node_swôch
].
buf„ªd
)

1823 
f‹w¨d_∑ss_å™s
 = 
TRUE
;

1825 ++
u£d
;

1829 if(
is_to_sbox
)

1831 if(
FALSE
 =
swôch_öf
[
‰om_node_swôch
].
buf„ªd
)

1833 
swôch_ty≥s
[
u£d
] = 
‰om_node_swôch
;

1834 
backw¨d_∑ss_å™s
 = 
TRUE
;

1835 ++
u£d
;

1840 if(
f‹w¨d_∑ss_å™s
 && 
backw¨d_∑ss_å™s
)

1842 
mö
 = 
	`mö
(
to_node_swôch
, 
‰om_node_swôch
);

1843 
max
 = 
	`max
(
to_node_swôch
, 
‰om_node_swôch
);

1847 
swôch_ty≥s
[
u£d
] = 
mö
;

1848 if(
swôch_öf
[
max
].
R
 < swôch_öf[
mö
].R)

1850 
swôch_ty≥s
[
u£d
] = 
max
;

1852 ++
u£d
;

1854 
	}
}

1857 
	$v¥_to_phy_åack
(
IN
 
ôøck
,

1858 
IN
 
ch™_num
,

1859 
IN
 
£g_num
,

1860 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1861 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
)

1863 
group_°¨t
, 
group_size
;

1864 
v¥_off£t_f‹_fú°_phy_åack
;

1865 
v¥_off£t
, 
phy_off£t
;

1866 
phy_åack
;

1867 
Ác
;

1870 
Ác
 = 1;

1871 if(
UNI_DIRECTIONAL
 =
dúe˘i⁄Æôy
)

1873 
Ác
 = 2;

1876 
group_°¨t
 = 
£g_dëaûs
[
ôøck
].group_start;

1877 
group_size
 = 
£g_dëaûs
[
ôøck
].group_size;

1879 
v¥_off£t_f‹_fú°_phy_åack
 =

1880 (
ch™_num
 + 
£g_num
 - 1Ë% (
group_size
 / 
Ác
);

1881 
v¥_off£t
 = (
ôøck
 - 
group_°¨t
Ë/ 
Ác
;

1882 
phy_off£t
 =

1883 (
v¥_off£t_f‹_fú°_phy_åack
 + 
v¥_off£t
Ë% (
group_size
 / 
Ác
);

1884 
phy_åack
 =

1885 
group_°¨t
 + (
Ác
 * 
phy_off£t
Ë+ (
ôøck
 - group_start) % fac;

1887  
phy_åack
;

1888 
	}
}

1893 
	$Æloc_sblock_∑âîn_lookup
(
IN
 
nx
,

1894 
IN
 
ny
,

1895 
IN
 
nodes_≥r_ch™
)

1897 
i
, 
j
, 
‰om_side
, 
to_side
, 
ôøck
, 
ôems
;

1898 *****
ªsu…
;

1899 *****
i_li°
;

1900 ****
j_li°
;

1901 ***
‰om_li°
;

1902 **
to_li°
;

1903 *
åack_li°
;

1915 
ôems
 = 1;

1916 
ôems
 *(
nx
 + 1);

1917 
i_li°
 = (*****)
	`my_mÆloc
((****Ë* 
ôems
);

1918 
ôems
 *(
ny
 + 1);

1919 
j_li°
 = (****)
	`my_mÆloc
((***Ë* 
ôems
);

1920 
ôems
 *= (4);

1921 
‰om_li°
 = (***)
	`my_mÆloc
((**Ë* 
ôems
);

1922 
ôems
 *= (4);

1923 
to_li°
 = (**)
	`my_mÆloc
((*Ë* 
ôems
);

1924 
ôems
 *(
nodes_≥r_ch™
);

1925 
åack_li°
 = (*)
	`my_mÆloc
((Ë* 
ôems
);

1928 
ªsu…
 = 
i_li°
;

1929 
i_li°
 +(
nx
 + 1);

1930 
i
 = 0; i < (
nx
 + 1); ++i)

1933 
ªsu…
[
i
] = 
j_li°
;

1934 
j_li°
 +(
ny
 + 1);

1935 
j
 = 0; j < (
ny
 + 1); ++j)

1938 
ªsu…
[
i
][
j
] = 
‰om_li°
;

1939 
‰om_li°
 += (4);

1940 
‰om_side
 = 0; from_side < 4; ++from_side)

1943 
ªsu…
[
i
][
j
][
‰om_side
] = 
to_li°
;

1944 
to_li°
 += (4);

1945 
to_side
 = 0;Åo_side < 4; ++to_side)

1948 
ªsu…
[
i
][
j
][
‰om_side
][
to_side
] =

1949 
åack_li°
;

1950 
åack_li°
 +(
nodes_≥r_ch™
);

1951 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
;

1952 
ôøck
++)

1956 
ªsu…
[
i
][
j
][
‰om_side
][
to_side
]

1957 [
ôøck
] = 
UN_SET
;

1965  
ªsu…
;

1966 
	}
}

1970 
	$‰ì_sblock_∑âîn_lookup
(
INOUT
 *****
sblock_∑âîn
)

1980 
	`‰ì
(****
sblock_∑âîn
);

1981 
	`‰ì
(***
sblock_∑âîn
);

1982 
	`‰ì
(**
sblock_∑âîn
);

1983 
	`‰ì
(*
sblock_∑âîn
);

1984 
	`‰ì
(
sblock_∑âîn
);

1985 
	}
}

1989 
	$lﬂd_sblock_∑âîn_lookup
(
IN
 
i
,

1990 
IN
 
j
,

1991 
IN
 
nodes_≥r_ch™
,

1992 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

1993 
IN
 
Fs
,

1994 
IN
 
e_swôch_block_ty≥
 
swôch_block_ty≥
,

1995 
INOUT
 *****
sblock_∑âîn
)

2002 
side_cw_öcomög_wúe_cou¡
, 
side_ccw_öcomög_wúe_cou¡
,

2003 
›p_öcomög_wúe_cou¡
;

2004 
to_side
, 
side
, 
side_cw
, 
side_ccw
, 
side_›p
, 
ôøck
;

2005 
Fs_≥r_side
, 
ch™
, 
£g
, 
ch™_Àn
, 
sb_£g
;

2006 
boﬁón
 
is_c‹e_sblock
, 
is_c‹√r_sblock
, 
x_edge
, 
y_edge
;

2007 *
öcomög_wúe_œbñ
[4];

2008 *
wúe_mux_⁄_åack
[4];

2009 
num_öcomög_wúes
[4];

2010 
num_ídög_wúes
[4];

2011 
num_wúe_muxes
[4];

2012 
boﬁón
 
skù
, 
vît
, 
pos_dú
;

2013 
e_dúe˘i⁄
 
dú
;

2015 
Fs_≥r_side
 = 1;

2016 if(
Fs
 != -1)

2018 
Fs_≥r_side
 = 
Fs
 / 3;

2022 
	`as£π
(
i
 >= 0);

2023 
	`as£π
(
i
 <
nx
);

2024 
	`as£π
(
j
 >= 0);

2025 
	`as£π
(
j
 <
ny
);

2068 
x_edge
 = ((
i
 < 1Ë|| (ò>
nx
));

2069 
y_edge
 = ((
j
 < 1Ë|| (j >
ny
));

2071 
is_c‹√r_sblock
 = (
x_edge
 && 
y_edge
);

2072 
is_c‹e_sblock
 = (!
x_edge
 && !
y_edge
);

2075 
side
 = 0; side < 4; ++side)

2078 
wúe_mux_⁄_åack
[
side
] = 
NULL
;

2079 
öcomög_wúe_œbñ
[
side
] = 
NULL
;

2080 
num_öcomög_wúes
[
side
] = 0;

2081 
num_ídög_wúes
[
side
] = 0;

2082 
num_wúe_muxes
[
side
] = 0;

2086 
skù
 = 
TRUE
;

2087 
side
)

2089 
TOP
:

2090 if(
j
 < 
ny
)

2092 
skù
 = 
FALSE
;

2095 
RIGHT
:

2096 if(
i
 < 
nx
)

2098 
skù
 = 
FALSE
;

2101 
BOTTOM
:

2102 if(
j
 > 0)

2104 
skù
 = 
FALSE
;

2107 
LEFT
:

2108 if(
i
 > 0)

2110 
skù
 = 
FALSE
;

2114 if(
skù
)

2120 
vît
 = ((
side
 =
TOP
Ë|| (sidê=
BOTTOM
));

2121 
pos_dú
 = ((
side
 =
TOP
Ë|| (sidê=
RIGHT
));

2122 
ch™
 = (
vît
 ? 
i
 : 
j
);

2123 
sb_£g
 = (
vît
 ? 
j
 : 
i
);

2124 
£g
 = (
pos_dú
 ? (
sb_£g
 + 1) : sb_seg);

2125 
ch™_Àn
 = (
vît
 ? 
ny
 : 
nx
);

2129 
dú
 = (
pos_dú
 ? 
DEC_DIRECTION
 : 
INC_DIRECTION
);

2130 
öcomög_wúe_œbñ
[
side
] =

2131 
	`œbñ_öcomög_wúes
(
ch™
, 
£g
, 
sb_£g
, 
£g_dëaûs
, 
ch™_Àn
,

2132 
dú
, 
nodes_≥r_ch™
,

2133 &
num_öcomög_wúes
[
side
],

2134 &
num_ídög_wúes
[
side
]);

2137 
dú
 = (
pos_dú
 ? 
INC_DIRECTION
 : 
DEC_DIRECTION
);

2138 
wúe_mux_⁄_åack
[
side
] = 
	`œbñ_wúe_muxes
(
ch™
, 
£g
,

2139 
£g_dëaûs
, 
ch™_Àn
,

2140 
dú
, 
nodes_≥r_ch™
,

2141 &
num_wúe_muxes
[
side
]);

2144 
to_side
 = 0;Åo_side < 4;Åo_side++)

2147 if(0 =
num_wúe_muxes
[
to_side
])

2153 
	`as£π
((
TOP
 =0Ë&& (
RIGHT
 =1Ë&& (
BOTTOM
 == 2)

2154 && (
LEFT
 == 3));

2155 
side_cw
 = (
to_side
 + 1) % 4;

2156 
side_›p
 = (
to_side
 + 2) % 4;

2157 
side_ccw
 = (
to_side
 + 3) % 4;

2170 
side_cw_öcomög_wúe_cou¡
 = 0;

2171 if(
öcomög_wúe_œbñ
[
side_cw
])

2173 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2176 if(
öcomög_wúe_œbñ
[
side_cw
][
ôøck
] !
UN_SET
)

2179 if((
is_c‹√r_sblock
 || 
is_c‹e_sblock
) &&

2180 (
öcomög_wúe_œbñ
[
side_cw
][
ôøck
] <

2181 
num_ídög_wúes
[
side_cw
]))

2187 
	`as£π
(
num_ídög_wúes
[
side_cw
]

2189 
num_wúe_muxes
[
to_side
]);

2190 
sblock_∑âîn
[
i
][
j
][
side_cw
]

2191 [
to_side
][
ôøck
] =

2192 
gë_sim∂e_swôch_block_åack


2193 (
side_cw
, 
to_side
,

2194 
öcomög_wúe_œbñ
[
side_cw
]

2195 [
ôøck
], 
swôch_block_ty≥
,

2196 
num_wúe_muxes
[
to_side
]);

2204 
sblock_∑âîn
[
i
][
j
][
side_cw
]

2205 [
to_side
][
ôøck
] =

2206 (
side_cw_öcomög_wúe_cou¡
 *

2207 
Fs_≥r_side
) %

2208 
num_wúe_muxes
[
to_side
];

2209 
side_cw_öcomög_wúe_cou¡
++;

2216 
side_ccw_öcomög_wúe_cou¡
 = 0;

2217 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2221 if(
öcomög_wúe_œbñ
[
side_ccw
] =
NULL
)

2225 if(
öcomög_wúe_œbñ
[
side_ccw
][
ôøck
] !
UN_SET
)

2228 if((
is_c‹√r_sblock
 || 
is_c‹e_sblock
) &&

2229 (
öcomög_wúe_œbñ
[
side_ccw
][
ôøck
] <

2230 
num_ídög_wúes
[
side_ccw
]))

2234 
	`as£π
(
öcomög_wúe_œbñ
[
side_ccw
]

2235 [
ôøck
] <

2236 
num_wúe_muxes
[
to_side
]);

2237 
sblock_∑âîn
[
i
][
j
][
side_ccw
][
to_side
]

2238 [
ôøck
] =

2239 
gë_sim∂e_swôch_block_åack


2240 (
side_ccw
, 
to_side
,

2241 
öcomög_wúe_œbñ
[
side_ccw
]

2242 [
ôøck
], 
swôch_block_ty≥
,

2243 
num_wúe_muxes
[
to_side
]);

2250 
sblock_∑âîn
[
i
][
j
][
side_ccw
][
to_side
]

2251 [
ôøck
] =

2252 ((
side_ccw_öcomög_wúe_cou¡
 +

2253 
side_cw_öcomög_wúe_cou¡
) *

2254 
Fs_≥r_side
) %

2255 
num_wúe_muxes
[
to_side
];

2256 
side_ccw_öcomög_wúe_cou¡
++;

2262 
›p_öcomög_wúe_cou¡
 = 0;

2263 if(
öcomög_wúe_œbñ
[
side_›p
])

2265 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

2268 if(
öcomög_wúe_œbñ
[
side_›p
][
ôøck
] !=

2269 
UN_SET
)

2273 if(
is_c‹e_sblock
)

2275 if(
öcomög_wúe_œbñ
[
side_›p
]

2276 [
ôøck
] <

2277 
num_ídög_wúes
[
side_›p
])

2283 
sblock_∑âîn
[
i
][
j
]

2284 [
side_›p
][
to_side
]

2285 [
ôøck
] =

2286 
föd_œbñ_of_åack


2287 (
wúe_mux_⁄_åack


2288 [
to_side
],

2289 
num_wúe_muxes


2290 [
to_side
], 
ôøck
);

2295 
sblock_∑âîn
[
i
][
j
]

2296 [
side_›p
][
to_side
]

2297 [
ôøck
] =

2298 ((
side_ccw_öcomög_wúe_cou¡
 + 
side_cw_öcomög_wúe_cou¡
Ë* 
Fs_≥r_side
 + 
›p_öcomög_wúe_cou¡
 * (Fs_≥r_sidê- 1)Ë% 
num_wúe_muxes
[
to_side
];

2299 
›p_öcomög_wúe_cou¡
++;

2304 if(
öcomög_wúe_œbñ
[
side_›p
]

2305 [
ôøck
] <

2306 
num_ídög_wúes
[
side_›p
])

2308 
sblock_∑âîn
[
i
][
j
]

2309 [
side_›p
][
to_side
]

2310 [
ôøck
] =

2311 
föd_œbñ_of_åack


2312 (
wúe_mux_⁄_åack


2313 [
to_side
],

2314 
num_wúe_muxes


2315 [
to_side
], 
ôøck
);

2320 
sblock_∑âîn
[
i
][
j
]

2321 [
side_›p
][
to_side
]

2322 [
ôøck
] =

2323 ((
side_ccw_öcomög_wúe_cou¡
 + 
side_cw_öcomög_wúe_cou¡
Ë* 
Fs_≥r_side
 + 
›p_öcomög_wúe_cou¡
 * (Fs_≥r_sidê- 1)Ë% 
num_wúe_muxes
[
to_side
];

2324 
›p_öcomög_wúe_cou¡
++;

2332 
side
 = 0; side < 4; ++side)

2334 if(
öcomög_wúe_œbñ
[
side
])

2336 
	`‰ì
(
öcomög_wúe_œbñ
[
side
]);

2338 if(
wúe_mux_⁄_åack
[
side
])

2340 
	`‰ì
(
wúe_mux_⁄_åack
[
side
]);

2343 
	}
}

2346 
	$œbñ_wúe_muxes_f‹_bÆ™˚
(
IN
 
ch™_num
,

2347 
IN
 
£g_num
,

2348 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

2349 
IN
 
max_Àn
,

2350 
IN
 
e_dúe˘i⁄
 
dúe˘i⁄
,

2351 
IN
 
nodes_≥r_ch™
,

2352 
IN
 *
num_wúe_muxes
,

2353 
IN
 
t_º_ty≥
 
ch™_ty≥
,

2354 
IN
 *
›ö_mux_size
,

2355 
IN
 
t_ivec
 *** 
º_node_ödi˚s
)

2382 
num_œbñs
, 
max_›ö_mux_size
, 
mö_›ö_mux_size
;

2383 
öode
, 
i
, 
j
, 
x
, 
y
;

2384 *
¥e_œbñs
, *
föÆ_œbñs
;

2386 i‡(
ch™_ty≥
 =
CHANX
){

2387 
x
 = 
£g_num
;

2388 
y
 = 
ch™_num
;

2390 i‡(
ch™_ty≥
 =
CHANY
){

2391 
x
 = 
ch™_num
;

2392 
y
 = 
£g_num
;

2395 
	`¥ötf
("Eº‹: Bad ch™√»ty≥ (%d).\n", 
ch™_ty≥
);

2396 
	`exô
(1);

2400 
¥e_œbñs
 =

2401 
	`œbñ_wúe_muxes
(
ch™_num
, 
£g_num
, 
£g_dëaûs
, 
max_Àn
,

2402 
dúe˘i⁄
, 
nodes_≥r_ch™
, &
num_œbñs
);

2405 
mö_›ö_mux_size
 = 
MAX_SHORT
;

2406 
max_›ö_mux_size
 = 0;

2407 
i
 = 0; i < 
num_œbñs
; ++i)

2409 
öode
 = 
	`gë_º_node_ödex
(
x
, 
y
, 
ch™_ty≥
, 
¥e_œbñs
[
i
],

2410 
º_node_ödi˚s
);

2411 if(
›ö_mux_size
[
öode
] < 
mö_›ö_mux_size
)

2413 
mö_›ö_mux_size
 = 
›ö_mux_size
[
öode
];

2415 if(
›ö_mux_size
[
öode
] > 
max_›ö_mux_size
)

2417 
max_›ö_mux_size
 = 
›ö_mux_size
[
öode
];

2420 if(
max_›ö_mux_size
 > (
mö_›ö_mux_size
 + 1))

2422 
	`¥ötf
(
ERRTAG
 "opin muxesáreÇot balanced!\n");

2423 
	`¥ötf
("max_opin_mux_size %d min_opin_mux_size %d chan_type %d x %d y %d\n",

2424 
max_›ö_mux_size
, 
mö_›ö_mux_size
, 
ch™_ty≥
, 
x
, 
y
);

2425 
	`exô
(1);

2429 
föÆ_œbñs
 = (*)
	`my_mÆloc
((Ë* 
num_œbñs
);

2430 
j
 = 0;

2431 
i
 = 0; i < 
num_œbñs
; ++i)

2433 
öode
 = 
¥e_œbñs
[
i
];

2434 if(
›ö_mux_size
[
öode
] < 
max_›ö_mux_size
)

2436 
föÆ_œbñs
[
j
] = 
öode
;

2437 ++
j
;

2440 
i
 = 0; i < 
num_œbñs
; ++i)

2442 
öode
 = 
¥e_œbñs
[
i
];

2443 if(
›ö_mux_size
[
öode
] >
max_›ö_mux_size
)

2445 
föÆ_œbñs
[
j
] = 
öode
;

2446 ++
j
;

2451 if(
¥e_œbñs
)

2453 
	`‰ì
(
¥e_œbñs
);

2454 
¥e_œbñs
 = 
NULL
;

2457 *
num_wúe_muxes
 = 
num_œbñs
;

2458  
föÆ_œbñs
;

2459 
	}
}

2463 
	$œbñ_wúe_muxes
(
IN
 
ch™_num
,

2464 
IN
 
£g_num
,

2465 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

2466 
IN
 
max_Àn
,

2467 
IN
 
e_dúe˘i⁄
 
dú
,

2468 
IN
 
nodes_≥r_ch™
,

2469 
OUT
 *
num_wúe_muxes
)

2476 
ôøck
, 
°¨t
, 
íd
, 
num_œbñs
, 
∑ss
;

2477 *
œbñs
 = 
NULL
;

2478 
boﬁón
 
is_ídpoöt
;

2481 
num_œbñs
 = 0;

2482 
∑ss
 = 0;Öass < 2; ++pass)

2485 if(
∑ss
 > 0)

2487 
œbñs
 = (*)
	`my_mÆloc
((Ë* 
num_œbñs
);

2488 
num_œbñs
 = 0;

2492 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; ++itrack)

2494 
°¨t
 =

2495 
	`gë_£g_°¨t
(
£g_dëaûs
, 
ôøck
, 
ch™_num
, 
£g_num
);

2496 
íd
 =

2497 
	`gë_£g_íd
(
£g_dëaûs
, 
ôøck
, 
°¨t
, 
ch™_num
,

2498 
max_Àn
);

2501 if(
£g_dëaûs
[
ôøck
].
dúe˘i⁄
 !
dú
)

2507 
is_ídpoöt
 = (
£g_num
 =
°¨t
);

2508 if(
DEC_DIRECTION
 =
£g_dëaûs
[
ôøck
].
dúe˘i⁄
)

2510 
is_ídpoöt
 = (
£g_num
 =
íd
);

2514 if(
is_ídpoöt
)

2516 if(
∑ss
 > 0)

2518 
œbñs
[
num_œbñs
] = 
ôøck
;

2520 ++
num_œbñs
;

2525 *
num_wúe_muxes
 = 
num_œbñs
;

2526  
œbñs
;

2527 
	}
}

2532 
	$œbñ_öcomög_wúes
(
IN
 
ch™_num
,

2533 
IN
 
£g_num
,

2534 
IN
 
sb_£g
,

2535 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

2536 
IN
 
max_Àn
,

2537 
IN
 
e_dúe˘i⁄
 
dú
,

2538 
IN
 
nodes_≥r_ch™
,

2539 
OUT
 *
num_öcomög_wúes
,

2540 
OUT
 *
num_ídög_wúes
)

2547 
ôøck
, 
°¨t
, 
íd
, 
i
, 
num_∑ssög
, 
num_ídög
, 
∑ss
;

2548 *
œbñs
;

2549 
boﬁón
 
sbox_exi°s
, 
is_ídpoöt
;

2552 
œbñs
 = (*)
	`my_mÆloc
(
nodes_≥r_ch™
 * ());

2553 
i
 = 0; i < 
nodes_≥r_ch™
; ++i)

2555 
œbñs
[
i
] = 
UN_SET
;

2558 
num_ídög
 = 0;

2559 
num_∑ssög
 = 0;

2560 
∑ss
 = 0;Öass < 2; ++pass)

2562 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; ++itrack)

2564 if(
£g_dëaûs
[
ôøck
].
dúe˘i⁄
 =
dú
)

2566 
°¨t
 =

2567 
	`gë_£g_°¨t
(
£g_dëaûs
, 
ôøck
, 
ch™_num
,

2568 
£g_num
);

2569 
íd
 =

2570 
	`gë_£g_íd
(
£g_dëaûs
, 
ôøck
, 
°¨t
,

2571 
ch™_num
, 
max_Àn
);

2574 
is_ídpoöt
 = (
£g_num
 =
íd
);

2575 if(
DEC_DIRECTION
 =
£g_dëaûs
[
ôøck
].
dúe˘i⁄
)

2577 
is_ídpoöt
 = (
£g_num
 =
°¨t
);

2581 
sbox_exi°s
 = 
	`is_sbox
(
ch™_num
, 
£g_num
, 
sb_£g
,

2582 
ôøck
, 
£g_dëaûs
,

2583 
UNI_DIRECTIONAL
);

2585 
∑ss
)

2589 if(
is_ídpoöt
)

2591 
œbñs
[
ôøck
] = 
num_ídög
;

2592 ++
num_ídög
;

2599 if((
FALSE
 =
is_ídpoöt
Ë&& 
sbox_exi°s
)

2601 
œbñs
[
ôøck
] =

2602 
num_ídög
 + 
num_∑ssög
;

2603 ++
num_∑ssög
;

2611 *
num_öcomög_wúes
 = 
num_∑ssög
 + 
num_ídög
;

2612 *
num_ídög_wúes
 = 
num_ídög
;

2613  
œbñs
;

2614 
	}
}

2619 
	$föd_œbñ_of_åack
(*
wúe_mux_⁄_åack
,

2620 
num_wúe_muxes
,

2621 
‰om_åack
)

2623 
i
, 
max_œbñ
, 
√¨e°_œbñ
, 
max_íåy
, 
√¨e°_íåy
;

2628 
max_œbñ
 = 
√¨e°_œbñ
 = 
max_íåy
 = 
√¨e°_íåy
 = -1;

2630 
i
 = 0; i < 
num_wúe_muxes
; i++)

2632 if(
wúe_mux_⁄_åack
[
i
] =
‰om_åack
)

2634  
i
;

2638 
	`¥ötf
("Error: Expected muxÇot found.\n");

2639 
	`exô
(1);

2640 
	}
}

	@rr_graph2.h

3 
boﬁón
 *
º_edge_d⁄e
;

9 
s_ivec
 ***
Æloc_™d_lﬂd_º_node_ödi˚s
(
IN
 
nodes_≥r_ch™
,

10 
IN
 
nx
,

11 
IN
 
ny
,

12 
INOUT
 *
ödex
,

13 
IN
 
t_£g_dëaûs
 *

14 
£g_dëaûs
);

16 
‰ì_º_node_ödi˚s
(
IN
 
t_ivec
 *** 
º_node_ödi˚s
);

18 
gë_º_node_ödex
(
x
,

19 
y
,

20 
t_º_ty≥
 
º_ty≥
,

21 
±c
,

22 
t_ivec
 *** 
º_node_ödi˚s
);

24 
‰ì_£g_dëaûs
(
t_£g_dëaûs
 * 
£g_dëaûs
,

25 
nodes_≥r_ch™
);

27 
t_£g_dëaûs
 *
Æloc_™d_lﬂd_£g_dëaûs
(
INOUT
 *
nodes_≥r_ch™
,

28 
IN
 
max_Àn
,

29 
IN
 
num_£g_ty≥s
,

30 
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

31 
IN
 
boﬁón
 
u£_fuŒ_£g_groups
,

32 
IN
 
boﬁón
 
is_globÆ_gøph
,

33 
IN
 
e_dúe˘i⁄Æôy


34 
dúe˘i⁄Æôy
);

36 
dump_£g_dëaûs
(
t_£g_dëaûs
 * 
£g_dëaûs
,

37 
nodes_≥r_ch™
,

38 *
‚ame
);

40 
gë_£g_°¨t
(
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

41 
IN
 
ôøck
,

42 
IN
 
ch™_num
,

43 
IN
 
£g_num
);

45 
gë_£g_íd
(
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

46 
IN
 
ôøck
,

47 
IN
 
i°¨t
,

48 
IN
 
ch™_num
,

49 
IN
 
£g_max
);

51 
boﬁón
 
is_cbox
(
IN
 
ch™
,

52 
IN
 
£g
,

53 
IN
 
åack
,

54 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

55 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
);

57 
boﬁón
 
is_sbox
(
IN
 
ch™
,

58 
IN
 
wúe_£g
,

59 
IN
 
sb_£g
,

60 
IN
 
åack
,

61 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

62 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
);

64 
gë_bidú_›ö_c⁄√˘i⁄s
(
IN
 
i
,

65 
IN
 
j
,

66 
IN
 
ùö
,

67 
IN
 
s_löked_edge
 **
edge_li°
,

68 
IN
 *****
›ö_to_åack_m≠
,

69 
IN
 
Fc
,

70 
IN
 
boﬁón
 * 
º_edge_d⁄e
,

71 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

72 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
);

74 
gë_unidú_›ö_c⁄√˘i⁄s
(
IN
 
ch™
,

75 
IN
 
£g
,

76 
IN
 
Fc
,

77 
IN
 
t_º_ty≥
 
ch™_ty≥
,

78 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

79 
INOUT
 
t_löked_edge
 ** 
edge_li°_±r
,

80 
INOUT
 **
Fc_ofs
,

81 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

82 
IN
 
max_Àn
,

83 
IN
 
nodes_≥r_ch™
,

84 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

85 
OUT
 
boﬁón
 * 
Fc_˛ù≥d
);

87 
gë_åack_to_ùös
(
£g
,

88 
ch™
,

89 
åack
,

90 
t_löked_edge
 ** 
edge_li°_±r
,

91 
t_ivec
 *** 
º_node_ödi˚s
,

92 
s_ivec
 ****
åack_to_ùö_lookup
,

93 
t_£g_dëaûs
 * 
£g_dëaûs
,

94 
e_º_ty≥
 
ch™_ty≥
,

95 
ch™_Àngth
,

96 
wúe_to_ùö_swôch
,

97 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
);

99 
gë_åack_to_åacks
(
IN
 
‰om_ch™
,

100 
IN
 
‰om_£g
,

101 
IN
 
‰om_åack
,

102 
IN
 
t_º_ty≥
 
‰om_ty≥
,

103 
IN
 
to_£g
,

104 
IN
 
t_º_ty≥
 
to_ty≥
,

105 
IN
 
ch™_Àn
,

106 
IN
 
nodes_≥r_ch™
,

107 
IN
 *
›ö_mux_size
,

108 
IN
 
Fs_≥r_side
,

109 
IN
 *****
sblock_∑âîn
,

110 
INOUT
 
s_löked_edge
 **
edge_li°
,

111 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

112 
IN
 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

113 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

114 
INOUT
 
boﬁón
 * 
º_edge_d⁄e
,

115 
IN
 
s_ivec
 ***
swôch_block_c⁄n
);

117 *****
Æloc_sblock_∑âîn_lookup
(
IN
 
nx
,

118 
IN
 
ny
,

119 
IN
 
nodes_≥r_ch™
);

120 
‰ì_sblock_∑âîn_lookup
(
INOUT
 *****
sblock_∑âîn
);

121 
lﬂd_sblock_∑âîn_lookup
(
IN
 
i
,

122 
IN
 
j
,

123 
IN
 
nodes_≥r_ch™
,

124 
IN
 
t_£g_dëaûs
 * 
£g_dëaûs
,

125 
IN
 
Fs
,

126 
IN
 
e_swôch_block_ty≥
 
swôch_block_ty≥
,

127 
INOUT
 *****
sblock_∑âîn
);

	@rr_graph_area.c

1 
	~<m©h.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~<as£π.h
>

5 
	~"globÆs.h
"

6 
	~"º_gøph_utû.h
"

7 
	~"º_gøph_¨ó.h
"

12 
cou¡_bidú_routög_å™si°‹s
(
num_swôch
,

13 
R_möW_nmos
,

14 
R_möW_pmos
);

16 
cou¡_unidú_routög_å™si°‹s
(
t_£gmít_öf
 * 
£gmít_öf
,

17 
R_möW_nmos
,

18 
R_möW_pmos
);

20 
gë_cblock_å™s
(*
num_öputs_to_cblock
,

21 
max_öputs_to_cblock
,

22 
å™s_cblock_to_lblock_buf
,

23 
å™s_§am_bô
);

25 *
Æloc_™d_lﬂd_unsh¨abÀ_swôch_å™s
(
num_swôch
,

26 
å™s_§am_bô
,

27 
R_möW_nmos
);

29 *
Æloc_™d_lﬂd_sh¨abÀ_swôch_å™s
(
num_swôch
,

30 
å™s_§am_bô
,

31 
R_möW_nmos
,

32 
R_möW_pmos
);

34 
å™s_≥r_buf
(
Rbuf
,

35 
R_möW_nmos
,

36 
R_möW_pmos
);

38 
å™s_≥r_mux
(
num_öputs
,

39 
å™s_§am_bô
,

40 
∑ss_å™s_¨ó
);

42 
å™s_≥r_R
(
Rå™s
,

43 
R_möW_å™s
);

50 
	$cou¡_routög_å™si°‹s
(
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

51 
num_swôch
,

52 
t_£gmít_öf
 * 
£gmít_öf
,

53 
R_möW_nmos
,

54 
R_möW_pmos
)

68 if(
dúe˘i⁄Æôy
 =
BI_DIRECTIONAL
)

70 
	`cou¡_bidú_routög_å™si°‹s
(
num_swôch
, 
R_möW_nmos
,

71 
R_möW_pmos
);

75 
	`as£π
(
dúe˘i⁄Æôy
 =
UNI_DIRECTIONAL
);

76 
	`cou¡_unidú_routög_å™si°‹s
(
£gmít_öf
, 
R_möW_nmos
,

77 
R_möW_pmos
);

79 
	}
}

82 
	$cou¡_bidú_routög_å™si°‹s
(
num_swôch
,

83 
R_möW_nmos
,

84 
R_möW_pmos
)

109 *
num_öputs_to_cblock
;

113 
boﬁón
 *
cblock_cou¡ed
;

114 *
sh¨ed_buf„r_å™s
;

115 *
unsh¨abÀ_swôch_å™s
, *
sh¨abÀ_swôch_å™s
;

117 
t_º_ty≥
 
‰om_º_ty≥
, 
to_º_ty≥
;

118 
‰om_node
, 
to_node
, 
õdge
, 
num_edges
, 
maxÀn
;

119 
iswôch
, 
i
, 
j
, 
i£g
, 
max_öputs_to_cblock
;

120 
öput_cblock_å™s
, 
sh¨ed_›ö_buf„r_å™s
;

121 c⁄° 
å™s_§am_bô
 = 6.;

131 
¡øns_sh¨ög
, 
¡øns_no_sh¨ög
;

138 
å™s_åack_to_cblock_buf
;

139 
å™s_cblock_to_lblock_buf
;

142 
¡øns_sh¨ög
 = 0.;

143 
¡øns_no_sh¨ög
 = 0.;

144 
max_öputs_to_cblock
 = 0;

150 
å™s_åack_to_cblock_buf
 =

151 
	`å™s_≥r_buf
(
R_möW_nmos
 / 4., R_möW_nmos, 
R_möW_pmos
);

153 
å™s_cblock_to_lblock_buf
 =

154 
	`å™s_≥r_buf
(
R_möW_nmos
 / 4., R_möW_nmos, 
R_möW_pmos
);

156 
num_öputs_to_cblock
 = (*)
	`my_ˇŒoc
(
num_º_nodes
, ());

158 
maxÀn
 = 
	`max
(
nx
, 
ny
) + 1;

159 
cblock_cou¡ed
 = (
boﬁón
 *Ë
	`my_ˇŒoc
(
maxÀn
, (boolean));

160 
sh¨ed_buf„r_å™s
 = (*)
	`my_ˇŒoc
(
maxÀn
, ());

162 
unsh¨abÀ_swôch_å™s
 =

163 
	`Æloc_™d_lﬂd_unsh¨abÀ_swôch_å™s
(
num_swôch
, 
å™s_§am_bô
,

164 
R_möW_nmos
);

166 
sh¨abÀ_swôch_å™s
 =

167 
	`Æloc_™d_lﬂd_sh¨abÀ_swôch_å™s
(
num_swôch
, 
å™s_§am_bô
,

168 
R_möW_nmos
, 
R_möW_pmos
);

170 
‰om_node
 = 0; from_nodê< 
num_º_nodes
; from_node++)

173 
‰om_º_ty≥
 = 
º_node
[
‰om_node
].
ty≥
;

175 
‰om_º_ty≥
)

178 
CHANX
:

179 
CHANY
:

180 
num_edges
 = 
º_node
[
‰om_node
].num_edges;

182 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

185 
to_node
 = 
º_node
[
‰om_node
].
edges
[
õdge
];

186 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

188 
to_º_ty≥
)

191 
CHANX
:

192 
CHANY
:

193 
iswôch
 =

194 
º_node
[
‰om_node
].
swôches
[
õdge
];

196 if(
swôch_öf
[
iswôch
].
buf„ªd
)

198 
i£g
 =

199 
	`£g_ödex_of_sblock
(
‰om_node
,

200 
to_node
);

201 
sh¨ed_buf„r_å™s
[
i£g
] =

202 
	`max
(
sh¨ed_buf„r_å™s
[
i£g
],

203 
sh¨abÀ_swôch_å™s


204 [
iswôch
]);

206 
¡øns_no_sh¨ög
 +=

207 
unsh¨abÀ_swôch_å™s


208 [
iswôch
] +

209 
sh¨abÀ_swôch_å™s


210 [
iswôch
];

211 
¡øns_sh¨ög
 +=

212 
unsh¨abÀ_swôch_å™s


213 [
iswôch
];

215 if(
‰om_node
 < 
to_node
)

221 
¡øns_no_sh¨ög
 +=

222 
unsh¨abÀ_swôch_å™s


223 [
iswôch
];

224 
¡øns_sh¨ög
 +=

225 
unsh¨abÀ_swôch_å™s


226 [
iswôch
];

230 
IPIN
:

231 
num_öputs_to_cblock
[
to_node
]++;

232 
max_öputs_to_cblock
 =

233 
	`max
(
max_öputs_to_cblock
,

234 
num_öputs_to_cblock
[
to_node
]);

236 
i£g
 =

237 
	`£g_ödex_of_cblock
(
‰om_º_ty≥
,

238 
to_node
);

240 if(
cblock_cou¡ed
[
i£g
] =
FALSE
)

242 
cblock_cou¡ed
[
i£g
] = 
TRUE
;

243 
¡øns_sh¨ög
 +=

244 
å™s_åack_to_cblock_buf
;

245 
¡øns_no_sh¨ög
 +=

246 
å™s_åack_to_cblock_buf
;

251 
¥ötf


254 
‰om_node
, 
‰om_º_ty≥
, 
to_node
,

255 
to_º_ty≥
);

256 
	`exô
(1);

265 if(
‰om_º_ty≥
 =
CHANX
)

267 
i
 = 
º_node
[
‰om_node
].
xlow
 - 1;

268 
i
 <
º_node
[
‰om_node
].
xhigh
; i++)

270 
¡øns_sh¨ög
 +
sh¨ed_buf„r_å™s
[
i
];

271 
sh¨ed_buf„r_å™s
[
i
] = 0.;

274 
i
 = 
º_node
[
‰om_node
].
xlow
;

275 
i
 <
º_node
[
‰om_node
].
xhigh
; i++)

276 
cblock_cou¡ed
[
i
] = 
FALSE
;

281 
j
 = 
º_node
[
‰om_node
].
ylow
 - 1;

282 
j
 <
º_node
[
‰om_node
].
yhigh
; j++)

284 
¡øns_sh¨ög
 +
sh¨ed_buf„r_å™s
[
j
];

285 
sh¨ed_buf„r_å™s
[
j
] = 0.;

288 
j
 = 
º_node
[
‰om_node
].
ylow
;

289 
j
 <
º_node
[
‰om_node
].
yhigh
; j++)

290 
cblock_cou¡ed
[
j
] = 
FALSE
;

295 
OPIN
:

296 
num_edges
 = 
º_node
[
‰om_node
].num_edges;

297 
sh¨ed_›ö_buf„r_å™s
 = 0.;

299 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

301 
iswôch
 = 
º_node
[
‰om_node
].
swôches
[
õdge
];

302 
¡øns_no_sh¨ög
 +=

303 
unsh¨abÀ_swôch_å™s
[
iswôch
] +

304 
sh¨abÀ_swôch_å™s
[
iswôch
];

305 
¡øns_sh¨ög
 +=

306 
unsh¨abÀ_swôch_å™s
[
iswôch
];

308 
sh¨ed_›ö_buf„r_å™s
 =

309 
	`max
(
sh¨ed_›ö_buf„r_å™s
,

310 
sh¨abÀ_swôch_å™s
[
iswôch
]);

313 
¡øns_sh¨ög
 +
sh¨ed_›ö_buf„r_å™s
;

322 
	`‰ì
(
cblock_cou¡ed
);

323 
	`‰ì
(
sh¨ed_buf„r_å™s
);

324 
	`‰ì
(
unsh¨abÀ_swôch_å™s
);

325 
	`‰ì
(
sh¨abÀ_swôch_å™s
);

329 
öput_cblock_å™s
 = 
	`gë_cblock_å™s
(
num_öputs_to_cblock
,

330 
max_öputs_to_cblock
,

331 
å™s_cblock_to_lblock_buf
,

332 
å™s_§am_bô
);

334 
	`‰ì
(
num_öputs_to_cblock
);

336 
¡øns_sh¨ög
 +
öput_cblock_å™s
;

337 
¡øns_no_sh¨ög
 +
öput_cblock_å™s
;

339 
	`¥ötf
("\nRoutingárea (in minimum widthÅransistoráreas):\n");

340 
¥ötf


342 "%#g\n", 
¡øns_no_sh¨ög
,Çå™s_no_sh¨ög / ()(
nx
 * 
ny
));

343 
¥ötf


345 "%#g\n\n", 
¡øns_sh¨ög
,Çå™s_sh¨ög / ()(
nx
 * 
ny
));

346 
	}
}

349 
	$cou¡_unidú_routög_å™si°‹s
(
t_£gmít_öf
 * 
£gmít_öf
,

350 
R_möW_nmos
,

351 
R_möW_pmos
)

353 
boﬁón
 *
cblock_cou¡ed
;

354 *
num_öputs_to_cblock
;

358 
t_º_ty≥
 
‰om_º_ty≥
, 
to_º_ty≥
;

359 
i
, 
j
, 
i£g
, 
‰om_node
, 
to_node
, 
õdge
, 
num_edges
, 
maxÀn
;

360 
max_öputs_to_cblock
, 
co°_ödex
, 
£g_ty≥
, 
swôch_ty≥
;

361 
öput_cblock_å™s
;

362 c⁄° 
å™s_§am_bô
 = 6.;

372 
¡øns
;

379 
å™s_åack_to_cblock_buf
;

380 
å™s_cblock_to_lblock_buf
;

382 
max_öputs_to_cblock
 = 0;

388 
å™s_åack_to_cblock_buf
 =

389 
	`å™s_≥r_buf
(
R_möW_nmos
 / 4., R_möW_nmos, 
R_möW_pmos
);

391 
å™s_cblock_to_lblock_buf
 =

392 
	`å™s_≥r_buf
(
R_möW_nmos
 / 4., R_möW_nmos, 
R_möW_pmos
);

394 
num_öputs_to_cblock
 = (*)
	`my_ˇŒoc
(
num_º_nodes
, ());

395 
maxÀn
 = 
	`max
(
nx
, 
ny
) + 1;

396 
cblock_cou¡ed
 = (
boﬁón
 *Ë
	`my_ˇŒoc
(
maxÀn
, (boolean));

398 
¡øns
 = 0;

399 
‰om_node
 = 0; from_nodê< 
num_º_nodes
; from_node++)

402 
‰om_º_ty≥
 = 
º_node
[
‰om_node
].
ty≥
;

404 
‰om_º_ty≥
)

407 
CHANX
:

408 
CHANY
:

409 
num_edges
 = 
º_node
[
‰om_node
].num_edges;

410 
co°_ödex
 = 
º_node
[
‰om_node
].cost_index;

411 
£g_ty≥
 = 
º_ödexed_d©a
[
co°_ödex
].
£g_ödex
;

412 
swôch_ty≥
 = 
£gmít_öf
[
£g_ty≥
].
wúe_swôch
;

413 
	`as£π
(
£gmít_öf
[
£g_ty≥
].
wúe_swôch
 ==

414 
£gmít_öf
[
£g_ty≥
].
›ö_swôch
);

415 
	`as£π
(
swôch_öf
[
swôch_ty≥
].
mux_å™s_size
 >= 1);

417 
	`as£π
(
º_node
[
‰om_node
].
num_›ö_drivîs
 == 0);

418 
	`as£π
(
º_node
[
‰om_node
].
num_wúe_drivîs
 == 0);

422 
¡øns
 +=

423 
	`å™s_≥r_mux
(
º_node
[
‰om_node
].
Án_ö
,

424 
å™s_§am_bô
,

425 
swôch_öf
[
swôch_ty≥
].
mux_å™s_size
);

428 if(
swôch_öf
[
swôch_ty≥
].
buf_size
 == 0)

430 
¡øns
 +=

431 
	`å™s_≥r_buf
(
swôch_öf
[
swôch_ty≥
].
R
,

432 
R_möW_nmos
, 
R_möW_pmos
);

436 
¡øns
 +
swôch_öf
[
swôch_ty≥
].
buf_size
;

439 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

442 
to_node
 = 
º_node
[
‰om_node
].
edges
[
õdge
];

443 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

445 
to_º_ty≥
)

448 
CHANX
:

449 
CHANY
:

452 
IPIN
:

453 
num_öputs_to_cblock
[
to_node
]++;

454 
max_öputs_to_cblock
 =

455 
	`max
(
max_öputs_to_cblock
,

456 
num_öputs_to_cblock
[
to_node
]);

457 
i£g
 =

458 
	`£g_ödex_of_cblock
(
‰om_º_ty≥
,

459 
to_node
);

461 if(
cblock_cou¡ed
[
i£g
] =
FALSE
)

463 
cblock_cou¡ed
[
i£g
] = 
TRUE
;

464 
¡øns
 +=

465 
å™s_åack_to_cblock_buf
;

470 
¥ötf


473 
‰om_node
, 
‰om_º_ty≥
, 
to_node
,

474 
to_º_ty≥
);

475 
	`exô
(1);

483 if(
‰om_º_ty≥
 =
CHANX
)

485 
i
 = 
º_node
[
‰om_node
].
xlow
;

486 
i
 <
º_node
[
‰om_node
].
xhigh
; i++)

487 
cblock_cou¡ed
[
i
] = 
FALSE
;

492 
j
 = 
º_node
[
‰om_node
].
ylow
;

493 
j
 <
º_node
[
‰om_node
].
yhigh
; j++)

494 
cblock_cou¡ed
[
j
] = 
FALSE
;

498 
OPIN
:

509 
öput_cblock_å™s
 = 
	`gë_cblock_å™s
(
num_öputs_to_cblock
,

510 
max_öputs_to_cblock
,

511 
å™s_cblock_to_lblock_buf
,

512 
å™s_§am_bô
);

514 
	`‰ì
(
cblock_cou¡ed
);

515 
	`‰ì
(
num_öputs_to_cblock
);

517 
¡øns
 +
öput_cblock_å™s
;

519 
	`¥ötf
("\nRoutingárea (in minimum widthÅransistoráreas):\n");

520 
	`¥ötf
("TŸÆ Routög Aªa: %#g PîÜogi¯tûe: %#g\n", 
¡øns
,

521 
¡øns
 / ()(
nx
 * 
ny
));

522 
	}
}

526 
	$gë_cblock_å™s
(*
num_öputs_to_cblock
,

527 
max_öputs_to_cblock
,

528 
å™s_cblock_to_lblock_buf
,

529 
å™s_§am_bô
)

537 *
å™s_≥r_cblock
;

538 
å™s_cou¡
;

539 
i
, 
num_öputs
;

541 
å™s_≥r_cblock
 = (*)
	`my_mÆloc
((
max_öputs_to_cblock
 + 1) *

544 
å™s_≥r_cblock
[0] = 0.;

550 
i
 = 1; i <
max_öputs_to_cblock
; i++)

551 
å™s_≥r_cblock
[
i
] =

552 
	`å™s_≥r_mux
(
i
, 
å™s_§am_bô
,

553 
ùö_mux_å™s_size
Ë+ 
å™s_cblock_to_lblock_buf
;

555 
å™s_cou¡
 = 0.;

557 
i
 = 0; i < 
num_º_nodes
; i++)

559 
num_öputs
 = 
num_öputs_to_cblock
[
i
];

560 
å™s_cou¡
 +
å™s_≥r_cblock
[
num_öputs
];

563 
	`‰ì
(
å™s_≥r_cblock
);

564  (
å™s_cou¡
);

565 
	}
}

569 
	$Æloc_™d_lﬂd_unsh¨abÀ_swôch_å™s
(
num_swôch
,

570 
å™s_§am_bô
,

571 
R_möW_nmos
)

579 *
unsh¨abÀ_swôch_å™s
, 
R∑ss
;

580 
i
;

582 
unsh¨abÀ_swôch_å™s
 = (*)
	`my_mÆloc
(
num_swôch
 * ());

584 
i
 = 0; i < 
num_swôch
; i++)

587 if(
swôch_öf
[
i
].
buf„ªd
 =
FALSE
)

589 
R∑ss
 = 
swôch_öf
[
i
].
R
;

593 
R∑ss
 = 
swôch_öf
[
i
].
R
 / 2.;

596 
unsh¨abÀ_swôch_å™s
[
i
] = 
	`å™s_≥r_R
(
R∑ss
, 
R_möW_nmos
) +

597 
å™s_§am_bô
;

600  (
unsh¨abÀ_swôch_å™s
);

601 
	}
}

605 
	$Æloc_™d_lﬂd_sh¨abÀ_swôch_å™s
(
num_swôch
,

606 
å™s_§am_bô
,

607 
R_möW_nmos
,

608 
R_möW_pmos
)

617 *
sh¨abÀ_swôch_å™s
, 
Rbuf
;

618 
i
;

620 
sh¨abÀ_swôch_å™s
 = (*)
	`my_mÆloc
(
num_swôch
 * ());

622 
i
 = 0; i < 
num_swôch
; i++)

625 if(
swôch_öf
[
i
].
buf„ªd
 =
FALSE
)

627 
sh¨abÀ_swôch_å™s
[
i
] = 0.;

631 
Rbuf
 = 
swôch_öf
[
i
].
R
 / 2.;

632 
sh¨abÀ_swôch_å™s
[
i
] =

633 
	`å™s_≥r_buf
(
Rbuf
, 
R_möW_nmos
, 
R_möW_pmos
);

637  (
sh¨abÀ_swôch_å™s
);

638 
	}
}

642 
	$å™s_≥r_buf
(
Rbuf
,

643 
R_möW_nmos
,

644 
R_möW_pmos
)

651 
num_°age
, 
i°age
;

652 
å™s_cou¡
, 
°age_øtio
, 
R°age
;

654 if(
Rbuf
 > 0.6 * 
R_möW_nmos
 || Rbuf <= 0.)

656 
å™s_cou¡
 = 
	`å™s_≥r_R
(
Rbuf
, 
R_möW_nmos
) +Årans_per_R(Rbuf,

657 
R_möW_pmos
);

665 
num_°age
 = 
	`nöt
(
	`log10
(
R_möW_nmos
 / 
Rbuf
) /Üog10(4.));

666 
num_°age
 = 
	`max
(num_stage, 1);

667 
°age_øtio
 = 
	`pow
(
R_möW_nmos
 / 
Rbuf
, 1. / ()
num_°age
);

669 
R°age
 = 
R_möW_nmos
;

670 
å™s_cou¡
 = 0.;

672 
i°age
 = 0; i°agê<
num_°age
; istage++)

674 
å™s_cou¡
 +=

675 
	`å™s_≥r_R
(
R°age
, 
R_möW_nmos
) +Årans_per_R(Rstage,

676 
R_möW_pmos
);

677 
R°age
 /
°age_øtio
;

681  (
å™s_cou¡
);

682 
	}
}

686 
	$å™s_≥r_mux
(
num_öputs
,

687 
å™s_§am_bô
,

688 
∑ss_å™s_¨ó
)

696 
¡øns
, 
§am_å™s
, 
∑ss_å™s
;

697 
num_£c⁄d_°age_å™s
;

699 if(
num_öputs
 <= 1)

703 if(
num_öputs
 == 2)

705 
∑ss_å™s
 = 2 * 
∑ss_å™s_¨ó
;

706 
§am_å™s
 = 1 * 
å™s_§am_bô
;

708 if(
num_öputs
 <= 4)

711 
∑ss_å™s
 = 
num_öputs
 * 
∑ss_å™s_¨ó
;

712 
§am_å™s
 = 
num_öputs
 * 
å™s_§am_bô
;

719 
num_£c⁄d_°age_å™s
 = 
	`Êo‹
(
	`sqπ
(
num_öputs
) + 0.00001);

720 
∑ss_å™s
 =

721 (
num_öputs
 + 
num_£c⁄d_°age_å™s
Ë* 
∑ss_å™s_¨ó
;

722 
§am_å™s
 =

723 (
	`˚û
(()
num_öputs
 / 
num_£c⁄d_°age_å™s
 - 0.00001) +

724 
num_£c⁄d_°age_å™s
Ë* 
å™s_§am_bô
;

725 if(
num_£c⁄d_°age_å™s
 == 2)

729 
§am_å™s
 -1 * 
å™s_§am_bô
;

733 
¡øns
 = 
∑ss_å™s
 + 
§am_å™s
;

734  (
¡øns
);

735 
	}
}

739 
	$å™s_≥r_R
(
Rå™s
,

740 
R_möW_å™s
)

747 
å™s_¨ó
;

749 if(
Rå™s
 <= 0.)

752 if(
Rå™s
 >
R_möW_å™s
)

761 
å™s_¨ó
 = 0.5 * 
R_möW_å™s
 / 
Rå™s
 + 0.5;

762  (
å™s_¨ó
);

763 
	}
}

	@rr_graph_area.h

1 
cou¡_routög_å™si°‹s
(
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

2 
num_swôch
,

3 
t_£gmít_öf
 * 
£gmít_öf
,

4 
R_möW_nmos
,

5 
R_möW_pmos
);

	@rr_graph_indexed_data.c

1 
	~<m©h.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"º_gøph_utû.h
"

6 
	~"º_gøph2.h
"

7 
	~"º_gøph_ödexed_d©a.h
"

12 
lﬂd_º_ödexed_d©a_ba£_co°s
(
nodes_≥r_ch™
,

13 
t_ivec
 *** 
º_node_ödi˚s
,

14 
e_ba£_co°_ty≥


15 
ba£_co°_ty≥
,

16 
wúe_to_ùö_swôch
);

18 
gë_dñay_n‹mÆiz©i⁄_Ác
(
nodes_≥r_ch™
,

19 
t_ivec
 *** 
º_node_ödi˚s
);

21 
gë_avîage_›ö_dñay
(
t_ivec
 *** 
º_node_ödi˚s
,

22 
nodes_≥r_ch™
);

24 
lﬂd_º_ödexed_d©a_T_vÆues
(
ödex_°¨t
,

25 
num_ödi˚s_to_lﬂd
,

26 
t_º_ty≥
 
º_ty≥
,

27 
nodes_≥r_ch™
,

28 
t_ivec
 *** 
º_node_ödi˚s
,

29 
t_£gmít_öf
 * 
£gmít_öf
);

49 
	$Æloc_™d_lﬂd_º_ödexed_d©a
(
IN
 
t_£gmít_öf
 * 
£gmít_öf
,

50 
IN
 
num_£gmít
,

51 
IN
 
t_ivec
 *** 
º_node_ödi˚s
,

52 
IN
 
nodes_≥r_ch™
,

53 
wúe_to_ùö_swôch
,

54 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
)

57 
i£g
, 
Àngth
, 
i
, 
ödex
;

59 
num_º_ödexed_d©a
 = 
CHANX_COST_INDEX_START
 + (2 * 
num_£gmít
);

60 
º_ödexed_d©a
 = (
t_º_ödexed_d©a
 *Ë
	`my_mÆloc
(
num_º_ödexed_d©a
 *

62 (
t_º_ödexed_d©a
));

69 
i
 = 
SOURCE_COST_INDEX
; i <
IPIN_COST_INDEX
; i++)

71 
º_ödexed_d©a
[
i
].
‹tho_co°_ödex
 = 
OPEN
;

72 
º_ödexed_d©a
[
i
].
£g_ödex
 = 
OPEN
;

73 
º_ödexed_d©a
[
i
].
öv_Àngth
 = 
OPEN
;

74 
º_ödexed_d©a
[
i
].
T_löór
 = 
OPEN
;

75 
º_ödexed_d©a
[
i
].
T_quadøtic
 = 
OPEN
;

76 
º_ödexed_d©a
[
i
].
C_lﬂd
 = 
OPEN
;

79 
º_ödexed_d©a
[
IPIN_COST_INDEX
].
T_löór
 =

80 
swôch_öf
[
wúe_to_ùö_swôch
].
Tdñ
;

84 
i£g
 = 0; i£g < 
num_£gmít
; iseg++)

86 
ödex
 = 
CHANX_COST_INDEX_START
 + 
i£g
;

88 
º_ödexed_d©a
[
ödex
].
‹tho_co°_ödex
 = index + 
num_£gmít
;

90 if(
£gmít_öf
[
i£g
].
l⁄glöe
)

91 
Àngth
 = 
nx
;

93 
Àngth
 = 
	`mö
(
£gmít_öf
[
i£g
].Àngth, 
nx
);

96 
º_ödexed_d©a
[
ödex
].
öv_Àngth
 = 1. / 
Àngth
;

97 
º_ödexed_d©a
[
ödex
].
£g_ödex
 = 
i£g
;

100 
	`lﬂd_º_ödexed_d©a_T_vÆues
(
CHANX_COST_INDEX_START
, 
num_£gmít
,

101 
CHANX
, 
nodes_≥r_ch™
, 
º_node_ödi˚s
,

102 
£gmít_öf
);

106 
i£g
 = 0; i£g < 
num_£gmít
; iseg++)

108 
ödex
 = 
CHANX_COST_INDEX_START
 + 
num_£gmít
 + 
i£g
;

110 
º_ödexed_d©a
[
ödex
].
‹tho_co°_ödex
 = index - 
num_£gmít
;

112 if(
£gmít_öf
[
i£g
].
l⁄glöe
)

113 
Àngth
 = 
ny
;

115 
Àngth
 = 
	`mö
(
£gmít_öf
[
i£g
].Àngth, 
ny
);

117 
º_ödexed_d©a
[
ödex
].
öv_Àngth
 = 1. / 
Àngth
;

118 
º_ödexed_d©a
[
ödex
].
£g_ödex
 = 
i£g
;

121 
	`lﬂd_º_ödexed_d©a_T_vÆues
((
CHANX_COST_INDEX_START
 + 
num_£gmít
),

122 
num_£gmít
, 
CHANY
, 
nodes_≥r_ch™
,

123 
º_node_ödi˚s
, 
£gmít_öf
);

125 
	`lﬂd_º_ödexed_d©a_ba£_co°s
(
nodes_≥r_ch™
, 
º_node_ödi˚s
,

126 
ba£_co°_ty≥
, 
wúe_to_ùö_swôch
);

128 
	}
}

132 
	$lﬂd_º_ödexed_d©a_ba£_co°s
(
nodes_≥r_ch™
,

133 
t_ivec
 *** 
º_node_ödi˚s
,

134 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
,

135 
wúe_to_ùö_swôch
)

141 
dñay_n‹mÆiz©i⁄_Ác
;

142 
ödex
;

144 if(
ba£_co°_ty≥
 =
DELAY_NORMALIZED
)

146 
dñay_n‹mÆiz©i⁄_Ác
 =

147 
	`gë_dñay_n‹mÆiz©i⁄_Ác
(
nodes_≥r_ch™
, 
º_node_ödi˚s
);

151 
dñay_n‹mÆiz©i⁄_Ác
 = 1.;

154 if(
ba£_co°_ty≥
 =
DEMAND_ONLY
 || ba£_co°_ty≥ =
DELAY_NORMALIZED
)

156 
º_ödexed_d©a
[
SOURCE_COST_INDEX
].
ba£_co°
 =

157 
dñay_n‹mÆiz©i⁄_Ác
;

158 
º_ödexed_d©a
[
SINK_COST_INDEX
].
ba£_co°
 = 0.;

159 
º_ödexed_d©a
[
OPIN_COST_INDEX
].
ba£_co°
 =

160 
dñay_n‹mÆiz©i⁄_Ác
;

162 #i‚de‡
SPEC


163 
º_ödexed_d©a
[
IPIN_COST_INDEX
].
ba£_co°
 =

164 0.95 * 
dñay_n‹mÆiz©i⁄_Ác
;

166 
º_ödexed_d©a
[
IPIN_COST_INDEX
].
ba£_co°
 =

167 
dñay_n‹mÆiz©i⁄_Ác
;

171 if(
ba£_co°_ty≥
 =
INTRINSIC_DELAY
)

173 
º_ödexed_d©a
[
SOURCE_COST_INDEX
].
ba£_co°
 = 0.;

174 
º_ödexed_d©a
[
SINK_COST_INDEX
].
ba£_co°
 = 0.;

175 
º_ödexed_d©a
[
OPIN_COST_INDEX
].
ba£_co°
 =

176 
	`gë_avîage_›ö_dñay
(
º_node_ödi˚s
, 
nodes_≥r_ch™
);

177 
º_ödexed_d©a
[
IPIN_COST_INDEX
].
ba£_co°
 =

178 
swôch_öf
[
wúe_to_ùö_swôch
].
Tdñ
;

183 
ödex
 = 
CHANX_COST_INDEX_START
; index < 
num_º_ödexed_d©a
; index++)

185 if(
ba£_co°_ty≥
 =
INTRINSIC_DELAY
)

186 
º_ödexed_d©a
[
ödex
].
ba£_co°
 =

187 
º_ödexed_d©a
[
ödex
].
T_löór
 +

188 
º_ödexed_d©a
[
ödex
].
T_quadøtic
;

193 
º_ödexed_d©a
[
ödex
].
ba£_co°
 = 
dñay_n‹mÆiz©i⁄_Ác
;

204 
ödex
 = 0; index < 
num_º_ödexed_d©a
; index++)

206 
º_ödexed_d©a
[
ödex
].
ßved_ba£_co°
 =

207 
º_ödexed_d©a
[
ödex
].
ba£_co°
;

209 
	}
}

213 
	$gë_dñay_n‹mÆiz©i⁄_Ác
(
nodes_≥r_ch™
,

214 
t_ivec
 *** 
º_node_ödi˚s
)

219 c⁄° 
˛b_di°
 = 3;

221 
öode
, 
ôøck
, 
co°_ödex
;

222 
Tdñ
, 
Tdñ_sum
, 
‰ac_num_£g
;

224 
Tdñ_sum
 = 0.;

226 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

228 
öode
 =

229 
	`gë_º_node_ödex
((
nx
 + 1Ë/ 2, (
ny
 + 1Ë/ 2, 
CHANX
, 
ôøck
,

230 
º_node_ödi˚s
);

231 
co°_ödex
 = 
º_node
[
öode
].cost_index;

232 
‰ac_num_£g
 = 
˛b_di°
 * 
º_ödexed_d©a
[
co°_ödex
].
öv_Àngth
;

233 
Tdñ
 = 
‰ac_num_£g
 * 
º_ödexed_d©a
[
co°_ödex
].
T_löór
 +

234 
‰ac_num_£g
 * frac_num_seg *

235 
º_ödexed_d©a
[
co°_ödex
].
T_quadøtic
;

236 
Tdñ_sum
 +
Tdñ
 / ()
˛b_di°
;

239 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

241 
öode
 =

242 
	`gë_º_node_ödex
((
nx
 + 1Ë/ 2, (
ny
 + 1Ë/ 2, 
CHANY
, 
ôøck
,

243 
º_node_ödi˚s
);

244 
co°_ödex
 = 
º_node
[
öode
].cost_index;

245 
‰ac_num_£g
 = 
˛b_di°
 * 
º_ödexed_d©a
[
co°_ödex
].
öv_Àngth
;

246 
Tdñ
 = 
‰ac_num_£g
 * 
º_ödexed_d©a
[
co°_ödex
].
T_löór
 +

247 
‰ac_num_£g
 * frac_num_seg *

248 
º_ödexed_d©a
[
co°_ödex
].
T_quadøtic
;

249 
Tdñ_sum
 +
Tdñ
 / ()
˛b_di°
;

252  (
Tdñ_sum
 / (2. * 
nodes_≥r_ch™
));

253 
	}
}

257 
	$gë_avîage_›ö_dñay
(
t_ivec
 *** 
º_node_ödi˚s
,

258 
nodes_≥r_ch™
)

264 
öode
, 
ùö
, 
i˛ass
, 
õdge
, 
ôy≥
, 
num_edges
, 
to_swôch
, 
to_node
,

265 
num_c⁄n
;

266 
Clﬂd
, 
Tdñ
;

268 
Tdñ
 = 0.;

269 
num_c⁄n
 = 0;

270 
ôy≥
 = 0;

271 
ôy≥
 < 
num_ty≥s
 && &
ty≥_des¸ùt‹s
[ôy≥] !
IO_TYPE
; itype++)

273 
ùö
 = 0; ipö < 
ty≥_des¸ùt‹s
[
ôy≥
].
num_pös
; ipin++)

275 
i˛ass
 = 
ty≥_des¸ùt‹s
[
ôy≥
].
pö_˛ass
[
ùö
];

276 if(
ty≥_des¸ùt‹s
[
ôy≥
].
˛ass_öf
[
i˛ass
].
ty≥
 ==

277 
DRIVER
)

279 
öode
 =

280 
	`gë_º_node_ödex
((
nx
 + 1Ë/ 2, (
ny
 + 1) / 2,

281 
OPIN
, 
ùö
,

282 
º_node_ödi˚s
);

283 
num_edges
 = 
º_node
[
öode
].num_edges;

285 
õdge
 = 0; iedgê< 
num_edges
; iedge++)

287 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

288 
to_swôch
 =

289 
º_node
[
öode
].
swôches
[
õdge
];

290 
Clﬂd
 = 
º_node
[
to_node
].
C
;

291 
Tdñ
 +=

292 
Clﬂd
 * 
swôch_öf
[
to_swôch
].
R
 +

293 
swôch_öf
[
to_swôch
].
Tdñ
;

294 
num_c⁄n
++;

300 
Tdñ
 /()
num_c⁄n
;

301  (
Tdñ
);

302 
	}
}

306 
	$lﬂd_º_ödexed_d©a_T_vÆues
(
ödex_°¨t
,

307 
num_ödi˚s_to_lﬂd
,

308 
t_º_ty≥
 
º_ty≥
,

309 
nodes_≥r_ch™
,

310 
t_ivec
 *** 
º_node_ödi˚s
,

311 
t_£gmít_öf
 * 
£gmít_öf
)

320 
ôøck
, 
i£g
, 
öode
, 
co°_ödex
, 
iswôch
;

321 *
C_tŸÆ
, *
R_tŸÆ
;

322 *
num_nodes_of_ödex
;

323 
Rnode
, 
Cnode
, 
Rsw
, 
Tsw
;

325 
num_nodes_of_ödex
 = (*)
	`my_ˇŒoc
(
num_º_ödexed_d©a
, ());

326 
C_tŸÆ
 = (*)
	`my_ˇŒoc
(
num_º_ödexed_d©a
, ());

327 
R_tŸÆ
 = (*)
	`my_ˇŒoc
(
num_º_ödexed_d©a
, ());

332 
ôøck
 = 0; iåack < 
nodes_≥r_ch™
; itrack++)

334 
öode
 =

335 
	`gë_º_node_ödex
((
nx
 + 1Ë/ 2, (
ny
 + 1Ë/ 2, 
º_ty≥
, 
ôøck
,

336 
º_node_ödi˚s
);

337 
co°_ödex
 = 
º_node
[
öode
].cost_index;

338 
num_nodes_of_ödex
[
co°_ödex
]++;

339 
C_tŸÆ
[
co°_ödex
] +
º_node
[
öode
].
C
;

340 
R_tŸÆ
[
co°_ödex
] +
º_node
[
öode
].
R
;

344 
co°_ödex
 = 
ödex_°¨t
;

345 
co°_ödex
 < 
ödex_°¨t
 + 
num_ödi˚s_to_lﬂd
; cost_index++)

348 if(
num_nodes_of_ödex
[
co°_ödex
] == 0)

350 
º_ödexed_d©a
[
co°_ödex
].
T_löór
 = 
OPEN
;

351 
º_ödexed_d©a
[
co°_ödex
].
T_quadøtic
 = 
OPEN
;

352 
º_ödexed_d©a
[
co°_ödex
].
C_lﬂd
 = 
OPEN
;

356 
Rnode
 =

357 
R_tŸÆ
[
co°_ödex
] / 
num_nodes_of_ödex
[cost_index];

358 
Cnode
 =

359 
C_tŸÆ
[
co°_ödex
] / 
num_nodes_of_ödex
[cost_index];

360 
i£g
 = 
º_ödexed_d©a
[
co°_ödex
].
£g_ödex
;

361 
iswôch
 = 
£gmít_öf
[
i£g
].
wúe_swôch
;

362 
Rsw
 = 
swôch_öf
[
iswôch
].
R
;

363 
Tsw
 = 
swôch_öf
[
iswôch
].
Tdñ
;

365 if(
swôch_öf
[
iswôch
].
buf„ªd
)

367 
º_ödexed_d©a
[
co°_ödex
].
T_löór
 =

368 
Tsw
 + 
Rsw
 * 
Cnode
 + 0.5 * 
Rnode
 * Cnode;

369 
º_ödexed_d©a
[
co°_ödex
].
T_quadøtic
 = 0.;

370 
º_ödexed_d©a
[
co°_ödex
].
C_lﬂd
 = 0.;

374 
º_ödexed_d©a
[
co°_ödex
].
C_lﬂd
 = 
Cnode
;

378 
º_ödexed_d©a
[
co°_ödex
].
T_löór
 =

379 
Tsw
 + 0.5 * 
Rsw
 * 
Cnode
;

380 
º_ödexed_d©a
[
co°_ödex
].
T_quadøtic
 =

381 (
Rsw
 + 
Rnode
Ë* 0.5 * 
Cnode
;

386 
	`‰ì
(
num_nodes_of_ödex
);

387 
	`‰ì
(
C_tŸÆ
);

388 
	`‰ì
(
R_tŸÆ
);

389 
	}
}

	@rr_graph_indexed_data.h

1 
Æloc_™d_lﬂd_º_ödexed_d©a
(
t_£gmít_öf
 * 
£gmít_öf
,

2 
num_£gmít
,

3 
t_ivec
 *** 
º_node_ödi˚s
,

4 
nodes_≥r_ch™
,

5 
wúe_to_ùö_swôch
,

6 
e_ba£_co°_ty≥
 
ba£_co°_ty≥
);

	@rr_graph_sbox.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"º_gøph_sbox.h
"

5 
	~"º_gøph_utû.h
"

29 
gë_sim∂e_swôch_block_åack
(
IN
 
e_side
 
‰om_side
,

30 
IN
 
e_side
 
to_side
,

31 
IN
 
‰om_åack
,

32 
IN
 
e_swôch_block_ty≥


33 
swôch_block_ty≥
,

34 
IN
 
nodes_≥r_ch™
);

36 
e_side
 
gë_sbox_side
(
IN
 
gë_i
,

37 
IN
 
gë_j
,

38 
IN
 
t_º_ty≥
 
gë_ty≥
,

39 
IN
 
comp_i
,

40 
IN
 
comp_j
);

46 
s_ivec
 ***

47 
	$Æloc_™d_lﬂd_swôch_block_c⁄n
(
IN
 
nodes_≥r_ch™
,

48 
IN
 

49 
e_swôch_block_ty≥
 
swôch_block_ty≥
,

50 
IN
 
Fs
)

52 
e_side
 
‰om_side
, 
to_side
;

53 
‰om_åack
;

54 
s_ivec
 ***
swôch_block_c⁄n
 = 
NULL
;

56 #ifde‡
CREATE_ECHO_FILES


57 
i
, 
j
, 
k
, 
l
;

58 
FILE
 *
out
;

62 
	`as£π
(3 =
Fs
);

64 
swôch_block_c⁄n
 =

65 (
s_ivec
 ***)
	`Æloc_m©rix3
(0, 3,

67 0, (
nodes_≥r_ch™
 - 1),

68 (
s_ivec
));

70 
‰om_side
 = 0; from_side < 4; from_side++)

72 
to_side
 = 0;Åo_side < 4;Åo_side++)

74 
‰om_åack
 = 0; from_åack < 
nodes_≥r_ch™
;

75 
‰om_åack
++)

77 if(
‰om_side
 !
to_side
)

79 
swôch_block_c⁄n
[
‰om_side
][
to_side
]

80 [
‰om_åack
].
√Àm
 = 1;

81 
swôch_block_c⁄n
[
‰om_side
][
to_side
]

82 [
‰om_åack
].
li°
 =

83 (*)
	`my_mÆloc
(());

85 
swôch_block_c⁄n
[
‰om_side
][
to_side
]

86 [
‰om_åack
].
li°
[0] =

87 
gë_sim∂e_swôch_block_åack


88 (
‰om_side
, 
to_side
, 
‰om_åack
,

89 
swôch_block_ty≥
, 
nodes_≥r_ch™
);

93 
swôch_block_c⁄n
[
‰om_side
][
to_side
]

94 [
‰om_åack
].
√Àm
 = 0;

95 
swôch_block_c⁄n
[
‰om_side
][
to_side
]

96 [
‰om_åack
].
li°
 = 
NULL
;

102 #ifde‡
CREATE_ECHO_FILES


103 
out
 = 
	`my_f›í
("switch_block_conn.echo", "w");

104 
l
 = 0;Ü < 4; ++l)

106 
k
 = 0; k < 4; ++k)

108 
	`Ârötf
(
out
, "Sidê%dÅÿ%d\n", 
l
, 
k
);

109 
j
 = 0; j < 
nodes_≥r_ch™
; ++j)

111 
	`Ârötf
(
out
, "%d: ", 
j
);

112 
i
 = 0; i < 
swôch_block_c⁄n
[
l
][
k
][
j
].
√Àm
;

113 ++
i
)

115 
	`Ârötf
(
out
, "%d ",

116 
swôch_block_c⁄n
[
l
][
k
][
j
].

117 
li°
[
i
]);

119 
	`Ârötf
(
out
, "\n");

121 
	`Ârötf
(
out
, "\n");

124 
	`f˛o£
(
out
);

127  
swôch_block_c⁄n
;

128 
	}
}

132 
	$‰ì_swôch_block_c⁄n
(
s_ivec
 ***
swôch_block_c⁄n
,

133 
nodes_≥r_ch™
)

137 
	`‰ì_ivec_m©rix3
(
swôch_block_c⁄n
, 0, 3, 0, 3, 0, 
nodes_≥r_ch™
 - 1);

138 
	}
}

141 
	#SBOX_ERROR
 -1

	)

149 
	$gë_sim∂e_swôch_block_åack
(
IN
 
e_side
 
‰om_side
,

150 
IN
 
e_side
 
to_side
,

151 
IN
 
‰om_åack
,

152 
IN
 
e_swôch_block_ty≥
 
swôch_block_ty≥
,

153 
IN
 
nodes_≥r_ch™
)

159 
to_åack
;

161 
to_åack
 = 
SBOX_ERROR
;

163 if(
swôch_block_ty≥
 =
SUBSET
)

165 
to_åack
 = 
‰om_åack
;

171 if(
swôch_block_ty≥
 =
WILTON
)

174 if(
‰om_side
 =
LEFT
)

177 if(
to_side
 =
RIGHT
)

179 
to_åack
 = 
‰om_åack
;

181 if(
to_side
 =
TOP
)

183 
to_åack
 =

184 (
nodes_≥r_ch™
 -

185 
‰om_åack
Ë% 
nodes_≥r_ch™
;

187 if(
to_side
 =
BOTTOM
)

189 
to_åack
 =

190 (
nodes_≥r_ch™
 + 
‰om_åack
 -

191 1Ë% 
nodes_≥r_ch™
;

195 if(
‰om_side
 =
RIGHT
)

197 if(
to_side
 =
LEFT
)

199 
to_åack
 = 
‰om_åack
;

201 if(
to_side
 =
TOP
)

203 
to_åack
 =

204 (
nodes_≥r_ch™
 + 
‰om_åack
 -

205 1Ë% 
nodes_≥r_ch™
;

207 if(
to_side
 =
BOTTOM
)

209 
to_åack
 =

210 (2 * 
nodes_≥r_ch™
 - 2 -

211 
‰om_åack
Ë% 
nodes_≥r_ch™
;

215 if(
‰om_side
 =
BOTTOM
)

217 if(
to_side
 =
TOP
)

219 
to_åack
 = 
‰om_åack
;

221 if(
to_side
 =
LEFT
)

223 
to_åack
 = (
‰om_åack
 + 1Ë% 
nodes_≥r_ch™
;

225 if(
to_side
 =
RIGHT
)

227 
to_åack
 =

228 (2 * 
nodes_≥r_ch™
 - 2 -

229 
‰om_åack
Ë% 
nodes_≥r_ch™
;

233 if(
‰om_side
 =
TOP
)

235 if(
to_side
 =
BOTTOM
)

237 
to_åack
 = 
‰om_åack
;

239 if(
to_side
 =
LEFT
)

241 
to_åack
 =

242 (
nodes_≥r_ch™
 -

243 
‰om_åack
Ë% 
nodes_≥r_ch™
;

245 if(
to_side
 =
RIGHT
)

247 
to_åack
 = (
‰om_åack
 + 1Ë% 
nodes_≥r_ch™
;

253 if(
swôch_block_ty≥
 =
UNIVERSAL
)

256 if(
‰om_side
 =
LEFT
)

259 if(
to_side
 =
RIGHT
)

261 
to_åack
 = 
‰om_åack
;

263 if(
to_side
 =
TOP
)

265 
to_åack
 = 
nodes_≥r_ch™
 - 1 - 
‰om_åack
;

267 if(
to_side
 =
BOTTOM
)

269 
to_åack
 = 
‰om_åack
;

273 if(
‰om_side
 =
RIGHT
)

275 if(
to_side
 =
LEFT
)

277 
to_åack
 = 
‰om_åack
;

279 if(
to_side
 =
TOP
)

281 
to_åack
 = 
‰om_åack
;

283 if(
to_side
 =
BOTTOM
)

285 
to_åack
 = 
nodes_≥r_ch™
 - 1 - 
‰om_åack
;

289 if(
‰om_side
 =
BOTTOM
)

291 if(
to_side
 =
TOP
)

293 
to_åack
 = 
‰om_åack
;

295 if(
to_side
 =
LEFT
)

297 
to_åack
 = 
‰om_åack
;

299 if(
to_side
 =
RIGHT
)

301 
to_åack
 = 
nodes_≥r_ch™
 - 1 - 
‰om_åack
;

305 if(
‰om_side
 =
TOP
)

307 if(
to_side
 =
BOTTOM
)

309 
to_åack
 = 
‰om_åack
;

311 if(
to_side
 =
LEFT
)

313 
to_åack
 = 
nodes_≥r_ch™
 - 1 - 
‰om_åack
;

315 if(
to_side
 =
RIGHT
)

317 
to_åack
 = 
‰om_åack
;

324 if(
swôch_block_ty≥
 =
FULL
)

326 
to_åack
 = 
‰om_åack
;

330 if(
to_åack
 =
SBOX_ERROR
)

332 
¥ötf


335 
‰om_side
, 
to_side
, 
swôch_block_ty≥
);

336 
	`exô
(1);

339  (
to_åack
);

340 
	}
}

	@rr_graph_sbox.h

1 
s_ivec
 
gë_swôch_box_åacks
(
IN
 
‰om_i
,

2 
IN
 
‰om_j
,

3 
IN
 
‰om_åack
,

4 
IN
 
t_º_ty≥
 
‰om_ty≥
,

5 
IN
 
to_i
,

6 
IN
 
to_j
,

7 
IN
 
t_º_ty≥
 
to_ty≥
,

8 
IN
 
s_ivec
 ***
swôch_block_c⁄n
);

10 
‰ì_swôch_block_c⁄n
(
s_ivec
 ***
swôch_block_c⁄n
,

11 
nodes_≥r_ch™
);

13 
s_ivec
 ***
Æloc_™d_lﬂd_swôch_block_c⁄n
(
nodes_≥r_ch™
,

14 
e_swôch_block_ty≥


15 
swôch_block_ty≥
,

16 
Fs
);

18 
gë_sim∂e_swôch_block_åack
(
e_side
 
‰om_side
,

19 
e_side
 
to_side
,

20 
‰om_åack
,

21 
e_swôch_block_ty≥
 
swôch_block_ty≥
,

22 
nodes_≥r_ch™
);

	@rr_graph_timing_params.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"º_gøph.h
"

6 
	~"º_gøph_utû.h
"

7 
	~"º_gøph2.h
"

8 
	~"º_gøph_timög_∑øms.h
"

16 
	$add_º_gøph_C_‰om_swôches
(
C_ùö_cblock
)

32 
öode
, 
õdge
, 
swôch_ödex
, 
to_node
, 
maxÀn
;

33 
icblock
, 
isblock
, 
i£g_low
, 
i£g_high
;

34 
Cö
, 
Cout
;

35 
t_º_ty≥
 
‰om_º_ty≥
, 
to_º_ty≥
;

36 
boﬁón
 *
cblock_cou¡ed
;

37 *
buf„r_Cö
;

38 
boﬁón
 
buf„ªd
;

39 *
Couts_to_add
;

41 
maxÀn
 = 
	`max
(
nx
, 
ny
) + 1;

42 
cblock_cou¡ed
 = (
boﬁón
 *Ë
	`my_ˇŒoc
(
maxÀn
, (boolean));

43 
buf„r_Cö
 = (*)
	`my_ˇŒoc
(
maxÀn
, ());

45 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

48 
‰om_º_ty≥
 = 
º_node
[
öode
].
ty≥
;

50 if(
‰om_º_ty≥
 =
CHANX
 || from_º_ty≥ =
CHANY
)

53 
õdge
 = 0; iedgê< 
º_node
[
öode
].
num_edges
; iedge++)

56 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

57 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

59 if(
to_º_ty≥
 =
CHANX
 ||Åo_º_ty≥ =
CHANY
)

62 
swôch_ödex
 =

63 
º_node
[
öode
].
swôches
[
õdge
];

64 
Cö
 = 
swôch_öf
[
swôch_ödex
].Cin;

65 
Cout
 = 
swôch_öf
[
swôch_ödex
].Cout;

66 
buf„ªd
 =

67 
swôch_öf
[
swôch_ödex
].
buf„ªd
;

86 if(!
buf„ªd
 && 
öode
 < 
to_node
)

88 
º_node
[
öode
].
C
 +
Cö
;

89 
º_node
[
to_node
].
C
 +
Cout
;

92 if(
buf„ªd
)

95 if(
º_node
[
to_node
].
drivîs
 !=

96 
SINGLE
)

100 
º_node
[
to_node
].
C
 +=

101 
Cout
;

103 
isblock
 =

104 
	`£g_ödex_of_sblock
(
öode
,

105 
to_node
);

106 
buf„r_Cö
[
isblock
] =

107 
	`max
(
buf„r_Cö
[
isblock
], 
Cö
);

112 if(
to_º_ty≥
 =
IPIN
)

120 
icblock
 =

121 
	`£g_ödex_of_cblock
(
‰om_º_ty≥
,

122 
to_node
);

123 if(
cblock_cou¡ed
[
icblock
] =
FALSE
)

125 
º_node
[
öode
].
C
 +
C_ùö_cblock
;

126 
cblock_cou¡ed
[
icblock
] = 
TRUE
;

144 if(
‰om_º_ty≥
 =
CHANX
)

146 
i£g_low
 = 
º_node
[
öode
].
xlow
;

147 
i£g_high
 = 
º_node
[
öode
].
xhigh
;

151 
i£g_low
 = 
º_node
[
öode
].
ylow
;

152 
i£g_high
 = 
º_node
[
öode
].
yhigh
;

155 
icblock
 = 
i£g_low
; icblock <
i£g_high
; icblock++)

157 
cblock_cou¡ed
[
icblock
] = 
FALSE
;

160 
isblock
 = 
i£g_low
 - 1; isblock <
i£g_high
;

161 
isblock
++)

163 
º_node
[
öode
].
C
 +
buf„r_Cö
[
isblock
];

164 
buf„r_Cö
[
isblock
] = 0.;

169 if(
‰om_º_ty≥
 =
OPIN
)

172 
õdge
 = 0; iedgê< 
º_node
[
öode
].
num_edges
; iedge++)

174 
swôch_ödex
 = 
º_node
[
öode
].
swôches
[
õdge
];

176 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

177 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

178 
	`as£π
(
to_º_ty≥
 =
CHANX


179 || 
to_º_ty≥
 =
CHANY
);

180 if(
º_node
[
to_node
].
drivîs
 !
SINGLE
)

182 
Cout
 = 
swôch_öf
[
swôch_ödex
].Cout;

183 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

184 
º_node
[
to_node
].
C
 +
Cout
;

195 
Couts_to_add
 = (*)
	`my_ˇŒoc
(
num_º_nodes
, ());

196 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

198 
õdge
 = 0; iedgê< 
º_node
[
öode
].
num_edges
; iedge++)

200 
swôch_ödex
 = 
º_node
[
öode
].
swôches
[
õdge
];

201 
to_node
 = 
º_node
[
öode
].
edges
[
õdge
];

202 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

203 if(
to_º_ty≥
 =
CHANX
 ||Åo_º_ty≥ =
CHANY
)

205 if(
º_node
[
to_node
].
drivîs
 =
SINGLE
)

208 if(
Couts_to_add
[
to_node
] != 0)

213 if(
Couts_to_add
[
to_node
] !=

214 
swôch_öf
[
swôch_ödex
].
Cout
)

216 
¥ötf


218 
to_node
,

219 
Couts_to_add


220 [
to_node
],

221 
swôch_öf


222 [
swôch_ödex
].
Cout
);

223 
	`exô
(1);

226 
Couts_to_add
[
to_node
] =

227 
swôch_öf
[
swôch_ödex
].
Cout
;

233 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

235 
º_node
[
öode
].
C
 +
Couts_to_add
[inode];

237 
	`‰ì
(
Couts_to_add
);

238 
	`‰ì
(
cblock_cou¡ed
);

239 
	`‰ì
(
buf„r_Cö
);

240 
	}
}

	@rr_graph_timing_params.h

1 
add_º_gøph_C_‰om_swôches
(
C_ùö_cblock
);

	@rr_graph_util.c

1 
	~"utû.h
"

2 
	~"v¥_ty≥s.h
"

3 
	~"globÆs.h
"

4 
	~"º_gøph_utû.h
"

9 
t_löked_edge
 *

10 
	$ö£π_ö_edge_li°
(
IN
 
t_löked_edge
 * 
hód
,

11 
IN
 
edge
,

12 
IN
 
iswôch
)

20 
t_löked_edge
 *
löked_edge
;

22 
löked_edge
 = (
t_löked_edge
 *Ë
	`my_mÆloc
((t_linked_edge));

24 
löked_edge
->
edge
 =Édge;

25 
löked_edge
->
iswôch
 = iswitch;

26 
löked_edge
->
√xt
 = 
hód
;

28  
löked_edge
;

29 
	}
}

33 
	$‰ì_löked_edge_so·
(
INOUT
 
t_löked_edge
 * 
edge_±r
,

34 
INOUT
 
t_löked_edge
 ** 
‰ì_li°_hód_±r
)

41 
edge_±r
->
√xt
 = *
‰ì_li°_hód_±r
;

42 *
‰ì_li°_hód_±r
 = 
edge_±r
;

43 
	}
}

48 
	$£g_ödex_of_cblock
(
t_º_ty≥
 
‰om_º_ty≥
,

49 
to_node
)

55 if(
‰om_º_ty≥
 =
CHANX
)

56  (
º_node
[
to_node
].
xlow
);

58  (
º_node
[
to_node
].
ylow
);

59 
	}
}

63 
	$£g_ödex_of_sblock
(
‰om_node
,

64 
to_node
)

74 
t_º_ty≥
 
‰om_º_ty≥
, 
to_º_ty≥
;

76 
‰om_º_ty≥
 = 
º_node
[
‰om_node
].
ty≥
;

77 
to_º_ty≥
 = 
º_node
[
to_node
].
ty≥
;

79 if(
‰om_º_ty≥
 =
CHANX
)

81 if(
to_º_ty≥
 =
CHANY
)

83  (
º_node
[
to_node
].
xlow
);

85 if(
to_º_ty≥
 =
CHANX
)

87 if(
º_node
[
to_node
].
xlow
 >Ñr_node[
‰om_node
].xlow)

89  (
º_node
[
‰om_node
].
xhigh
);

93  (
º_node
[
to_node
].
xhigh
);

98 
¥ötf


100 
to_node
, 
to_º_ty≥
);

101 
	`exô
(1);

105 if(
‰om_º_ty≥
 =
CHANY
)

107 if(
to_º_ty≥
 =
CHANX
)

109  (
º_node
[
to_node
].
ylow
);

111 if(
to_º_ty≥
 =
CHANY
)

113 if(
º_node
[
to_node
].
ylow
 >Ñr_node[
‰om_node
].ylow)

115  (
º_node
[
‰om_node
].
yhigh
);

119  (
º_node
[
to_node
].
yhigh
);

124 
¥ötf


126 
to_node
, 
to_º_ty≥
);

127 
	`exô
(1);

133 
¥ötf


135 
‰om_node
, 
‰om_º_ty≥
);

136 
	`exô
(1);

138 
	}
}

	@rr_graph_util.h

1 
	ss_löked_edge


3 
	medge
;

4 
	miswôch
;

5 
s_löked_edge
 *
	m√xt
;

7 
s_löked_edge
 
	tt_löked_edge
;

10 
t_löked_edge
 *
ö£π_ö_edge_li°
—_löked_edgê* 
hód
,

11 
edge
,

12 
iswôch
);

14 
‰ì_löked_edge_so·
(
t_löked_edge
 * 
edge_±r
,

15 
t_löked_edge
 ** 
‰ì_li°_hód_±r
);

17 
£g_ödex_of_cblock
(
t_º_ty≥
 
‰om_º_ty≥
,

18 
to_node
);

20 
£g_ödex_of_sblock
(
‰om_node
,

21 
to_node
);

	@segment_stats.c

1 
	~<°dio.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"£gmít_°©s.h
"

10 
	#LONGLINE
 0

	)

18 
	$gë_£gmít_ußge_°©s
(
num_£gmít
,

19 
t_£gmít_öf
 * 
£gmít_öf
)

28 
öode
, 
Àngth
, 
£g_ty≥
, 
max_£gmít_Àngth
, 
co°_ödex
;

29 *
£g_occ_by_Àngth
, *
£g_ˇp_by_Àngth
;

30 *
£g_occ_by_ty≥
, *
£g_ˇp_by_ty≥
;

31 
utûiz©i⁄
;

34 
max_£gmít_Àngth
 = 0;

35 
£g_ty≥
 = 0; seg_ty≥ < 
num_£gmít
; seg_type++)

37 if(
£gmít_öf
[
£g_ty≥
].
l⁄glöe
 =
FALSE
)

38 
max_£gmít_Àngth
 = 
	`max
(max_segment_length,

39 
£gmít_öf
[
£g_ty≥
].
Àngth
);

42 
£g_occ_by_Àngth
 = (*)
	`my_ˇŒoc
((
max_£gmít_Àngth
 + 1),

44 
£g_ˇp_by_Àngth
 = (*)
	`my_ˇŒoc
((
max_£gmít_Àngth
 + 1),

47 
£g_occ_by_ty≥
 = (*)
	`my_ˇŒoc
(
num_£gmít
, ());

48 
£g_ˇp_by_ty≥
 = (*)
	`my_ˇŒoc
(
num_£gmít
, ());

51 
öode
 = 0; inodê< 
num_º_nodes
; inode++)

53 if(
º_node
[
öode
].
ty≥
 =
CHANX
 ||Ñr_node[öode].ty≥ =
CHANY
)

55 
co°_ödex
 = 
º_node
[
öode
].cost_index;

56 
£g_ty≥
 = 
º_ödexed_d©a
[
co°_ödex
].
£g_ödex
;

58 if(!
£gmít_öf
[
£g_ty≥
].
l⁄glöe
)

59 
Àngth
 = 
£gmít_öf
[
£g_ty≥
].length;

61 
Àngth
 = 
LONGLINE
;

63 
£g_occ_by_Àngth
[
Àngth
] +
º_node
[
öode
].
occ
;

64 
£g_ˇp_by_Àngth
[
Àngth
] +
º_node
[
öode
].
ˇ∑côy
;

65 
£g_occ_by_ty≥
[
£g_ty≥
] +
º_node
[
öode
].
occ
;

66 
£g_ˇp_by_ty≥
[
£g_ty≥
] +
º_node
[
öode
].
ˇ∑côy
;

71 
	`¥ötf
("\nSegment usage byÅype (index):\n");

72 
	`¥ötf
("SegmentÅype Fractional utilization\n");

73 
	`¥ötf
("------------ ----------------------\n");

75 
£g_ty≥
 = 0; seg_ty≥ < 
num_£gmít
; seg_type++)

77 if(
£g_ˇp_by_ty≥
[
£g_ty≥
] != 0)

79 
utûiz©i⁄
 = ()
£g_occ_by_ty≥
[
£g_ty≥
] /

80 ()
£g_ˇp_by_ty≥
[
£g_ty≥
];

81 
	`¥ötf
("%8d %5.3g\n", 
£g_ty≥
,

82 
utûiz©i⁄
);

87 
	`¥ötf
("\nSegment usage byÜength:\n");

88 
	`¥ötf
("SegmentÜength Fractional utilization\n");

89 
	`¥ötf
("-------------- ----------------------\n");

92 
Àngth
 = 1;Üígth <
max_£gmít_Àngth
;Üength++)

94 if(
£g_ˇp_by_Àngth
[
Àngth
] != 0)

96 
utûiz©i⁄
 = ()
£g_occ_by_Àngth
[
Àngth
] /

97 ()
£g_ˇp_by_Àngth
[
Àngth
];

98 
	`¥ötf
("%9d %5.3g\n", 
Àngth
,

99 
utûiz©i⁄
);

103 if(
£g_ˇp_by_Àngth
[
LONGLINE
] != 0)

105 
utûiz©i⁄
 = ()
£g_occ_by_Àngth
[
LONGLINE
] /

106 ()
£g_ˇp_by_Àngth
[
LONGLINE
];

107 
	`¥ötf
("Ü⁄glöê %5.3g\n", 
utûiz©i⁄
);

111 
	`‰ì
(
£g_occ_by_Àngth
);

112 
	`‰ì
(
£g_ˇp_by_Àngth
);

113 
	`‰ì
(
£g_occ_by_ty≥
);

114 
	`‰ì
(
£g_ˇp_by_ty≥
);

115 
	}
}

	@segment_stats.h

1 
gë_£gmít_ußge_°©s
(
num_£gmít
,

2 
t_£gmít_öf
 * 
£gmít_öf
);

	@stats.c

1 
	~<as£π.h
>

2 
	~<°dio.h
>

3 
	~<m©h.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"globÆs.h
"

7 
	~"º_gøph_¨ó.h
"

8 
	~"£gmít_°©s.h
"

9 
	~"°©s.h
"

10 
	~"√t_dñay.h
"

11 
	~"∑th_dñay.h
"

16 
lﬂd_ch™√l_occu∑ncõs
(**
ch™x_occ
,

17 **
ch™y_occ
);

19 
gë_num_bíds_™d_Àngth
(
öë
,

20 *
bíds
,

21 *
Àngth
,

22 *
£gmíts
);

24 
gë_Àngth_™d_bíds_°©s
();

26 
gë_ch™√l_occu∑ncy_°©s
();

34 
	$routög_°©s
(
boﬁón
 
fuŒ_°©s
,

35 
e_rouã_ty≥
 
rouã_ty≥
,

36 
num_swôch
,

37 
t_£gmít_öf
 * 
£gmít_öf
,

38 
num_£gmít
,

39 
R_möW_nmos
,

40 
R_möW_pmos
,

41 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

42 
boﬁón
 
timög_™Æysis_íabÀd
,

43 **
√t_¶ack
,

44 **
√t_dñay
,

45 
t_subblock_d©a
 
subblock_d©a
)

51 
T_¸ô
;

54 
	`gë_Àngth_™d_bíds_°©s
();

55 
	`gë_ch™√l_occu∑ncy_°©s
();

57 
	`¥ötf
("Logic Area (in minimum widthÅransistoráreas):\n");

58 
	`¥ötf
("Total Logic Area: %g Per 1x1ÜogicÅile: %g\n",

59 
nx
 * 
ny
 * 
grid_logic_tûe_¨ó
, grid_logic_tile_area);

61 if(
rouã_ty≥
 =
DETAILED
)

63 
	`cou¡_routög_å™si°‹s
(
dúe˘i⁄Æôy
, 
num_swôch
, 
£gmít_öf
,

64 
R_möW_nmos
, 
R_möW_pmos
);

65 
	`gë_£gmít_ußge_°©s
(
num_£gmít
, 
£gmít_öf
);

67 if(
timög_™Æysis_íabÀd
)

69 
	`lﬂd_√t_dñay_‰om_routög
(
√t_dñay
);

71 #ifde‡
CREATE_ECHO_FILES


72 
	`¥öt_√t_dñay
(
√t_dñay
, "net_delay.echo");

75 
	`lﬂd_timög_gøph_√t_dñays
(
√t_dñay
);

76 
T_¸ô
 = 
	`lﬂd_√t_¶ack
(
√t_¶ack
, 0);

78 #ifde‡
CREATE_ECHO_FILES


79 
	`¥öt_timög_gøph
("timing_graph.echo");

80 
	`¥öt_√t_¶ack
("√t_¶ack.echo", 
√t_¶ack
);

81 
	`¥öt_¸ôiˇl_∑th
("¸ôiˇl_∑th.echo", 
subblock_d©a
);

84 
	`¥ötf
("\n");

85 
	`¥ötf
("Crôiˇ»P©h: %g (s)\n", 
T_¸ô
);

89 if(
fuŒ_°©s
 =
TRUE
)

90 
	`¥öt_wúñí_¥ob_di°
();

91 
	}
}

95 
	$gë_Àngth_™d_bíds_°©s
()

101 
öë
, 
bíds
, 
tŸÆ_bíds
, 
max_bíds
;

102 
Àngth
, 
tŸÆ_Àngth
, 
max_Àngth
;

103 
£gmíts
, 
tŸÆ_£gmíts
, 
max_£gmíts
;

104 
av_bíds
, 
av_Àngth
, 
av_£gmíts
;

105 
num_globÆ_√ts
;

108 
max_bíds
 = 0;

109 
tŸÆ_bíds
 = 0;

110 
max_Àngth
 = 0;

111 
tŸÆ_Àngth
 = 0;

112 
max_£gmíts
 = 0;

113 
tŸÆ_£gmíts
 = 0;

114 
num_globÆ_√ts
 = 0;

116 
öë
 = 0; i√à< 
num_√ts
; inet++)

118 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

120 
	`gë_num_bíds_™d_Àngth
(
öë
, &
bíds
, &
Àngth
,

121 &
£gmíts
);

123 
tŸÆ_bíds
 +
bíds
;

124 
max_bíds
 = 
	`max
(
bíds
, max_bends);

126 
tŸÆ_Àngth
 +
Àngth
;

127 
max_Àngth
 = 
	`max
(
Àngth
, max_length);

129 
tŸÆ_£gmíts
 +
£gmíts
;

130 
max_£gmíts
 = 
	`max
(
£gmíts
, max_segments);

134 
num_globÆ_√ts
++;

139 
av_bíds
 = ()
tŸÆ_bíds
 / ()(
num_√ts
 - 
num_globÆ_√ts
);

140 
¥ötf


142 
av_bíds
, 
max_bíds
);

144 
av_Àngth
 = ()
tŸÆ_Àngth
 / ()(
num_√ts
 - 
num_globÆ_√ts
);

145 
	`¥ötf
("\nTheÇumber ofÑoutedÇets (nonglobal): %d\n",

146 
num_√ts
 - 
num_globÆ_√ts
);

147 
	`¥ötf
("WirelengthÑesults (all in units of 1 clb segments):\n");

148 
	`¥ötf
("\tTotal wirelength: %d AverageÇetÜength: %#g\n",

149 
tŸÆ_Àngth
, 
av_Àngth
);

150 
	`¥ötf
("\tMaximumÇëÜígth: %d\n\n", 
max_Àngth
);

152 
av_£gmíts
 = ()
tŸÆ_£gmíts
 / ()(
num_√ts
 - 
num_globÆ_√ts
);

153 
	`¥ötf
("WirelengthÑesults inÅerms ofÖhysical segments:\n");

154 
	`¥ötf
("\tTotal wiring segments used: %d Av. wire segmentsÖerÇet: "

155 "%#g\n", 
tŸÆ_£gmíts
, 
av_£gmíts
);

156 
	`¥ötf
("\tMaximum segmít†u£d byáÇë: %d\n\n", 
max_£gmíts
);

157 
	}
}

161 
	$gë_ch™√l_occu∑ncy_°©s
()

166 
i
, 
j
, 
max_occ
, 
tŸÆ_x
, 
tŸÆ_y
;

167 
av_occ
;

168 **
ch™x_occ
;

169 **
ch™y_occ
;

172 
ch™x_occ
 = (**)
	`Æloc_m©rix
(1, 
nx
, 0, 
ny
, ());

173 
ch™y_occ
 = (**)
	`Æloc_m©rix
(0, 
nx
, 1, 
ny
, ());

174 
	`lﬂd_ch™√l_occu∑ncõs
(
ch™x_occ
, 
ch™y_occ
);

176 
	`¥ötf
("\nX - Directed channels:\n\n");

177 
	`¥ötf
("j\tmax occ\tav_occ\t\tcapacity\n");

179 
tŸÆ_x
 = 0;

181 
j
 = 0; j <
ny
; j++)

183 
tŸÆ_x
 +
ch™_width_x
[
j
];

184 
av_occ
 = 0.;

185 
max_occ
 = -1;

187 
i
 = 1; i <
nx
; i++)

189 
max_occ
 = 
	`max
(
ch™x_occ
[
i
][
j
], max_occ);

190 
av_occ
 +
ch™x_occ
[
i
][
j
];

192 
av_occ
 /
nx
;

193 
	`¥ötf
("%d\t%d\t%-#9g\t%d\n", 
j
, 
max_occ
, 
av_occ
,

194 
ch™_width_x
[
j
]);

198 
	`¥ötf
("\nY - Directed channels:\n\n");

199 
	`¥ötf
("i\tmax occ\tav_occ\t\tcapacity\n");

201 
tŸÆ_y
 = 0;

203 
i
 = 0; i <
nx
; i++)

205 
tŸÆ_y
 +
ch™_width_y
[
i
];

206 
av_occ
 = 0.;

207 
max_occ
 = -1;

209 
j
 = 1; j <
ny
; j++)

211 
max_occ
 = 
	`max
(
ch™y_occ
[
i
][
j
], max_occ);

212 
av_occ
 +
ch™y_occ
[
i
][
j
];

214 
av_occ
 /
ny
;

215 
	`¥ötf
("%d\t%d\t%-#9g\t%d\n", 
i
, 
max_occ
, 
av_occ
,

216 
ch™_width_y
[
i
]);

219 
	`¥ötf
("\nTotal Tracks in X-direction: %d in Y-direction: %d\n\n",

220 
tŸÆ_x
, 
tŸÆ_y
);

222 
	`‰ì_m©rix
(
ch™x_occ
, 1, 
nx
, 0, ());

223 
	`‰ì_m©rix
(
ch™y_occ
, 0, 
nx
, 1, ());

224 
	}
}

228 
	$lﬂd_ch™√l_occu∑ncõs
(**
ch™x_occ
,

229 **
ch™y_occ
)

235 
i
, 
j
, 
öode
, 
öë
;

236 
s_åa˚
 *
çå
;

237 
t_º_ty≥
 
º_ty≥
;

241 
i
 = 1; i <
nx
; i++)

242 
j
 = 0; j <
ny
; j++)

243 
ch™x_occ
[
i
][
j
] = 0;

245 
i
 = 0; i <
nx
; i++)

246 
j
 = 1; j <
ny
; j++)

247 
ch™y_occ
[
i
][
j
] = 0;

251 
öë
 = 0; i√à< 
num_√ts
; inet++)

254 if(
√t
[
öë
].
is_globÆ
)

257 
çå
 = 
åa˚_hód
[
öë
];

258 
çå
 !
NULL
)

260 
öode
 = 
çå
->
ödex
;

261 
º_ty≥
 = 
º_node
[
öode
].
ty≥
;

263 if(
º_ty≥
 =
SINK
)

265 
çå
 =Å±r->
√xt
;

266 if(
çå
 =
NULL
)

270 if(
º_ty≥
 =
CHANX
)

272 
j
 = 
º_node
[
öode
].
ylow
;

273 
i
 = 
º_node
[
öode
].
xlow
;

274 
i
 <
º_node
[
öode
].
xhigh
; i++)

275 
ch™x_occ
[
i
][
j
]++;

278 if(
º_ty≥
 =
CHANY
)

280 
i
 = 
º_node
[
öode
].
xlow
;

281 
j
 = 
º_node
[
öode
].
ylow
;

282 
j
 <
º_node
[
öode
].
yhigh
; j++)

283 
ch™y_occ
[
i
][
j
]++;

286 
çå
 =Å±r->
√xt
;

289 
	}
}

293 
	$gë_num_bíds_™d_Àngth
(
öë
,

294 *
bíds_±r
,

295 *
Àn_±r
,

296 *
£gmíts_±r
)

302 
s_åa˚
 *
çå
, *
¥ev±r
;

303 
öode
;

304 
t_º_ty≥
 
cuº_ty≥
, 
¥ev_ty≥
;

305 
bíds
, 
Àngth
, 
£gmíts
;

307 
bíds
 = 0;

308 
Àngth
 = 0;

309 
£gmíts
 = 0;

311 
¥ev±r
 = 
åa˚_hód
[
öë
];

312 if(
¥ev±r
 =
NULL
)

314 
¥ötf


316 
öë
);

317 
	`exô
(1);

319 
öode
 = 
¥ev±r
->
ödex
;

320 
¥ev_ty≥
 = 
º_node
[
öode
].
ty≥
;

322 
çå
 = 
¥ev±r
->
√xt
;

324 
çå
 !
NULL
)

326 
öode
 = 
çå
->
ödex
;

327 
cuº_ty≥
 = 
º_node
[
öode
].
ty≥
;

329 if(
cuº_ty≥
 =
SINK
)

331 
çå
 =Å±r->
√xt
;

332 if(
çå
 =
NULL
)

335 
cuº_ty≥
 = 
º_node
[
çå
->
ödex
].
ty≥
;

338 if(
cuº_ty≥
 =
CHANX
 || cuº_ty≥ =
CHANY
)

340 
£gmíts
++;

341 
Àngth
 +1 + 
º_node
[
öode
].
xhigh
 -Ñr_node[öode].
xlow
 +

342 
º_node
[
öode
].
yhigh
 -Ñr_node[öode].
ylow
;

344 if(
cuº_ty≥
 !
¥ev_ty≥


345 && (
¥ev_ty≥
 =
CHANX
 ||Öªv_ty≥ =
CHANY
))

346 
bíds
++;

349 
¥ev_ty≥
 = 
cuº_ty≥
;

350 
çå
 =Å±r->
√xt
;

353 *
bíds_±r
 = 
bíds
;

354 *
Àn_±r
 = 
Àngth
;

355 *
£gmíts_±r
 = 
£gmíts
;

356 
	}
}

360 
	$¥öt_wúñí_¥ob_di°
()

367 *
¥ob_di°
;

368 
n‹m_Ác
, 
two_poöt_Àngth
;

369 
öë
, 
bíds
, 
Àngth
, 
£gmíts
, 
ödex
;

370 
av_Àngth
;

371 
¥ob_di°_size
, 
i
, 
ö¸
;

373 
¥ob_di°_size
 = 
nx
 + 
ny
 + 10;

374 
¥ob_di°
 = (*)
	`my_ˇŒoc
(
¥ob_di°_size
, ());

375 
n‹m_Ác
 = 0.;

377 
öë
 = 0; i√à< 
num_√ts
; inet++)

379 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

381 
	`gë_num_bíds_™d_Àngth
(
öë
, &
bíds
, &
Àngth
,

382 &
£gmíts
);

388 
two_poöt_Àngth
 =

389 ()
Àngth
 / ()(
√t
[
öë
].
num_söks
);

390 
ödex
 = ()
two_poöt_Àngth
;

391 if(
ödex
 >
¥ob_di°_size
)

394 
¥ötf


396 
ödex
, 
¥ob_di°_size
);

397 
¥ötf


399 
ö¸
 = 
ödex
 - 
¥ob_di°_size
 + 2;

400 
¥ob_di°_size
 +
ö¸
;

401 
¥ob_di°
 =

402 
	`my_ªÆloc
(
¥ob_di°
,

403 
¥ob_di°_size
 * ());

404 
i
 = 
¥ob_di°_size
 - 
ö¸
; i <Örob_dist_size;

405 
i
++)

406 
¥ob_di°
[
i
] = 0.0;

408 
¥ob_di°
[
ödex
] +=

409 (
√t
[
öë
].
num_söks
Ë* (1 - 
two_poöt_Àngth
 +

410 
ödex
);

412 
ödex
++;

413 if(
ödex
 >
¥ob_di°_size
)

416 
¥ötf


418 
ödex
, 
¥ob_di°_size
);

419 
¥ötf


421 
ö¸
 = 
ödex
 - 
¥ob_di°_size
 + 2;

422 
¥ob_di°_size
 +
ö¸
;

423 
¥ob_di°
 =

424 
	`my_ªÆloc
(
¥ob_di°
,

425 
¥ob_di°_size
 * ());

426 
i
 = 
¥ob_di°_size
 - 
ö¸
; i <Örob_dist_size;

427 
i
++)

428 
¥ob_di°
[
i
] = 0.0;

430 
¥ob_di°
[
ödex
] +(
√t
[
öë
].
num_söks
) * (1 - index +

431 
two_poöt_Àngth
);

433 
n‹m_Ác
 +
√t
[
öë
].
num_söks
;

439 
	`¥ötf
("\nProbability distribution of 2-pinÇetÜengths:\n\n");

440 
	`¥ötf
("LengthÖ(Lenth)\n");

442 
av_Àngth
 = 0;

444 
ödex
 = 0; index < 
¥ob_di°_size
; index++)

446 
¥ob_di°
[
ödex
] /
n‹m_Ác
;

447 
	`¥ötf
("%6d %10.6f\n", 
ödex
, 
¥ob_di°
[index]);

448 
av_Àngth
 +
¥ob_di°
[
ödex
] * index;

451 
	`¥ötf
("\nThênumbî o‡2-pöÇë†i†;%g;\n", 
n‹m_Ác
);

452 
	`¥ötf
("\nEx≥˘ed vÆuêo‡2-pöÇëÜígth (RËi†;%g;\n", 
av_Àngth
);

453 
	`¥ötf
("\nTŸÆ wúêÀngth i†;%g;\n", 
n‹m_Ác
 * 
av_Àngth
);

455 
	`‰ì
(
¥ob_di°
);

456 
	}
}

460 
	$¥öt_œmbda
()

467 
bnum
, 
ùö
;

468 
num_öputs_u£d
 = 0;

469 
i˛ass
, 
öë
;

470 
œmbda
;

471 
t_ty≥_±r
 
ty≥
;

473 
bnum
 = 0; bnum < 
num_blocks
; bnum++)

475 
ty≥
 = 
block
[
bnum
].type;

476 
	`as£π
(
ty≥
 !
NULL
);

477 if(
ty≥
 !
IO_TYPE
)

479 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ipin++)

481 
i˛ass
 = 
ty≥
->
pö_˛ass
[
ùö
];

482 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
RECEIVER
)

484 
öë
 = 
block
[
bnum
].
√ts
[
ùö
];

485 if(
öë
 !
OPEN
)

486 if(
√t
[
öë
].
is_globÆ
 =
FALSE
)

487 
num_öputs_u£d
++;

493 
œmbda
 = ()
num_öputs_u£d
 / ()
num_blocks
;

494 
	`¥ötf
("Avîagêœmbd®(öpuàpö†u£dÖî fbËis: %g\n", 
œmbda
);

495 
	}
}

	@stats.h

1 
routög_°©s
(
boﬁón
 
fuŒ_°©s
,

2 
e_rouã_ty≥
 
rouã_ty≥
,

3 
num_swôch
,

4 
t_£gmít_öf
 * 
£gmít_öf
,

5 
num_£gmít
,

6 
R_möW_nmos
,

7 
R_möW_pmos
,

8 
e_dúe˘i⁄Æôy
 
dúe˘i⁄Æôy
,

9 
boﬁón
 
timög_™Æysis_íabÀd
,

10 **
√t_¶ack
,

11 **
√t_dñay
,

12 
t_subblock_d©a
 
subblock_d©a
);

14 
¥öt_wúñí_¥ob_di°
();

16 
¥öt_œmbda
();

	@temp.c

2 
	$RódFixPös
(
IN
 c⁄° *c⁄° *
Args
,

3 
OUT
 **
PöFûe
)

5 
e_O±i⁄ArgTokí
 
Tokí
;

6 
Lí
;

7 c⁄° *c⁄° *
PªvArgs
 = 
Args
;

9 
Args
 = 
	`RódTokí
(Args, &
Tokí
);

10 if(
OT_RANDOM
 !
Tokí
)

12 
Lí
 = 1 + 
	`°æí
(*
PªvArgs
);

13 *
PöFûe
 = (*)
	`my_mÆloc
(
Lí
 * ());

14 
	`mem˝y
(*
PöFûe
, *
PªvArgs
, 
Lí
);

16  
Args
;

17 
	}
}

	@test_h.c

6 
	~"utû.h
"

7 
	~"v¥_ty≥s.h
"

8 
	~"globÆs.h
"

9 
	~"check_rouã.h
"

10 
	~"døw.h
"

11 
	~"gøphics.h
"

12 
	~"hash.h
"

13 
	~"hóps‹t.h
"

14 
	~"∂a˚.h
"

15 
	~"∂a˚_™d_rouã.h
"

16 
	~"ªad_√éi°.h
"

17 
	~"¥öt_√éi°.h
"

18 
	~"check_√éi°.h
"

19 
	~"ªad_∂a˚.h
"

20 
	~"m°.h
"

21 
	~"rouã_exp‹t.h
"

22 
	~"rouã_comm⁄.h
"

23 
	~"rouã_bªadth_fú°.h
"

24 
	~"rouã_åì_timög.h
"

25 
	~"rouã_timög.h
"

26 
	~"º_gøph.h
"

27 
	~"º_gøph_utû.h
"

28 
	~"º_gøph2.h
"

29 
	~"º_gøph_sbox.h
"

30 
	~"º_gøph_timög_∑øms.h
"

31 
	~"º_gøph_ödexed_d©a.h
"

32 
	~"º_gøph_¨ó.h
"

33 
	~"check_º_gøph.h
"

34 
	~"°©s.h
"

35 
	~"£gmít_°©s.h
"

36 
	~"√t_dñay.h
"

37 
	~"∑th_dñay.h
"

38 
	~"∑th_dñay2.h
"

39 
	~"v¥_utûs.h
"

40 
	~"timög_∂a˚_lookup.h
"

41 
	~"timög_∂a˚.h
"

42 
	~"RódO±i⁄s.h
"

43 
	~"RódArch.h
"

44 
	~"O±i⁄Tokís.h
"

45 
	~"ArchTokís.h
"

46 
	~"SëupVPR.h
"

	@testing.c

1 
	~"utû.h
"

2 
	~"v¥_ty≥s.h
"

3 
	~"globÆs_de˛¨e.h
"

4 
	~"ªad_¨ch.h
"

5 
	~"º_gøph.h
"

6 
	~"døw.h
"

7 
	~"gøphics.h
"

8 
	~<as£π.h
>

11 
	$maö
()

13 
msg
[
BUFSIZE
] = "This isáÅest.";

14 
s_dë_routög_¨ch
 
dë_routög_¨ch
;

15 
t_£gmít_öf
 *
£gmít_öf
;

16 
t_timög_öf
 
timög_öf
;

17 
t_subblock_d©a
 
subblock_d©a
;

18 
t_ch™_width_di°
 
ch™_width_di°
;

19 
nodes_≥r_ch™
;

20 
i
, 
j
;

22 
	`ªad_¨ch
("ã°.¨ch", 
DETAILED
, &
dë_routög_¨ch
, &
£gmít_öf
,

23 &
timög_öf
, &
subblock_d©a
, &
ch™_width_di°
);

25 
	`¥öt_¨ch
("ã°.¨ch", 
DETAILED
, 
dë_routög_¨ch
, 
£gmít_öf
,

26 
timög_öf
, 
subblock_d©a
, 
ch™_width_di°
);

28 
num_˛bs
 = 64;

29 
	`öô_¨ch
(1., 
FALSE
);

30 
	`¥ötf
("nx = %d;Çy = %d\n", 
nx
, 
ny
);

32 
	`¥ötf
("Setting Nodes Per Channel ...\n");

34 
nodes_≥r_ch™
 = 8;

35 
i
 = 0; i < 
nx
 + 1; i++)

36 
ch™_width_x
[
i
] = 
nodes_≥r_ch™
;

37 
i
 = 0; i < 
ny
 + 1; i++)

38 
ch™_width_y
[
i
] = 
nodes_≥r_ch™
;

40 
	`¥ötf
("BuildingÑr_graph ...\n");

41 
	`buûd_º_gøph
(
DETAILED
, 
dë_routög_¨ch
, 
£gmít_öf
, 
timög_öf
,

42 
INTRINSIC_DELAY
);

43 
	`¥ötf
("DumppingÑr_graph ...\n");

44 
	`dump_º_gøph
("rr_graph.echo");

46 
	`¥ötf
("Done.\n");

48 
	`¥ötf
("num_√t†%d\n", 
num_√ts
);

49 
	`¥ötf
("s_√à%d\n", ()
√t
);

51 
num_√ts
 = 0;

52 
num_blocks
 = 0;

53 
˛b
 = 
	`my_mÆloc
((
s_˛b
 *Ë* (
nx
 + 2));

54 
i
 = 0; i < 
nx
 + 2; i++)

56 
˛b
[
i
] = 
	`my_mÆloc
((
s_˛b
Ë* (
ny
 + 2));

58 
i
 = 0; i < 
nx
 + 2; i++)

60 
j
 = 0; j < 
ny
 + 2; j++)

62 
˛b
[
i
][
j
].
ty≥
 = 
CLB
;

63 
˛b
[
i
][
j
].
occ
 = 0;

64 
˛b
[
i
][
j
].
u
.
block
 = 0;

67 
i
 = 0; i < 
nx
 + 2; i++)

69 
˛b
[
i
][0].
ty≥
 = 
IO
;

70 
˛b
[
i
][
ny
 + 1].
ty≥
 = 
IO
;

71 
˛b
[
i
][0].
u
.
io_blocks
 = 
	`my_mÆloc
((Ë* 
io_øt
);

72 
˛b
[
i
][
ny
 + 1].
u
.
io_blocks
 = 
	`my_mÆloc
((Ë* 
io_øt
);

74 
j
 = 0; j < 
ny
 + 2; j++)

76 
˛b
[0][
j
].
ty≥
 = 
IO
;

77 
˛b
[
nx
 + 1][
j
].
ty≥
 = 
IO
;

78 
˛b
[0][
j
].
u
.
io_blocks
 = 
	`my_mÆloc
((Ë* 
io_øt
);

79 
˛b
[
nx
 + 1][
j
].
u
.
io_blocks
 = 
	`my_mÆloc
((Ë* 
io_øt
);

81 
˛b
[0][0].
ty≥
 = 
ILLEGAL
;

82 
˛b
[0][
ny
 + 1].
ty≥
 = 
ILLEGAL
;

83 
˛b
[
nx
 + 1][0].
ty≥
 = 
ILLEGAL
;

84 
˛b
[
nx
 + 1][
ny
 + 1].
ty≥
 = 
ILLEGAL
;

86 
	`£t_gøphics_°©e
(
TRUE
, 0, 
DETAILED
);

87 
	`öô_gøphics
("testing drawing capabilities");

88 
	`Æloc_døw_°ru˘s
();

89 
	`öô_døw_co‹ds
(
pös_≥r_˛b
);

90 
	`¥ötf
("num_º_node†%d\n", 
num_º_nodes
);

91 
	`upd©e_s¸ìn
(
MAJOR
, 
msg
, 
ROUTING
, 
FALSE
);

93 
	`˛o£_gøphics
();

96 
	}
}

	@timing_place.c

1 
	~<°dio.h
>

2 
	~<m©h.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"globÆs.h
"

6 
	~"∑th_dñay.h
"

7 
	~"∑th_dñay2.h
"

8 
	~"√t_dñay.h
"

9 
	~"timög_∂a˚_lookup.h
"

10 
	~"timög_∂a˚.h
"

13 **
	gtimög_∂a˚_¸ô
;

15 
s_löked_v±r
 *
	gtimög_∂a˚_¸ô_chunk_li°_hód
;

16 
s_löked_v±r
 *
	g√t_dñay_chunk_li°_hód
;

20 **
Æloc_¸ô
(
s_löked_v±r
 **
chunk_li°_hód_±r
);

22 
‰ì_¸ô
(
s_löked_v±r
 **
chunk_li°_hód_±r
);

27 
	$Æloc_¸ô
(
s_löked_v±r
 **
chunk_li°_hód_±r
)

34 **
loˇl_¸ô
;

35 *
tmp_±r
;

36 
öë
;

37 
chunk_byãs_avaû
;

38 *
chunk_√xt_avaû_mem
;

40 *
chunk_li°_hód_±r
 = 
NULL
;

41 
chunk_byãs_avaû
 = 0;

42 
chunk_√xt_avaû_mem
 = 
NULL
;

44 
loˇl_¸ô
 = (**)
	`my_mÆloc
(
num_√ts
 * (*));

46 
öë
 = 0; i√à< 
num_√ts
; inet++)

48 
tmp_±r
 = (*)
	`my_chunk_mÆloc
((
√t
[
öë
].
num_söks
) *

50 
chunk_li°_hód_±r
,

51 &
chunk_byãs_avaû
,

52 &
chunk_√xt_avaû_mem
);

53 
loˇl_¸ô
[
öë
] = 
tmp_±r
 - 1;

56  (
loˇl_¸ô
);

57 
	}
}

61 
	$‰ì_¸ô
(
s_löked_v±r
 **
chunk_li°_hód_±r
)

64 
	`‰ì_chunk_mem‹y
(*
chunk_li°_hód_±r
);

65 *
chunk_li°_hód_±r
 = 
NULL
;

66 
	}
}

70 
	$¥öt_sök_dñays
(*
‚ame
)

74 
num_©_Àvñ
, 
num_edges
, 
öode
, 
ûevñ
, 
i
;

75 
FILE
 *
Â
;

77 
Â
 = 
	`my_f›í
(
‚ame
, "w");

80 
ûevñ
 = 
num_äode_Àvñs
 - 1; ilevel >= 0; ilevel--)

82 
num_©_Àvñ
 = 
äodes_©_Àvñ
[
ûevñ
].
√Àm
;

84 
i
 = 0; i < 
num_©_Àvñ
; i++)

86 
öode
 = 
äodes_©_Àvñ
[
ûevñ
].
li°
[
i
];

87 
num_edges
 = 
äode
[
öode
].num_edges;

89 if(
num_edges
 == 0)

91 
	`Ârötf
(
Â
, "%g\n", 
äode
[
öode
].
T_¨r
);

95 
	`f˛o£
(
Â
);

96 
	}
}

100 
	$lﬂd_¸ôiˇlôõs
(
s_∂a˚r_›ts
 
∂a˚r_›ts
,

101 **
√t_¶ack
,

102 
d_max
,

103 
¸ô_exp⁄ít
)

110 
öë
, 
ùö
;

111 
pö_¸ô
;

115 
öë
 = 0; i√à< 
num_√ts
; inet++)

118 if(
öë
 =
OPEN
)

120 if(
√t
[
öë
].
is_globÆ
)

123 
ùö
 = 1; ipö <
√t
[
öë
].
num_söks
; ipin++)

127 
pö_¸ô
 = 
	`max
(1 - 
√t_¶ack
[
öë
][
ùö
] / 
d_max
, 0.);

128 
timög_∂a˚_¸ô
[
öë
][
ùö
] =

129 
	`pow
(
pö_¸ô
, 
¸ô_exp⁄ít
);

133 
	}
}

138 
	$Æloc_lookups_™d_¸ôiˇlôõs
(
t_ch™_width_di°
 
ch™_width_di°
,

139 
s_rouãr_›ts
 
rouãr_›ts
,

140 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

141 
t_£gmít_öf
 * 
£gmít_öf
,

142 
t_timög_öf
 
timög_öf
,

143 
t_subblock_d©a
 
subblock_d©a
,

144 ***
√t_dñay
,

145 ***
√t_¶ack
)

148 (*
√t_¶ack
Ë
	`Æloc_™d_lﬂd_timög_gøph
(
timög_öf
, 
subblock_d©a
);

150 (*
√t_dñay
Ë
	`Æloc_√t_dñay
(&
√t_dñay_chunk_li°_hód
);

152 
	`compuã_dñay_lookup_èbÀs
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

153 
timög_öf
, 
ch™_width_di°
, 
subblock_d©a
);

155 
timög_∂a˚_¸ô
 = 
	`Æloc_¸ô
(&
timög_∂a˚_¸ô_chunk_li°_hód
);

157 
	}
}

161 
	$‰ì_lookups_™d_¸ôiˇlôõs
(***
√t_dñay
,

162 ***
√t_¶ack
)

165 
	`‰ì
(
timög_∂a˚_¸ô
);

166 
	`‰ì_¸ô
(&
timög_∂a˚_¸ô_chunk_li°_hód
);

168 
	`‰ì_timög_gøph
(*
√t_¶ack
);

169 
	`‰ì_√t_dñay
(*
√t_dñay
, &
√t_dñay_chunk_li°_hód
);

171 
	}
}

	@timing_place.h

1 
Æloc_lookups_™d_¸ôiˇlôõs
(
t_ch™_width_di°
 
ch™_width_di°
,

2 
s_rouãr_›ts
 
rouãr_›ts
,

3 
s_dë_routög_¨ch


4 
dë_routög_¨ch
,

5 
t_£gmít_öf
 * 
£gmít_öf
,

6 
t_timög_öf
 
timög_öf
,

7 
t_subblock_d©a
 
subblock_d©a
,

8 ***
√t_dñay
,

9 ***
√t_¶ack
);

11 
lﬂd_¸ôiˇlôõs
(
s_∂a˚r_›ts
 
∂a˚r_›ts
,

12 **
√t_¶ack
,

13 
d_max
,

14 
¸ô_exp⁄ít
);

16 
‰ì_lookups_™d_¸ôiˇlôõs
(***
√t_dñay
,

17 ***
√t_¶ack
);

20 **
timög_∂a˚_¸ô
;

	@timing_place_lookup.c

1 
	~<°dio.h
>

2 
	~<m©h.h
>

3 
	~<°rög.h
>

4 
	~"utû.h
"

5 
	~"v¥_ty≥s.h
"

6 
	~"globÆs.h
"

7 
	~"rouã_comm⁄.h
"

8 
	~"∂a˚_™d_rouã.h
"

9 
	~"rouã_åì_timög.h
"

10 
	~"rouã_timög.h
"

11 
	~"timög_∂a˚_lookup.h
"

12 
	~"º_gøph.h
"

13 
	~"m°.h
"

14 
	~"rouã_exp‹t.h
"

15 
	~<as£π.h
>

36 
	#NET_COUNT
 1

	)

40 
	#NET_USED
 0

	)

42 
	#NET_USED_SOURCE_BLOCK
 0

	)

43 
	#NET_USED_SINK_BLOCK
 1

	)

44 
	#SOURCE_BLOCK
 0

	)

45 
	#SINK_BLOCK
 1

	)

47 
	#BLOCK_COUNT
 2

	)

54 
	#NUM_TYPES_USED
 3

	)

56 
	#DEBUG_TIMING_PLACE_LOOKUP


	)

58 
	#DUMPFILE
 "lookup_dump.echo"

	)

68 **
	gdñè_io_to_fb
;

69 **
	gdñè_fb_to_fb
;

70 **
	gdñè_fb_to_io
;

71 **
	gdñè_io_to_io
;

79 **
	g√t_dñay
;

80 **
	g√t_¶ack
;

81 *
	gpö_¸ôiˇlôy
;

82 *
	gsök_‹dî
;

83 
t_π_node
 **
	gπ_node_of_sök
;

84 
t_ty≥_±r
 
	gIO_TYPE_BACKUP
;

85 
t_ty≥_±r
 
	gEMPTY_TYPE_BACKUP
;

86 
t_ty≥_±r
 
	gFILL_TYPE_BACKUP
;

87 
t_ty≥_des¸ùt‹
 
	gdummy_ty≥_des¸ùt‹s
[
NUM_TYPES_USED
];

88 
t_ty≥_des¸ùt‹
 *
	gty≥_des¸ùt‹s_backup
;

89 
s_grid_tûe
 **
	ggrid_backup
;

90 
	gnum_ty≥s_backup
;

92 
t_ivec
 **
	g˛b_›ös_u£d_loˇŒy
;

94 #ifde‡
PRINT_ARRAYS


95 
FILE
 *
	glookup_dump
;

101 
Æloc_√t
();

103 
Æloc_block
();

105 
lﬂd_sim∂ifõd_devi˚
();

106 
ª°‹e_‹igöÆ_devi˚
();

108 
Æloc_™d_assign_öã∫Æ_°ru˘uªs
(
s_√t
 **
‹igöÆ_√t
,

109 
s_block


110 **
‹igöÆ_block
,

111 *
‹igöÆ_num_√ts
,

112 *
‹igöÆ_num_blocks
);

114 
‰ì_™d_ª£t_öã∫Æ_°ru˘uªs
(
s_√t
 *
‹igöÆ_√t
,

115 
s_block
 *
‹igöÆ_block
,

116 
‹igöÆ_num_√ts
,

117 
‹igöÆ_num_blocks
);

119 
£tup_ch™_width
(
s_rouãr_›ts
 
rouãr_›ts
,

120 
t_ch™_width_di°
 
ch™_width_di°
);

122 
Æloc_routög_°ru˘s
(
s_rouãr_›ts
 
rouãr_›ts
,

123 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

124 
t_£gmít_öf
 * 
£gmít_öf
,

125 
t_timög_öf
 
timög_öf
,

126 
t_subblock_d©a
 
subblock_d©a
);

128 
‰ì_routög_°ru˘s
(
s_rouãr_›ts
 
rouãr_›ts
,

129 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

130 
t_£gmít_öf
 * 
£gmít_öf
,

131 
t_timög_öf
 
timög_öf
);

133 
assign_loˇti⁄s
(
t_ty≥_±r
 
sour˚_ty≥
,

134 
sour˚_x_loc
,

135 
sour˚_y_loc
,

136 
sour˚_z_loc
,

137 
t_ty≥_±r
 
sök_ty≥
,

138 
sök_x_loc
,

139 
sök_y_loc
,

140 
sök_z_loc
);

142 
assign_blocks_™d_rouã_√t
(
t_ty≥_±r
 
sour˚_ty≥
,

143 
sour˚_x_loc
,

144 
sour˚_y_loc
,

145 
t_ty≥_±r
 
sök_ty≥
,

146 
sök_x_loc
,

147 
sök_y_loc
,

148 
s_rouãr_›ts
 
rouãr_›ts
,

149 
s_dë_routög_¨ch


150 
dë_routög_¨ch
,

151 
t_£gmít_öf
 * 
£gmít_öf
,

152 
t_timög_öf
 
timög_öf
);

154 
Æloc_dñè_¨øys
();

156 
‰ì_dñè_¨øys
();

158 
gíîic_compuã_m©rix
(***
m©rix_±r
,

159 
t_ty≥_±r
 
sour˚_ty≥
,

160 
t_ty≥_±r
 
sök_ty≥
,

161 
sour˚_x
,

162 
sour˚_y
,

163 
°¨t_x
,

164 
íd_x
,

165 
°¨t_y
,

166 
íd_y
,

167 
s_rouãr_›ts
 
rouãr_›ts
,

168 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

169 
t_£gmít_öf
 * 
£gmít_öf
,

170 
t_timög_öf
 
timög_öf
);

172 
compuã_dñè_fb_to_fb
(
s_rouãr_›ts
 
rouãr_›ts
,

173 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

174 
t_£gmít_öf
 * 
£gmít_öf
,

175 
t_timög_öf
 
timög_öf
,

176 
l⁄ge°_Àngth
);

178 
compuã_dñè_io_to_fb
(
s_rouãr_›ts
 
rouãr_›ts
,

179 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

180 
t_£gmít_öf
 * 
£gmít_öf
,

181 
t_timög_öf
 
timög_öf
);

183 
compuã_dñè_fb_to_io
(
s_rouãr_›ts
 
rouãr_›ts
,

184 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

185 
t_£gmít_öf
 * 
£gmít_öf
,

186 
t_timög_öf
 
timög_öf
);

188 
compuã_dñè_io_to_io
(
s_rouãr_›ts
 
rouãr_›ts
,

189 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

190 
t_£gmít_öf
 * 
£gmít_öf
,

191 
t_timög_öf
 
timög_öf
);

193 
compuã_dñè_¨øys
(
s_rouãr_›ts
 
rouãr_›ts
,

194 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

195 
t_£gmít_öf
 * 
£gmít_öf
,

196 
t_timög_öf
 
timög_öf
,

197 
l⁄ge°_Àngth
);

199 
gë_fú°_pö
(
e_pö_ty≥
 
pöty≥
,

200 
t_ty≥_±r
 
ty≥
);

202 
gë_l⁄ge°_£gmít_Àngth
(
s_dë_routög_¨ch


203 
dë_routög_¨ch
,

204 
t_£gmít_öf
 * 
£gmít_öf
);

205 
ª£t_∂a˚mít
();

207 #ifde‡
PRINT_ARRAYS


208 
¥öt_¨øy
(**
¨øy_to_¥öt
,

209 
x1
,

210 
x2
,

211 
y1
,

212 
y2
);

216 
	$gë_fú°_pö
(
e_pö_ty≥
 
pöty≥
,

217 
t_ty≥_±r
 
ty≥
)

223 
i
, 
cuºpö
;

225 
cuºpö
 = 0;

226 
i
 = 0; i < 
ty≥
->
num_˛ass
; i++)

228 if(
ty≥
->
˛ass_öf
[
i
].ty≥ =
pöty≥


229 && !
ty≥
->
is_globÆ_pö
[
cuºpö
])

230  (
ty≥
->
˛ass_öf
[
i
].
pöli°
[0]);

232 
cuºpö
 +
ty≥
->
˛ass_öf
[
i
].
num_pös
;

234 
	`as£π
(0);

235 
	`exô
(0);

236 
	}
}

240 
	$gë_l⁄ge°_£gmít_Àngth
(
s_dë_routög_¨ch
 
dë_routög_¨ch
,

241 
t_£gmít_öf
 * 
£gmít_öf
)

244 
i
, 
Àngth
;

246 
Àngth
 = 0;

247 
i
 = 0; i < 
dë_routög_¨ch
.
num_£gmít
; i++)

249 if(
£gmít_öf
[
i
].
Àngth
 >Üength)

250 
Àngth
 = 
£gmít_öf
[
i
].length;

252  (
Àngth
);

253 
	}
}

257 
	$Æloc_√t
()

260 
i
, 
Àn
;

262 
√t
 = (
s_√t
 *)
	`my_mÆloc
(
num_√ts
 * (s_net));

263 
i
 = 0; i < 
NET_COUNT
; i++)

266 
Àn
 = 
	`°æí
("TEMP_NET");

267 
√t
[
i
].
«me
 = (*)
	`my_mÆloc
((
Àn
 + 1) * ());

268 
√t
[
i
].
is_globÆ
 = 
FALSE
;

269 
	`°r˝y
(
√t
[
NET_USED
].
«me
, "TEMP_NET");

271 
√t
[
i
].
num_söks
 = (
BLOCK_COUNT
 - 1);

272 
√t
[
i
].
node_block
 = (*)
	`my_mÆloc
(
BLOCK_COUNT
 * ());

273 
√t
[
i
].
node_block
[
NET_USED_SOURCE_BLOCK
] = NET_USED_SOURCE_BLOCK;

274 
√t
[
i
].
node_block
[
NET_USED_SINK_BLOCK
] = NET_USED_SINK_BLOCK;

276 
√t
[
i
].
node_block_pö
 =

277 (*)
	`my_mÆloc
(
BLOCK_COUNT
 * ());

281 
	}
}

285 
	$Æloc_block
()

292 
ix_b
, 
ix_p
, 
Àn
, 
i
;

293 
max_pös
;

295 
max_pös
 = 0;

296 
i
 = 0; i < 
NUM_TYPES_USED
; i++)

298 
max_pös
 = 
	`max
(max_pös, 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

301 
block
 = (
s_block
 *)
	`my_mÆloc
(
num_blocks
 * (s_block));

303 
ix_b
 = 0; ix_b < 
BLOCK_COUNT
; ix_b++)

305 
Àn
 = 
	`°æí
("TEMP_BLOCK");

306 
block
[
ix_b
].
«me
 = (*)
	`my_mÆloc
((
Àn
 + 1) * ());

307 
	`°r˝y
(
block
[
ix_b
].
«me
, "TEMP_BLOCK");

309 
block
[
ix_b
].
√ts
 = (*)
	`my_mÆloc
(
max_pös
 * ());

310 
block
[
ix_b
].
√ts
[0] = 0;

311 
ix_p
 = 1; ix_∞< 
max_pös
; ix_p++)

312 
block
[
ix_b
].
√ts
[
ix_p
] = 
OPEN
;

314 
	}
}

318 
	$lﬂd_sim∂ifõd_devi˚
()

320 
i
, 
j
;

323 
EMPTY_TYPE_BACKUP
 = 
EMPTY_TYPE
;

324 
IO_TYPE_BACKUP
 = 
IO_TYPE
;

325 
FILL_TYPE_BACKUP
 = 
FILL_TYPE
;

326 
ty≥_des¸ùt‹s_backup
 = 
ty≥_des¸ùt‹s
;

327 
num_ty≥s_backup
 = 
num_ty≥s
;

328 
num_ty≥s
 = 
NUM_TYPES_USED
;

331 
dummy_ty≥_des¸ùt‹s
[0] = *
EMPTY_TYPE
;

332 
dummy_ty≥_des¸ùt‹s
[0].
ödex
 = 0;

333 
dummy_ty≥_des¸ùt‹s
[1] = *
IO_TYPE
;

334 
dummy_ty≥_des¸ùt‹s
[1].
ödex
 = 1;

335 
dummy_ty≥_des¸ùt‹s
[2] = *
FILL_TYPE
;

336 
dummy_ty≥_des¸ùt‹s
[2].
ödex
 = 2;

337 
ty≥_des¸ùt‹s
 = 
dummy_ty≥_des¸ùt‹s
;

338 
EMPTY_TYPE
 = &
dummy_ty≥_des¸ùt‹s
[0];

339 
IO_TYPE
 = &
dummy_ty≥_des¸ùt‹s
[1];

340 
FILL_TYPE
 = &
dummy_ty≥_des¸ùt‹s
[2];

343 
grid_backup
 = 
grid
;

344 
grid
 =

345 (
s_grid_tûe
 **)
	`Æloc_m©rix
(0, 
nx
 + 1, 0, 
ny
 + 1,

346 (
s_grid_tûe
));

347 
i
 = 0; i < 
nx
 + 2; i++)

349 
j
 = 0; j < 
ny
 + 2; j++)

351 if((
i
 =0 && 
j
 == 0) ||

352 (
i
 =
nx
 + 1 && 
j
 == 0) ||

353 (
i
 =0 && 
j
 =
ny
 + 1Ë|| (ò=
nx
 + 1

354 && 
j
 =
ny
 + 1))

356 
grid
[
i
][
j
].
ty≥
 = 
EMPTY_TYPE
;

358 if(
i
 =0 || i =
nx
 + 1 || 
j
 =0 || j =
ny
 + 1)

360 
grid
[
i
][
j
].
ty≥
 = 
IO_TYPE
;

364 
grid
[
i
][
j
].
ty≥
 = 
FILL_TYPE
;

366 
grid
[
i
][
j
].
blocks
 =

367 
	`my_mÆloc
(
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
 * ());

368 
grid
[
i
][
j
].
off£t
 = 0;

371 
	}
}

373 
	$ª°‹e_‹igöÆ_devi˚
()

375 
i
, 
j
;

378 
IO_TYPE
 = 
IO_TYPE_BACKUP
;

379 
EMPTY_TYPE
 = 
EMPTY_TYPE_BACKUP
;

380 
FILL_TYPE
 = 
FILL_TYPE_BACKUP
;

381 
ty≥_des¸ùt‹s
 = 
ty≥_des¸ùt‹s_backup
;

382 
num_ty≥s
 = 
num_ty≥s_backup
;

385 
i
 = 0; i < 
nx
 + 2; i++)

387 
j
 = 0; j < 
ny
 + 2; j++)

389 
	`‰ì
(
grid
[
i
][
j
].
blocks
);

392 
	`‰ì_m©rix
(
grid
, 0, 
nx
 + 1, 0, (
s_grid_tûe
));

393 
grid
 = 
grid_backup
;

394 
	}
}

398 
	$ª£t_∂a˚mít
()

400 
i
, 
j
, 
k
;

402 
i
 = 0; i <
nx
 + 1; i++)

404 
j
 = 0; j <
ny
 + 1; j++)

406 
grid
[
i
][
j
].
ußge
 = 0;

407 
k
 = 0; k < 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
; k++)

409 
grid
[
i
][
j
].
blocks
[
k
] = 
EMPTY
;

413 
	}
}

417 
	$Æloc_™d_assign_öã∫Æ_°ru˘uªs
(
s_√t
 **
‹igöÆ_√t
,

418 
s_block
 **
‹igöÆ_block
,

419 *
‹igöÆ_num_√ts
,

420 *
‹igöÆ_num_blocks
)

424 *
‹igöÆ_√t
 = 
√t
;

425 *
‹igöÆ_num_√ts
 = 
num_√ts
;

426 
num_√ts
 = 
NET_COUNT
;

427 
	`Æloc_√t
();

429 *
‹igöÆ_block
 = 
block
;

430 *
‹igöÆ_num_blocks
 = 
num_blocks
;

431 
num_blocks
 = 
BLOCK_COUNT
;

432 
	`Æloc_block
();

436 
√t_dñay
 =

437 (**)
	`Æloc_m©rix
(0, 
NET_COUNT
 - 1, 1, 
BLOCK_COUNT
 - 1,

439 
√t_¶ack
 =

440 (**)
	`Æloc_m©rix
(0, 
NET_COUNT
 - 1, 1, 
BLOCK_COUNT
 - 1,

443 
	`ª£t_∂a˚mít
();

444 
	}
}

448 
	$‰ì_™d_ª£t_öã∫Æ_°ru˘uªs
(
s_√t
 *
‹igöÆ_√t
,

449 
s_block
 *
‹igöÆ_block
,

450 
‹igöÆ_num_√ts
,

451 
‹igöÆ_num_blocks
)

456 
i
;

460 
i
 = 0; i < 
NET_COUNT
; i++)

462 
	`‰ì
(
√t
[
i
].
«me
);

463 
	`‰ì
(
√t
[
i
].
node_block
);

464 
	`‰ì
(
√t
[
i
].
node_block_pö
);

466 
	`‰ì
(
√t
);

467 
√t
 = 
‹igöÆ_√t
;

469 
i
 = 0; i < 
BLOCK_COUNT
; i++)

471 
	`‰ì
(
block
[
i
].
«me
);

472 
	`‰ì
(
block
[
i
].
√ts
);

474 
	`‰ì
(
block
);

475 
block
 = 
‹igöÆ_block
;

477 
num_√ts
 = 
‹igöÆ_num_√ts
;

478 
num_blocks
 = 
‹igöÆ_num_blocks
;

480 
	`‰ì_m©rix
(
√t_dñay
, 0, 
NET_COUNT
 - 1, 1, ());

481 
	`‰ì_m©rix
(
√t_¶ack
, 0, 
NET_COUNT
 - 1, 1, ());

483 
	}
}

487 
	$£tup_ch™_width
(
s_rouãr_›ts
 
rouãr_›ts
,

488 
t_ch™_width_di°
 
ch™_width_di°
)

493 
width_Ác
, 
i
, 
max_pös_≥r_fb
;

495 
max_pös_≥r_fb
 = 0;

496 
i
 = 0; i < 
num_ty≥s
; i++)

498 
max_pös_≥r_fb
 =

499 
	`max
(
max_pös_≥r_fb
, 
ty≥_des¸ùt‹s
[
i
].
num_pös
);

502 if(
rouãr_›ts
.
fixed_ch™√l_width
 =
NO_FIXED_CHANNEL_WIDTH
)

503 
width_Ác
 = 4 * 
max_pös_≥r_fb
;

507 
width_Ác
 = 
rouãr_›ts
.
fixed_ch™√l_width
;

509 
	`öô_ch™
(
width_Ác
, 
ch™_width_di°
);

510 
	}
}

514 
	$Æloc_routög_°ru˘s
(
s_rouãr_›ts
 
rouãr_›ts
,

515 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

516 
t_£gmít_öf
 * 
£gmít_öf
,

517 
t_timög_öf
 
timög_öf
,

518 
t_subblock_d©a
 
subblock_d©a
)

521 
bb_Á˘‹
;

522 
w¨nögs
;

523 
t_gøph_ty≥
 
gøph_ty≥
;

530 
	`assign_loˇti⁄s
(
FILL_TYPE
, 1, 1, 0, FILL_TYPE, 
nx
, 
ny
, 0);

532 
˛b_›ös_u£d_loˇŒy
 = 
	`Æloc_rouã_°ru˘s
(
subblock_d©a
);

534 
	`‰ì_º_gøph
();

536 if(
rouãr_›ts
.
rouã_ty≥
 =
GLOBAL
) {

537 
gøph_ty≥
 = 
GRAPH_GLOBAL
;

539 
gøph_ty≥
 = (
dë_routög_¨ch
.
dúe˘i⁄Æôy
 ==

540 
BI_DIRECTIONAL
 ? 
GRAPH_BIDIR
 : 
GRAPH_UNIDIR
);

543 
	`buûd_º_gøph
(
gøph_ty≥
, 
num_ty≥s
, 
dummy_ty≥_des¸ùt‹s
, 
nx
,

544 
ny
, 
grid
, 
ch™_width_x
[0], 
NULL
,

545 
dë_routög_¨ch
.
swôch_block_ty≥
,

546 
dë_routög_¨ch
.
Fs
, dë_routög_¨ch.
num_£gmít
, dë_routög_¨ch.
num_swôch
,

547 
£gmít_öf
, 
dë_routög_¨ch
.
globÆ_rouã_swôch
,

548 
dë_routög_¨ch
.
dñayÀss_swôch
, 
timög_öf
,

549 
dë_routög_¨ch
.
wúe_to_ùö_swôch
,

550 
rouãr_›ts
.
ba£_co°_ty≥
, &
w¨nögs
);

552 
	`Æloc_™d_lﬂd_º_node_rouã_°ru˘s
();

554 
	`Æloc_timög_driví_rouã_°ru˘s
(&
pö_¸ôiˇlôy
, &
sök_‹dî
,

555 &
π_node_of_sök
);

558 
bb_Á˘‹
 = 
nx
 + 
ny
;

559 
	`öô_rouã_°ru˘s
(
bb_Á˘‹
);

560 
	}
}

564 
	$‰ì_routög_°ru˘s
(
s_rouãr_›ts
 
rouãr_›ts
,

565 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

566 
t_£gmít_öf
 * 
£gmít_öf
,

567 
t_timög_öf
 
timög_öf
)

569 
	`‰ì_º_gøph
();

571 
	`‰ì_º_node_rouã_°ru˘s
();

572 
	`‰ì_rouã_°ru˘s
(
˛b_›ös_u£d_loˇŒy
);

573 
	`‰ì_åa˚_°ru˘s
();

575 
	`‰ì_timög_driví_rouã_°ru˘s
(
pö_¸ôiˇlôy
, 
sök_‹dî
,

576 
π_node_of_sök
);

577 
	}
}

581 
	$assign_loˇti⁄s
(
t_ty≥_±r
 
sour˚_ty≥
,

582 
sour˚_x_loc
,

583 
sour˚_y_loc
,

584 
sour˚_z_loc
,

585 
t_ty≥_±r
 
sök_ty≥
,

586 
sök_x_loc
,

587 
sök_y_loc
,

588 
sök_z_loc
)

591 
block
[
SOURCE_BLOCK
].
ty≥
 = 
sour˚_ty≥
;

592 
block
[
SOURCE_BLOCK
].
x
 = 
sour˚_x_loc
;

593 
block
[
SOURCE_BLOCK
].
y
 = 
sour˚_y_loc
;

594 
block
[
SOURCE_BLOCK
].
z
 = 
sour˚_z_loc
;

596 
block
[
SINK_BLOCK
].
ty≥
 = 
sök_ty≥
;

597 
block
[
SINK_BLOCK
].
x
 = 
sök_x_loc
;

598 
block
[
SINK_BLOCK
].
y
 = 
sök_y_loc
;

599 
block
[
SINK_BLOCK
].
z
 = 
sök_z_loc
;

601 
grid
[
sour˚_x_loc
][
sour˚_y_loc
].
blocks
[
sour˚_z_loc
] = 
SOURCE_BLOCK
;

602 
grid
[
sök_x_loc
][
sök_y_loc
].
blocks
[
sök_z_loc
] = 
SINK_BLOCK
;

604 
√t
[
NET_USED
].
node_block_pö
[
NET_USED_SOURCE_BLOCK
] =

605 
	`gë_fú°_pö
(
DRIVER
, 
block
[
SOURCE_BLOCK
].
ty≥
);

606 
√t
[
NET_USED
].
node_block_pö
[
NET_USED_SINK_BLOCK
] =

607 
	`gë_fú°_pö
(
RECEIVER
, 
block
[
SINK_BLOCK
].
ty≥
);

609 
grid
[
sour˚_x_loc
][
sour˚_y_loc
].
ußge
 += 1;

610 
grid
[
sök_x_loc
][
sök_y_loc
].
ußge
 += 1;

612 
	}
}

616 
	$assign_blocks_™d_rouã_√t
(
t_ty≥_±r
 
sour˚_ty≥
,

617 
sour˚_x_loc
,

618 
sour˚_y_loc
,

619 
t_ty≥_±r
 
sök_ty≥
,

620 
sök_x_loc
,

621 
sök_y_loc
,

622 
s_rouãr_›ts
 
rouãr_›ts
,

623 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

624 
t_£gmít_öf
 * 
£gmít_öf
,

625 
t_timög_öf
 
timög_öf
)

629 
boﬁón
 
is_rouãabÀ
;

630 
ùö
;

631 
¥es_Ác
, 
T_¸ô
;

632 
√t_dñay_vÆue
;

634 
sour˚_z_loc
, 
sök_z_loc
;

637 
sour˚_z_loc
 = 0;

638 
sök_z_loc
 = 0;

640 
√t_dñay_vÆue
 = 
IMPOSSIBLE
;

642 
	`assign_loˇti⁄s
(
sour˚_ty≥
, 
sour˚_x_loc
, 
sour˚_y_loc
, 
sour˚_z_loc
,

643 
sök_ty≥
, 
sök_x_loc
, 
sök_y_loc
, 
sök_z_loc
);

645 
	`lﬂd_√t_º_ãrmöÆs
(
º_node_ödi˚s
);

647 
T_¸ô
 = 1;

648 
¥es_Ác
 = 0;

650 
ùö
 = 1; ipö <
√t
[
NET_USED
].
num_söks
; ipin++)

651 
√t_¶ack
[
NET_USED
][
ùö
] = 0;

653 
is_rouãabÀ
 = 
	`timög_driví_rouã_√t
(
NET_USED
, 
¥es_Ác
,

654 
rouãr_›ts
.
max_¸ôiˇlôy
,

655 
rouãr_›ts
.
¸ôiˇlôy_exp
,

656 
rouãr_›ts
.
a°¨_Ác
,

657 
rouãr_›ts
.
bíd_co°
,

658 
√t_¶ack
[
NET_USED
],

659 
pö_¸ôiˇlôy
, 
sök_‹dî
,

660 
π_node_of_sök
, 
T_¸ô
,

661 
√t_dñay
[
NET_USED
]);

663 
√t_dñay_vÆue
 = 
√t_dñay
[
NET_USED
][
NET_USED_SINK_BLOCK
];

665 
grid
[
sour˚_x_loc
][
sour˚_y_loc
].
ußge
 = 0;

666 
grid
[
sour˚_x_loc
][
sour˚_y_loc
].
blocks
[
sour˚_z_loc
] = 
EMPTY
;

667 
grid
[
sök_x_loc
][
sök_y_loc
].
ußge
 = 0;

668 
grid
[
sök_x_loc
][
sök_y_loc
].
blocks
[
sök_z_loc
] = 
EMPTY
;

670  (
√t_dñay_vÆue
);

671 
	}
}

675 
	$Æloc_dñè_¨øys
()

677 
id_x
, 
id_y
;

679 
dñè_fb_to_fb
 =

680 (**)
	`Æloc_m©rix
(0, 
nx
 - 1, 0, 
ny
 - 1, ());

681 
dñè_io_to_fb
 = (**)
	`Æloc_m©rix
(0, 
nx
, 0, 
ny
, ());

682 
dñè_fb_to_io
 = (**)
	`Æloc_m©rix
(0, 
nx
, 0, 
ny
, ());

683 
dñè_io_to_io
 =

684 (**)
	`Æloc_m©rix
(0, 
nx
 + 1, 0, 
ny
 + 1, ());

689 
id_x
 = 0; id_x <
nx
; id_x++)

691 
id_y
 = 0; id_y <
ny
; id_y++)

693 
dñè_io_to_fb
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

696 
id_x
 = 0; id_x <
nx
 - 1; id_x++)

698 
id_y
 = 0; id_y <
ny
 - 1; id_y++)

700 
dñè_fb_to_fb
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

703 
id_x
 = 0; id_x <
nx
; id_x++)

705 
id_y
 = 0; id_y <
ny
; id_y++)

707 
dñè_fb_to_io
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

710 
id_x
 = 0; id_x <
nx
 + 1; id_x++)

712 
id_y
 = 0; id_y <
ny
 + 1; id_y++)

714 
dñè_io_to_io
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

717 
	}
}

721 
	$‰ì_dñè_¨øys
()

724 
	`‰ì_m©rix
(
dñè_io_to_fb
, 0, 
nx
, 0, ());

725 
	`‰ì_m©rix
(
dñè_fb_to_fb
, 0, 
nx
 - 1, 0, ());

726 
	`‰ì_m©rix
(
dñè_fb_to_io
, 0, 
nx
, 0, ());

727 
	`‰ì_m©rix
(
dñè_io_to_io
, 0, 
nx
 + 1, 0, ());

729 
	}
}

733 
	$gíîic_compuã_m©rix
(***
m©rix_±r
,

734 
t_ty≥_±r
 
sour˚_ty≥
,

735 
t_ty≥_±r
 
sök_ty≥
,

736 
sour˚_x
,

737 
sour˚_y
,

738 
°¨t_x
,

739 
íd_x
,

740 
°¨t_y
,

741 
íd_y
,

742 
s_rouãr_›ts
 
rouãr_›ts
,

743 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

744 
t_£gmít_öf
 * 
£gmít_öf
,

745 
t_timög_öf
 
timög_öf
)

748 
dñè_x
, 
dñè_y
;

749 
sök_x
, 
sök_y
;

751 
sök_x
 = 
°¨t_x
; sök_x <
íd_x
; sink_x++)

753 
sök_y
 = 
°¨t_y
; sök_y <
íd_y
; sink_y++)

755 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

756 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

758 if(
dñè_x
 =0 && 
dñè_y
 == 0)

762 (*
m©rix_±r
)[
dñè_x
][
dñè_y
] =

763 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
,

764 
sour˚_y
, 
sök_ty≥
,

765 
sök_x
, 
sök_y
,

766 
rouãr_›ts
,

767 
dë_routög_¨ch
,

768 
£gmít_öf
, 
timög_öf
);

771 
	}
}

775 
	$compuã_dñè_fb_to_fb
(
s_rouãr_›ts
 
rouãr_›ts
,

776 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

777 
t_£gmít_öf
 * 
£gmít_öf
,

778 
t_timög_öf
 
timög_öf
,

779 
l⁄ge°_Àngth
)

790 
sour˚_x
, 
sour˚_y
, 
sök_x
, 
sök_y
;

791 
°¨t_x
, 
°¨t_y
, 
íd_x
, 
íd_y
;

792 
dñè_x
, 
dñè_y
;

793 
t_ty≥_±r
 
sour˚_ty≥
, 
sök_ty≥
;

795 
sour˚_ty≥
 = 
FILL_TYPE
;

796 
sök_ty≥
 = 
FILL_TYPE
;

798 if(
l⁄ge°_Àngth
 < 0.5 * (
nx
))

800 
°¨t_x
 = 
l⁄ge°_Àngth
;

804 
°¨t_x
 = ()(0.5 * 
nx
);

806 
íd_x
 = 
nx
;

807 
sour˚_x
 = 
°¨t_x
;

809 if(
l⁄ge°_Àngth
 < 0.5 * (
ny
))

811 
°¨t_y
 = 
l⁄ge°_Àngth
;

815 
°¨t_y
 = ()(0.5 * 
ny
);

817 
íd_y
 = 
ny
;

818 
sour˚_y
 = 
°¨t_y
;

822 
sök_x
 = 
°¨t_x
; sök_x <
íd_x
 - 1; sink_x++)

824 
sök_y
 = 
°¨t_y
; sök_y <
íd_y
 - 1; sink_y++)

826 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

827 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

829 if(
dñè_x
 =0 && 
dñè_y
 == 0)

831 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
] = 0.0;

834 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
] =

835 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
,

836 
sour˚_y
, 
sök_ty≥
,

837 
sök_x
, 
sök_y
,

838 
rouãr_›ts
,

839 
dë_routög_¨ch
,

840 
£gmít_öf
, 
timög_öf
);

846 
sök_x
 = 
íd_x
 - 1;

847 
sök_y
 = 
íd_y
 - 1;

849 
sour˚_x
 = 
°¨t_x
 - 1; source_x >= 1; source_x--)

851 
sour˚_y
 = 
°¨t_y
; sour˚_y <
íd_y
 - 1; source_y++)

853 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

854 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

856 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
] =

857 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
,

858 
sour˚_y
, 
sök_ty≥
,

859 
sök_x
, 
sök_y
,

860 
rouãr_›ts
,

861 
dë_routög_¨ch
,

862 
£gmít_öf
, 
timög_öf
);

866 
sour˚_x
 = 1; sour˚_x <
íd_x
 - 1; source_x++)

868 
sour˚_y
 = 1; sour˚_y < 
°¨t_y
; source_y++)

870 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

871 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

873 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
] =

874 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
,

875 
sour˚_y
, 
sök_ty≥
,

876 
sök_x
, 
sök_y
,

877 
rouãr_›ts
,

878 
dë_routög_¨ch
,

879 
£gmít_öf
, 
timög_öf
);

885 
sök_x
 = 
íd_x
;

886 
sök_y
 = 
íd_y
;

887 
sour˚_x
 = 1;

888 
sour˚_y
 = 1; sour˚_y <
íd_y
; source_y++)

890 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

891 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

893 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
] =

894 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

895 
sök_ty≥
, 
sök_x
, 
sök_y
,

896 
rouãr_›ts
, 
dë_routög_¨ch
,

897 
£gmít_öf
, 
timög_öf
);

901 
sök_x
 = 
íd_x
;

902 
sök_y
 = 
íd_y
;

903 
sour˚_y
 = 1;

904 
sour˚_x
 = 1; sour˚_x <
íd_x
; source_x++)

906 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

907 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

909 
dñè_fb_to_fb
[
dñè_x
][
dñè_y
] =

910 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

911 
sök_ty≥
, 
sök_x
, 
sök_y
,

912 
rouãr_›ts
, 
dë_routög_¨ch
,

913 
£gmít_öf
, 
timög_öf
);

915 
	}
}

919 
	$compuã_dñè_io_to_fb
(
s_rouãr_›ts
 
rouãr_›ts
,

920 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

921 
t_£gmít_öf
 * 
£gmít_öf
,

922 
t_timög_öf
 
timög_öf
)

924 
sour˚_x
, 
sour˚_y
;

925 
°¨t_x
, 
°¨t_y
, 
íd_x
, 
íd_y
;

926 
t_ty≥_±r
 
sour˚_ty≥
, 
sök_ty≥
;

928 
sour˚_ty≥
 = 
IO_TYPE
;

929 
sök_ty≥
 = 
FILL_TYPE
;

931 
dñè_io_to_fb
[0][0] = 
IMPOSSIBLE
;

932 
dñè_io_to_fb
[
nx
][
ny
] = 
IMPOSSIBLE
;

934 
sour˚_x
 = 0;

935 
sour˚_y
 = 1;

937 
°¨t_x
 = 1;

938 
íd_x
 = 
nx
;

939 
°¨t_y
 = 1;

940 
íd_y
 = 
ny
;

941 
	`gíîic_compuã_m©rix
(&
dñè_io_to_fb
, 
sour˚_ty≥
, 
sök_ty≥
,

942 
sour˚_x
, 
sour˚_y
, 
°¨t_x
, 
íd_x
, 
°¨t_y
,

943 
íd_y
, 
rouãr_›ts
, 
dë_routög_¨ch
,

944 
£gmít_öf
, 
timög_öf
);

946 
sour˚_x
 = 1;

947 
sour˚_y
 = 0;

949 
°¨t_x
 = 1;

950 
íd_x
 = 1;

951 
°¨t_y
 = 1;

952 
íd_y
 = 
ny
;

953 
	`gíîic_compuã_m©rix
(&
dñè_io_to_fb
, 
sour˚_ty≥
, 
sök_ty≥
,

954 
sour˚_x
, 
sour˚_y
, 
°¨t_x
, 
íd_x
, 
°¨t_y
,

955 
íd_y
, 
rouãr_›ts
, 
dë_routög_¨ch
,

956 
£gmít_öf
, 
timög_öf
);

958 
°¨t_x
 = 1;

959 
íd_x
 = 
nx
;

960 
°¨t_y
 = 
ny
;

961 
íd_y
 = 
ny
;

962 
	`gíîic_compuã_m©rix
(&
dñè_io_to_fb
, 
sour˚_ty≥
, 
sök_ty≥
,

963 
sour˚_x
, 
sour˚_y
, 
°¨t_x
, 
íd_x
, 
°¨t_y
,

964 
íd_y
, 
rouãr_›ts
, 
dë_routög_¨ch
,

965 
£gmít_öf
, 
timög_öf
);

966 
	}
}

970 
	$compuã_dñè_fb_to_io
(
s_rouãr_›ts
 
rouãr_›ts
,

971 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

972 
t_£gmít_öf
 * 
£gmít_öf
,

973 
t_timög_öf
 
timög_öf
)

975 
sour˚_x
, 
sour˚_y
, 
sök_x
, 
sök_y
;

976 
dñè_x
, 
dñè_y
;

977 
t_ty≥_±r
 
sour˚_ty≥
, 
sök_ty≥
;

979 
sour˚_ty≥
 = 
FILL_TYPE
;

980 
sök_ty≥
 = 
IO_TYPE
;

982 
dñè_fb_to_io
[0][0] = 
IMPOSSIBLE
;

983 
dñè_fb_to_io
[
nx
][
ny
] = 
IMPOSSIBLE
;

985 
sök_x
 = 0;

986 
sök_y
 = 1;

987 
sour˚_x
 = 1; sour˚_x <
nx
; source_x++)

989 
sour˚_y
 = 1; sour˚_y <
ny
; source_y++)

991 
dñè_x
 = 
	`abs
(
sour˚_x
 - 
sök_x
);

992 
dñè_y
 = 
	`abs
(
sour˚_y
 - 
sök_y
);

994 
dñè_fb_to_io
[
dñè_x
][
dñè_y
] =

995 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
,

996 
sour˚_y
, 
sök_ty≥
,

997 
sök_x
, 
sök_y
,

998 
rouãr_›ts
,

999 
dë_routög_¨ch
,

1000 
£gmít_öf
, 
timög_öf
);

1004 
sök_x
 = 1;

1005 
sök_y
 = 0;

1006 
sour˚_x
 = 1;

1007 
dñè_x
 = 
	`abs
(
sour˚_x
 - 
sök_x
);

1008 
sour˚_y
 = 1; sour˚_y <
ny
; source_y++)

1010 
dñè_y
 = 
	`abs
(
sour˚_y
 - 
sök_y
);

1011 
dñè_fb_to_io
[
dñè_x
][
dñè_y
] =

1012 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

1013 
sök_ty≥
, 
sök_x
, 
sök_y
,

1014 
rouãr_›ts
, 
dë_routög_¨ch
,

1015 
£gmít_öf
, 
timög_öf
);

1018 
sök_x
 = 1;

1019 
sök_y
 = 0;

1020 
sour˚_y
 = 
ny
;

1021 
dñè_y
 = 
	`abs
(
sour˚_y
 - 
sök_y
);

1022 
sour˚_x
 = 2; sour˚_x <
nx
; source_x++)

1024 
dñè_x
 = 
	`abs
(
sour˚_x
 - 
sök_x
);

1025 
dñè_fb_to_io
[
dñè_x
][
dñè_y
] =

1026 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

1027 
sök_ty≥
, 
sök_x
, 
sök_y
,

1028 
rouãr_›ts
, 
dë_routög_¨ch
,

1029 
£gmít_öf
, 
timög_öf
);

1031 
	}
}

1035 
	$compuã_dñè_io_to_io
(
s_rouãr_›ts
 
rouãr_›ts
,

1036 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

1037 
t_£gmít_öf
 * 
£gmít_öf
,

1038 
t_timög_öf
 
timög_öf
)

1040 
sour˚_x
, 
sour˚_y
, 
sök_x
, 
sök_y
;

1041 
dñè_x
, 
dñè_y
;

1042 
t_ty≥_±r
 
sour˚_ty≥
, 
sök_ty≥
;

1044 
sour˚_ty≥
 = 
IO_TYPE
;

1045 
sök_ty≥
 = 
IO_TYPE
;

1047 
dñè_io_to_io
[0][0] = 0;

1048 
dñè_io_to_io
[
nx
 + 1][
ny
 + 1] = 
IMPOSSIBLE
;

1049 
dñè_io_to_io
[0][
ny
] = 
IMPOSSIBLE
;

1050 
dñè_io_to_io
[
nx
][0] = 
IMPOSSIBLE
;

1051 
dñè_io_to_io
[
nx
][
ny
 + 1] = 
IMPOSSIBLE
;

1052 
dñè_io_to_io
[
nx
 + 1][
ny
] = 
IMPOSSIBLE
;

1055 
sour˚_x
 = 0;

1056 
sour˚_y
 = 1;

1057 
sök_x
 = 0;

1058 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

1061 
sök_y
 = 2; sök_y <
ny
; sink_y++)

1063 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

1064 
dñè_io_to_io
[
dñè_x
][
dñè_y
] =

1065 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

1066 
sök_ty≥
, 
sök_x
, 
sök_y
,

1067 
rouãr_›ts
, 
dë_routög_¨ch
,

1068 
£gmít_öf
, 
timög_öf
);

1072 
sour˚_x
 = 0;

1073 
sour˚_y
 = 1;

1074 
sök_x
 = 
nx
 + 1;

1075 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

1077 
sök_y
 = 1; sök_y <
ny
; sink_y++)

1079 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

1080 
dñè_io_to_io
[
dñè_x
][
dñè_y
] =

1081 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

1082 
sök_ty≥
, 
sök_x
, 
sök_y
,

1083 
rouãr_›ts
, 
dë_routög_¨ch
,

1084 
£gmít_öf
, 
timög_öf
);

1089 
sour˚_x
 = 1;

1090 
sour˚_y
 = 0;

1091 
sök_y
 = 0;

1092 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

1094 
sök_x
 = 2; sök_x <
nx
; sink_x++)

1096 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

1097 
dñè_io_to_io
[
dñè_x
][
dñè_y
] =

1098 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

1099 
sök_ty≥
, 
sök_x
, 
sök_y
,

1100 
rouãr_›ts
, 
dë_routög_¨ch
,

1101 
£gmít_öf
, 
timög_öf
);

1105 
sour˚_x
 = 1;

1106 
sour˚_y
 = 0;

1107 
sök_y
 = 
ny
 + 1;

1108 
dñè_y
 = 
	`abs
(
sök_y
 - 
sour˚_y
);

1110 
sök_x
 = 1; sök_x <
nx
; sink_x++)

1112 
dñè_x
 = 
	`abs
(
sök_x
 - 
sour˚_x
);

1113 
dñè_io_to_io
[
dñè_x
][
dñè_y
] =

1114 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
, 
sour˚_y
,

1115 
sök_ty≥
, 
sök_x
, 
sök_y
,

1116 
rouãr_›ts
, 
dë_routög_¨ch
,

1117 
£gmít_öf
, 
timög_öf
);

1121 
sour˚_x
 = 0;

1122 
sök_y
 = 
ny
 + 1;

1123 
sour˚_y
 = 1; sour˚_y <
ny
; source_y++)

1125 
sök_x
 = 1; sök_x <
nx
; sink_x++)

1127 
dñè_y
 = 
	`abs
(
sour˚_y
 - 
sök_y
);

1128 
dñè_x
 = 
	`abs
(
sour˚_x
 - 
sök_x
);

1129 
dñè_io_to_io
[
dñè_x
][
dñè_y
] =

1130 
	`assign_blocks_™d_rouã_√t
(
sour˚_ty≥
, 
sour˚_x
,

1131 
sour˚_y
, 
sök_ty≥
,

1132 
sök_x
, 
sök_y
,

1133 
rouãr_›ts
,

1134 
dë_routög_¨ch
,

1135 
£gmít_öf
, 
timög_öf
);

1139 
	}
}

1142 #ifde‡
PRINT_ARRAYS


1144 
	$¥öt_¨øy
(**
¨øy_to_¥öt
,

1145 
x1
,

1146 
x2
,

1147 
y1
,

1148 
y2
)

1152 
idx_x
, 
idx_y
;

1154 
	`Ârötf
(
lookup_dump
, "\nPrinting Array \n\n");

1156 
idx_y
 = 
y2
; idx_y >
y1
; idx_y--)

1158 
idx_x
 = 
x1
; idx_x <
x2
; idx_x++)

1160 
	`Ârötf
(
lookup_dump
, " %9.2e",

1161 
¨øy_to_¥öt
[
idx_x
][
idx_y
]);

1163 
	`Ârötf
(
lookup_dump
, "\n");

1165 
	`Ârötf
(
lookup_dump
, "\n\n");

1166 
	}
}

1170 
	$compuã_dñè_¨øys
(
s_rouãr_›ts
 
rouãr_›ts
,

1171 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

1172 
t_£gmít_öf
 * 
£gmít_öf
,

1173 
t_timög_öf
 
timög_öf
,

1174 
l⁄ge°_Àngth
)

1177 
¥ötf


1179 
	`compuã_dñè_io_to_io
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1180 
timög_öf
);

1181 
¥ötf


1183 
	`compuã_dñè_io_to_fb
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1184 
timög_öf
);

1185 
¥ötf


1187 
	`compuã_dñè_fb_to_io
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1188 
timög_öf
);

1189 
¥ötf


1191 
	`compuã_dñè_fb_to_fb
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1192 
timög_öf
, 
l⁄ge°_Àngth
);

1194 #ifde‡
PRINT_ARRAYS


1195 
lookup_dump
 = 
	`my_f›í
(
DUMPFILE
, "w");

1196 
	`Ârötf
(
lookup_dump
, "\n\nprinting delta_fb_to_fb\n");

1197 
	`¥öt_¨øy
(
dñè_fb_to_fb
, 0, 
nx
 - 1, 0, 
ny
 - 1);

1198 
	`Ârötf
(
lookup_dump
, "\n\nprinting delta_io_to_fb\n");

1199 
	`¥öt_¨øy
(
dñè_io_to_fb
, 0, 
nx
, 0, 
ny
);

1200 
	`Ârötf
(
lookup_dump
, "\n\nprinting delta_fb_to_io\n");

1201 
	`¥öt_¨øy
(
dñè_fb_to_io
, 0, 
nx
, 0, 
ny
);

1202 
	`Ârötf
(
lookup_dump
, "\n\nprinting delta_io_to_io\n");

1203 
	`¥öt_¨øy
(
dñè_io_to_io
, 0, 
nx
 + 1, 0, 
ny
 + 1);

1204 
	`f˛o£
(
lookup_dump
);

1207 
	}
}

1213 
	$compuã_dñay_lookup_èbÀs
(
s_rouãr_›ts
 
rouãr_›ts
,

1214 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

1215 
t_£gmít_öf
 * 
£gmít_öf
,

1216 
t_timög_öf
 
timög_öf
,

1217 
t_ch™_width_di°
 
ch™_width_di°
,

1218 
t_subblock_d©a
 
subblock_d©a
)

1221 
s_√t
 *
‹igöÆ_√t
;

1226 
s_block
 *
‹igöÆ_block
;

1228 
‹igöÆ_num_√ts
;

1229 
‹igöÆ_num_blocks
;

1230 
l⁄ge°_Àngth
;

1232 
	`lﬂd_sim∂ifõd_devi˚
();

1234 
	`Æloc_™d_assign_öã∫Æ_°ru˘uªs
(&
‹igöÆ_√t
,

1235 &
‹igöÆ_block
,

1236 &
‹igöÆ_num_√ts
,

1237 &
‹igöÆ_num_blocks
);

1238 
	`£tup_ch™_width
(
rouãr_›ts
, 
ch™_width_di°
);

1240 
	`Æloc_routög_°ru˘s
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1241 
timög_öf
, 
subblock_d©a
);

1243 
l⁄ge°_Àngth
 =

1244 
	`gë_l⁄ge°_£gmít_Àngth
(
dë_routög_¨ch
, 
£gmít_öf
);

1248 
	`Æloc_dñè_¨øys
();

1249 
	`compuã_dñè_¨øys
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1250 
timög_öf
, 
l⁄ge°_Àngth
);

1253 
	`‰ì_routög_°ru˘s
(
rouãr_›ts
, 
dë_routög_¨ch
, 
£gmít_öf
,

1254 
timög_öf
);

1256 
	`ª°‹e_‹igöÆ_devi˚
();

1258 
	`‰ì_™d_ª£t_öã∫Æ_°ru˘uªs
(
‹igöÆ_√t
, 
‹igöÆ_block
,

1259 
‹igöÆ_num_√ts
,

1260 
‹igöÆ_num_blocks
);

1261 
	}
}

1265 
	$‰ì_∂a˚_lookup_°ru˘s
()

1268 
	`‰ì_dñè_¨øys
();

1270 
	}
}

	@timing_place_lookup.h

1 
	#IMPOSSIBLE
 -1

	)

4 
compuã_dñay_lookup_èbÀs
(
s_rouãr_›ts
 
rouãr_›ts
,

5 
s_dë_routög_¨ch
 
dë_routög_¨ch
,

6 
t_£gmít_öf
 * 
£gmít_öf
,

7 
t_timög_öf
 
timög_öf
,

8 
t_ch™_width_di°
 
ch™_width_di°
,

9 
t_subblock_d©a
 
subblock_d©a
);

10 
‰ì_∂a˚_lookup_°ru˘s
();

12 **
dñè_io_to_fb
;

13 **
dñè_fb_to_fb
;

14 **
dñè_fb_to_io
;

15 **
dñè_io_to_io
;

	@util.c

1 
	~<°rög.h
>

2 
	~<as£π.h
>

3 
	~<°dio.h
>

4 
	~<°dlib.h
>

5 
	~"utû.h
"

6 
	~"v¥_ty≥s.h
"

7 
	~"globÆs.h
"

16 
	glöíum
;

22 
	$limô_vÆue
(
cur
,

23 
max
,

24 c⁄° *
«me
)

26 if(
cur
 > 
max
)

28 
	`¥ötf
(
WARNTAG
 "%s is beingÜimited from [%d]Åo [%d]\n",

29 
«me
, 
cur
, 
max
);

30  
max
;

32  
cur
;

33 
	}
}

38 
	$my_°∫˝y
(*
de°
,

39 c⁄° *
§c
,

40 
size_t
 
size
)

43 
size_t
 
Àn
 = 
	`°æí
(
§c
);

46 if(
size
 <
Àn
)

47 
Àn
 = (
size
 - 1);

50 
	`mem˝y
(
de°
, 
§c
, 
Àn
);

53 
de°
[
Àn
] = '\0';

55  
de°
;

56 
	}
}

59 
FILE
 *

60 
	$my_f›í
(c⁄° *
‚ame
,

61 c⁄° *
Êag
)

63 
FILE
 *
Â
;

64 
Lí
;

65 *
√w_‚ame
 = 
NULL
;

68 if(
OutFûePªfix
)

70 if(
	`°rchr
(
Êag
, 'w'))

72 
Lí
 = 1;

73 
Lí
 +
	`°æí
(
OutFûePªfix
);

74 
Lí
 +
	`°æí
(
‚ame
);

75 
√w_‚ame
 = (*)
	`my_mÆloc
(
Lí
 * ());

76 
	`°r˝y
(
√w_‚ame
, 
OutFûePªfix
);

77 
	`°rˇt
(
√w_‚ame
, 
‚ame
);

78 
‚ame
 = 
√w_‚ame
;

82 if(
NULL
 =(
Â
 = 
	`f›í
(
‚ame
, 
Êag
)))

84 
	`¥ötf
("Eº‹ o≥nög fûê%†f‹ %†ac˚ss.\n", 
‚ame
, 
Êag
);

85 
	`exô
(1);

88 if(
√w_‚ame
)

89 
	`‰ì
(
√w_‚ame
);

91  (
Â
);

92 
	}
}

96 
	$my_°rdup
(c⁄° *
°r
)

98 
Lí
;

99 *
D°
;

101 
Lí
 = 1 + 
	`°æí
(
°r
);

102 
D°
 = (*)
	`my_mÆloc
(
Lí
 * ());

103 
	`mem˝y
(
D°
, 
°r
, 
Lí
);

105  
D°
;

106 
	}
}

110 
	$my_©oi
(c⁄° *
°r
)

116 if(
°r
[0] < '0' || str[0] > '9')

118 if(!(
°r
[0] == '-' && str[1] >= '0' && str[1] <= '9'))

120 
	`¥ötf
(
ERRTAG
 "ex≥˘edÇumbî in°ód o‡'%s'.\n", 
°r
);

121 
	`exô
(1);

124  (
	`©oi
(
°r
));

125 
	}
}

129 
	$my_ˇŒoc
(
size_t
 
√Àm
,

130 
size_t
 
size
)

133 *
ªt
;

135 if((
ªt
 = 
	`ˇŒoc
(
√Àm
, 
size
)Ë=
NULL
)

137 
	`Ârötf
(
°dîr
, "Error: UnableÅo calloc memory. Aborting.\n");

138 
	`exô
(1);

140  (
ªt
);

141 
	}
}

145 
	$my_mÆloc
(
size_t
 
size
)

148 *
ªt
;

150 if((
ªt
 = 
	`mÆloc
(
size
)Ë=
NULL
)

152 
	`Ârötf
(
°dîr
, "Error: UnableÅo malloc memory. Aborting.\n");

153 
	`ab‹t
();

154 
	`exô
(1);

156  (
ªt
);

157 
	}
}

162 
	$my_ªÆloc
(*
±r
,

163 
size_t
 
size
)

166 *
ªt
;

168 if(
size
 <= 0)

170 
	`¥ötf
("reallocating of size <= 0.\n");

173 
ªt
 = 
	`ªÆloc
(
±r
, 
size
);

174 if(
NULL
 =
ªt
)

176 
	`¥ötf
(
ERRTAG
 "UnableÅoÑealloc memory. Aborting. "

177 "±r=%p, Size=%d.\n", 
±r
, 
size
);

178 if(
±r
 =
NULL
)

180 
	`¥ötf
(
ERRTAG
 "my_realloc:Ötr == NULL. Aborting.\n");

182 
	`exô
(1);

184  (
ªt
);

185 
	}
}

189 
	$my_chunk_mÆloc
(
size_t
 
size
,

190 
s_löked_v±r
 **
chunk_±r_hód
,

191 *
mem_avaû_±r
,

192 **
√xt_mem_loc_±r
)

216 
	tAlign
;

218 
	#CHUNK_SIZE
 32768

	)

219 
	#FRAGMENT_THRESHOLD
 100

	)

221 *
tmp_±r
;

222 
Æig√d_size
;

224 
	`as£π
(*
mem_avaû_±r
 >= 0);

226 if((
size_t
Ë(*
mem_avaû_±r
Ë< 
size
)

228 if(
size
 > 
CHUNK_SIZE
)

230 
tmp_±r
 = 
	`my_mÆloc
(
size
);

240 if(
chunk_±r_hód
 !
NULL
)

241 *
chunk_±r_hód
 =

242 
	`ö£π_ö_v±r_li°
(*
chunk_±r_hód
, 
tmp_±r
);

243  (
tmp_±r
);

246 if(*
mem_avaû_±r
 < 
FRAGMENT_THRESHOLD
)

248 *
√xt_mem_loc_±r
 = 
	`my_mÆloc
(
CHUNK_SIZE
);

249 *
mem_avaû_±r
 = 
CHUNK_SIZE
;

250 if(
chunk_±r_hód
 !
NULL
)

251 *
chunk_±r_hód
 = 
	`ö£π_ö_v±r_li°
(*chunk_ptr_head,

252 *
√xt_mem_loc_±r
);

261 
tmp_±r
 = 
	`my_mÆloc
(
size
);

262 if(
chunk_±r_hód
 !
NULL
)

263 *
chunk_±r_hód
 =

264 
	`ö£π_ö_v±r_li°
(*
chunk_±r_hód
, 
tmp_±r
);

265  (
tmp_±r
);

272 if(
size
 % (
Align
) == 0)

274 
Æig√d_size
 = 
size
;

278 
Æig√d_size
 = 
size
 + (
Align
) - size % (Align);

281 
tmp_±r
 = *
√xt_mem_loc_±r
;

282 *
√xt_mem_loc_±r
 +
Æig√d_size
;

283 *
mem_avaû_±r
 -
Æig√d_size
;

284  (
tmp_±r
);

285 
	}
}

289 
	$‰ì_chunk_mem‹y
(
s_löked_v±r
 *
chunk_±r_hód
)

294 
s_löked_v±r
 *
cuº_±r
, *
¥ev_±r
;

296 
cuº_±r
 = 
chunk_±r_hód
;

298 
cuº_±r
 !
NULL
)

300 
	`‰ì
(
cuº_±r
->
d©a_v±r
);

301 
¥ev_±r
 = 
cuº_±r
;

302 
cuº_±r
 = cuº_±r->
√xt
;

303 
	`‰ì
(
¥ev_±r
);

305 
	}
}

308 
s_löked_v±r
 *

309 
	$ö£π_ö_v±r_li°
(
s_löked_v±r
 *
hód
,

310 *
v±r_to_add
)

316 
s_löked_v±r
 *
löked_v±r
;

318 
löked_v±r
 = (
s_löked_v±r
 *)
	`my_mÆloc
((

319 
s_löked_v±r
));

321 
löked_v±r
->
d©a_v±r
 = 
v±r_to_add
;

322 
löked_v±r
->
√xt
 = 
hód
;

323  (
löked_v±r
);

324 
	}
}

327 
t_löked_öt
 *

328 
	$ö£π_ö_öt_li°
(
t_löked_öt
 * 
hód
,

329 
d©a
,

330 
t_löked_öt
 ** 
‰ì_li°_hód_±r
)

338 
t_löked_öt
 *
löked_öt
;

340 if(*
‰ì_li°_hód_±r
 !
NULL
)

342 
löked_öt
 = *
‰ì_li°_hód_±r
;

343 *
‰ì_li°_hód_±r
 = 
löked_öt
->
√xt
;

347 
löked_öt
 = (
t_löked_öt
 *Ë
	`my_mÆloc
((t_linked_int));

350 
löked_öt
->
d©a
 = data;

351 
löked_öt
->
√xt
 = 
hód
;

352  (
löked_öt
);

353 
	}
}

357 
	$‰ì_öt_li°
(
t_löked_öt
 ** 
öt_li°_hód_±r
)

363 
t_löked_öt
 *
löked_öt
, *
√xt_löked_öt
;

365 
löked_öt
 = *
öt_li°_hód_±r
;

367 
löked_öt
 !
NULL
)

369 
√xt_löked_öt
 = 
löked_öt
->
√xt
;

370 
	`‰ì
(
löked_öt
);

371 
löked_öt
 = 
√xt_löked_öt
;

374 *
öt_li°_hód_±r
 = 
NULL
;

375 
	}
}

379 
	$Æloc_ive˘‹_™d_c›y_öt_li°
(
t_löked_öt
 ** 
li°_hód_±r
,

380 
num_ôems
,

381 
s_ivec
 *
ivec
,

382 
t_löked_öt
 ** 
‰ì_li°_hód_±r
)

390 
t_löked_öt
 *
löked_öt
, *
li°_hód
;

391 
i
, *
li°
;

393 
li°_hód
 = *
li°_hód_±r
;

395 if(
num_ôems
 == 0)

397 
ivec
->
√Àm
 = 0;

398 
ivec
->
li°
 = 
NULL
;

400 if(
li°_hód
 !
NULL
)

402 
	`¥ötf
(
ERRTAG


404 "buàli°áà%∞c⁄èö†m‹e.\n", 
num_ôems
,

405 (*)
li°_hód
);

406 
	`exô
(1);

411 
ivec
->
√Àm
 = 
num_ôems
;

412 
li°
 = (*)
	`my_mÆloc
(
num_ôems
 * ());

413 
ivec
->
li°
 =Üist;

414 
löked_öt
 = 
li°_hód
;

416 
i
 = 0; i < 
num_ôems
 - 1; i++)

418 
li°
[
i
] = 
löked_öt
->
d©a
;

419 
löked_öt
 =Üöked_öt->
√xt
;

422 
li°
[
num_ôems
 - 1] = 
löked_öt
->
d©a
;

424 if(
löked_öt
->
√xt
 !
NULL
)

426 
¥ötf


428 "buàli°áà%∞c⁄èö†m‹e.\n", 
num_ôems
,

429 (*)
li°_hód
);

430 
	`exô
(1);

433 
löked_öt
->
√xt
 = *
‰ì_li°_hód_±r
;

434 *
‰ì_li°_hód_±r
 = 
li°_hód
;

435 *
li°_hód_±r
 = 
NULL
;

436 
	}
}

439 
	gc⁄t
;

442 
	$my_fgës
(*
buf
,

443 
max_size
,

444 
FILE
 * 
Â
)

450 *
vÆ
;

451 
i
;

453 
c⁄t
 = 0;

454 
vÆ
 = 
	`fgës
(
buf
, 
max_size
, 
Â
);

455 
löíum
++;

456 if(
vÆ
 =
NULL
)

457  (
vÆ
);

462 
i
 = 0; i < 
max_size
; i++)

464 if(
buf
[
i
] == '\n')

466 if(
buf
[
i
] == '\0')

468 
¥ötf


470 
löíum
);

471 
	`¥ötf
("AllÜines must beát most %d charactersÜong.\n",

472 
BUFSIZE
 - 2);

473 
¥ötf


475 
	`exô
(1);

480 
i
 = 0; i < 
max_size
 && 
buf
[i] != '\0'; i++)

482 if(
buf
[
i
] == '#')

484 
buf
[
i
] = '\0';

489 if(
i
 < 2)

490  (
vÆ
);

491 if(
buf
[
i
 - 1] == '\n' && buf[i - 2] == '\\')

493 
c⁄t
 = 1;

494 
buf
[
i
 - 2] = '\n';

495 
buf
[
i
 - 1] = '\0';

497  (
vÆ
);

498 
	}
}

502 
	$my_°πok
(*
±r
,

503 *
tokís
,

504 
FILE
 * 
Â
,

505 *
buf
)

517 *
vÆ
;

519 
vÆ
 = 
	`°πok
(
±r
, 
tokís
);

522 if(
vÆ
 !
NULL
 || 
c⁄t
 == 0)

523  (
vÆ
);

526 if(
	`my_fgës
(
buf
, 
BUFSIZE
, 
Â
Ë=
NULL
)

527  (
NULL
);

529 
vÆ
 = 
	`°πok
(
buf
, 
tokís
);

531 
	}
}

535 
	$‰ì_ivec_ve˘‹
(
s_ivec
 *
ivec_ve˘‹
,

536 
ƒmö
,

537 
ƒmax
)

542 
i
;

544 
i
 = 
ƒmö
; i <
ƒmax
; i++)

545 if(
ivec_ve˘‹
[
i
].
√Àm
 != 0)

546 
	`‰ì
(
ivec_ve˘‹
[
i
].
li°
);

548 
	`‰ì
(
ivec_ve˘‹
 + 
ƒmö
);

549 
	}
}

553 
	$‰ì_ivec_m©rix
(
s_ivec
 **
ivec_m©rix
,

554 
ƒmö
,

555 
ƒmax
,

556 
ncmö
,

557 
ncmax
)

562 
i
, 
j
;

564 
i
 = 
ƒmö
; i <
ƒmax
; i++)

566 
j
 = 
ncmö
; j <
ncmax
; j++)

568 if(
ivec_m©rix
[
i
][
j
].
√Àm
 != 0)

570 
	`‰ì
(
ivec_m©rix
[
i
][
j
].
li°
);

575 
	`‰ì_m©rix
(
ivec_m©rix
, 
ƒmö
, 
ƒmax
, 
ncmö
, (
s_ivec
));

576 
	}
}

580 
	$‰ì_ivec_m©rix3
(
s_ivec
 ***
ivec_m©rix3
,

581 
ƒmö
,

582 
ƒmax
,

583 
ncmö
,

584 
ncmax
,

585 
ndmö
,

586 
ndmax
)

591 
i
, 
j
, 
k
;

593 
i
 = 
ƒmö
; i <
ƒmax
; i++)

595 
j
 = 
ncmö
; j <
ncmax
; j++)

597 
k
 = 
ndmö
; k <
ndmax
; k++)

599 if(
ivec_m©rix3
[
i
][
j
][
k
].
√Àm
 != 0)

601 
	`‰ì
(
ivec_m©rix3
[
i
][
j
][
k
].
li°
);

607 
	`‰ì_m©rix3
(
ivec_m©rix3
, 
ƒmö
, 
ƒmax
, 
ncmö
, 
ncmax
, 
ndmö
,

608 (
s_ivec
));

609 
	}
}

613 
	$Æloc_m©rix
(
ƒmö
,

614 
ƒmax
,

615 
ncmö
,

616 
ncmax
,

617 
size_t
 
ñsize
)

625 
i
;

626 **
˝å
;

628 
˝å
 = (**)
	`my_mÆloc
((
ƒmax
 - 
ƒmö
 + 1) * (*));

629 
˝å
 -
ƒmö
;

630 
i
 = 
ƒmö
; i <
ƒmax
; i++)

632 
˝å
[
i
] = (*)
	`my_mÆloc
((
ncmax
 - 
ncmö
 + 1Ë* 
ñsize
);

633 
˝å
[
i
] -
ncmö
 * 
ñsize
 / ();

635  ((**)
˝å
);

636 
	}
}

643 
	$‰ì_m©rix
(*
v±r
,

644 
ƒmö
,

645 
ƒmax
,

646 
ncmö
,

647 
size_t
 
ñsize
)

650 
i
;

651 **
˝å
;

653 
˝å
 = (**)
v±r
;

655 
i
 = 
ƒmö
; i <
ƒmax
; i++)

656 
	`‰ì
(
˝å
[
i
] + 
ncmö
 * 
ñsize
 / ());

657 
	`‰ì
(
˝å
 + 
ƒmö
);

658 
	}
}

662 
	$Æloc_m©rix3
(
ƒmö
,

663 
ƒmax
,

664 
ncmö
,

665 
ncmax
,

666 
ndmö
,

667 
ndmax
,

668 
size_t
 
ñsize
)

677 
i
, 
j
;

678 ***
˝å
;

680 
˝å
 = (***)
	`my_mÆloc
((
ƒmax
 - 
ƒmö
 + 1) * (**));

681 
˝å
 -
ƒmö
;

682 
i
 = 
ƒmö
; i <
ƒmax
; i++)

684 
˝å
[
i
] =

685 (**)
	`my_mÆloc
((
ncmax
 - 
ncmö
 + 1) * (*));

686 
˝å
[
i
] -
ncmö
;

687 
j
 = 
ncmö
; j <
ncmax
; j++)

689 
˝å
[
i
][
j
] =

690 (*)
	`my_mÆloc
((
ndmax
 - 
ndmö
 + 1Ë* 
ñsize
);

691 
˝å
[
i
][
j
] -
ndmö
 * 
ñsize
 / ();

694  ((***)
˝å
);

695 
	}
}

698 
	$Æloc_m©rix4
(
ƒmö
,

699 
ƒmax
,

700 
ncmö
,

701 
ncmax
,

702 
ndmö
,

703 
ndmax
,

704 
√mö
,

705 
√max
,

706 
size_t
 
ñsize
)

715 
i
, 
j
, 
k
;

716 ****
˝å
;

718 
˝å
 = (****)
	`my_mÆloc
((
ƒmax
 - 
ƒmö
 + 1) * (***));

719 
˝å
 -
ƒmö
;

720 
i
 = 
ƒmö
; i <
ƒmax
; i++)

722 
˝å
[
i
] =

723 (***)
	`my_mÆloc
((
ncmax
 - 
ncmö
 + 1) * (**));

724 
˝å
[
i
] -
ncmö
;

725 
j
 = 
ncmö
; j <
ncmax
; j++)

727 
˝å
[
i
][
j
] =

728 (**)
	`my_mÆloc
((
ndmax
 - 
ndmö
 + 1) *

730 
˝å
[
i
][
j
] -
ndmö
;

731 
k
 = 
ndmö
; k <
ndmax
; k++)

733 
˝å
[
i
][
j
][
k
] =

734 (*)
	`my_mÆloc
((
√max
 - 
√mö
 + 1) *

735 
ñsize
);

736 
˝å
[
i
][
j
][
k
] -
√mö
 * 
ñsize
 / ();

740  ((****)
˝å
);

741 
	}
}

744 
	$¥öt_öt_m©rix3
(***
v±r
,

745 
ƒmö
,

746 
ƒmax
,

747 
ncmö
,

748 
ncmax
,

749 
ndmö
,

750 
ndmax
,

751 *
fûe
)

753 
FILE
 *
outfûe
;

754 
i
, 
j
, 
k
;

756 
outfûe
 = 
	`my_f›í
(
fûe
, "w");

758 
k
 = 
ƒmö
; k <
ƒmax
; ++k)

760 
	`Ârötf
(
outfûe
, "Pœ√ %d\n", 
k
);

761 
j
 = 
ncmö
; j <
ncmax
; ++j)

763 
i
 = 
ndmö
; i <
ndmax
; ++i)

765 
	`Ârötf
(
outfûe
, "%d ", 
v±r
[
k
][
j
][
i
]);

767 
	`Ârötf
(
outfûe
, "\n");

769 
	`Ârötf
(
outfûe
, "\n");

772 
	`f˛o£
(
outfûe
);

773 
	}
}

777 
	$‰ì_m©rix3
(*
v±r
,

778 
ƒmö
,

779 
ƒmax
,

780 
ncmö
,

781 
ncmax
,

782 
ndmö
,

783 
size_t
 
ñsize
)

786 
i
, 
j
;

787 ***
˝å
;

789 
˝å
 = (***)
v±r
;

791 
i
 = 
ƒmö
; i <
ƒmax
; i++)

793 
j
 = 
ncmö
; j <
ncmax
; j++)

794 
	`‰ì
(
˝å
[
i
][
j
] + 
ndmö
 * 
ñsize
 / ());

795 
	`‰ì
(
˝å
[
i
] + 
ncmö
);

797 
	`‰ì
(
˝å
 + 
ƒmö
);

798 
	}
}

801 
	$‰ì_m©rix4
(*
v±r
,

802 
ƒmö
,

803 
ƒmax
,

804 
ncmö
,

805 
ncmax
,

806 
ndmö
,

807 
ndmax
,

808 
√mö
,

809 
size_t
 
ñsize
)

812 
i
, 
j
, 
k
;

813 ****
˝å
;

815 
˝å
 = (****)
v±r
;

817 
i
 = 
ƒmö
; i <
ƒmax
; i++)

819 
j
 = 
ncmö
; j <
ncmax
; j++)

821 
k
 = 
ndmö
; k <
ndmax
; k++)

822 
	`‰ì
(
˝å
[
i
][
j
][
k
] + 
√mö
 * 
ñsize
 / ());

823 
	`‰ì
(
˝å
[
i
][
j
] + 
ndmö
 * 
ñsize
 / ());

825 
	`‰ì
(
˝å
[
i
] + 
ncmö
);

827 
	`‰ì
(
˝å
 + 
ƒmö
);

828 
	}
}

834 
	#IA
 1103515245u

	)

835 
	#IC
 12345u

	)

836 
	#IM
 2147483648u

	)

837 
	#CHECK_RAND


	)

839 
	gcuºít_øndom
 = 0;

843 
	$my_§™dom
(
£ed
)

845 
cuºít_øndom
 = ()
£ed
;

846 
	}
}

850 
	$my_ú™d
(
imax
)

855 
ivÆ
;

858 
cuºít_øndom
 = cuºít_øndom * 
IA
 + 
IC
;

859 
ivÆ
 = 
cuºít_øndom
 & (
IM
 - 1);

860 
ivÆ
 = ()(()ivÆ * ()(
imax
 + 0.999Ë/ ()
IM
);

862 #ifde‡
CHECK_RAND


863 if((
ivÆ
 < 0Ë|| (ivÆ > 
imax
))

865 
	`¥ötf
("Bad vÆuêö my_ú™d, imax = %d ivÆ = %d\n", 
imax
,

866 
ivÆ
);

867 
	`exô
(1);

871  (
ivÆ
);

872 
	}
}

876 
	$my_‰™d
()

881 
fvÆ
;

882 
ivÆ
;

884 
cuºít_øndom
 = cuºít_øndom * 
IA
 + 
IC
;

885 
ivÆ
 = 
cuºít_øndom
 & (
IM
 - 1);

886 
fvÆ
 = ()
ivÆ
 / ()
IM
;

888 #ifde‡
CHECK_RAND


889 if((
fvÆ
 < 0) || (fval > 1.))

891 
	`¥ötf
("Bad vÆuêö my_‰™d, fvÆ = %g\n", 
fvÆ
);

892 
	`exô
(1);

896  (
fvÆ
);

897 
	}
}

	@util.h

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<m©h.h
>

7 
löíum
;

12 #i‚de‡
TRUE


14 { 
	mFALSE
, 
	mTRUE
 }

15 
	tboﬁón
;

17 
	tboﬁón
;

21 
	#IN


	)

22 
	#OUT


	)

23 
	#INOUT


	)

26 
	#ERRTAG
 "ERROR:\t"

	)

27 
	#WARNTAG
 "WARN:\t"

	)

29 
	#BUFSIZE
 300

	)

30 #i‚de‡
max


31 
	#max
(
a
,
b
Ë((◊Ë> (b))? (aË: (b))

	)

32 
	#mö
(
a
,
b
Ë(◊Ë> (b)? (bË: (a))

	)

34 
	#nöt
(
a
Ë((Ë
	`Êo‹
 (®+ 0.5))

	)

36 
limô_vÆue
(
cur
,

37 
max
,

38 c⁄° *
«me
);

42 
	ss_löked_v±r


44 *
	md©a_v±r
;

45 
s_löked_v±r
 *
	m√xt
;

48 
	ss_löked_öt


50 
	md©a
;

51 
s_löked_öt
 *
	m√xt
;

53 
s_löked_öt
 
	tt_löked_öt
;

59 
	ss_ivec


61 
	m√Àm
;

62 *
	mli°
;

64 
s_ivec
 
	tt_ivec
;

69 *
my_ˇŒoc
(
size_t
 
√Àm
,

70 
size_t
 
size
);

71 *
my_mÆloc
(
size_t
 
size
);

72 *
my_ªÆloc
(*
±r
,

73 
size_t
 
size
);

75 *
my_chunk_mÆloc
(
size_t
 
size
,

76 
s_löked_v±r
 **
chunk_±r_hód
,

77 *
mem_avaû_±r
,

78 **
√xt_mem_loc_±r
);

80 
‰ì_chunk_mem‹y
(
s_löked_v±r
 *
chunk_±r_hód
);

85 
‰ì_ivec_ve˘‹
(
s_ivec
 *
ivec_ve˘‹
,

86 
ƒmö
,

87 
ƒmax
);

89 
‰ì_ivec_m©rix
(
s_ivec
 **
ivec_m©rix
,

90 
ƒmö
,

91 
ƒmax
,

92 
ncmö
,

93 
ncmax
);

95 
‰ì_ivec_m©rix3
(
s_ivec
 ***
ivec_m©rix3
,

96 
ƒmö
,

97 
ƒmax
,

98 
ncmö
,

99 
ncmax
,

100 
ndmö
,

101 
ndmax
);

103 **
Æloc_m©rix
(
ƒmö
,

104 
ƒmax
,

105 
ncmö
,

106 
ncmax
,

107 
size_t
 
ñsize
);

109 ***
Æloc_m©rix3
(
ƒmö
,

110 
ƒmax
,

111 
ncmö
,

112 
ncmax
,

113 
ndmö
,

114 
ndmax
,

115 
size_t
 
ñsize
);

117 ****
Æloc_m©rix4
(
ƒmö
,

118 
ƒmax
,

119 
ncmö
,

120 
ncmax
,

121 
ndmö
,

122 
ndmax
,

123 
√mö
,

124 
√max
,

125 
size_t
 
ñsize
);

127 
‰ì_m©rix
(*
v±r
,

128 
ƒmö
,

129 
ƒmax
,

130 
ncmö
,

131 
size_t
 
ñsize
);

133 
‰ì_m©rix3
(*
v±r
,

134 
ƒmö
,

135 
ƒmax
,

136 
ncmö
,

137 
ncmax
,

138 
ndmö
,

139 
size_t
 
ñsize
);

141 
‰ì_m©rix4
(*
v±r
,

142 
ƒmö
,

143 
ƒmax
,

144 
ncmö
,

145 
ncmax
,

146 
ndmö
,

147 
ndmax
,

148 
√mö
,

149 
size_t
 
ñsize
);

151 
¥öt_öt_m©rix3
(***
v±r
,

152 
ƒmö
,

153 
ƒmax
,

154 
ncmö
,

155 
ncmax
,

156 
ndmö
,

157 
ndmax
,

158 *
fûe
);

160 
s_löked_v±r
 *
ö£π_ö_v±r_li°
(s_löked_v±∏*
hód
,

161 *
v±r_to_add
);

163 
t_löked_öt
 *
ö£π_ö_öt_li°
—_löked_öà* 
hód
,

164 
d©a
,

165 
t_löked_öt
 ** 
‰ì_li°_hód_±r
);

167 
‰ì_öt_li°
(
t_löked_öt
 ** 
öt_li°_hód_±r
);

169 
Æloc_ive˘‹_™d_c›y_öt_li°
(
t_löked_öt
 ** 
li°_hód_±r
,

170 
num_ôems
,

171 
s_ivec
 *
ivec
,

172 
t_löked_öt
 ** 
‰ì_li°_hód_±r
);

177 
FILE
 *
my_f›í
(c⁄° *
‚ame
,

178 c⁄° *
Êag
);

180 *
my_°πok
(*
±r
,

181 *
tokís
,

182 
FILE
 * 
Â
,

183 *
buf
);

185 *
my_fgës
(*
buf
,

186 
max_size
,

187 
FILE
 * 
Â
);

189 
my_©oi
(c⁄° *
°r
);

191 *
my_°rdup
(c⁄° *
°r
);

193 *
my_°∫˝y
(*
de°
,

194 c⁄° *
§c
,

195 
size_t
 
size
);

199 
my_§™dom
(
£ed
);

200 
my_ú™d
(
imax
);

201 
my_‰™d
();

	@vpr_types.h

1 #i‚de‡
SPEC


2 
	#DEBUG
 1

	)

14 #ifde‡
SPEC


15 
	#NO_GRAPHICS


	)

16 
	#NDEBUG


	)

19 
	#TOKENS
 " \t\n"

	)

22 
	ee_pö_ty≥


23 { 
	mOPEN
 = -1, 
	mDRIVER
 = 0, 
	mRECEIVER
 = 1 };

27 
	ee_side


28 { 
	mTOP
 = 0, 
	mRIGHT
 = 1, 
	mBOTTOM
 = 2, 
	mLEFT
 = 3 };

30 
size_t
 
	tbôfõld
;

32 
	#MINOR
 0

	)

33 
	#MAJOR
 1

	)

35 
	#HUGE_FLOAT
 1.e30

	)

40 
	#MAX_CHANNEL_WIDTH
 8000

	)

41 
	#MAX_SHORT
 32767

	)

43 
	#EMPTY
 -1

	)

45 
	esched_ty≥


46 { 
	mAUTO_SCHED
, 
	mUSER_SCHED
 };

48 
	epic_ty≥


49 { 
	mNO_PICTURE
, 
	mPLACEMENT
, 
	mROUTING
 };

53 
	e∂a˚_c_ty≥s


54 { 
	mLINEAR_CONG
, 
	mNONLINEAR_CONG
 };

56 
	ee_›î©i⁄


57 { 
	mPLACE_AND_ROUTE
, 
	mPLACE_ONLY
, 
	mROUTE_ONLY
,

58 
	mTIMING_ANALYSIS_ONLY


61 
	ep‰eq


62 { 
	mPLACE_NEVER
, 
	mPLACE_ONCE
, 
	mPLACE_ALWAYS
 };

67 
	ee_∑d_loc_ty≥


68 { 
	mFREE
, 
	mRANDOM
, 
	mUSER
 };

71 
	ss_√t


73 *
	m«me
;

74 
	mnum_söks
;

75 *
	mnode_block
;

76 *
	mnode_block_pö
;

77 
boﬁón
 
	mis_globÆ
;

81 
	ss_T_subblock


83 **
	mT_comb
;

84 *
	mT_£q_ö
;

85 *
	mT_£q_out
;

87 
	tt_T_subblock
;

101 
	ss_timög_öf


103 
boﬁón
 
	mtimög_™Æysis_íabÀd
;

104 
	mC_ùö_cblock
;

105 
	mT_ùö_cblock
;

107 
	tt_timög_öf
;

108 
	ss_ty≥_timög_öf


110 
	mT_sblk_›ö_to_sblk_ùö
;

111 
	mT_fb_ùö_to_sblk_ùö
;

112 
	mT_sblk_›ö_to_fb_›ö
;

113 
t_T_subblock
 *
	mT_subblock
;

115 
	tt_ty≥_timög_öf
;

135 
	ee_grid_loc_ty≥


136 { 
	mBOUNDARY
 = 0, 
	mFILL
, 
	mCOL_REPEAT
, 
	mCOL_REL
 };

137 
	ss_grid_loc_def


139 
e_grid_loc_ty≥
 
	mgrid_loc_ty≥
;

140 
	m°¨t_cﬁ
;

141 
	mª≥©
;

142 
	mcﬁ_ªl
;

143 
	m¥i‹ôy
;

165 
	ss_ty≥_des¸ùt‹


167 c⁄° *
	m«me
;

168 
	mnum_pös
;

169 
	mˇ∑côy
;

171 
	mheight
;

172 ***
	mpöloc
;

174 
	mnum_˛ass
;

175 
s_˛ass
 *
	m˛ass_öf
;

176 *
	mpö_˛ass
;

178 
boﬁón
 *
	mis_globÆ_pö
;

180 
boﬁón
 
	mis_Fc_‰ac
;

181 
boﬁón
 
	mis_Fc_out_fuŒ_Êex
;

182 
	mFc_ö
;

183 
	mFc_out
;

186 
	mmax_subblocks
;

187 
	mmax_subblock_öputs
;

188 
	mmax_subblock_ouçuts
;

191 
s_grid_loc_def
 *
	mgrid_loc_def
;

192 
	mnum_grid_loc_def
;

195 
t_ty≥_timög_öf
 
	mty≥_timög_öf
;

198 
	mnum_drivîs
;

199 
	mnum_ª˚ivîs
;

201 
	mödex
;

203 
s_ty≥_des¸ùt‹
 
	tt_ty≥_des¸ùt‹
;

204 c⁄° 
	ts_ty≥_des¸ùt‹
 *
	tt_ty≥_±r
;

221 
	ss_block


223 *
	m«me
;

224 
t_ty≥_±r
 
	mty≥
;

225 *
	m√ts
;

226 
	mx
;

227 
	my
;

228 
	mz
;

240 
	ss_grid_tûe


242 
t_ty≥_±r
 
	mty≥
;

243 
	moff£t
;

244 
	mußge
;

245 *
	mblocks
;

256 
	ss_bb


258 
	mxmö
;

259 
	mxmax
;

260 
	mymö
;

261 
	mymax
;

269 
	ee_°©


270 { 
	mUNIFORM
, 
	mGAUSSIAN
, 
	mPULSE
, 
	mDELTA
 };

271 
	ss_ch™


273 
e_°©
 
	mty≥
;

274 
	m≥ak
;

275 
	mwidth
;

276 
	mx≥ak
;

277 
	mdc
;

279 
	tt_ch™
;

285 
	ss_ch™_width_di°


287 
	mch™_width_io
;

288 
t_ch™
 
	mch™_x_di°
;

289 
t_ch™
 
	mch™_y_di°
;

291 
	tt_ch™_width_di°
;

299 
	ss_˛ass


301 
e_pö_ty≥
 
	mty≥
;

302 
	mnum_pös
;

303 *
	mpöli°
;

305 
s_˛ass
 
	tt_˛ass
;

313 
	ss_∂a˚_ªgi⁄


315 
	mˇ∑côy
;

316 
	möv_ˇ∑côy
;

317 
	moccu∑ncy
;

318 
	mco°
;

326 
	ss_subblock


328 *
	m«me
;

329 
	m˛ock
;

330 *
	mouçuts
;

331 *
	möputs
;

333 
s_subblock
 
	tt_subblock
;

348 
	ss_subblock_d©a


350 
t_subblock
 **
	msubblock_öf
;

351 *
	mnum_subblocks_≥r_block
;

352 
	mnum_ff
;

353 
	mnum_c⁄°_gí
;

355 
s_subblock_d©a
 
	tt_subblock_d©a
;

368 
	ss_™√Æög_sched


370 
sched_ty≥
 
	mty≥
;

371 
	mö√r_num
;

372 
	möô_t
;

373 
	mÆpha_t
;

374 
	mexô_t
;

384 
	ee_∂a˚_Æg‹ôhm


385 { 
	mBOUNDING_BOX_PLACE
, 
	mNET_TIMING_DRIVEN_PLACE
,

386 
	mPATH_TIMING_DRIVEN_PLACE


388 
	ss_∂a˚r_›ts


390 
e_∂a˚_Æg‹ôhm
 
	m∂a˚_Æg‹ôhm
;

391 
	mtimög_åadeoff
;

392 
	mblock_di°
;

393 
∂a˚_c_ty≥s
 
	m∂a˚_co°_ty≥
;

394 
	m∂a˚_co°_exp
;

395 
	m∂a˚_ch™_width
;

396 
e_∑d_loc_ty≥
 
	m∑d_loc_ty≥
;

397 *
	m∑d_loc_fûe
;

398 
p‰eq
 
	m∂a˚_‰eq
;

399 
	mnum_ªgi⁄s
;

400 
	mªcompuã_¸ô_ôî
;

401 
boﬁón
 
	míabÀ_timög_compuèti⁄s
;

402 
	mö√r_lo›_ªcompuã_dividî
;

403 
	mtd_∂a˚_exp_fú°
;

404 
	m£ed
;

405 
	mtd_∂a˚_exp_œ°
;

439 
	ee_rouã_ty≥


440 { 
	mGLOBAL
, 
	mDETAILED
 };

441 
	ee_rouãr_Æg‹ôhm


442 { 
	mBREADTH_FIRST
, 
	mTIMING_DRIVEN
, 
	mDIRECTED_SEARCH
 };

443 
	ee_ba£_co°_ty≥


444 { 
	mINTRINSIC_DELAY
, 
	mDELAY_NORMALIZED
, 
	mDEMAND_ONLY
 };

446 
	#NO_FIXED_CHANNEL_WIDTH
 -1

	)

448 
	ss_rouãr_›ts


450 
	mfú°_ôî_¥es_Ác
;

451 
	möôül_¥es_Ác
;

452 
	m¥es_Ác_mu…
;

453 
	macc_Ác
;

454 
	mbíd_co°
;

455 
	mmax_rouãr_ôî©i⁄s
;

456 
	mbb_Á˘‹
;

457 
e_rouã_ty≥
 
	mrouã_ty≥
;

458 
	mfixed_ch™√l_width
;

459 
e_rouãr_Æg‹ôhm
 
	mrouãr_Æg‹ôhm
;

460 
e_ba£_co°_ty≥
 
	mba£_co°_ty≥
;

461 
	ma°¨_Ác
;

462 
	mmax_¸ôiˇlôy
;

463 
	m¸ôiˇlôy_exp
;

464 
boﬁón
 
	mvîify_bö¨y_£¨ch
;

465 
boﬁón
 
	mfuŒ_°©s
;

509 
	ee_dúe˘i⁄Æôy


510 { 
	mUNI_DIRECTIONAL
, 
	mBI_DIRECTIONAL
 };

511 
	ee_swôch_block_ty≥


512 { 
	mSUBSET
, 
	mWILTON
, 
	mUNIVERSAL
, 
	mFULL
 };

513 
e_swôch_block_ty≥
 
	tt_swôch_block_ty≥
;

514 
	ee_Fc_ty≥


515 { 
	mABSOLUTE
, 
	mFRACTIONAL
 };

517 
	ss_dë_routög_¨ch


519 
e_dúe˘i⁄Æôy
 
	mdúe˘i⁄Æôy
;

520 
	mFs
;

521 
e_swôch_block_ty≥
 
	mswôch_block_ty≥
;

522 
	mnum_£gmít
;

523 
	mnum_swôch
;

524 
	mglobÆ_rouã_swôch
;

525 
	mdñayÀss_swôch
;

526 
	mwúe_to_ùö_swôch
;

527 
	mR_möW_nmos
;

528 
	mR_möW_pmos
;

560 
	ee_drivîs


561 { 
	mMULTI_BUFFERED
, 
	mMULTI_MUXED
, 
	mMULTI_MERGED
, 
	mSINGLE
 };

565 
	ss_£gmít_öf


567 
	m‰equícy
;

568 
	mÀngth
;

569 
	mwúe_swôch
;

570 
	m›ö_swôch
;

571 
	m‰ac_cb
;

572 
	m‰ac_sb
;

573 
boﬁón
 
	ml⁄glöe
;

574 
	mRmëÆ
;

575 
	mCmëÆ
;

576 
e_dúe˘i⁄Æôy
 
	mdúe˘i⁄Æôy
;

577 
boﬁón
 *
	mcb
;

578 
	mcb_Àn
;

579 
boﬁón
 *
	msb
;

580 
	msb_Àn
;

582 
	tt_£gmít_öf
;

603 
	ss_swôch_öf


605 
boﬁón
 
	mbuf„ªd
;

606 
	mR
;

607 
	mCö
;

608 
	mCout
;

609 
	mTdñ
;

610 
	mmux_å™s_size
;

611 
	mbuf_size
;

612 *
	m«me
;

629 
	ee_dúe˘i⁄


631 
	mINC_DIRECTION
 = 0,

632 
	mDEC_DIRECTION
 = 1,

633 
	mBI_DIRECTION
 = 2

636 
	ss_£g_dëaûs


638 
	mÀngth
;

639 
	m°¨t
;

640 
boﬁón
 
	ml⁄glöe
;

641 
boﬁón
 *
	msb
;

642 
boﬁón
 *
	mcb
;

643 
	mwúe_swôch
;

644 
	m›ö_swôch
;

645 
	mRmëÆ
;

646 
	mCmëÆ
;

647 
boﬁón
 
	mtwi°ed
;

648 
e_dúe˘i⁄
 
	mdúe˘i⁄
;

649 
e_drivîs
 
	mdrivîs
;

650 
	m°¨t_åack
;

651 
	míd_åack
;

652 
	mgroup_°¨t
;

653 
	mgroup_size
;

654 
	mödex
;

656 
	tt_£g_dëaûs
;

680 
	ss_löked_f_poöãr


682 
s_löked_f_poöãr
 *
	m√xt
;

683 *
	mÂå
;

694 
	ee_º_ty≥


695 { 
	mSOURCE
, 
	mSINK
, 
	mIPIN
, 
	mOPIN
, 
	mCHANX
, 
	mCHANY
, 
	mNUM_RR_TYPES
 }

696 
	tt_º_ty≥
;

707 
	ss_åa˚


709 
	mödex
;

710 
	miswôch
;

711 
s_åa˚
 *
	m√xt
;

723 
	#NO_PREVIOUS
 -1

	)

725 
	ss_º_node


727 
	mxlow
;

728 
	mxhigh
;

729 
	mylow
;

730 
	myhigh
;

732 
	m±c_num
;

734 
	mco°_ödex
;

735 
	mocc
;

736 
	mˇ∑côy
;

737 
	mÁn_ö
;

738 
	mnum_edges
;

739 
t_º_ty≥
 
	mty≥
;

740 *
	medges
;

741 *
	mswôches
;

743 
	mR
;

744 
	mC
;

746 
e_dúe˘i⁄
 
	mdúe˘i⁄
;

747 
e_drivîs
 
	mdrivîs
;

748 
	mnum_wúe_drivîs
;

749 
	mnum_›ö_drivîs
;

751 
	tt_º_node
;

799 
	ss_º_ödexed_d©a


801 
	mba£_co°
;

802 
	mßved_ba£_co°
;

803 
	m‹tho_co°_ödex
;

804 
	m£g_ödex
;

805 
	möv_Àngth
;

806 
	mT_löór
;

807 
	mT_quadøtic
;

808 
	mC_lﬂd
;

810 
	tt_º_ödexed_d©a
;

835 
	ee_co°_ödi˚s


836 { 
	mSOURCE_COST_INDEX
 = 0, 
	mSINK_COST_INDEX
, 
	mOPIN_COST_INDEX
,

837 
	mIPIN_COST_INDEX
, 
	mCHANX_COST_INDEX_START


844 
	ss_TokíPaú


846 *
	mSå
;

847 
	mEnum
;

	@vpr_utils.c

1 
	~<as£π.h
>

2 
	~"utû.h
"

3 
	~"v¥_ty≥s.h
"

4 
	~"globÆs.h
"

5 
	~"v¥_utûs.h
"

15 
	$sync_grid_to_blocks
(
IN
 
num_blocks
,

16 
IN
 c⁄° 
s_block
 
block_li°
[],

17 
IN
 
nx
,

18 
IN
 
ny
,

19 
INOUT
 
s_grid_tûe
 **
grid
)

21 
i
, 
j
, 
k
;

24 
j
 = 0; j <(
ny
 + 1); ++j)

26 
i
 = 0; i <(
nx
 + 1); ++i)

28 
grid
[
i
][
j
].
ußge
 = 0;

29 if(
grid
[
i
][
j
].
ty≥
)

32 if(
NULL
 =
grid
[
i
][
j
].
blocks
)

34 
grid
[
i
][
j
].
blocks
 =

35 (*)
	`my_mÆloc
(() *

36 
grid
[
i
][
j
].
ty≥
->

37 
ˇ∑côy
);

40 
k
 = 0; k < 
grid
[
i
][
j
].
ty≥
->
ˇ∑côy
;

41 ++
k
)

43 
grid
[
i
][
j
].
blocks
[
k
] = 
OPEN
;

51 
i
 = 0; i < 
num_blocks
; ++i)

54 if(
block
[
i
].
x
 < 0 || block[i].x > (
nx
 + 1) ||

55 
block
[
i
].
y
 < 0

56 || (
block
[
i
].
y
 + block[i].
ty≥
->
height
 - 1Ë> (
ny
 + 1)

57 || 
block
[
i
].
z
 < 0 || block[i].z > (block[i].
ty≥
->
ˇ∑côy
))

59 
	`¥ötf
(
ERRTAG


61 
i
, 
block
[i].
x
, block[i].
y
, block[i].
z
);

62 
	`exô
(1);

66 if(
block
[
i
].
ty≥
 !
grid
[block[i].
x
][block[i].
y
].type)

68 
	`¥ötf
(
ERRTAG
 "A block is iná gridÜocation "

69 "(%d x %dËwôhá c⁄Êi˘ögÅy≥.\n", 
block
[
i
].
x
,

70 
block
[
i
].
y
);

71 
	`exô
(1);

75 if(
OPEN
 !
grid
[
block
[
i
].
x
][block[i].
y
].
blocks
[block[i].
z
])

77 
	`¥ötf
(
ERRTAG


79 
block
[
i
].
x
, block[i].
y
, block[i].
z
);

80 
	`exô
(1);

83 if(
grid
[
block
[
i
].
x
][block[i].
y
].
off£t
 != 0)

85 
	`¥ötf
(
ERRTAG


87 
i
, 
block
[i].
x
, block[i].
y
, block[i].
z
);

88 
	`exô
(1);

92 
j
 = 0; j < 
block
[
i
].
ty≥
->
height
; j++)

94 
grid
[
block
[
i
].
x
][block[i].
y
 + 
j
].
blocks
[block[i].
z
] = i;

95 
grid
[
block
[
i
].
x
][block[i].
y
 + 
j
].
ußge
++;

96 
	`as£π
(
grid
[
block
[
i
].
x
][block[i].
y
 + 
j
].
off£t
 == j);

99 
	}
}

103 
	$sync_√ts_to_blocks
(
IN
 
num_blocks
,

104 
IN
 c⁄° 
s_block
 
block_li°
[],

105 
IN
 
num_√ts
,

106 
INOUT
 
s_√t
 
√t_li°
[])

108 
i
, 
j
, 
k
, 
l
;

109 
t_ty≥_±r
 
cur_ty≥
;

112 
i
 = 0; i < 
num_√ts
; ++i)

114 
j
 = 0; j < 
num_blocks
; ++j)

116 
cur_ty≥
 = 
block_li°
[
j
].
ty≥
;

117 
k
 = 0; k < 
cur_ty≥
->
num_pös
; ++k)

119 if(
block_li°
[
j
].
√ts
[
k
] =
i
)

121 if(
RECEIVER
 ==

122 
cur_ty≥
->
˛ass_öf
[cur_type->

123 
pö_˛ass
[
k
]].
ty≥
)

125 ++
√t_li°
[
i
].
num_söks
;

133 
i
 = 0; i < 
num_√ts
; ++i)

136 if(
√t_li°
[
i
].
node_block
)

138 
	`‰ì
(
√t_li°
[
i
].
node_block
);

140 
√t_li°
[
i
].
node_block
 =

141 (*)
	`my_mÆloc
((Ë* (
√t_li°
[
i
].
num_söks
 + 1));

142 if(
√t_li°
[
i
].
node_block_pö
)

144 
	`‰ì
(
√t_li°
[
i
].
node_block_pö
);

146 
√t_li°
[
i
].
node_block_pö
 =

147 (*)
	`my_mÆloc
((Ë* (
√t_li°
[
i
].
num_söks
 + 1));

149 
l
 = 1;

151 
j
 = 0; j < 
num_blocks
; ++j)

153 
cur_ty≥
 = 
block_li°
[
j
].
ty≥
;

154 
k
 = 0; k < 
cur_ty≥
->
num_pös
; ++k)

156 if(
block_li°
[
j
].
√ts
[
k
] =
i
)

158 if(
RECEIVER
 ==

159 
cur_ty≥
->
˛ass_öf
[cur_type->

160 
pö_˛ass
[
k
]].
ty≥
)

162 
√t_li°
[
i
].
node_block
[
l
] = 
j
;

163 
√t_li°
[
i
].
node_block_pö
[
l
] = 
k
;

164 ++
l
;

168 
	`as£π
(
DRIVER
 ==

169 
cur_ty≥
->

170 
˛ass_öf
[
cur_ty≥
->

171 
pö_˛ass
[
k
]].

172 
ty≥
);

173 
√t_li°
[
i
].
node_block
[0] = 
j
;

174 
√t_li°
[
i
].
node_block_pö
[0] = 
k
;

180 
	}
}

182 
boﬁón


183 
	$is_›ö
(
ùö
,

184 
t_ty≥_±r
 
ty≥
)

189 
i˛ass
;

191 
i˛ass
 = 
ty≥
->
pö_˛ass
[
ùö
];

193 if(
ty≥
->
˛ass_öf
[
i˛ass
].ty≥ =
DRIVER
)

194  (
TRUE
);

196  (
FALSE
);

197 
	}
}

200 
	$gë_˛ass_ønge_f‹_block
(
IN
 
iblk
,

201 
OUT
 *
˛ass_low
,

202 
OUT
 *
˛ass_high
)

205 
t_ty≥_±r
 
ty≥
;

207 
ty≥
 = 
block
[
iblk
].type;

208 
	`as£π
(
ty≥
->
num_˛ass
 %Åy≥->
ˇ∑côy
 == 0);

209 *
˛ass_low
 = 
block
[
iblk
].
z
 * (
ty≥
->
num_˛ass
 /Åy≥->
ˇ∑côy
);

210 *
˛ass_high
 =

211 (
block
[
iblk
].
z
 + 1Ë* (
ty≥
->
num_˛ass
 /Åy≥->
ˇ∑côy
) - 1;

212 
	}
}

216 
	$lﬂd_⁄e_fb_Ánout_cou¡
(
t_subblock
 * 
subblock_öf
,

217 
num_subblocks
,

218 *
num_u£s_of_fb_ùö
,

219 **
num_u£s_of_sblk_›ö
,

220 
iblk
)

224 
t_ty≥_±r
 
ty≥
 = 
block
[
iblk
].type;

225 
isub
, 
ùö
, 
c⁄n_pö
, 
›ö
;

226 
öã∫Æ_sub
, 
öã∫Æ_pö
;

229 
ùö
 = 0; ipö < 
ty≥
->
num_pös
; ipin++)

231 
num_u£s_of_fb_ùö
[
ùö
] = 0;

235 
isub
 = 0; isub < 
num_subblocks
; isub++)

237 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

239 
num_u£s_of_sblk_›ö
[
isub
][
›ö
] = 0;

243 
isub
 = 0; isub < 
num_subblocks
; isub++)

250 
›ö
 = 0; opö < 
ty≥
->
max_subblock_ouçuts
; opin++)

252 
c⁄n_pö
 = 
subblock_öf
[
isub
].
ouçuts
[
›ö
];

253 if(
c⁄n_pö
 !
OPEN
)

255 if(
block
[
iblk
].
√ts
[
c⁄n_pö
] !
OPEN
)

257 
num_u£s_of_sblk_›ö
[
isub
][
›ö
]++;

262 
ùö
 = 0; ipö < 
ty≥
->
max_subblock_öputs
; ipin++)

264 
c⁄n_pö
 = 
subblock_öf
[
isub
].
öputs
[
ùö
];

266 if(
c⁄n_pö
 !
OPEN
)

268 if(
c⁄n_pö
 < 
ty≥
->
num_pös
)

270 
num_u£s_of_fb_ùö
[
c⁄n_pö
]++;

274 
öã∫Æ_sub
 =

275 (
c⁄n_pö
 -

276 
ty≥
->
num_pös
) /

277 
ty≥
->
max_subblock_ouçuts
;

278 
öã∫Æ_pö
 =

279 (
c⁄n_pö
 -

280 
ty≥
->
num_pös
) %

281 
ty≥
->
max_subblock_ouçuts
;

282 
num_u£s_of_sblk_›ö
[
öã∫Æ_sub
]

283 [
öã∫Æ_pö
]++;

288 
c⁄n_pö
 = 
subblock_öf
[
isub
].
˛ock
;

290 if(
c⁄n_pö
 !
OPEN
)

292 if(
c⁄n_pö
 < 
ty≥
->
num_pös
)

294 
num_u£s_of_fb_ùö
[
c⁄n_pö
]++;

298 
öã∫Æ_sub
 =

299 (
c⁄n_pö
 -

300 
ty≥
->
num_pös
Ë/Åy≥->
max_subblock_ouçuts
;

301 
öã∫Æ_pö
 =

302 (
c⁄n_pö
 -

303 
ty≥
->
num_pös
Ë%Åy≥->
max_subblock_ouçuts
;

304 
num_u£s_of_sblk_›ö
[
öã∫Æ_sub
]

305 [
öã∫Æ_pö
]++;

310 
	}
}

	@vpr_utils.h

1 
boﬁón
 
is_›ö
(
ùö
,

2 
t_ty≥_±r
 
ty≥
);

4 
gë_˛ass_ønge_f‹_block
(
IN
 
iblk
,

5 
OUT
 *
˛ass_low
,

6 
OUT
 *
˛ass_high
);

8 
lﬂd_⁄e_fb_Ánout_cou¡
(
t_subblock
 * 
subblock_öf
,

9 
num_subblocks
,

10 *
num_u£s_of_fb_ùö
,

11 **
num_u£s_of_sblk_›ö
,

12 
iblk
);

14 
sync_√ts_to_blocks
(
IN
 
num_blocks
,

15 
IN
 c⁄° 
s_block
 
block_li°
[],

16 
IN
 
num_√ts
,

17 
INOUT
 
s_√t
 
√t_li°
[]);

19 
sync_grid_to_blocks
(
IN
 
num_blocks
,

20 
IN
 c⁄° 
s_block
 
block_li°
[],

21 
IN
 
nx
,

22 
IN
 
ny
,

23 
INOUT
 
s_grid_tûe
 **
grid
);

	@xml_arch.c

1 
	~<°rög.h
>

2 
	~<as£π.h
>

3 
	~"utû.h
"

4 
	~"v¥_ty≥s.h
"

5 
	~"RódLöe.h
"

6 
	~"ezxml.h
"

7 
	~"globÆs.h
"

8 
	~"xml_¨ch.h
"

12 
	#EMPTY_TYPE_INDEX
 0

	)

13 
	#IO_TYPE_INDEX
 1

	)

14 
	eFc_ty≥


15 { 
	mFC_ABS
, 
	mFC_FRAC
, 
	mFC_FULL
 };

19 
boﬁón
 
IsWhôe•a˚
(
c
);

20 
Cou¡TokísInSåög
(
IN
 c⁄° *
Så
,

21 
OUT
 *
Num
,

22 
OUT
 *
Lí
);

23 **
GëNodeTokís
(
IN
 
ezxml_t
 
Node
);

24 
CheckEÀmít
(
IN
 
ezxml_t
 
Node
,

25 
IN
 c⁄° *
Name
);

26 
CheckText
(
IN
 
ezxml_t
 
Node
);

27 
FªeNode
(
INOUT
 
ezxml_t
 
Node
);

28 
ezxml_t
 
FödEÀmít
(
IN
Ézxml_à
P¨ít
,

29 
IN
 c⁄° *
Name
,

30 
IN
 
boﬁón
 
Requúed
);

31 c⁄° *
FödPr›îty
(
IN
 
ezxml_t
 
P¨ít
,

32 
IN
 c⁄° *
Name
,

33 
IN
 
boﬁón
 
Requúed
);

34 
Cou¡Chûdªn
(
IN
 
ezxml_t
 
Node
,

35 
IN
 c⁄° *
Name
);

36 
P¨£Fc
(
ezxml_t
 
Node
,

37 
Fc_ty≥
 *
Fc
,

38 *
VÆ
);

39 
SëupEm±yTy≥
();

40 
SëupCœssInf
(
ezxml_t
 
Cœs£s
,

41 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

42 
SëupPöCœs£s
(
ezxml_t
 
Cœs£s
,

43 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

44 
SëupPöLoˇti⁄s
(
ezxml_t
 
Loˇti⁄s
,

45 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

46 
SëupGridLoˇti⁄s
(
ezxml_t
 
Loˇti⁄s
,

47 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

48 
SëupTy≥Timög
(
ezxml_t
 
timög
,

49 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

50 
SëupSubblocksTcomb
(
ezxml_t
 
timög
,

51 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

52 
SëupSubblocksTSeq
(
ezxml_t
 
timög_£q_ö
,

53 
ezxml_t
 
timög_£q_out
,

54 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

55 
Pro˚ss_Fc
(
ezxml_t
 
Fc_ö_node
,

56 
ezxml_t
 
Fc_out_node
,

57 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

58 
Pro˚ssSubblocks
(
INOUT
 
ezxml_t
 
P¨ít
,

59 
INOUT
 
t_ty≥_des¸ùt‹
 * 
Ty≥
,

60 
IN
 
boﬁón
 
timög_íabÀd
);

61 
Pro˚ssTy≥Pr›s
(
ezxml_t
 
Node
,

62 
t_ty≥_des¸ùt‹
 * 
Ty≥
);

63 
Pro˚ssCh™WidthDi°r
(
INOUT
 
ezxml_t
 
Node
,

64 
OUT
 
s_¨ch
 *
¨ch
);

65 
Pro˚ssCh™WidthDi°rDú
(
INOUT
 
ezxml_t
 
Node
,

66 
OUT
 
t_ch™
 * 
ch™
);

67 
Pro˚ssLayout
(
INOUT
 
ezxml_t
 
Node
,

68 
OUT
 
s_¨ch
 *
¨ch
);

69 
Pro˚ssDevi˚
(
INOUT
 
ezxml_t
 
Node
,

70 
OUT
 
s_¨ch
 *
¨ch
,

71 
IN
 
boﬁón
 
timög_íabÀd
);

72 
Pro˚ssIO
(
INOUT
 
ezxml_t
 
Node
,

73 
IN
 
boﬁón
 
timög_íabÀd
);

74 
Pro˚ssTy≥s
(
INOUT
 
ezxml_t
 
Node
,

75 
OUT
 
t_ty≥_des¸ùt‹
 ** 
Ty≥s
,

76 
OUT
 *
NumTy≥s
,

77 
IN
 
boﬁón
 
timög_íabÀd
);

78 
Pro˚ssSwôches
(
INOUT
 
ezxml_t
 
Node
,

79 
OUT
 
s_swôch_öf
 **
Swôches
,

80 
OUT
 *
NumSwôches
,

81 
IN
 
boﬁón
 
timög_íabÀd
);

82 
Pro˚ssSegmíts
(
INOUT
 
ezxml_t
 
P¨ít
,

83 
OUT
 
s_£gmít_öf
 **
Segs
,

84 
OUT
 *
NumSegs
,

85 
IN
 
s_swôch_öf
 *
Swôches
,

86 
IN
 
NumSwôches
,

87 
IN
 
boﬁón
 
timög_íabÀd
);

88 
Pro˚ssCB_SB
(
INOUT
 
ezxml_t
 
Node
,

89 
INOUT
 
boﬁón
 * 
li°
,

90 
IN
 
Àn
);

94 
boﬁón


95 
	$IsWhôe•a˚
(
c
)

97 
c
)

103  
TRUE
;

105  
FALSE
;

107 
	}
}

112 
	$Cou¡TokísInSåög
(
IN
 c⁄° *
Så
,

113 
OUT
 *
Num
,

114 
OUT
 *
Lí
)

116 
boﬁón
 
InTokí
;

117 *
Num
 = 0;

118 *
Lí
 = 0;

119 
InTokí
 = 
FALSE
;

120 *
Så
)

122 if(
	`IsWhôe•a˚
(*
Så
))

124 
InTokí
 = 
FALSE
;

130 if(!
InTokí
)

132 ++(*
Num
);

134 ++(*
Lí
);

135 
InTokí
 = 
TRUE
;

137 ++
Så
;

139 
	}
}

145 
	$GëNodeTokís
(
IN
 
ezxml_t
 
Node
)

147 
Cou¡
, 
Lí
;

148 *
Cur
, *
D°
;

150 
boﬁón
 
InTokí
;

151 **
Tokís
;

155 
	`Cou¡TokísInSåög
(
Node
->
txt
, &
Cou¡
, &
Lí
);

158 if(
Cou¡
 < 1)

160 
	`¥ötf
(
ERRTAG
 "Tag '%s'ÉxpectedÉnclosedÅext data "

161 "buàn⁄êwa†found.\n", 
Node
->
«me
);

162 
	`exô
(1);

164 
Lí
 = (() * Len) +

165 ((Ë* 
Cou¡
);

169 
Tokís
 = (**)
	`my_mÆloc
((*Ë* (
Cou¡
 + 1));

170 
D°
 = (*)
	`my_mÆloc
((Ë* 
Lí
);

171 
Cou¡
 = 0;

174 
Cur
 = 
Node
->
txt
;

175 
InTokí
 = 
FALSE
;

176 *
Cur
)

178 if(
	`IsWhôe•a˚
(*
Cur
))

180 if(
InTokí
)

182 *
D°
 = '\0';

183 ++
D°
;

185 
InTokí
 = 
FALSE
;

190 if(!
InTokí
)

192 
Tokís
[
Cou¡
] = 
D°
;

193 ++
Cou¡
;

195 *
D°
 = *
Cur
;

196 ++
D°
;

197 
InTokí
 = 
TRUE
;

199 ++
Cur
;

201 if(
InTokí
)

203 *
D°
 = '\0';

204 ++
D°
;

206 
	`ezxml_£t_txt
(
Node
, "");

207 
Tokís
[
Cou¡
] = 
NULL
;

210  
Tokís
;

211 
	}
}

216 
	$CheckEÀmít
(
IN
 
ezxml_t
 
Node
,

217 
IN
 c⁄° *
Name
)

219 if(0 !
	`°rcmp
(
Node
->
«me
, 
Name
))

221 
	`¥ötf
(
ERRTAG


223 "ñemíàty≥ o‡'%s'\n", 
Node
->
«me
, Node->
∑ª¡
->name,

224 
Name
);

225 
	`exô
(1);

227 
	}
}

234 
	$FªeNode
(
INOUT
 
ezxml_t
 
Node
)

236 
ezxml_t
 
Cur
;

237 *
Txt
;

241 if(
Node
->
©å
[0])

243 
	`¥ötf
(
ERRTAG
 "Node '%s' has invalidÖroperty %s=\"%s\".\n",

244 
Node
->
«me
, Node->
©å
[0], Node->attr[1]);

245 
	`exô
(1);

249 
Txt
 = 
Node
->
txt
;

250 *
Txt
)

252 if(!
	`IsWhôe•a˚
(*
Txt
))

254 
	`¥ötf
(
ERRTAG


256 
Node
->
«me
, Node->
txt
);

257 
	`exô
(1);

259 ++
Txt
;

263 
Cur
 = 
Node
->
chûd
;

264 if(
Cur
)

266 
	`¥ötf
(
ERRTAG
 "Node '%s' on has invalid childÇode '%s'.\n",

267 
Node
->
«me
, 
Cur
->name);

268 
	`exô
(1);

272 
	`ezxml_ªmove
(
Node
);

273 
	}
}

278 
ezxml_t


279 
	$FödEÀmít
(
IN
 
ezxml_t
 
P¨ít
,

280 
IN
 c⁄° *
Name
,

281 
IN
 
boﬁón
 
Requúed
)

283 
ezxml_t
 
Cur
;

286 
Cur
 = 
	`ezxml_chûd
(
P¨ít
, 
Name
);

289 if(
Requúed
)

291 if(
NULL
 =
Cur
)

293 
	`¥ötf
(
ERRTAG


295 
Name
, 
P¨ít
->
«me
);

296 
	`exô
(1);

301 if(
Cur
 !
NULL
 && Cur->
√xt
)

303 
	`¥ötf
(
ERRTAG
 "Element '%s' foundÅwice withinÉlement '%s'.\n",

304 
Name
, 
P¨ít
->
«me
);

305 
	`exô
(1);

307  
Cur
;

308 
	}
}

310 
	$FödPr›îty
(
IN
 
ezxml_t
 
P¨ít
,

311 
IN
 c⁄° *
Name
,

312 
IN
 
boﬁón
 
Requúed
)

314 c⁄° *
Res
;

316 
Res
 = 
	`ezxml_©å
(
P¨ít
, 
Name
);

317 if(
Requúed
)

319 if(
NULL
 =
Res
)

321 
	`¥ötf
(
ERRTAG


323 
Name
, 
P¨ít
->
«me
);

324 
	`exô
(1);

327  
Res
;

328 
	}
}

335 
	$Cou¡Chûdªn
(
IN
 
ezxml_t
 
Node
,

336 
IN
 c⁄° *
Name
)

338 
ezxml_t
 
Cur
, 
siblög
;

339 
Cou¡
;

341 
Cou¡
 = 0;

342 
Cur
 = 
Node
->
chûd
;

343 
Cur
)

345 if(
	`°rcmp
(
Cur
->
«me
, 
Name
) == 0)

347 ++
Cou¡
;

349 
siblög
 = 
Cur
->sibling;

350 
Cur
 = Cur->
√xt
;

351 if(
Cur
 =
NULL
)

353 
Cur
 = 
siblög
;

358 if(
Cou¡
 < 1)

360 
	`¥ötf
(
ERRTAG
 "ExpectedÇode '%s'Åo have "

361 "chûdÉÀmíts, buàn⁄êfound.\n", 
Node
->
«me
);

362 
	`exô
(1);

364  
Cou¡
;

365 
	}
}

371 
	$P¨£Fc
(
ezxml_t
 
Node
,

372 
Fc_ty≥
 *
Fc
,

373 *
VÆ
)

375 c⁄° *
Pr›
;

377 
Pr›
 = 
	`FödPr›îty
(
Node
, "ty≥", 
TRUE
);

378 if(0 =
	`°rcmp
(
Pr›
, "abs"))

380 *
Fc
 = 
FC_ABS
;

383 if(0 =
	`°rcmp
(
Pr›
, "frac"))

385 *
Fc
 = 
FC_FRAC
;

388 if(0 =
	`°rcmp
(
Pr›
, "full"))

390 *
Fc
 = 
FC_FULL
;

395 
	`¥ötf
(
ERRTAG
 "InvalidÅype '%s' for Fc. Onlyábs, frac "

396 "™d fuŒáªáŒowed.\n", 
Pr›
);

397 
	`exô
(1);

399 *
Fc
)

401 
FC_FULL
:

402 *
VÆ
 = 0.0;

404 
FC_ABS
:

405 
FC_FRAC
:

406 *
VÆ
 = 
	`©of
(
Node
->
txt
);

407 
	`ezxml_£t_©å
(
Node
, "ty≥", 
NULL
);

408 
	`ezxml_£t_txt
(
Node
, "");

411 
	`as£π
(0);

415 
	`ezxml_£t_©å
(
Node
, "ty≥", 
NULL
);

416 
	}
}

424 
	$SëupCœssInf
(
ezxml_t
 
Cœs£s
,

425 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

427 
i
, 
k
, 
CurCœss
, 
CurPö
, 
NumCœssPös
;

429 
ezxml_t
 
Cur
;

430 c⁄° *
Pr›
;

434 
Ty≥
->
num_˛ass
 = Ty≥->
ˇ∑côy
 * 
	`Cou¡Chûdªn
(
Cœs£s
, "class");

435 
Ty≥
->
˛ass_öf
 =

436 (
t_˛ass
 *Ë
	`my_mÆloc
(
Ty≥
->
num_˛ass
 * (t_class));

439 
CurPö
 = 0;

440 
CurCœss
 = 0;

441 
Ty≥
->
num_pös
 = 0;

442 
Ty≥
->
num_drivîs
 = 0;

443 
Ty≥
->
num_ª˚ivîs
 = 0;

444 
i
 = 0; i < 
Ty≥
->
ˇ∑côy
; ++i)

448 
Cur
 = 
Cœs£s
->
chûd
;

449 
Cur
)

451 
	`CheckEÀmít
(
Cur
, "class");

454 
	`Cou¡TokísInSåög
(
Cur
->
txt
, &
NumCœssPös
, &
k
);

455 
Ty≥
->
num_pös
 +
NumCœssPös
;

458 
Ty≥
->
˛ass_öf
[
CurCœss
].
num_pös
 = 
NumCœssPös
;

459 
Ty≥
->
˛ass_öf
[
CurCœss
].
pöli°
 =

460 (*)
	`my_mÆloc
(
NumCœssPös
 * ());

461 
k
 = 0; k < 
NumCœssPös
; ++k)

463 
Ty≥
->
˛ass_öf
[
CurCœss
].
pöli°
[
k
] = 
CurPö
;

464 ++
CurPö
;

468 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ty≥", 
TRUE
);

469 if(0 =
	`°rcmp
(
Pr›
, "in"))

471 
Ty≥
->
num_ª˚ivîs
 +
NumCœssPös
;

472 
Ty≥
->
˛ass_öf
[
CurCœss
].
ty≥
 = 
RECEIVER
;

475 if(0 =
	`°rcmp
(
Pr›
, "out"))

477 
Ty≥
->
num_drivîs
 +
NumCœssPös
;

478 
Ty≥
->
˛ass_öf
[
CurCœss
].
ty≥
 = 
DRIVER
;

481 if(0 =
	`°rcmp
(
Pr›
, "global"))

483 
Ty≥
->
˛ass_öf
[
CurCœss
].
ty≥
 = 
RECEIVER
;

488 
	`¥ötf
(
ERRTAG
 "InvalidÖin classÅype '%s'.\n",

489 
Pr›
);

490 
	`exô
(1);

492 ++
CurCœss
;

493 
Cur
 = Cur->
√xt
;

496 
	}
}

505 
	$SëupPöCœs£s
(
ezxml_t
 
Cœs£s
,

506 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

508 
CurCœss
, 
i
, 
j
, 
CurPö
, 
PösPîSubtûe
, 
Cœs£sPîSubtûe
;

510 
ezxml_t
 
Cur
, 
Pªv
;

511 c⁄° *
Pr›
;

513 
boﬁón
 
IsGlobÆ
;

514 **
Tokís
;

515 *
pö_u£d
 = 
NULL
;

519 
	`SëupCœssInf
(
Cœs£s
, 
Ty≥
);

520 
PösPîSubtûe
 = 
Ty≥
->
num_pös
 / Ty≥->
ˇ∑côy
;

521 
Cœs£sPîSubtûe
 = 
Ty≥
->
num_˛ass
 / Ty≥->
ˇ∑côy
;

524 
Ty≥
->
is_globÆ_pö
 =

525 (
boﬁón
 *Ë
	`my_mÆloc
(
Ty≥
->
num_pös
 * (boolean));

526 
Ty≥
->
pö_˛ass
 = (*)
	`my_mÆloc
(Ty≥->
num_pös
 * ());

527 
pö_u£d
 = (*)
	`my_mÆloc
(
Ty≥
->
num_pös
 * ());

528 
i
 = 0; i < 
Ty≥
->
num_pös
; ++i)

530 
pö_u£d
[
i
] = 
FALSE
;

534 
CurCœss
 = 0;

535 
Cur
 = 
Cœs£s
->
chûd
;

536 
Cur
)

538 
	`CheckEÀmít
(
Cur
, "class");

541 
IsGlobÆ
 = 
FALSE
;

542 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ty≥", 
TRUE
);

543 if(0 =
	`°rcmp
(
Pr›
, "global"))

545 
IsGlobÆ
 = 
TRUE
;

547 
	`ezxml_£t_©å
(
Cur
, "ty≥", 
NULL
);

550 
Tokís
 = 
	`GëNodeTokís
(
Cur
);

551 
	`as£π
(
	`Cou¡Tokís
(
Tokís
) ==

552 
Ty≥
->
˛ass_öf
[
CurCœss
].
num_pös
);

553 
j
 = 0; j < 
Ty≥
->
˛ass_öf
[
CurCœss
].
num_pös
; ++j)

555 
CurPö
 = 
	`my_©oi
(
Tokís
[
j
]);

558 if(
pö_u£d
[
CurPö
])

560 
	`¥ötf
(
ERRTAG


562 
CurPö
, 
Ty≥
->
«me
);

563 
	`exô
(1);

565 
pö_u£d
[
CurPö
] = 
TRUE
;

568 
i
 = 0; i < 
Ty≥
->
ˇ∑côy
; ++i)

570 
Ty≥
->
pö_˛ass
[
CurPö
 + (
i
 * 
PösPîSubtûe
)] =

571 
CurCœss
 + (
i
 * 
Cœs£sPîSubtûe
);

572 
Ty≥
->
is_globÆ_pö
[
CurPö
 +

573 (
i
 * 
PösPîSubtûe
)] =

574 
IsGlobÆ
;

577 
	`FªeTokís
(&
Tokís
);

578 ++
CurCœss
;

579 
Pªv
 = 
Cur
;

580 
Cur
 = Cur->
√xt
;

581 
	`FªeNode
(
Pªv
);

583 if(
pö_u£d
)

585 
	`‰ì
(
pö_u£d
);

586 
pö_u£d
 = 
NULL
;

588 
	}
}

595 
	$SëupPöLoˇti⁄s
(
ezxml_t
 
Loˇti⁄s
,

596 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

598 
i
, 
j
, 
k
, 
l
, 
PösPîSubtûe
, 
Cou¡
, 
Lí
;

600 
ezxml_t
 
Cur
, 
Pªv
;

601 c⁄° *
Pr›
;

602 **
Tokís
, **
CurTokís
;

604 
PösPîSubtûe
 = 
Ty≥
->
num_pös
 / Ty≥->
ˇ∑côy
;

607 
Ty≥
->
pöloc
 = (***)
	`my_mÆloc
(Ty≥->
height
 * (**));

608 
i
 = 0; i < 
Ty≥
->
height
; ++i)

610 
Ty≥
->
pöloc
[
i
] = (**)
	`my_mÆloc
(4 * (*));

611 
j
 = 0; j < 4; ++j)

613 
Ty≥
->
pöloc
[
i
][
j
] =

614 (*)
	`my_mÆloc
(
Ty≥
->
num_pös
 * ());

615 
k
 = 0; k < 
Ty≥
->
num_pös
; ++k)

617 
Ty≥
->
pöloc
[
i
][
j
][
k
] = 0;

623 
Cur
 = 
Loˇti⁄s
->
chûd
;

624 
Cur
)

626 
	`CheckEÀmít
(
Cur
, "loc");

629 
i
 = 0;

630 
Pr›
 = 
	`FödPr›îty
(
Cur
, "off£t", 
FALSE
);

631 if(
Pr›
)

633 
i
 = 
	`my_©oi
(
Pr›
);

634 if((
i
 < 0Ë|| (ò>
Ty≥
->
height
))

636 
	`¥ötf
(
ERRTAG


638 
i
, 
Ty≥
->
«me
);

639 
	`exô
(1);

641 
	`ezxml_£t_©å
(
Cur
, "off£t", 
NULL
);

645 
Pr›
 = 
	`FödPr›îty
(
Cur
, "side", 
TRUE
);

646 if(0 =
	`°rcmp
(
Pr›
, "left"))

648 
j
 = 
LEFT
;

651 if(0 =
	`°rcmp
(
Pr›
, "top"))

653 
j
 = 
TOP
;

656 if(0 =
	`°rcmp
(
Pr›
, "right"))

658 
j
 = 
RIGHT
;

661 if(0 =
	`°rcmp
(
Pr›
, "bottom"))

663 
j
 = 
BOTTOM
;

668 
	`¥ötf
(
ERRTAG
 "'%s' i†nŸá vÆid side.\n", 
Pr›
);

669 
	`exô
(1);

671 
	`ezxml_£t_©å
(
Cur
, "side", 
NULL
);

674 if((
TOP
 =
j
Ë&& (
i
 !(
Ty≥
->
height
 - 1)))

676 
	`¥ötf
(
ERRTAG


679 (
Ty≥
->
height
 - 1));

680 
	`exô
(1);

682 if((
BOTTOM
 =
j
Ë&& (
i
 != 0))

684 
	`¥ötf
(
ERRTAG


687 
	`exô
(1);

691 
	`Cou¡TokísInSåög
(
Cur
->
txt
, &
Cou¡
, &
Lí
);

692 if(
Cou¡
 > 0)

694 
Tokís
 = 
	`GëNodeTokís
(
Cur
);

695 
CurTokís
 = 
Tokís
;

696 *
CurTokís
)

700 
k
 = 
	`my_©oi
(*
CurTokís
);

701 if(
k
 >
Ty≥
->
num_pös
)

703 
	`¥ötf
(
ERRTAG


705 
k
, 
Ty≥
->
«me
);

706 
	`exô
(1);

710 
l
 = 0;Ü < 
Ty≥
->
ˇ∑côy
; ++l)

712 
Ty≥
->
pöloc
[
i
][
j
][
k
 + (
l
 * 
PösPîSubtûe
)] = 1;

716 ++
CurTokís
;

718 
	`FªeTokís
(&
Tokís
);

720 
Pªv
 = 
Cur
;

721 
Cur
 = Cur->
√xt
;

722 
	`FªeNode
(
Pªv
);

724 
	}
}

730 
	$SëupGridLoˇti⁄s
(
ezxml_t
 
Loˇti⁄s
,

731 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

733 
i
;

735 
ezxml_t
 
Cur
, 
Pªv
;

736 c⁄° *
Pr›
;

738 
Ty≥
->
num_grid_loc_def
 = 
	`Cou¡Chûdªn
(
Loˇti⁄s
, "loc");

739 
Ty≥
->
grid_loc_def
 =

740 (
s_grid_loc_def
 *)
	`my_ˇŒoc
(
Ty≥
->
num_grid_loc_def
,

741 (
s_grid_loc_def
));

744 
Cur
 = 
Loˇti⁄s
->
chûd
;

745 
i
 = 0;

746 
Cur
)

748 
	`CheckEÀmít
(
Cur
, "loc");

751 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ty≥", 
TRUE
);

752 if(
Pr›
)

754 if(
	`°rcmp
(
Pr›
, "fill") == 0)

756 if(
Ty≥
->
num_grid_loc_def
 != 1)

758 
	`¥ötf
(
ERRTAG


760 
	`exô
(1);

762 
Ty≥
->
grid_loc_def
[
i
].
grid_loc_ty≥
 = 
FILL
;

763 
FILL_TYPE
 = 
Ty≥
;

765 if(
	`°rcmp
(
Pr›
, "col") == 0)

767 
Ty≥
->
grid_loc_def
[
i
].
grid_loc_ty≥
 = 
COL_REPEAT
;

769 if(
	`°rcmp
(
Pr›
, "rel") == 0)

771 
Ty≥
->
grid_loc_def
[
i
].
grid_loc_ty≥
 = 
COL_REL
;

775 
	`¥ötf
(
ERRTAG


777 
Pr›
, 
Ty≥
->
«me
);

778 
	`exô
(1);

780 
	`ezxml_£t_©å
(
Cur
, "ty≥", 
NULL
);

782 
Pr›
 = 
	`FödPr›îty
(
Cur
, "°¨t", 
FALSE
);

783 if(
Ty≥
->
grid_loc_def
[
i
].
grid_loc_ty≥
 =
COL_REPEAT
)

785 if(
Pr›
 =
NULL
)

787 
	`¥ötf
(
ERRTAG


789 
	`exô
(1);

791 
Ty≥
->
grid_loc_def
[
i
].
°¨t_cﬁ
 = 
	`my_©oi
(
Pr›
);

792 
	`ezxml_£t_©å
(
Cur
, "°¨t", 
NULL
);

794 if(
Pr›
 !
NULL
)

796 
	`¥ötf
(
ERRTAG


798 
	`exô
(1);

800 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ª≥©", 
FALSE
);

801 if(
Ty≥
->
grid_loc_def
[
i
].
grid_loc_ty≥
 =
COL_REPEAT
)

803 if(
Pr›
 !
NULL
)

805 
Ty≥
->
grid_loc_def
[
i
].
ª≥©
 = 
	`my_©oi
(
Pr›
);

806 
	`ezxml_£t_©å
(
Cur
, "ª≥©", 
NULL
);

809 if(
Pr›
 !
NULL
)

811 
	`¥ötf
(
ERRTAG


813 
	`exô
(1);

815 
Pr›
 = 
	`FödPr›îty
(
Cur
, "pos", 
FALSE
);

816 if(
Ty≥
->
grid_loc_def
[
i
].
grid_loc_ty≥
 =
COL_REL
)

818 if(
Pr›
 =
NULL
)

820 
	`¥ötf
(
ERRTAG


822 
	`exô
(1);

824 
Ty≥
->
grid_loc_def
[
i
].
cﬁ_ªl
 = 
	`©of
(
Pr›
);

825 
	`ezxml_£t_©å
(
Cur
, "pos", 
NULL
);

827 if(
Pr›
 !
NULL
)

829 
	`¥ötf
(
ERRTAG


831 
	`exô
(1);

833 
Pr›
 = 
	`FödPr›îty
(
Cur
, "¥i‹ôy", 
FALSE
);

834 if(
Pr›
)

836 
Ty≥
->
grid_loc_def
[
i
].
¥i‹ôy
 = 
	`my_©oi
(
Pr›
);

837 
	`ezxml_£t_©å
(
Cur
, "¥i‹ôy", 
NULL
);

839 
Pªv
 = 
Cur
;

840 
Cur
 = Cur->
√xt
;

841 
	`FªeNode
(
Pªv
);

842 
i
++;

844 
	}
}

846 
	$SëupTy≥Timög
(
ezxml_t
 
timög
,

847 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

849 
ezxml_t
 
Cur
, 
Pªv
;

850 c⁄° *
Pr›
;

851 
vÆue
;

852 **
Tokís
;

856 
Ty≥
->
ty≥_timög_öf
.
T_fb_ùö_to_sblk_ùö
 = 0;

857 
Ty≥
->
ty≥_timög_öf
.
T_sblk_›ö_to_fb_›ö
 = 0;

858 
Ty≥
->
ty≥_timög_öf
.
T_sblk_›ö_to_sblk_ùö
 = 0;

861 
Cur
 = 
timög
->
chûd
;

862 
Cur
)

864 
	`CheckEÀmít
(
Cur
, "tedge");

867 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ty≥", 
TRUE
);

868 
Tokís
 = 
	`GëNodeTokís
(
Cur
);

869 if(
	`Cou¡Tokís
(
Tokís
) != 1)

871 
	`¥ötf
(
ERRTAG


874 
vÆue
 = 
	`©of
(
Tokís
[0]);

875 if(0 =
	`°rcmp
(
Pr›
, "T_fb_ipin_to_sblk_ipin"))

877 
Ty≥
->
ty≥_timög_öf
.
T_fb_ùö_to_sblk_ùö
 = 
vÆue
;

879 if(0 =
	`°rcmp
(
Pr›
, "T_sblk_opin_to_fb_opin"))

881 
Ty≥
->
ty≥_timög_öf
.
T_sblk_›ö_to_fb_›ö
 = 
vÆue
;

883 if(0 =
	`°rcmp
(
Pr›
, "T_sblk_opin_to_sblk_ipin"))

885 
Ty≥
->
ty≥_timög_öf
.
T_sblk_›ö_to_sblk_ùö
 = 
vÆue
;

889 
	`¥ötf
(
ERRTAG
 "'%s' isán unrecognizedÅimingÉdge.\n",

890 
Pr›
);

891 
	`exô
(1);

893 
	`ezxml_£t_©å
(
Cur
, "ty≥", 
NULL
);

894 
Pªv
 = 
Cur
;

895 
Cur
 = Cur->
√xt
;

896 
	`FªeNode
(
Pªv
);

897 
	`FªeTokís
(&
Tokís
);

899 
	}
}

901 
	$SëupSubblocksTcomb
(
ezxml_t
 
timög
,

902 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

904 
ezxml_t
 
Cur
, 
¥ev
;

905 
t_T_subblock
 ** 
T_subblock_±r
;

906 **
t_comb
;

907 
i
, 
j
;

908 **
Tokís
;

910 
T_subblock_±r
 = &
Ty≥
->
ty≥_timög_öf
.
T_subblock
;

911 
t_comb
 =

912 (**)
	`Æloc_m©rix
(0, 
Ty≥
->
max_subblock_öputs
 - 1, 0,

913 
Ty≥
->
max_subblock_ouçuts
 - 1, ());

914 
i
 = 0; i < 
Ty≥
->
max_subblock_öputs
; i++)

916 
j
 = 0; j < 
Ty≥
->
max_subblock_ouçuts
; j++)

918 
t_comb
[
i
][
j
] = 0;

923 
Cur
 = 
timög
->
chûd
;

924 
i
 = 0;

925 
Cur
)

927 
	`CheckEÀmít
(
Cur
, "trow");

928 
Tokís
 = 
	`GëNodeTokís
(
Cur
);

929 if(
	`Cou¡Tokís
(
Tokís
Ë!
Ty≥
->
max_subblock_ouçuts
)

931 
	`¥ötf
(
ERRTAG


933 
	`Cou¡Tokís
(
Tokís
),

934 
Ty≥
->
max_subblock_ouçuts
);

935 
	`exô
(1);

937 
j
 = 0; j < 
Ty≥
->
max_subblock_ouçuts
; j++)

939 
t_comb
[
i
][
j
] = 
	`©of
(
Tokís
[j]);

941 
i
++;

942 
¥ev
 = 
Cur
;

943 
Cur
 = Cur->
√xt
;

944 
	`FªeNode
(
¥ev
);

945 
	`FªeTokís
(&
Tokís
);

947 if(
i
 !
Ty≥
->
max_subblock_öputs
)

949 
	`¥ötf
(
ERRTAG


951 
i
, 
Ty≥
->
max_subblock_öputs
);

952 
	`exô
(1);

954 
i
 = 0; i < 
Ty≥
->
max_subblocks
; i++)

956 (*
T_subblock_±r
)[
i
].
T_comb
 = 
t_comb
;

958 
	}
}

960 
	$SëupSubblocksTSeq
(
ezxml_t
 
timög_£q_ö
,

961 
ezxml_t
 
timög_£q_out
,

962 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

964 
ezxml_t
 
Cur
, 
¥ev
;

965 
t_T_subblock
 ** 
T_subblock_±r
;

966 
i
, 
j
;

967 *
t_£q
[2];

969 
ezxml_t
 
£q_timög
[2];

970 **
Tokís
;

972 
T_subblock_±r
 = &
Ty≥
->
ty≥_timög_öf
.
T_subblock
;

973 
£q_timög
[0] = 
timög_£q_ö
;

974 
£q_timög
[1] = 
timög_£q_out
;

975 
t_£q
[0] = (*)
	`my_ˇŒoc
(
Ty≥
->
max_subblock_öputs
, ());

976 
t_£q
[1] = (*)
	`my_ˇŒoc
(
Ty≥
->
max_subblock_ouçuts
, ());

979 
i
 = 0; i < 2; i++)

981 
Cur
 = 
£q_timög
[
i
]->
chûd
;

982 
j
 = 0;

983 
Cur
)

985 
	`CheckEÀmít
(
Cur
, "trow");

986 
Tokís
 = 
	`GëNodeTokís
(
Cur
);

987 if(
	`Cou¡Tokís
(
Tokís
) != 1)

989 
	`¥ötf
(
ERRTAG


992 
t_£q
[
i
][
j
] = 
	`©of
(
Tokís
[0]);

993 
j
++;

994 
¥ev
 = 
Cur
;

995 
Cur
 = Cur->
√xt
;

996 
	`FªeNode
(
¥ev
);

997 
	`FªeTokís
(&
Tokís
);

999 if(
j
 !
Ty≥
->
max_subblock_ouçuts
)

1001 
	`¥ötf
(
ERRTAG


1003 
j
, 
Ty≥
->
max_subblock_ouçuts
);

1004 
	`exô
(1);

1007 
i
 = 0; i < 
Ty≥
->
max_subblocks
; i++)

1009 (*
T_subblock_±r
)[
i
].
T_£q_ö
 = 
t_£q
[0];

1010 (*
T_subblock_±r
)[
i
].
T_£q_out
 = 
t_£q
[1];

1012 
	}
}

1018 
	$Pro˚ss_Fc
(
ezxml_t
 
Fc_ö_node
,

1019 
ezxml_t
 
Fc_out_node
,

1020 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

1022 
Fc_ty≥
 
Ty≥_ö
;

1023 
Fc_ty≥
 
Ty≥_out
;

1025 
	`P¨£Fc
(
Fc_ö_node
, &
Ty≥_ö
, &
Ty≥
->
Fc_ö
);

1026 
	`P¨£Fc
(
Fc_out_node
, &
Ty≥_out
, &
Ty≥
->
Fc_out
);

1027 if(
FC_FULL
 =
Ty≥_ö
)

1029 
	`¥ötf
(
ERRTAG
 "'full' FcÅype isn'tállowed for Fc_in.\n");

1030 
	`exô
(1);

1032 
Ty≥
->
is_Fc_out_fuŒ_Êex
 = 
FALSE
;

1033 
Ty≥
->
is_Fc_‰ac
 = 
FALSE
;

1034 if(
FC_FULL
 =
Ty≥_out
)

1036 
Ty≥
->
is_Fc_out_fuŒ_Êex
 = 
TRUE
;

1039 if(
Ty≥_ö
 !
Ty≥_out
)

1041 
	`¥ötf
(
ERRTAG


1043 
	`exô
(1);

1045 if(
FC_FRAC
 =
Ty≥_ö
)

1047 
Ty≥
->
is_Fc_‰ac
 = 
TRUE
;

1049 
	}
}

1054 
	$Pro˚ssSubblocks
(
INOUT
 
ezxml_t
 
P¨ít
,

1055 
INOUT
 
t_ty≥_des¸ùt‹
 * 
Ty≥
,

1056 
boﬁón
 
timög_íabÀd
)

1058 c⁄° *
Pr›
;

1060 
ezxml_t
 
CurTy≥
, 
Cur
, 
Cur2
;

1061 
Ty≥
->
max_subblocks
 = 1;

1062 
Pr›
 = 
	`FödPr›îty
(
P¨ít
, "max_subblocks", 
FALSE
);

1063 if(
Pr›
)

1065 
Ty≥
->
max_subblocks
 = 
	`my_©oi
(
Pr›
);

1066 
	`ezxml_£t_©å
(
P¨ít
, "max_subblocks", 
NULL
);

1068 
Ty≥
->
max_subblock_öputs
 = 1;

1069 
Pr›
 = 
	`FödPr›îty
(
P¨ít
, "max_subblock_öputs", 
FALSE
);

1070 if(
Pr›
)

1072 
Ty≥
->
max_subblock_öputs
 = 
	`my_©oi
(
Pr›
);

1073 
	`ezxml_£t_©å
(
P¨ít
, "max_subblock_öputs", 
NULL
);

1075 
Ty≥
->
max_subblock_ouçuts
 = 1;

1076 
Pr›
 = 
	`FödPr›îty
(
P¨ít
, "max_subblock_ouçuts", 
FALSE
);

1077 if(
Pr›
)

1079 
Ty≥
->
max_subblock_ouçuts
 = 
	`my_©oi
(
Pr›
);

1080 
	`ezxml_£t_©å
(
P¨ít
, "max_subblock_ouçuts", 
NULL
);

1082 
CurTy≥
 = 
	`FödEÀmít
(
P¨ít
, "timög", 
timög_íabÀd
);

1083 if(
CurTy≥
 !
NULL
)

1085 
Ty≥
->
ty≥_timög_öf
.
T_subblock
 =

1086 (
t_T_subblock
 *Ë
	`my_mÆloc
(
Ty≥
->
max_subblocks
 *

1087 (
t_T_subblock
));

1090 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "T_comb", 
TRUE
);

1091 
	`SëupSubblocksTcomb
(
Cur
, 
Ty≥
);

1092 
	`FªeNode
(
Cur
);

1095 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "T_£q_ö", 
TRUE
);

1096 
Cur2
 = 
	`FödEÀmít
(
CurTy≥
, "T_£q_out", 
TRUE
);

1097 
	`SëupSubblocksTSeq
(
Cur
, 
Cur2
, 
Ty≥
);

1098 
	`FªeNode
(
Cur
);

1099 
	`FªeNode
(
Cur2
);

1100 
	`FªeNode
(
CurTy≥
);

1102 
	}
}

1107 
	$Pro˚ssTy≥Pr›s
(
ezxml_t
 
Node
,

1108 
t_ty≥_des¸ùt‹
 * 
Ty≥
)

1110 c⁄° *
Pr›
;

1114 
Pr›
 = 
	`FödPr›îty
(
Node
, "«me", 
TRUE
);

1115 
Ty≥
->
«me
 = 
	`my_°rdup
(
Pr›
);

1116 
	`ezxml_£t_©å
(
Node
, "«me", 
NULL
);

1119 
Ty≥
->
ˇ∑côy
 = 1;

1122 
Ty≥
->
height
 = 1;

1123 
Pr›
 = 
	`FödPr›îty
(
Node
, "height", 
FALSE
);

1124 if(
Pr›
)

1126 
Ty≥
->
height
 = 
	`my_©oi
(
Pr›
);

1127 
	`ezxml_£t_©å
(
Node
, "height", 
NULL
);

1129 
	}
}

1136 
	$Pro˚ssLayout
(
INOUT
 
ezxml_t
 
Node
,

1137 
OUT
 
s_¨ch
 *
¨ch
)

1139 c⁄° *
Pr›
;

1141 
¨ch
->
˛b_grid
.
IsAuto
 = 
TRUE
;

1144 
Pr›
 = 
	`FödPr›îty
(
Node
, "width", 
FALSE
);

1145 if(
Pr›
 !
NULL
)

1147 
¨ch
->
˛b_grid
.
IsAuto
 = 
FALSE
;

1148 
¨ch
->
˛b_grid
.
W
 = 
	`my_©oi
(
Pr›
);

1149 
	`ezxml_£t_©å
(
Node
, "width", 
NULL
);

1150 
Pr›
 = 
	`FödPr›îty
(
Node
, "height", 
TRUE
);

1151 if(
Pr›
 !
NULL
)

1153 
¨ch
->
˛b_grid
.
H
 = 
	`my_©oi
(
Pr›
);

1154 
	`ezxml_£t_©å
(
Node
, "height", 
NULL
);

1159 
Pr›
 = 
	`FödPr›îty
(
Node
, "auto", 
¨ch
->
˛b_grid
.
IsAuto
);

1160 if(
Pr›
 !
NULL
)

1162 if(
¨ch
->
˛b_grid
.
IsAuto
 =
FALSE
)

1164 
	`¥ötf
(
ERRTAG


1167 
¨ch
->
˛b_grid
.
A•e˘
 = 
	`©of
(
Pr›
);

1168 
	`ezxml_£t_©å
(
Node
, "auto", 
NULL
);

1170 
	}
}

1177 
	$Pro˚ssDevi˚
(
INOUT
 
ezxml_t
 
Node
,

1178 
OUT
 
s_¨ch
 *
¨ch
,

1179 
IN
 
boﬁón
 
timög_íabÀd
)

1181 c⁄° *
Pr›
;

1183 
ezxml_t
 
Cur
;

1184 
Cur
 = 
	`FödEÀmít
(
Node
, "sizög", 
TRUE
);

1185 
¨ch
->
R_möW_nmos
 = 0;

1186 
Pr›
 = 
	`FödPr›îty
(
Cur
, "R_möW_nmos", 
timög_íabÀd
);

1187 if(
Pr›
 !
NULL
)

1189 
¨ch
->
R_möW_nmos
 = 
	`©of
(
Pr›
);

1190 
	`ezxml_£t_©å
(
Cur
, "R_möW_nmos", 
NULL
);

1192 
¨ch
->
R_möW_pmos
 = 0;

1193 
Pr›
 = 
	`FödPr›îty
(
Cur
, "R_möW_pmos", 
timög_íabÀd
);

1194 if(
Pr›
 !
NULL
)

1196 
¨ch
->
R_möW_pmos
 = 
	`©of
(
Pr›
);

1197 
	`ezxml_£t_©å
(
Cur
, "R_möW_pmos", 
NULL
);

1199 
¨ch
->
ùö_mux_å™s_size
 = 0;

1200 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ùö_mux_å™s_size", 
FALSE
);

1201 if(
Pr›
 !
NULL
)

1203 
¨ch
->
ùö_mux_å™s_size
 = 
	`©of
(
Pr›
);

1204 
	`ezxml_£t_©å
(
Cur
, "ùö_mux_å™s_size", 
NULL
);

1206 
	`FªeNode
(
Cur
);

1207 
Cur
 = 
	`FödEÀmít
(
Node
, "timög", 
timög_íabÀd
);

1208 if(
Cur
 !
NULL
)

1210 
¨ch
->
C_ùö_cblock
 = 0;

1211 
Pr›
 = 
	`FödPr›îty
(
Cur
, "C_ùö_cblock", 
FALSE
);

1212 if(
Pr›
 !
NULL
)

1214 
¨ch
->
C_ùö_cblock
 = 
	`©of
(
Pr›
);

1215 
	`ezxml_£t_©å
(
Cur
, "C_ùö_cblock", 
NULL
);

1217 
¨ch
->
T_ùö_cblock
 = 0;

1218 
Pr›
 = 
	`FödPr›îty
(
Cur
, "T_ùö_cblock", 
FALSE
);

1219 if(
Pr›
 !
NULL
)

1221 
¨ch
->
T_ùö_cblock
 = 
	`©of
(
Pr›
);

1222 
	`ezxml_£t_©å
(
Cur
, "T_ùö_cblock", 
NULL
);

1224 
	`FªeNode
(
Cur
);

1226 
Cur
 = 
	`FödEÀmít
(
Node
, "¨ó", 
TRUE
);

1227 
Pr›
 = 
	`FödPr›îty
(
Cur
, "grid_logic_tûe_¨ó", 
FALSE
);

1228 
¨ch
->
grid_logic_tûe_¨ó
 = 0;

1229 if(
Pr›
 !
NULL
)

1231 
¨ch
->
grid_logic_tûe_¨ó
 = 
	`©of
(
Pr›
);

1232 
	`ezxml_£t_©å
(
Cur
, "grid_logic_tûe_¨ó", 
NULL
);

1234 
	`FªeNode
(
Cur
);

1235 
Cur
 = 
	`FödEÀmít
(
Node
, "ch™_width_di°r", 
FALSE
);

1236 if(
Cur
 !
NULL
)

1238 
	`Pro˚ssCh™WidthDi°r
(
Cur
, 
¨ch
);

1239 
	`FªeNode
(
Cur
);

1241 
Cur
 = 
	`FödEÀmít
(
Node
, "swôch_block", 
TRUE
);

1242 
Pr›
 = 
	`FödPr›îty
(
Cur
, "ty≥", 
TRUE
);

1243 if(
	`°rcmp
(
Pr›
, "wilton") == 0)

1245 
¨ch
->
SBTy≥
 = 
WILTON
;

1247 if(
	`°rcmp
(
Pr›
, "universal") == 0)

1249 
¨ch
->
SBTy≥
 = 
UNIVERSAL
;

1251 if(
	`°rcmp
(
Pr›
, "subset") == 0)

1253 
¨ch
->
SBTy≥
 = 
SUBSET
;

1257 
	`¥ötf
(
ERRTAG
 "UnknownÖroperty %s for switch blockÅype x\n",

1258 
Pr›
);

1259 
	`exô
(1);

1261 
	`ezxml_£t_©å
(
Cur
, "ty≥", 
NULL
);

1262 
Pr›
 = 
	`FödPr›îty
(
Cur
, "fs", 
TRUE
);

1263 
¨ch
->
Fs
 = 
	`my_©oi
(
Pr›
);

1264 
	`ezxml_£t_©å
(
Cur
, "fs", 
NULL
);

1265 
	`FªeNode
(
Cur
);

1266 
	}
}

1273 
	$Pro˚ssCh™WidthDi°r
(
INOUT
 
ezxml_t
 
Node
,

1274 
OUT
 
s_¨ch
 *
¨ch
)

1276 c⁄° *
Pr›
;

1278 
ezxml_t
 
Cur
;

1279 
Cur
 = 
	`FödEÀmít
(
Node
, "io", 
TRUE
);

1280 
Pr›
 = 
	`FödPr›îty
(
Cur
, "width", 
TRUE
);

1281 
¨ch
->
Ch™s
.
ch™_width_io
 = 
	`©of
(
Pr›
);

1282 
	`ezxml_£t_©å
(
Cur
, "width", 
NULL
);

1283 
	`FªeNode
(
Cur
);

1284 
Cur
 = 
	`FödEÀmít
(
Node
, "x", 
TRUE
);

1285 
	`Pro˚ssCh™WidthDi°rDú
(
Cur
, &
¨ch
->
Ch™s
.
ch™_x_di°
);

1286 
	`FªeNode
(
Cur
);

1287 
Cur
 = 
	`FödEÀmít
(
Node
, "y", 
TRUE
);

1288 
	`Pro˚ssCh™WidthDi°rDú
(
Cur
, &
¨ch
->
Ch™s
.
ch™_y_di°
);

1289 
	`FªeNode
(
Cur
);

1290 
	}
}

1296 
	$Pro˚ssCh™WidthDi°rDú
(
INOUT
 
ezxml_t
 
Node
,

1297 
OUT
 
t_ch™
 * 
ch™
)

1299 c⁄° *
Pr›
;

1301 
boﬁón
 
hasX≥ak
, 
hasWidth
, 
hasDc
;

1302 
hasX≥ak
 = 
hasWidth
 = 
hasDc
 = 
FALSE
;

1303 
Pr›
 = 
	`FödPr›îty
(
Node
, "di°r", 
TRUE
);

1304 if(
	`°rcmp
(
Pr›
, "uniform") == 0)

1306 
ch™
->
ty≥
 = 
UNIFORM
;

1308 if(
	`°rcmp
(
Pr›
, "gaussian") == 0)

1310 
ch™
->
ty≥
 = 
GAUSSIAN
;

1311 
hasX≥ak
 = 
hasWidth
 = 
hasDc
 = 
TRUE
;

1313 if(
	`°rcmp
(
Pr›
, "pulse") == 0)

1315 
ch™
->
ty≥
 = 
PULSE
;

1316 
hasX≥ak
 = 
hasWidth
 = 
hasDc
 = 
TRUE
;

1318 if(
	`°rcmp
(
Pr›
, "delta") == 0)

1320 
hasX≥ak
 = 
hasDc
 = 
TRUE
;

1321 
ch™
->
ty≥
 = 
DELTA
;

1325 
	`¥ötf
(
ERRTAG
 "UnknownÖroperty %s for chan_width_distr x\n",

1326 
Pr›
);

1327 
	`exô
(1);

1329 
	`ezxml_£t_©å
(
Node
, "di°r", 
NULL
);

1330 
Pr›
 = 
	`FödPr›îty
(
Node
, "≥ak", 
TRUE
);

1331 
ch™
->
≥ak
 = 
	`©of
(
Pr›
);

1332 
	`ezxml_£t_©å
(
Node
, "≥ak", 
NULL
);

1333 
Pr›
 = 
	`FödPr›îty
(
Node
, "width", 
hasWidth
);

1334 if(
hasWidth
)

1336 
ch™
->
width
 = 
	`©of
(
Pr›
);

1337 
	`ezxml_£t_©å
(
Node
, "width", 
NULL
);

1339 
Pr›
 = 
	`FödPr›îty
(
Node
, "x≥ak", 
hasX≥ak
);

1340 if(
hasX≥ak
)

1342 
ch™
->
x≥ak
 = 
	`©of
(
Pr›
);

1343 
	`ezxml_£t_©å
(
Node
, "x≥ak", 
NULL
);

1345 
Pr›
 = 
	`FödPr›îty
(
Node
, "dc", 
hasDc
);

1346 if(
hasDc
)

1348 
ch™
->
dc
 = 
	`©of
(
Pr›
);

1349 
	`ezxml_£t_©å
(
Node
, "dc", 
NULL
);

1351 
	}
}

1353 
	$SëupEm±yTy≥
()

1355 
t_ty≥_des¸ùt‹
 * 
ty≥
;

1356 
ty≥
 = &
ty≥_des¸ùt‹s
[
EMPTY_TYPE
->
ödex
];

1357 
ty≥
->
«me
 = "<EMPTY>";

1358 
ty≥
->
num_pös
 = 0;

1359 
ty≥
->
height
 = 1;

1360 
ty≥
->
ˇ∑côy
 = 0;

1361 
ty≥
->
num_drivîs
 = 0;

1362 
ty≥
->
num_ª˚ivîs
 = 0;

1363 
ty≥
->
pöloc
 = 
NULL
;

1364 
ty≥
->
num_˛ass
 = 0;

1365 
ty≥
->
˛ass_öf
 = 
NULL
;

1366 
ty≥
->
pö_˛ass
 = 
NULL
;

1367 
ty≥
->
is_globÆ_pö
 = 
NULL
;

1368 
ty≥
->
is_Fc_‰ac
 = 
TRUE
;

1369 
ty≥
->
is_Fc_out_fuŒ_Êex
 = 
FALSE
;

1370 
ty≥
->
Fc_ö
 = 0;

1371 
ty≥
->
Fc_out
 = 0;

1372 
ty≥
->
max_subblocks
 = 0;

1373 
ty≥
->
max_subblock_öputs
 = 0;

1374 
ty≥
->
max_subblock_ouçuts
 = 0;

1377 
ty≥
->
grid_loc_def
 = 
NULL
;

1378 
ty≥
->
num_grid_loc_def
 = 0;

1379 
	}
}

1386 
	$Pro˚ssIO
(
INOUT
 
ezxml_t
 
Node
,

1387 
IN
 
boﬁón
 
timög_íabÀd
)

1389 c⁄° *
Pr›
;

1391 
ezxml_t
 
Cur
, 
Cur2
;

1392 
i
, 
j
;

1394 
t_ty≥_des¸ùt‹
 * 
ty≥
;

1395 
num_öputs
, 
num_ouçuts
, 
num_˛ocks
, 
num_pös
, 
ˇ∑côy
, 
t_ö
, 
t_out
;

1397 { 
INCLASS
 = 0, 
OUTCLASS
 = 1, 
CLKCLASS
 = 2 };

1399 
ty≥
 = &
ty≥_des¸ùt‹s
[
IO_TYPE
->
ödex
];

1400 
num_öputs
 = 1;

1401 
num_ouçuts
 = 1;

1402 
num_˛ocks
 = 1;

1403 
	`CheckEÀmít
(
Node
, "io");

1404 
ty≥
->
«me
 = ".io";

1405 
ty≥
->
height
 = 1;

1408 
Pr›
 = 
	`FödPr›îty
(
Node
, "ˇ∑côy", 
TRUE
);

1409 
ˇ∑côy
 = 
	`my_©oi
(
Pr›
);

1410 
ty≥
->
ˇ∑côy
 = capacity;

1411 
	`ezxml_£t_©å
(
Node
, "ˇ∑côy", 
NULL
);

1414 
Cur
 = 
	`FödEÀmít
(
Node
, "fc_ö", 
TRUE
);

1415 
Cur2
 = 
	`FödEÀmít
(
Node
, "fc_out", 
TRUE
);

1416 
	`Pro˚ss_Fc
(
Cur
, 
Cur2
, 
ty≥
);

1417 
	`FªeNode
(
Cur
);

1418 
	`FªeNode
(
Cur2
);

1421 
num_pös
 = 3 * 
ˇ∑côy
;

1422 
ty≥
->
num_pös
 =Çum_pins;

1423 
ty≥
->
num_drivîs
 = 
num_ouçuts
 * 
ˇ∑côy
;

1424 
ty≥
->
num_ª˚ivîs
 = 
num_öputs
 * 
ˇ∑côy
;

1425 
ty≥
->
pöloc
 =

1426 (***)
	`Æloc_m©rix3
(0, 0, 0, 3, 0, 
num_pös
 - 1, ());

1431 
i
 = 0; i < 
num_pös
; ++i)

1433 
j
 = 0; j < 4; ++j)

1435 
ty≥
->
pöloc
[0][
j
][
i
] = 1;

1440 
ty≥
->
num_˛ass
 = 3 * 
ˇ∑côy
;

1441 
ty≥
->
˛ass_öf
 =

1442 (
s_˛ass
 *)
	`my_mÆloc
((s_˛assË* 3 * 
ˇ∑côy
);

1443 
ty≥
->
pö_˛ass
 = (*)
	`my_mÆloc
((Ë* 
num_pös
);

1444 
ty≥
->
is_globÆ_pö
 = (
boﬁón
 *Ë
	`my_mÆloc
((boﬁónË* 
num_pös
);

1445 
j
 = 0; j < 
ˇ∑côy
; ++j)

1449 
ty≥
->
˛ass_öf
[3 * 
j
 + 
INCLASS
].
num_pös
 = 
num_öputs
;

1450 
ty≥
->
˛ass_öf
[3 * 
j
 + 
INCLASS
].ty≥ = 
RECEIVER
;

1451 
ty≥
->
˛ass_öf
[3 * 
j
 + 
INCLASS
].
pöli°
 =

1452 (*)
	`my_mÆloc
((Ë* 
num_öputs
);

1453 
i
 = 0; i < 
num_öputs
; ++i)

1455 
ty≥
->
˛ass_öf
[3 * 
j
 + 
INCLASS
].
pöli°
[
i
] =

1456 
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
;

1457 
ty≥
->
pö_˛ass
[
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
] =

1458 3 * 
j
 + 
INCLASS
;

1459 
ty≥
->
is_globÆ_pö
[
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
] = 
FALSE
;

1461 
ty≥
->
˛ass_öf
[3 * 
j
 + 
OUTCLASS
].
num_pös
 = 
num_ouçuts
;

1462 
ty≥
->
˛ass_öf
[3 * 
j
 + 
OUTCLASS
].ty≥ = 
DRIVER
;

1463 
ty≥
->
˛ass_öf
[3 * 
j
 + 
OUTCLASS
].
pöli°
 =

1464 (*)
	`my_mÆloc
((Ë* 
num_ouçuts
);

1465 
i
 = 0; i < 
num_ouçuts
; ++i)

1467 
ty≥
->
˛ass_öf
[3 * 
j
 + 
OUTCLASS
].
pöli°
[
i
] =

1468 
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
 + 
num_öputs
;

1469 
ty≥
->
pö_˛ass
[
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
 +

1470 
num_öputs
] = 3 * 
j
 + 
OUTCLASS
;

1471 
ty≥
->
is_globÆ_pö
[
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
 +

1472 
num_öputs
] = 
FALSE
;

1474 
ty≥
->
˛ass_öf
[3 * 
j
 + 
CLKCLASS
].
num_pös
 = 
num_˛ocks
;

1475 
ty≥
->
˛ass_öf
[3 * 
j
 + 
CLKCLASS
].ty≥ = 
RECEIVER
;

1476 
ty≥
->
˛ass_öf
[3 * 
j
 + 
CLKCLASS
].
pöli°
 =

1477 (*)
	`my_mÆloc
((Ë* 
num_˛ocks
);

1478 
i
 = 0; i < 
num_˛ocks
; ++i)

1480 
ty≥
->
˛ass_öf
[3 * 
j
 + 
CLKCLASS
].
pöli°
[
i
] =

1481 
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
 + 
num_öputs
 +

1482 
num_ouçuts
;

1483 
ty≥
->
pö_˛ass
[
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
 +

1484 
num_öputs
 + 
num_ouçuts
] =

1485 3 * 
j
 + 
CLKCLASS
;

1486 
ty≥
->
is_globÆ_pö
[
num_pös
 * 
j
 / 
ˇ∑côy
 + 
i
 +

1487 
num_öputs
 + 
num_ouçuts
] = 
TRUE
;

1490 
ty≥
->
max_subblocks
 = 1;

1491 
ty≥
->
max_subblock_öputs
 = 1;

1492 
ty≥
->
max_subblock_ouçuts
 = 1;

1495 
ty≥
->
num_grid_loc_def
 = 1;

1496 
ty≥
->
grid_loc_def
 =

1497 (
s_grid_loc_def
 *)
	`my_ˇŒoc
(1, (s_grid_loc_def));

1498 
ty≥
->
grid_loc_def
[0].
grid_loc_ty≥
 = 
BOUNDARY
;

1499 
ty≥
->
grid_loc_def
[0].
¥i‹ôy
 = 0;

1500 
t_ö
 = -1;

1501 
t_out
 = -1;

1502 
Pr›
 = 
	`FödPr›îty
(
Node
, "t_ö∑d", 
timög_íabÀd
);

1503 if(
Pr›
 !
NULL
)

1505 
t_ö
 = 
	`©of
(
Pr›
);

1506 
	`ezxml_£t_©å
(
Node
, "t_ö∑d", 
NULL
);

1508 
Pr›
 = 
	`FödPr›îty
(
Node
, "t_ouçad", 
timög_íabÀd
);

1509 if(
Pr›
 !
NULL
)

1511 
t_out
 = 
	`©of
(
Pr›
);

1512 
	`ezxml_£t_©å
(
Node
, "t_ouçad", 
NULL
);

1514 if(
timög_íabÀd
)

1516 
ty≥
->
ty≥_timög_öf
.
T_fb_ùö_to_sblk_ùö
 = 0;

1517 
ty≥
->
ty≥_timög_öf
.
T_sblk_›ö_to_fb_›ö
 = 0;

1518 
ty≥
->
ty≥_timög_öf
.
T_sblk_›ö_to_sblk_ùö
 = 0;

1519 
ty≥
->
ty≥_timög_öf
.
T_subblock
 =

1520 (
t_T_subblock
 *Ë
	`my_mÆloc
((t_T_subblock));

1521 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_comb
 =

1522 (**)
	`my_mÆloc
((*));

1523 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_comb
[0] =

1524 (*)
	`my_mÆloc
(());

1525 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_comb
[0][0] = 
t_out
;

1526 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_£q_ö
 =

1527 (*)
	`my_mÆloc
(());

1528 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_£q_ö
[0] = 0;

1529 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_£q_out
 =

1530 (*)
	`my_mÆloc
(());

1531 
ty≥
->
ty≥_timög_öf
.
T_subblock
[0].
T_£q_out
[0] = 
t_ö
;

1533 
	}
}

1540 
	$Pro˚ssTy≥s
(
INOUT
 
ezxml_t
 
Node
,

1541 
OUT
 
t_ty≥_des¸ùt‹
 ** 
Ty≥s
,

1542 
OUT
 *
NumTy≥s
,

1543 
boﬁón
 
timög_íabÀd
)

1545 
ezxml_t
 
CurTy≥
, 
Pªv
;

1546 
ezxml_t
 
Cur
, 
Cur2
;

1547 
t_ty≥_des¸ùt‹
 * 
Ty≥
;

1548 
i
;

1555 *
NumTy≥s
 = 
	`Cou¡Chûdªn
(
Node
, "type") + 2;

1556 *
Ty≥s
 = (
t_ty≥_des¸ùt‹
 *)

1557 
	`my_mÆloc
((
t_ty≥_des¸ùt‹
Ë* (*
NumTy≥s
));

1558 
EMPTY_TYPE
 = &
ty≥_des¸ùt‹s
[
EMPTY_TYPE_INDEX
];

1559 
IO_TYPE
 = &
ty≥_des¸ùt‹s
[
IO_TYPE_INDEX
];

1560 
ty≥_des¸ùt‹s
[
EMPTY_TYPE_INDEX
].
ödex
 = EMPTY_TYPE_INDEX;

1561 
ty≥_des¸ùt‹s
[
IO_TYPE_INDEX
].
ödex
 = IO_TYPE_INDEX;

1562 
	`SëupEm±yTy≥
();

1563 
Cur
 = 
	`FödEÀmít
(
Node
, "io", 
TRUE
);

1564 
	`Pro˚ssIO
(
Cur
, 
timög_íabÀd
);

1565 
	`FªeNode
(
Cur
);

1568 
i
 = 2;

1569 
CurTy≥
 = 
Node
->
chûd
;

1570 
CurTy≥
)

1572 
	`CheckEÀmít
(
CurTy≥
, "type");

1575 
Ty≥
 = &(*
Ty≥s
)[
i
];

1578 
	`Pro˚ssTy≥Pr›s
(
CurTy≥
, 
Ty≥
);

1581 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "subblocks", 
TRUE
);

1582 
	`Pro˚ssSubblocks
(
Cur
, 
Ty≥
, 
timög_íabÀd
);

1583 
	`FªeNode
(
Cur
);

1586 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "fc_ö", 
TRUE
);

1587 
Cur2
 = 
	`FödEÀmít
(
CurTy≥
, "fc_out", 
TRUE
);

1588 
	`Pro˚ss_Fc
(
Cur
, 
Cur2
, 
Ty≥
);

1589 
	`FªeNode
(
Cur
);

1590 
	`FªeNode
(
Cur2
);

1593 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "pö˛as£s", 
TRUE
);

1594 
	`SëupPöCœs£s
(
Cur
, 
Ty≥
);

1595 
	`FªeNode
(
Cur
);

1596 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "pöloˇti⁄s", 
TRUE
);

1597 
	`SëupPöLoˇti⁄s
(
Cur
, 
Ty≥
);

1598 
	`FªeNode
(
Cur
);

1599 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "gridloˇti⁄s", 
TRUE
);

1600 
	`SëupGridLoˇti⁄s
(
Cur
, 
Ty≥
);

1601 
	`FªeNode
(
Cur
);

1602 
Cur
 = 
	`FödEÀmít
(
CurTy≥
, "timög", 
timög_íabÀd
);

1603 if(
Cur
)

1605 
	`SëupTy≥Timög
(
Cur
, 
Ty≥
);

1606 
	`FªeNode
(
Cur
);

1608 
Ty≥
->
ödex
 = 
i
;

1611 ++
i
;

1614 
Pªv
 = 
CurTy≥
;

1615 
CurTy≥
 = CurTy≥->
√xt
;

1616 
	`FªeNode
(
Pªv
);

1618 if(
FILL_TYPE
 =
NULL
)

1620 
	`¥ötf
(
ERRTAG
 "gridÜocationÅype 'fill' must be specified.\n");

1621 
	`exô
(1);

1623 
	}
}

1629 
	$XmlRódArch
(
IN
 c⁄° *
ArchFûe
,

1630 
IN
 
boﬁón
 
timög_íabÀd
,

1631 
OUT
 
s_¨ch
 *
¨ch
,

1632 
OUT
 
t_ty≥_des¸ùt‹
 ** 
Ty≥s
,

1633 
OUT
 *
NumTy≥s
)

1635 
ezxml_t
 
Cur
, 
Next
;

1638 
Cur
 = 
	`ezxml_∑r£_fûe
(
ArchFûe
);

1639 if(
NULL
 =
Cur
)

1641 
	`¥ötf
(
ERRTAG
 "UnableÅoÜoadárchitecture file '%s'.\n",

1642 
ArchFûe
);

1646 
	`CheckEÀmít
(
Cur
, "architecture");

1649 
Next
 = 
	`FödEÀmít
(
Cur
, "œyout", 
TRUE
);

1650 
	`Pro˚ssLayout
(
Next
, 
¨ch
);

1651 
	`FªeNode
(
Next
);

1654 
Next
 = 
	`FödEÀmít
(
Cur
, "devi˚", 
TRUE
);

1655 
	`Pro˚ssDevi˚
(
Next
, 
¨ch
, 
timög_íabÀd
);

1656 
	`FªeNode
(
Next
);

1659 
Next
 = 
	`FödEÀmít
(
Cur
, "ty≥li°", 
TRUE
);

1660 
	`Pro˚ssTy≥s
(
Next
, 
Ty≥s
, 
NumTy≥s
, 
timög_íabÀd
);

1661 
	`FªeNode
(
Next
);

1664 
Next
 = 
	`FödEÀmít
(
Cur
, "swôchli°", 
TRUE
);

1665 
	`Pro˚ssSwôches
(
Next
, &(
¨ch
->
Swôches
), &◊rch->
num_swôches
),

1666 
timög_íabÀd
);

1667 
	`FªeNode
(
Next
);

1670 
Next
 = 
	`FödEÀmít
(
Cur
, "£gmíéi°", 
TRUE
);

1671 
	`Pro˚ssSegmíts
(
Next
, &(
¨ch
->
Segmíts
), &◊rch->
num_£gmíts
),

1672 
¨ch
->
Swôches
,árch->
num_swôches
, 
timög_íabÀd
);

1673 
	`FªeNode
(
Next
);

1676 
	`FªeNode
(
Cur
);

1677 
	}
}

1679 
	$Pro˚ssSegmíts
(
INOUT
 
ezxml_t
 
P¨ít
,

1680 
OUT
 
s_£gmít_öf
 **
Segs
,

1681 
OUT
 *
NumSegs
,

1682 
IN
 
s_swôch_öf
 *
Swôches
,

1683 
IN
 
NumSwôches
,

1684 
IN
 
boﬁón
 
timög_íabÀd
)

1686 
i
, 
j
, 
Àngth
;

1687 c⁄° *
tmp
;

1689 
ezxml_t
 
SubEÀm
;

1690 
ezxml_t
 
Node
;

1694 *
NumSegs
 = 
	`Cou¡Chûdªn
(
P¨ít
, "segment");

1697 *
Segs
 = 
NULL
;

1698 if(*
NumSegs
 > 0)

1700 *
Segs
 =

1701 (
s_£gmít_öf
 *)
	`my_mÆloc
(*
NumSegs
 *

1703 
s_£gmít_öf
));

1704 
	`mem£t
(*
Segs
, 0, (*
NumSegs
 * (
s_£gmít_öf
)));

1708 
i
 = 0; i < *
NumSegs
; ++i)

1710 
Node
 = 
	`ezxml_chûd
(
P¨ít
, "segment");

1713 
Àngth
 = 1;

1714 
tmp
 = 
	`FödPr›îty
(
Node
, "Àngth", 
FALSE
);

1715 if(
tmp
)

1717 if(
	`°rcmp
(
tmp
, "longline") == 0)

1719 (*
Segs
)[
i
].
l⁄glöe
 = 
TRUE
;

1723 
Àngth
 = 
	`my_©oi
(
tmp
);

1726 (*
Segs
)[
i
].
Àngth
 =Üength;

1727 
	`ezxml_£t_©å
(
Node
, "Àngth", 
NULL
);

1730 (*
Segs
)[
i
].
‰equícy
 = 1;

1731 
tmp
 = 
	`FödPr›îty
(
Node
, "‰eq", 
FALSE
);

1732 if(
tmp
)

1734 (*
Segs
)[
i
].
‰equícy
 = (Ë(
	`©of
(
tmp
Ë* 
MAX_CHANNEL_WIDTH
);

1736 
	`ezxml_£t_©å
(
Node
, "‰eq", 
NULL
);

1739 (*
Segs
)[
i
].
RmëÆ
 = 0;

1740 
tmp
 = 
	`FödPr›îty
(
Node
, "RmëÆ", 
timög_íabÀd
);

1741 if(
tmp
)

1743 (*
Segs
)[
i
].
RmëÆ
 = 
	`©of
(
tmp
);

1745 
	`ezxml_£t_©å
(
Node
, "RmëÆ", 
NULL
);

1746 (*
Segs
)[
i
].
CmëÆ
 = 0;

1747 
tmp
 = 
	`FödPr›îty
(
Node
, "CmëÆ", 
timög_íabÀd
);

1748 if(
tmp
)

1750 (*
Segs
)[
i
].
CmëÆ
 = 
	`©of
(
tmp
);

1752 
	`ezxml_£t_©å
(
Node
, "CmëÆ", 
NULL
);

1755 
tmp
 = 
	`FödPr›îty
(
Node
, "ty≥", 
TRUE
);

1756 if(0 =
	`°rcmp
(
tmp
, "bidir"))

1758 (*
Segs
)[
i
].
dúe˘i⁄Æôy
 = 
BI_DIRECTIONAL
;

1761 if(0 =
	`°rcmp
(
tmp
, "unidir"))

1763 (*
Segs
)[
i
].
dúe˘i⁄Æôy
 = 
UNI_DIRECTIONAL
;

1768 
	`¥ötf
(
ERRTAG
 "InvÆid swôchÅy≥ '%s'.\n", 
tmp
);

1769 
	`exô
(1);

1771 
	`ezxml_£t_©å
(
Node
, "ty≥", 
NULL
);

1774 if(
UNI_DIRECTIONAL
 =(*
Segs
)[
i
].
dúe˘i⁄Æôy
)

1776 
SubEÀm
 = 
	`FödEÀmít
(
Node
, "mux", 
TRUE
);

1777 
tmp
 = 
	`FödPr›îty
(
SubEÀm
, "«me", 
TRUE
);

1780 
j
 = 0; j < 
NumSwôches
; ++j)

1782 if(0 =
	`°rcmp
(
tmp
, 
Swôches
[
j
].
«me
))

1787 if(
j
 >
NumSwôches
)

1789 
	`¥ötf
(
ERRTAG
 "'%s' isÇotá valid muxÇame.\n",

1790 
tmp
);

1791 
	`exô
(1);

1793 
	`ezxml_£t_©å
(
SubEÀm
, "«me", 
NULL
);

1794 
	`FªeNode
(
SubEÀm
);

1799 (*
Segs
)[
i
].
wúe_swôch
 = 
j
;

1800 (*
Segs
)[
i
].
›ö_swôch
 = 
j
;

1805 
	`as£π
(
BI_DIRECTIONAL
 =(*
Segs
)[
i
].
dúe˘i⁄Æôy
);

1806 
SubEÀm
 = 
	`FödEÀmít
(
Node
, "wúe_swôch", 
TRUE
);

1807 
tmp
 = 
	`FödPr›îty
(
SubEÀm
, "«me", 
TRUE
);

1810 
j
 = 0; j < 
NumSwôches
; ++j)

1812 if(0 =
	`°rcmp
(
tmp
, 
Swôches
[
j
].
«me
))

1817 if(
j
 >
NumSwôches
)

1819 
	`¥ötf
(
ERRTAG


1821 
tmp
);

1822 
	`exô
(1);

1824 (*
Segs
)[
i
].
wúe_swôch
 = 
j
;

1825 
	`ezxml_£t_©å
(
SubEÀm
, "«me", 
NULL
);

1826 
	`FªeNode
(
SubEÀm
);

1827 
SubEÀm
 = 
	`FödEÀmít
(
Node
, "›ö_swôch", 
TRUE
);

1828 
tmp
 = 
	`FödPr›îty
(
SubEÀm
, "«me", 
TRUE
);

1831 
j
 = 0; j < 
NumSwôches
; ++j)

1833 if(0 =
	`°rcmp
(
tmp
, 
Swôches
[
j
].
«me
))

1838 if(
j
 >
NumSwôches
)

1840 
	`¥ötf
(
ERRTAG


1842 
tmp
);

1843 
	`exô
(1);

1845 (*
Segs
)[
i
].
›ö_swôch
 = 
j
;

1846 
	`ezxml_£t_©å
(
SubEÀm
, "«me", 
NULL
);

1847 
	`FªeNode
(
SubEÀm
);

1851 (*
Segs
)[
i
].
cb_Àn
 = 
Àngth
;

1852 (*
Segs
)[
i
].
cb
 = (
boﬁón
 *Ë
	`my_mÆloc
(
Àngth
 * (boolean));

1853 
j
 = 0; j < 
Àngth
; ++j)

1855 (*
Segs
)[
i
].
cb
[
j
] = 
TRUE
;

1857 
SubEÀm
 = 
	`FödEÀmít
(
Node
, "cb", 
FALSE
);

1858 if(
SubEÀm
)

1860 
	`Pro˚ssCB_SB
(
SubEÀm
, (*
Segs
)[
i
].
cb
, 
Àngth
);

1861 
	`FªeNode
(
SubEÀm
);

1865 (*
Segs
)[
i
].
sb_Àn
 = (
Àngth
 + 1);

1866 (*
Segs
)[
i
].
sb
 =

1867 (
boﬁón
 *Ë
	`my_mÆloc
((
Àngth
 + 1) * (boolean));

1868 
j
 = 0; j < (
Àngth
 + 1); ++j)

1870 (*
Segs
)[
i
].
sb
[
j
] = 
TRUE
;

1872 
SubEÀm
 = 
	`FödEÀmít
(
Node
, "sb", 
FALSE
);

1873 if(
SubEÀm
)

1875 
	`Pro˚ssCB_SB
(
SubEÀm
, (*
Segs
)[
i
].
sb
, (
Àngth
 + 1));

1876 
	`FªeNode
(
SubEÀm
);

1878 
	`FªeNode
(
Node
);

1880 
	}
}

1882 
	$Pro˚ssCB_SB
(
INOUT
 
ezxml_t
 
Node
,

1883 
INOUT
 
boﬁón
 * 
li°
,

1884 
IN
 
Àn
)

1886 c⁄° *
tmp
 = 
NULL
;

1887 
i
;

1892 
tmp
 = 
	`FödPr›îty
(
Node
, "ty≥", 
TRUE
);

1893 if(0 =
	`°rcmp
(
tmp
, "pattern"))

1895 
i
 = 0;

1898 
tmp
 = 
Node
->
txt
;

1899 *
tmp
)

1901 *
tmp
)

1907 if(
i
 >
Àn
)

1909 
	`¥ötf
(
ERRTAG


1914 
	`exô
(1);

1916 
li°
[
i
] = 
TRUE
;

1917 ++
i
;

1921 if(
i
 >
Àn
)

1923 
	`¥ötf
(
ERRTAG


1928 
	`exô
(1);

1930 
li°
[
i
] = 
FALSE
;

1931 ++
i
;

1934 
	`¥ötf
(
ERRTAG
 "Invalid character %c in CB or "

1935 "SB dï›uœti⁄Üi°.\n", *
tmp
);

1936 
	`exô
(1);

1938 ++
tmp
;

1940 if(
i
 < 
Àn
)

1942 
	`¥ötf
(
ERRTAG
 "CB or SB depopulation isÅoo short. It "

1945 
	`exô
(1);

1949 
	`ezxml_£t_txt
(
Node
, "");

1954 
	`¥ötf
(
ERRTAG
 "'%s' isÇotá validÅype for specifying "

1955 "cbánd sb dï›uœti⁄.\n", 
tmp
);

1956 
	`exô
(1);

1958 
	`ezxml_£t_©å
(
Node
, "ty≥", 
NULL
);

1959 
	}
}

1961 
	$Pro˚ssSwôches
(
INOUT
 
ezxml_t
 
P¨ít
,

1962 
OUT
 
s_swôch_öf
 **
Swôches
,

1963 
OUT
 *
NumSwôches
,

1964 
IN
 
boﬁón
 
timög_íabÀd
)

1966 
i
, 
j
;

1967 c⁄° *
ty≥_«me
;

1968 c⁄° *
swôch_«me
;

1969 c⁄° *
Pr›
;

1971 
boﬁón
 
has_buf_size
;

1972 
ezxml_t
 
Node
;

1973 
has_buf_size
 = 
FALSE
;

1976 *
NumSwôches
 = 
	`Cou¡Chûdªn
(
P¨ít
, "switch");

1979 *
Swôches
 = 
NULL
;

1980 if(*
NumSwôches
 > 0)

1982 *
Swôches
 =

1983 (
s_swôch_öf
 *)
	`my_mÆloc
(*
NumSwôches
 *

1985 
s_swôch_öf
));

1986 
	`mem£t
(*
Swôches
, 0,

1987 (*
NumSwôches
 * (
s_swôch_öf
)));

1991 
i
 = 0; i < *
NumSwôches
; ++i)

1993 
Node
 = 
	`ezxml_chûd
(
P¨ít
, "switch");

1994 
swôch_«me
 = 
	`FödPr›îty
(
Node
, "«me", 
TRUE
);

1995 
ty≥_«me
 = 
	`FödPr›îty
(
Node
, "ty≥", 
TRUE
);

1998 
j
 = 0; j < 
i
; ++j)

2000 if(0 =
	`°rcmp
((*
Swôches
)[
j
].
«me
, 
swôch_«me
))

2002 
	`¥ötf
(
ERRTAG


2004 "found.\n", 
swôch_«me
);

2005 
	`exô
(1);

2008 (*
Swôches
)[
i
].
«me
 = 
	`my_°rdup
(
swôch_«me
);

2009 
	`ezxml_£t_©å
(
Node
, "«me", 
NULL
);

2012 if(0 =
	`°rcmp
(
ty≥_«me
, "mux"))

2014 (*
Swôches
)[
i
].
buf„ªd
 = 
TRUE
;

2015 
has_buf_size
 = 
TRUE
;

2018 if(0 =
	`°rcmp
(
ty≥_«me
, "pass_trans"))

2020 (*
Swôches
)[
i
].
buf„ªd
 = 
FALSE
;

2023 if(0 =
	`°rcmp
(
ty≥_«me
, "buffer"))

2025 (*
Swôches
)[
i
].
buf„ªd
 = 
TRUE
;

2030 
	`¥ötf
(
ERRTAG
 "InvÆid swôchÅy≥ '%s'.\n", 
ty≥_«me
);

2031 
	`exô
(1);

2033 
	`ezxml_£t_©å
(
Node
, "ty≥", 
NULL
);

2034 
Pr›
 = 
	`FödPr›îty
(
Node
, "R", 
timög_íabÀd
);

2035 if(
Pr›
 !
NULL
)

2037 (*
Swôches
)[
i
].
R
 = 
	`©of
(
Pr›
);

2038 
	`ezxml_£t_©å
(
Node
, "R", 
NULL
);

2040 
Pr›
 = 
	`FödPr›îty
(
Node
, "Cö", 
timög_íabÀd
);

2041 if(
Pr›
 !
NULL
)

2043 (*
Swôches
)[
i
].
Cö
 = 
	`©of
(
Pr›
);

2044 
	`ezxml_£t_©å
(
Node
, "Cö", 
NULL
);

2046 
Pr›
 = 
	`FödPr›îty
(
Node
, "Cout", 
timög_íabÀd
);

2047 if(
Pr›
 !
NULL
)

2049 (*
Swôches
)[
i
].
Cout
 = 
	`©of
(
Pr›
);

2050 
	`ezxml_£t_©å
(
Node
, "Cout", 
NULL
);

2052 
Pr›
 = 
	`FödPr›îty
(
Node
, "Tdñ", 
timög_íabÀd
);

2053 if(
Pr›
 !
NULL
)

2055 (*
Swôches
)[
i
].
Tdñ
 = 
	`©of
(
Pr›
);

2056 
	`ezxml_£t_©å
(
Node
, "Tdñ", 
NULL
);

2058 
Pr›
 = 
	`FödPr›îty
(
Node
, "buf_size", 
has_buf_size
);

2059 if(
has_buf_size
)

2061 (*
Swôches
)[
i
].
buf_size
 = 
	`©of
(
Pr›
);

2062 
	`ezxml_£t_©å
(
Node
, "buf_size", 
NULL
);

2064 
Pr›
 = 
	`FödPr›îty
(
Node
, "mux_å™s_size", 
FALSE
);

2065 if(
Pr›
 !
NULL
)

2067 (*
Swôches
)[
i
].
mux_å™s_size
 = 
	`©of
(
Pr›
);

2068 
	`ezxml_£t_©å
(
Node
, "mux_å™s_size", 
NULL
);

2072 
	`FªeNode
(
Node
);

2074 
	}
}

2080 
	$EchoArch
(
IN
 c⁄° *
EchoFûe
,

2081 
IN
 c⁄° 
t_ty≥_des¸ùt‹
 * 
Ty≥s
,

2082 
IN
 
NumTy≥s
)

2084 
i
, 
j
, 
k
;

2086 
FILE
 * 
Echo
;

2087 
Echo
 = 
	`my_f›í
(
EchoFûe
, "w");

2088 
i
 = 0; i < 
NumTy≥s
; ++i)

2090 
	`Ârötf
(
Echo
, "Ty≥: \"%s\"\n", 
Ty≥s
[
i
].
«me
);

2091 
	`Ârötf
(
Echo
, "\tˇ∑côy: %d\n", 
Ty≥s
[
i
].
ˇ∑côy
);

2092 
	`Ârötf
(
Echo
, "\theight: %d\n", 
Ty≥s
[
i
].
height
);

2093 if(
Ty≥s
[
i
].
num_pös
 > 0)

2095 
j
 = 0; j < 
Ty≥s
[
i
].
height
; ++j)

2097 
	`Ârötf
(
Echo
,

2099 
j
);

2100 
k
 = 0; k < 
Ty≥s
[
i
].
num_pös
; ++k)

2102 
	`Ârötf
(
Echo
, "\t\t%d %d %d %d\n",

2103 
Ty≥s
[
i
].
pöloc
[
j
][
TOP
][
k
],

2104 
Ty≥s
[
i
].
pöloc
[
j
][
LEFT
][
k
],

2105 
Ty≥s
[
i
].
pöloc
[
j
][
BOTTOM
][
k
],

2106 
Ty≥s
[
i
].
pöloc
[
j
][
RIGHT
][
k
]);

2110 
	`Ârötf
(
Echo
, "\tnum_pins (scaled for capacity): %d\n",

2111 
Ty≥s
[
i
].
num_pös
);

2112 if(
Ty≥s
[
i
].
num_pös
 > 0)

2114 
	`Ârötf
(
Echo
, "\tPins: NAME CLASS IS_GLOBAL\n");

2115 
j
 = 0; j < 
Ty≥s
[
i
].
num_pös
; ++j)

2117 
	`Ârötf
(
Echo
, "\t\t%d %d %s\n", 
j
,

2118 
Ty≥s
[
i
].
pö_˛ass
[
j
],

2119 (
Ty≥s
[
i
].

2120 
is_globÆ_pö
[
j
] ? "TRUE" : "FALSE"));

2123 
	`Ârötf
(
Echo
, "\äum_˛ass: %d\n", 
Ty≥s
[
i
].
num_˛ass
);

2124 if(
Ty≥s
[
i
].
num_˛ass
 > 0)

2126 
j
 = 0; j < 
Ty≥s
[
i
].
num_˛ass
; ++j)

2128 
Ty≥s
[
i
].
˛ass_öf
[
j
].
ty≥
)

2130 
RECEIVER
:

2131 
	`Ârötf
(
Echo
, "\t\tType: RECEIVER\n");

2133 
DRIVER
:

2134 
	`Ârötf
(
Echo
, "\t\tType: DRIVER\n");

2136 
OPEN
:

2137 
	`Ârötf
(
Echo
, "\t\tType: OPEN\n");

2140 
	`Ârötf
(
Echo
, "\t\tType: UNKNOWN\n");

2143 
	`Ârötf
(
Echo
, "\t\t\tnum_pins: %d\n",

2144 
Ty≥s
[
i
].
˛ass_öf
[
j
].
num_pös
);

2145 
	`Ârötf
(
Echo
, "\t\t\tpins: ");

2146 
k
 = 0; k < 
Ty≥s
[
i
].
˛ass_öf
[
j
].
num_pös
;

2147 ++
k
)

2149 
	`Ârötf
(
Echo
, "%d ", 
Ty≥s
[
i
].
˛ass_öf
[
j
].
pöli°
[
k
]);

2151 
	`Ârötf
(
Echo
, "\n");

2154 
	`Ârötf
(
Echo
, "\tis_Fc_frac: %s\n",

2155 (
Ty≥s
[
i
].
is_Fc_‰ac
 ? "TRUE" : "FALSE"));

2156 
	`Ârötf
(
Echo
, "\tis_Fc_out_full_flex: %s\n",

2157 (
Ty≥s
[
i
].
is_Fc_out_fuŒ_Êex
 ? "TRUE" : "FALSE"));

2158 
	`Ârötf
(
Echo
, "\tFc_ö: %f\n", 
Ty≥s
[
i
].
Fc_ö
);

2159 
	`Ârötf
(
Echo
, "\tFc_out: %f\n", 
Ty≥s
[
i
].
Fc_out
);

2160 
	`Ârötf
(
Echo
, "\tmax_subblocks: %d\n", 
Ty≥s
[
i
].
max_subblocks
);

2161 
	`Ârötf
(
Echo
, "\tmax_subblock_inputs: %d\n",

2162 
Ty≥s
[
i
].
max_subblock_öputs
);

2163 
	`Ârötf
(
Echo
, "\tmax_subblock_outputs: %d\n",

2164 
Ty≥s
[
i
].
max_subblock_ouçuts
);

2165 
	`Ârötf
(
Echo
, "\äum_drivîs: %d\n", 
Ty≥s
[
i
].
num_drivîs
);

2166 
	`Ârötf
(
Echo
, "\äum_ª˚ivîs: %d\n", 
Ty≥s
[
i
].
num_ª˚ivîs
);

2167 
	`Ârötf
(
Echo
, "\tödex: %d\n", 
Ty≥s
[
i
].
ödex
);

2168 
	`Ârötf
(
Echo
, "\n");

2170 
	`f˛o£
(
Echo
);

2171 
	}
}

	@xml_arch.h

2 
	ss_˛b_grid


4 
boﬁón
 
	mIsAuto
;

5 
	mA•e˘
;

6 
	mW
;

7 
	mH
;

9 
s_¨ch
 
	tt_¨ch
;

10 
	ss_¨ch


12 
t_ch™_width_di°
 
	mCh™s
;

13 
	mN
;

14 
	mK
;

15 
e_swôch_block_ty≥
 
	mSBTy≥
;

16 
	mR_möW_nmos
;

17 
	mR_möW_pmos
;

18 
	mFs
;

19 
	mC_ùö_cblock
;

20 
	mT_ùö_cblock
;

21 
	mgrid_logic_tûe_¨ó
;

22 
	mùö_mux_å™s_size
;

23 
s_˛b_grid
 
	m˛b_grid
;

24 
t_£gmít_öf
 * 
	mSegmíts
;

25 
	mnum_£gmíts
;

26 
s_swôch_öf
 *
	mSwôches
;

27 
	mnum_swôches
;

32 
XmlRódArch
(
IN
 c⁄° *
ArchFûe
,

33 
IN
 
boﬁón
 
timög_íabÀd
,

34 
OUT
 
s_¨ch
 *
¨ch
,

35 
OUT
 
t_ty≥_des¸ùt‹
 ** 
Ty≥s
,

36 
OUT
 *
NumTy≥s
);

37 
EchoArch
(
IN
 c⁄° *
EchoFûe
,

38 
IN
 c⁄° 
t_ty≥_des¸ùt‹
 * 
Ty≥s
,

39 
IN
 
NumTy≥s
);

	@
1
.
0
94
1296
CheckArch.c
CheckOptions.c
CheckSetup.c
OptionTokens.c
OptionTokens.h
ReadLine.c
ReadLine.h
ReadOptions.c
ReadOptions.h
SetupVPR.c
SetupVPR.h
ShowSetup.c
check_netlist.c
check_netlist.h
check_route.c
check_route.h
check_rr_graph.c
check_rr_graph.h
draw.c
draw.h
ezxml.c
ezxml.h
globals.h
globals_declare.h
graphics.c
graphics.h
hash.c
hash.h
heapsort.c
heapsort.h
main.c
mst.c
mst.h
net_delay.c
net_delay.h
path_delay.c
path_delay.h
path_delay2.c
path_delay2.h
place.c
place.h
place_and_route.c
place_and_route.h
place_stats.c
place_stats.h
print_netlist.c
print_netlist.h
read_netlist.c
read_netlist.h
read_place.c
read_place.h
route_breadth_first.c
route_breadth_first.h
route_common.c
route_common.h
route_directed_search.c
route_directed_search.h
route_export.h
route_timing.c
route_timing.h
route_tree_timing.c
route_tree_timing.h
rr_graph.c
rr_graph.h
rr_graph2.c
rr_graph2.h
rr_graph_area.c
rr_graph_area.h
rr_graph_indexed_data.c
rr_graph_indexed_data.h
rr_graph_sbox.c
rr_graph_sbox.h
rr_graph_timing_params.c
rr_graph_timing_params.h
rr_graph_util.c
rr_graph_util.h
segment_stats.c
segment_stats.h
stats.c
stats.h
temp.c
test_h.c
testing.c
timing_place.c
timing_place.h
timing_place_lookup.c
timing_place_lookup.h
util.c
util.h
vpr_types.h
vpr_utils.c
vpr_utils.h
xml_arch.c
xml_arch.h
